<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="天空の城">
<meta property="og:url" content="http://www.njiang.cn/page/6/index.html">
<meta property="og:site_name" content="天空の城">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天空の城">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.njiang.cn/page/6/"/>





  <title> 天空の城 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-43682645-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">天空の城</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">愤怒的程序员，梦想着有一天也能飞！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/09/03/auto-ptrde-shi-xian-c-plus-plus/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/03/auto-ptrde-shi-xian-c-plus-plus/" itemprop="url">
                  auto_ptr的实现及CTCI
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-09-03T21:47:49+08:00">
              2014-09-03
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/09/03/auto-ptrde-shi-xian-c-plus-plus/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/09/03/auto-ptrde-shi-xian-c-plus-plus/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>代码是参考auto_ptr的真实实现，其实大部分都一样，只是自己实现了一遍。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div><div class="line"><span class="keyword">class</span> <span class="keyword">auto_ptr_t</span> &#123;</div><div class="line"><span class="keyword">private</span>:</div><div class="line">    T* __ptr;</div><div class="line">    </div><div class="line"><span class="keyword">public</span>:</div><div class="line"></div><div class="line">	<span class="comment">/*</span></div><div class="line">	* Use a T pointer to init the auto_ptr</div><div class="line">	*/</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">explicit</span> <span class="title">auto_ptr_t</span><span class="params">(T* <span class="keyword">__t</span> = <span class="number">0</span>)</span> </span>&#123;__ptr = <span class="keyword">__t</span>;&#125;</div><div class="line">    <span class="keyword">inline</span> ~<span class="keyword">auto_ptr_t</span>() &#123;<span class="keyword">delete</span> __ptr;&#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> T* <span class="title">release</span><span class="params">()</span> </span>&#123; T* __tmp = __ptr; __ptr = <span class="literal">NULL</span>; <span class="keyword">return</span> __tmp; &#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">reset</span><span class="params">(T* <span class="keyword">__t</span>)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (__ptr != <span class="keyword">__t</span>)</div><div class="line">            <span class="keyword">delete</span> __ptr;</div><div class="line">        __ptr = <span class="keyword">__t</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">inline</span> <span class="keyword">auto_ptr_t</span>&amp; <span class="keyword">operator</span>=(<span class="keyword">auto_ptr_t</span>&amp; <span class="keyword">__t</span>)</div><div class="line">    &#123;</div><div class="line">        reset(<span class="keyword">__t</span>.release());</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> __up&gt; <span class="keyword">inline</span> <span class="keyword">auto_ptr_t</span>&amp; <span class="keyword">operator</span>=(<span class="keyword">auto_ptr_t</span>&lt;__up&gt;&amp; __p)</div><div class="line">    &#123;</div><div class="line">        reset(__p.release());</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">inline</span> <span class="keyword">auto_ptr_t</span>&amp; <span class="keyword">operator</span>=(auto_ptr_ref&lt;T&gt; __p)</div><div class="line">    &#123;</div><div class="line">        reset(__p.release());</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">inline</span> T* <span class="keyword">operator</span>-&gt;() &#123; <span class="keyword">return</span> __ptr; &#125;</div><div class="line">    <span class="keyword">inline</span> T&amp; <span class="keyword">operator</span>*() &#123;<span class="keyword">return</span> *__ptr;&#125;</div><div class="line">    <span class="function"><span class="keyword">inline</span> T* <span class="title">get</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> __ptr;&#125;</div><div class="line">    </div><div class="line">    <span class="keyword">template</span>&lt;<span class="keyword">class</span> __up&gt; <span class="keyword">inline</span> <span class="keyword">operator</span> <span class="keyword">auto_ptr_t</span>&lt;__up&gt;()</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">auto_ptr_t</span>&lt;__up&gt;(release());</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/09/02/c-plus-plus-zhi-neng-zhi-zhen-xiang-jie/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/02/c-plus-plus-zhi-neng-zhi-zhen-xiang-jie/" itemprop="url">
                  C++智能指针详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-09-02T11:38:11+08:00">
              2014-09-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/09/02/c-plus-plus-zhi-neng-zhi-zhen-xiang-jie/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/09/02/c-plus-plus-zhi-neng-zhi-zhen-xiang-jie/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##一、简介<br>由于 C++ 语言没有自动内存回收机制，程序员每次 new 出来的内存都要手动 delete。程序员忘记 delete，流程太复杂，最终导致没有 delete，异常导致程序过早退出，没有执行 delete 的情况并不罕见。<br>用智能指针便可以有效缓解这类问题，本文主要讲解参见的智能指针的用法。包括：<code>std::auto_ptr</code>、<code>boost::scoped_ptr</code>、<code>boost::shared_ptr</code>、<code>boost::scoped_array</code>、<code>boost::shared_array</code>、<code>boost::weak_ptr</code>、<code>boost:: intrusive_ptr</code>。你可能会想，如此多的智能指针就为了解决new、delete匹配问题，真的有必要吗？看完这篇文章后，我想你心里自然会有答案。下面就按照顺序讲解如上 7 种智能指针（smart_ptr）。</p>
<p>##二、具体使用</p>
<p>###1、总括<br>对于编译器来说，智能指针实际上是一个栈对象，并非指针类型，在栈对象生命期即将结束时，智能指针通过析构函数释放有它管理的堆内存。所有智能指针都重载了“operator-&gt;”操作符，直接返回对象的引用，用以操作对象。访问智能指针原来的方法则使用“.”操作符。<br>访问智能指针包含的裸指针则可以用 get() 函数。由于智能指针是一个对象，所以<code>if (my_smart_object)</code>永远为真，要判断智能指针的裸指针是否为空，需要这样判断：<code>if (my_smart_object.get())</code>。<br>智能指针包含了 <code>reset()</code> 方法，如果不传递参数（或者传递 NULL），则智能指针会释放当前管理的内存。如果传递一个对象，则智能指针会释放当前对象，来管理新传入的对象。<br>我们编写一个测试类来辅助分析：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Simple &#123;</div><div class="line"> <span class="keyword">public</span>:</div><div class="line">  Simple(<span class="keyword">int</span> param = <span class="number">0</span>) &#123;</div><div class="line">    number = param;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Simple: "</span> &lt;&lt; number &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>; </div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  ~Simple() &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"~Simple: "</span> &lt;&lt; number &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  <span class="function"><span class="keyword">void</span> <span class="title">PrintSomething</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"PrintSomething: "</span> &lt;&lt; info_extend.c_str() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  <span class="built_in">std</span>::<span class="built_in">string</span> info_extend;</div><div class="line">  <span class="keyword">int</span> number;</div><div class="line">&#125;;</div><div class="line">``` </div><div class="line"></div><div class="line">###<span class="number">2</span>、<span class="built_in">std</span>::<span class="built_in">auto_ptr</span></div><div class="line">`<span class="built_in">std</span>::<span class="built_in">auto_ptr</span>` 属于 STL，当然在 <span class="keyword">namespace</span> <span class="built_in">std</span> 中，包含头文件 <span class="string">"#include&lt;memory&gt;"</span>便可以使用。<span class="built_in">std</span>::<span class="built_in">auto_ptr</span> 能够方便的管理单个堆内存对象。</div><div class="line">我们从代码开始分析：</div><div class="line"></div><div class="line">```<span class="function">cpp</span></div><div class="line"><span class="keyword">void</span> <span class="title">TestAutoPtr</span><span class="params">()</span> </div><div class="line">&#123;</div><div class="line"><span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));   <span class="comment">// 创建对象，输出：Simple：1</span></div><div class="line"><span class="keyword">if</span> (my_memory.get()) &#123;                            <span class="comment">// 判断智能指针是否为空</span></div><div class="line">my_memory-&gt;PrintSomething();                    <span class="comment">// 使用 operator-&gt; 调用智能指针对象中的函数</span></div><div class="line">my_memory.get()-&gt;info_extend = <span class="string">"Addition"</span>;      <span class="comment">// 使用 get() 返回裸指针，然后给内部对象赋值</span></div><div class="line">my_memory-&gt;PrintSomething();                    <span class="comment">// 再次打印，表明上述赋值成功</span></div><div class="line"></div><div class="line">(*my_memory).info_extend += <span class="string">" other"</span>;			<span class="comment">// 使用 operator* 返回智能指针内部对象，然后用"."调用智能指针对象中的函数</span></div><div class="line"></div><div class="line">my_memory-&gt;PrintSomething();                    <span class="comment">// 再次打印，表明上述赋值成功</span></div><div class="line">&#125;</div><div class="line">&#125;                                              <span class="comment">// my_memory 栈对象即将结束生命期，析构堆对象 Simple(1)</span></div></pre></td></tr></table></figure>
<p>执行结果为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Simple: <span class="number">1</span></div><div class="line">PrintSomething:</div><div class="line">PrintSomething: Addition</div><div class="line">PrintSomething: Addition other</div><div class="line"></div><div class="line">~Simple: <span class="number">1</span></div></pre></td></tr></table></figure>
<p>上述为正常使用 <code>std::auto_ptr</code>的代码，一切似乎都良好，无论如何不用我们显示使用该死的 delete 了。</p>
<p>其实好景不长，我们看看如下的另一个例子：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestAutoPtr2</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line">  <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory2;   <span class="comment">// 创建一个新的 my_memory2 对象</span></div><div class="line">    my_memory2 = my_memory;             <span class="comment">// 复制旧的 my_memory 给 my_memory2</span></div><div class="line">    my_memory2-&gt;PrintSomething();       <span class="comment">// 输出信息，复制成功 </span></div><div class="line">  	my_memory-&gt;PrintSomething();        <span class="comment">// 崩溃</span></div><div class="line">  	</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>最终如上代码导致崩溃，如上代码时绝对符合 C++ 编程思想的，居然崩溃了，跟进 std::auto_ptr 的源码后，我们看到，罪魁祸首是<code>my_memory2 = my_memory</code>，这行代码，my_memory2 完全夺取了 my_memory 的内存管理所有权，导致 my_memory 悬空，最后使用时导致崩溃。<br>所以，使用 <code>std::auto_ptr</code> 时，绝对不能使用“operator=”操作符。作为一个库，不允许用户使用，确没有明确拒绝[1]，多少会觉得有点出乎预料。</p>
<p>看完 <code>std::auto_ptr</code> 好景不长的第一个例子后，让我们再来看一个：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestAutoPtr3</span><span class="params">()</span> </span>&#123;</div><div class="line"> <span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line"> </div><div class="line"> <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    my_memory.release();</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行结果为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Simple: <span class="number">1</span></div></pre></td></tr></table></figure>
<p>看到什么异常了吗？我们创建出来的对象没有被析构，没有输出“~Simple: 1”，导致内存泄露。当我们不想让 my_memory 继续生存下去，我们调用 release() 函数释放内存，结果却导致内存泄露（在内存受限系统中，如果my_memory占用太多内存，我们会考虑在使用完成后，立刻归还，而不是等到 my_memory 结束生命期后才归还）。正确的代码应该为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestAutoPtr3</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line">  <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    Simple* temp_memory = my_memory.release();</div><div class="line">    <span class="keyword">delete</span> temp_memory;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestAutoPtr3</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line">  <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    my_memory.reset();  <span class="comment">// 释放 my_memory 内部管理的内存</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>原来<code>std::auto_ptr</code>的 release() 函数只是让出内存所有权，这显然也不符合 C++ 编程思想。<br>总结：<code>std::auto_ptr</code>可用来管理单个对象的对内存，但是，请注意如下几点：<br>（1）    尽量不要使用“operator=”。如果使用了，请不要再使用先前对象。<br>（2）    记住 release() 函数不会释放对象，仅仅归还所有权。<br>（3）    std::auto_ptr 最好不要当成参数传递（读者可以自行写代码确定为什么不能）。<br>（4）    由于<code>std::auto_ptr</code>的“operator=”问题，有其管理的对象不能放入<code>std::vector</code>等容器中。<br>（5）    ……<br>使用一个<code>std::auto_ptr</code>的限制还真多，还不能用来管理堆内存数组，这应该是你目前在想的事情吧，我也觉得限制挺多的，哪天一个不小心，就导致问题了。<br>由于<code>std::auto_ptr</code>引发了诸多问题，一些设计并不是非常符合 C++ 编程思想，所以引发了下面 boost 的智能指针，boost 智能指针可以解决如上问题。<br>让我们继续向下看。</p>
<p>###3、boost::scoped_ptr<br><code>boost::scoped_ptr</code>属于 boost 库，定义在<code>namespace boost</code>中，包含头文件<code>#include&lt;boost/smart_ptr.hpp&gt;</code>便可以使用。<code>boost::scoped_ptr</code>跟<code>std::auto_ptr</code>一样，可以方便的管理单个堆内存对象，特别的是，boost::scoped_ptr 独享所有权，避免了 <code>std::auto_ptr</code>恼人的几个问题。<br>我们还是从代码开始分析：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestScopedPtr</span><span class="params">()</span> </span>&#123;</div><div class="line">  boost::scoped_ptr&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line">  <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    my_memory-&gt;PrintSomething();</div><div class="line">    my_memory.get()-&gt;info_extend = <span class="string">"Addition"</span>;</div><div class="line">    my_memory-&gt;PrintSomething();</div><div class="line">    (*my_memory).info_extend += <span class="string">" other"</span>;</div><div class="line">    my_memory-&gt;PrintSomething();</div><div class="line">   </div><div class="line">   	my_memory.release();           <span class="comment">// 编译 error: scoped_ptr 没有 release 函数</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">auto_ptr</span>&lt;Simple&gt; my_memory2;</div><div class="line">    my_memory2 = my_memory;        <span class="comment">// 编译 error: scoped_ptr 没有重载 operator=，不会导致所有权转移</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>首先，我们可以看到，<code>boost::scoped_ptr</code>也可以像<code>auto_ptr</code>一样正常使用。但其没有<code>release()</code>函数，不会导致先前的内存泄露问题。其次，由于<code>boost::scoped_ptr</code>是独享所有权的，所以明确拒绝用户写“my_memory2 = my_memory”之类的语句，可以缓解<code>std::auto_ptr</code>几个恼人的问题。</p>
<p>由于<code>boost::scoped_ptr</code>独享所有权，当我们真真需要复制智能指针时，需求便满足不了了，如此我们再引入一个智能指针，专门用于处理复制，参数传递的情况，这便是如下的<code>boost::shared_ptr</code>。</p>
<p>###4、boost::shared_ptr<br><code>boost::shared_ptr</code>属于 boost 库，定义在 namespace boost 中，包含头文件<code>#include&lt;boost/smart_ptr.hpp&gt;</code>便可以使用。在上面我们看到<code>boost::scoped_ptr</code>独享所有权，不允许赋值、拷贝，<code>boost::shared_ptr</code>是专门用于共享所有权的，由于要共享所有权，其在内部使用了引用计数。boost::shared_ptr 也是用于管理单个堆内存对象的。<br>我们还是从代码开始分析：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestSharedPtr</span><span class="params">(boost::<span class="built_in">shared_ptr</span>&lt;Simple&gt; memory)</span> </span>&#123;  <span class="comment">// 注意：无需使用 reference (或 const reference)</span></div><div class="line">  memory-&gt;PrintSomething();</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestSharedPtr UseCount: "</span> &lt;&lt; memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestSharedPtr2</span><span class="params">()</span> </span>&#123;</div><div class="line">  boost::<span class="built_in">shared_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line">  <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    my_memory-&gt;PrintSomething();</div><div class="line">    my_memory.get()-&gt;info_extend = <span class="string">"Addition"</span>;</div><div class="line">    my_memory-&gt;PrintSomething();</div><div class="line">    (*my_memory).info_extend += <span class="string">" other"</span>;</div><div class="line">    my_memory-&gt;PrintSomething();</div><div class="line">  &#125;</div><div class="line"> </div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestSharedPtr2 UseCount: "</span> &lt;&lt; my_memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  TestSharedPtr(my_memory);</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestSharedPtr2 UseCount: "</span> &lt;&lt; my_memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line"> </div><div class="line">  <span class="comment">//my_memory.release();// 编译 error: 同样，shared_ptr 也没有 release 函数</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行结果为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Simple: <span class="number">1</span></div><div class="line">PrintSomething:</div><div class="line">PrintSomething: Addition</div><div class="line">PrintSomething: Addition other</div><div class="line">TestSharedPtr2 UseCount: <span class="number">1</span></div><div class="line">PrintSomething: Addition other</div><div class="line">TestSharedPtr UseCount: <span class="number">2</span></div><div class="line">TestSharedPtr2 UseCount: <span class="number">1</span></div><div class="line"></div><div class="line">~Simple: <span class="number">1</span></div></pre></td></tr></table></figure>
<p><code>boost::shared_ptr</code>也可以很方便的使用。并且没有<code>release()</code>函数。关键的一点，boost::shared_ptr 内部维护了一个引用计数，由此可以支持复制、参数传递等。boost::shared_ptr 提供了一个函数 use_count() ，此函数返回 boost::shared_ptr 内部的引用计数。查看执行结果，我们可以看到在 TestSharedPtr2 函数中，引用计数为 1，传递参数后（此处进行了一次复制），在函数TestSharedPtr 内部，引用计数为2，在 TestSharedPtr 返回后，引用计数又降低为 1。当我们需要使用一个共享对象的时候，boost::shared_ptr 是再好不过的了。<br>在此，我们已经看完单个对象的智能指针管理，关于智能指针管理数组，我们接下来讲到。</p>
<p>###5、boost::scoped_array<br><code>boost::scoped_array</code> 属于 boost 库，定义在<code>namespace boost</code>中，包含头文件 #include<boost smart_ptr.hpp=""> 便可以使用。<br>    boost::scoped_array 便是用于管理动态数组的。跟 boost::scoped_ptr 一样，也是独享所有权的。<br>我们还是从代码开始分析：</boost></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestScopedArray</span><span class="params">()</span> </span>&#123;</div><div class="line">   boost::scoped_array&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple[<span class="number">2</span>]); <span class="comment">// 使用内存数组来初始化</span></div><div class="line">   <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">     my_memory[<span class="number">0</span>].PrintSomething();</div><div class="line">     my_memory.get()[<span class="number">0</span>].info_extend = <span class="string">"Addition"</span>;</div><div class="line">     my_memory[<span class="number">0</span>].PrintSomething();</div><div class="line">     </div><div class="line">  	(*my_memory)[<span class="number">0</span>].info_extend += <span class="string">" other"</span>;            <span class="comment">// 编译 error，scoped_ptr 没有重载 operator*</span></div><div class="line">     my_memory[<span class="number">0</span>].release();                             <span class="comment">// 同上，没有 release 函数</span></div><div class="line">     boost::scoped_array&lt;Simple&gt; my_memory2;</div><div class="line">     my_memory2 = my_memory;                             <span class="comment">// 编译 error，同上，没有重载 operator=</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>boost::scoped_array 的使用跟 boost::scoped_ptr 差不多，不支持复制，并且初始化的时候需要使用动态数组。另外，boost::scoped_array 没有重载“operator*”，其实这并无大碍，一般情况下，我们使用 get() 函数更明确些。</p>
<p>下面肯定应该讲 boost::shared_array 了，一个用引用计数解决复制、参数传递的智能指针类。</p>
<p>###6、boost::shared_array<br>boost::shared_array 属于 boost 库，定义在 namespace boost 中，包含头文件 #include<boost smart_ptr.hpp=""> 便可以使用。</boost></p>
<p>由于 boost::scoped_array 独享所有权，显然在很多情况下（参数传递、对象赋值等）不满足需求，由此我们引入 boost::shared_array。跟 boost::shared_ptr 一样，内部使用了引用计数。<br>我们还是从代码开始分析:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestSharedArray</span><span class="params">(boost::shared_array&lt;Simple&gt; memory)</span> </span>&#123;  <span class="comment">// 注意：无需使用 reference (或 const reference)</span></div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestSharedArray UseCount: "</span> &lt;&lt; memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestSharedArray2</span><span class="params">()</span> </span>&#123;</div><div class="line">  boost::shared_array&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple[<span class="number">2</span>]);</div><div class="line">  <span class="keyword">if</span> (my_memory.get()) &#123;</div><div class="line">    my_memory[<span class="number">0</span>].PrintSomething();</div><div class="line">    my_memory.get()[<span class="number">0</span>].info_extend = <span class="string">"Addition 00"</span>;</div><div class="line">    my_memory[<span class="number">0</span>].PrintSomething();</div><div class="line">    my_memory[<span class="number">1</span>].PrintSomething();</div><div class="line">    my_memory.get()[<span class="number">1</span>].info_extend = <span class="string">"Addition 11"</span>;</div><div class="line">    my_memory[<span class="number">1</span>].PrintSomething();</div><div class="line">    <span class="comment">//(*my_memory)[0].info_extend += " other";  // 编译 error，scoped_ptr 没有重载 operator*</span></div><div class="line">  &#125;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestSharedArray2 UseCount: "</span> &lt;&lt; my_memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  TestSharedArray(my_memory);</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestSharedArray2 UseCount: "</span> &lt;&lt; my_memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行结果为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Simple: <span class="number">0</span></div><div class="line">Simple: <span class="number">0</span></div><div class="line">PrintSomething:</div><div class="line">PrintSomething: Addition <span class="number">00</span></div><div class="line">PrintSomething:</div><div class="line">PrintSomething: Addition <span class="number">11</span></div><div class="line">TestSharedArray2 UseCount: <span class="number">1</span></div><div class="line">TestSharedArray UseCount: <span class="number">2</span></div><div class="line">TestSharedArray2 UseCount: <span class="number">1</span></div><div class="line"></div><div class="line">~Simple: <span class="number">0</span></div><div class="line">~Simple: <span class="number">0</span></div></pre></td></tr></table></figure>
<p>跟<code>boost::shared_ptr</code>一样，使用了引用计数，可以复制，通过参数来传递。</p>
<p>至此，我们讲过的智能指针有<code>std::auto_ptr</code>、<code>boost::scoped_ptr</code>、<code>boost::shared_ptr</code>、<code>boost::scoped_array</code>、<code>boost::shared_array</code>。这几个智能指针已经基本够我们使用了，90% 的使用过标准智能指针的代码就这 5 种。可如下还有两种智能指针，它们肯定有用，但有什么用处呢，一起看看吧。</p>
<p>###7、boost::weak_ptr<br>boost::weak_ptr 属于 boost 库，定义在 namespace boost 中，包含头文件 #include<boost smart_ptr.hpp=""> 便可以使用。<br>在讲 boost::weak_ptr 之前，让我们先回顾一下前面讲解的内容。似乎 boost::scoped_ptr、boost::shared_ptr 这两个智能指针就可以解决所有单个对象内存的管理了，这儿还多出一个 boost::weak_ptr，是否还有某些情况我们没纳入考虑呢？<br>回答：有。首先 boost::weak_ptr 是专门为 boost::shared_ptr 而准备的。有时候，我们只关心能否使用对象，并不关心内部的引用计数。boost::weak_ptr 是 boost::shared_ptr 的观察者（Observer）对象，观察者意味着 boost::weak_ptr 只对 boost::shared_ptr 进行引用，而不改变其引用计数，当被观察的 boost::shared_ptr 失效后，相应的 boost::weak_ptr 也相应失效。<br>我们还是从代码开始分析：</boost></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">TestWeakPtr</span><span class="params">()</span> </span>&#123;</div><div class="line">  boost::weak_ptr&lt;Simple&gt; my_memory_weak;</div><div class="line">  boost::<span class="built_in">shared_ptr</span>&lt;Simple&gt; my_memory(<span class="keyword">new</span> Simple(<span class="number">1</span>));</div><div class="line"></div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestWeakPtr boost::shared_ptr UseCount: "</span> &lt;&lt; my_memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">  my_memory_weak = my_memory;</div><div class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"TestWeakPtr boost::shared_ptr UseCount: "</span> &lt;&lt; my_memory.use_count() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>执行结果为：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Simple: <span class="number">1</span></div><div class="line">TestWeakPtr boost::<span class="built_in">shared_ptr</span> UseCount: <span class="number">1</span></div><div class="line">TestWeakPtr boost::<span class="built_in">shared_ptr</span> UseCount: <span class="number">1</span></div><div class="line"></div><div class="line">~Simple: <span class="number">1</span></div></pre></td></tr></table></figure>
<p>我们看到，尽管被赋值了，内部的引用计数并没有什么变化，当然，读者也可以试试传递参数等其他情况。<br>现在要说的问题是，<code>boost::weak_ptr</code>到底有什么作用呢？从上面那个例子看来，似乎没有任何作用，其实<code>boost::weak_ptr</code>主要用在软件架构设计中，可以在基类（此处的基类并非抽象基类，而是指继承于抽象基类的虚基类）中定义一个<code>boost::weak_ptr</code>，用于指向子类的 boost::shared_ptr，这样基类仅仅观察自己的 boost::weak_ptr 是否为空就知道子类有没对自己赋值了，而不用影响子类 boost::shared_ptr 的引用计数，用以降低复杂度，更好的管理对象。</p>
<p>###8、boost::intrusive_ptr<br><code>boost::intrusive_ptr</code>属于 boost 库，定义在 namespace boost 中，包含头文件<code>#include&lt;boost/smart_ptr.hpp&gt;</code>便可以使用。<br>讲完如上 6 种智能指针后，对于一般程序来说 C++ 堆内存管理就够用了，现在有多了一种<code>boost::intrusive_ptr</code>，这是一种插入式的智能指针，内部不含有引用计数，需要程序员自己加入引用计数，不然编译不过（⊙﹏⊙b汗）。个人感觉这个智能指针没太大用处，至少我没用过。有兴趣的朋友自己研究一下源代码哦J。</p>
<p>##三、总结<br>如上讲了这么多智能指针，有必要对这些智能指针做个总结：<br>1、在可以使用 boost 库的场合下，拒绝使用 std::auto_ptr，因为其不仅不符合 C++ 编程思想，而且极容易出错[2]。<br>2、在确定对象无需共享的情况下，使用 boost::scoped_ptr（当然动态数组使用 boost::scoped_array）。<br>3、在对象需要共享的情况下，使用 boost::shared_ptr（当然动态数组使用 boost::shared_array）。<br>4、在需要访问 boost::shared_ptr 对象，而又不想改变其引用计数的情况下，使用 boost::weak_ptr，一般常用于软件框架设计中。<br>5、最后一点，也是要求最苛刻一点：在你的代码中，不要出现 delete 关键字（或 C 语言的 free 函数），因为可以用智能指针去管理。</p>
<hr>
<p>[1]参见《effective C++（3rd）》，条款06 。<br>[2]关于 boost 库的使用，可本博客另外一篇文章：《在 Windows 中编译 boost1.42.0》。<br>[3]读者应该看到了，在我所有的名字前，都加了命名空间标识符std::（或boost::），这不是我不想写 using namespace XXX 之类的语句，在大型项目中，有可能会用到 N 个第三方库，如果把命名空间全放出来，命名污染（Naming conflicts）问题很难避免，到时要改回来是极端麻烦的事情。当然，如果你只是写 Demo，可以例外。</p>
<p>转自：<a href="http://blog.csdn.net/xt_xiaotian/article/details/5714477" target="_blank" rel="external">http://blog.csdn.net/xt_xiaotian/article/details/5714477</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/09/01/she-ji-mo-shi-shi-ba-ce-lue-mo-shi-strategy(dui-xiang-xing-wei-xing/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/09/01/she-ji-mo-shi-shi-ba-ce-lue-mo-shi-strategy(dui-xiang-xing-wei-xing/" itemprop="url">
                  设计模式 ( 十八 ) 策略模式Strategy（对象行为型)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-09-01T10:17:27+08:00">
              2014-09-01
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/09/01/she-ji-mo-shi-shi-ba-ce-lue-mo-shi-strategy(dui-xiang-xing-wei-xing/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/09/01/she-ji-mo-shi-shi-ba-ce-lue-mo-shi-strategy(dui-xiang-xing-wei-xing/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>设计模式 ( 十八 ) 策略模式Strategy（对象行为型）</p>
<p>1.概述</p>
<p>在软件开发中也常常遇到类似的情况，实现某一个功能有多种算法或者策略，我们可以根据环境或者条件的不同选择不同的算法或者策略来完成该功能。如查找、排序等，一种常用的方法是硬编码(Hard Coding)在一个类中，如需要提供多种查找算法，可以将这些算法写到一个类中，在该类中提供多个方法，每一个方法对应一个具体的查找算法；当然也可以将这些查找算法封装在一个统一的方法中，通过if…else…或者case等条件判断语句来进行选择。这两种实现方法我们都可以称之为硬编码，如果需要增加一种新的查找算法，需要修改封装算法类的源代码；更换查找算法，也需要修改客户端调用代码。在这个算法类中封装了大量查找算法，该类代码将较复杂，维护较为困难。如果我们将这些策略包含在客户端，这种做法更不可取，将导致客户端程序庞大而且难以维护，如果存在大量可供选择的算法时问题将变得更加严重。</p>
<p>例子1：一个菜单功能能够根据用户的“皮肤”首选项来决定是否采用水平的还是垂直的排列形式。同事可以灵活增加菜单那的显示样式。</p>
<p>例子2：出行旅游：我们可以有几个策略可以考虑：可以骑自行车，汽车，做火车，飞机。每个策略都可以得到相同的结果，但是它们使用了不同的资源。选择策略的依据是费用，时间，使用工具还有每种方式的方便程度 。</p>
<img src="/uploads/2014/09/01/1.png" class="center">
<p>2.问题</p>
<p>如何让算法和对象分开来，使得算法可以独立于使用它的客户而变化？</p>
<p>3.解决方案</p>
<p>策略模式：定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。也称为政策模式(Policy)。（Definea family of algorithms,encapsulate each one, andmake them interchangeable. Strategy lets the algorithmvary independently from clients that use it. ）</p>
<p>策略模式把对象本身和运算规则区分开来，其功能非常强大，因为这个设计模式本身的核心思想就是面向对象编程的多形性的思想。</p>
<p>4.适用性</p>
<p>当存在以下情况时使用Strategy模式<br>1）许多相关的类仅仅是行为有异。 “策略”提供了一种用多个行为中的一个行为来配置一个类的方法。即一个系统需要动态地在几种算法中选择一种。</p>
<p>2）需要使用一个算法的不同变体。例如，你可能会定义一些反映不同的空间 /时间权衡的算法。当这些变体实现为一个算法的类层次时 ,可以使用策略模式。</p>
<p>3）算法使用客户不应该知道的数据。可使用策略模式以避免暴露复杂的、与算法相关的数据结构。</p>
<p>4）一个类定义了多种行为 , 并且这些行为在这个类的操作中以多个条件语句的形式出现。将相关的条件分支移入它们各自的Strategy类中以代替这些条件语句。</p>
<p>5.结构<br><img src="/uploads/2014/09/01/2.jpg" class="center"></p>
<p>6.模式的组成</p>
<p>环境类(Context):用一个ConcreteStrategy对象来配置。维护一个对Strategy对象的引用。可定义一个接口来让Strategy访问它的数据。<br>抽象策略类(Strategy):定义所有支持的算法的公共接口。 Context使用这个接口来调用某ConcreteStrategy定义的算法。<br>具体策略类(ConcreteStrategy):以Strategy接口实现某具体算法。</p>
<p>7.效果</p>
<p>Strategy模式有下面的一些优点：</p>
<p>1) 相关算法系列 Strategy类层次为Context定义了一系列的可供重用的算法或行为。 继承有助于析取出这些算法中的公共功能。</p>
<p>2) 提供了可以替换继承关系的办法： 继承提供了另一种支持多种算法或行为的方法。你可以直接生成一个Context类的子类，从而给它以不同的行为。但这会将行为硬行编制到 Context中，而将算法的实现与Context的实现混合起来,从而使Context难以理解、难以维护和难以扩展，而且还不能动态地改变算法。最后你得到一堆相关的类 , 它们之间的唯一差别是它们所使用的算法或行为。 将算法封装在独立的Strategy类中使得你可以独立于其Context改变它，使它易于切换、易于理解、易于扩展。</p>
<p>3) 消除了一些if else条件语句 ：Strategy模式提供了用条件语句选择所需的行为以外的另一种选择。当不同的行为堆砌在一个类中时 ,很难避免使用条件语句来选择合适的行为。将行为封装在一个个独立的Strategy类中消除了这些条件语句。含有许多条件语句的代码通常意味着需要使用Strategy模式。</p>
<p>4) 实现的选择 Strategy模式可以提供相同行为的不同实现。客户可以根据不同时间 /空间权衡取舍要求从不同策略中进行选择。</p>
<p>Strategy模式缺点:</p>
<p>1)客户端必须知道所有的策略类，并自行决定使用哪一个策略类:  本模式有一个潜在的缺点，就是一个客户要选择一个合适的Strategy就必须知道这些Strategy到底有何不同。此时可能不得不向客户暴露具体的实现问题。因此仅当这些不同行为变体与客户相关的行为时 , 才需要使用Strategy模式。</p>
<p>2 ) Strategy和Context之间的通信开销 ：无论各个ConcreteStrategy实现的算法是简单还是复杂, 它们都共享Strategy定义的接口。因此很可能某些 ConcreteStrategy不会都用到所有通过这个接口传递给它们的信息；简单的 ConcreteStrategy可能不使用其中的任何信息！这就意味着有时Context会创建和初始化一些永远不会用到的参数。如果存在这样问题 , 那么将需要在Strategy和Context之间更进行紧密的耦合。</p>
<p>3 )策略模式将造成产生很多策略类：可以通过使用享元模式在一定程度上减少对象的数量。 增加了对象的数目 Strategy增加了一个应用中的对象的数目。有时你可以将 Strategy实现为可供各Context共享的无状态的对象来减少这一开销。任何其余的状态都由 Context维护。Context在每一次对Strategy对象的请求中都将这个状态传递过去。共享的 Strategy不应在各次调用之间维护状态。</p>
<p>8.实现</p>
<p>1)出行旅游：</p>
<p>uml：<br><img src="/uploads/2014/09/01/3.jpg" class="center"></p>
<p>代码实现：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** </span></div><div class="line">* 策略模式 </div><div class="line">* 定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化 </div><div class="line">* </div><div class="line">*/   </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line">* 出行旅游 </div><div class="line">* </div><div class="line">*  </div><div class="line">*/  </div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">TravelStrategy</span></span>&#123;  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>;  </div><div class="line">&#125;   </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * 具体策略类(ConcreteStrategy)1：乘坐飞机 </div><div class="line"> */  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AirPlanelStrategy</span> <span class="keyword">implements</span> <span class="title">TravelStrategy</span> </span>&#123;  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">echo</span> <span class="string">"travel by AirPlain"</span>, <span class="string">"&lt;BR&gt;\r\n"</span>;   </div><div class="line">    &#125;  </div><div class="line">&#125;   </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * 具体策略类(ConcreteStrategy)2：乘坐火车 </div><div class="line"> */  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrainStrategy</span> <span class="keyword">implements</span> <span class="title">TravelStrategy</span> </span>&#123;  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">echo</span> <span class="string">"travel by Train"</span>, <span class="string">"&lt;BR&gt;\r\n"</span>;   </div><div class="line">    &#125;  </div><div class="line">&#125;   </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line"> * 具体策略类(ConcreteStrategy)3：骑自行车 </div><div class="line"> */  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BicycleStrategy</span> <span class="keyword">implements</span> <span class="title">TravelStrategy</span> </span>&#123;  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travelAlgorithm</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">echo</span> <span class="string">"travel by Bicycle"</span>, <span class="string">"&lt;BR&gt;\r\n"</span>;   </div><div class="line">    &#125;  </div><div class="line">&#125;   </div><div class="line">  </div><div class="line">  </div><div class="line">  </div><div class="line"><span class="comment">/** </span></div><div class="line"> *  </div><div class="line"> * 环境类(Context):用一个ConcreteStrategy对象来配置。维护一个对Strategy对象的引用。可定义一个接口来让Strategy访问它的数据。 </div><div class="line"> * 算法解决类，以提供客户选择使用何种解决方案： </div><div class="line"> */  </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PersonContext</span></span>&#123;  </div><div class="line">    <span class="keyword">private</span> $_strategy = <span class="keyword">null</span>;  </div><div class="line">  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(TravelStrategy $travel)</span></span>&#123;  </div><div class="line">        <span class="keyword">$this</span>-&gt;_strategy = $travel;  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">/** </span></div><div class="line">    * 旅行 </div><div class="line">    */  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setTravelStrategy</span><span class="params">(TravelStrategy $travel)</span></span>&#123;  </div><div class="line">        <span class="keyword">$this</span>-&gt;_strategy = $travel;  </div><div class="line">    &#125;  </div><div class="line">    <span class="comment">/** </span></div><div class="line">    * 旅行 </div><div class="line">    */  </div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">travel</span><span class="params">()</span></span>&#123;  </div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_strategy -&gt;travelAlgorithm();  </div><div class="line">    &#125;  </div><div class="line">&#125;   </div><div class="line">  </div><div class="line"><span class="comment">// 乘坐火车旅行  </span></div><div class="line">$person = <span class="keyword">new</span> PersonContext(<span class="keyword">new</span> TrainStrategy());  </div><div class="line">$person-&gt;travel();  </div><div class="line">  </div><div class="line"><span class="comment">// 改骑自行车  </span></div><div class="line">$person-&gt;setTravelStrategy(<span class="keyword">new</span> BicycleStrategy());  </div><div class="line">$person-&gt;travel();</div></pre></td></tr></table></figure>
<p>2)排序策略:某系统提供了一个用于对数组数据进行操作的类，该类封装了对数组的常见操作，</p>
<p>如查找数组元素、对数组元素进行排序等。现以排序操作为例，使用策略模式设计该数组操作类，</p>
<p>使得客户端可以动态地更换排序算法，可以根据需要选择冒泡排序或选择排序或插入排序，</p>
<p>也能够灵活地增加新的排序算法。</p>
<p>9.与其他相关模式</p>
<p>1）状态模式</p>
<p>策略模式和其它许多设计模式比较起来是非常类似的。策略模式和状态模式最大的区别就是策略模式只是的条件选择只执行一次，而状态模式是随着实例参数（对象实例的状态）的改变不停地更改执行模式。换句话说，策略模式只是在</p>
<p>对象初始化的时候更改执行模式，而状态模式是根据对象实例的周期时间而动态地改变对象实例的执行模式。</p>
<p>•可以通过环境类状态的个数来决定是使用策略模式还是状态模式。<br>•策略模式的环境类自己选择一个具体策略类，具体策略类无须关心环境类；而状态模式的环境类由于外在因素需要放进一个具体状态中，<br>以便通过其方法实现状态的切换，因此环境类和状态类之间存在一种双向的关联关系。<br>•使用策略模式时，客户端需要知道所选的具体策略是哪一个，而使用状态模式时，客户端无须关心具体状态，环境类的状态会根据用户的操作自动转换。<br>•如果系统中某个类的对象存在多种状态，不同状态下行为有差异，而且这些状态之间可以发生转换时使用状态模式；<br>如果系统中某个类的某一行为存在多种实现方式，而且这些实现方式可以互换时使用策略模式。<br>2）简单工厂的区别：点击打开链接</p>
<p>工厂模式是创建型模式 ，它关注对象创建，提供创建对象的接口. 让对象的创建与具体的使用客户无关。<br>策略模式是对象行为型模式 ，它关注行为和算法的封装 。它定义一系列的算法,把每一个算法封装起来, 并且使它们可相互替换。使得算法可独立于使用它的客户而变化</p>
<p>用我们上面提到旅行的例子：<br>我们去旅行。策略模式的做法：有几种方案供你选择旅行，选择火车好呢还是骑自行车，完全有客户自行决定去构建旅行方案（比如你自己需要去买火车票，或者机票）。而工厂模式是你决定哪种旅行方案后，不用关注这旅行方案怎么给你创建，也就是说你告诉我方案的名称就可以了，然后由工厂代替你去构建具体方案（工厂代替你去买火车票）。</p>
<p>上面的例子里面client代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$person = new PersonContext(new TrainStrategy());</div><div class="line">$person-&gt;travel();</div></pre></td></tr></table></figure></p>
<p>我们看到客户需要自己去创建具体旅行（new TrainStrategy()）实例。传递的是具体实例。<br>而工厂模式你只要告诉哪种旅行就可以了，不是传递一个具体实例，而是一个标识（旅行方案标识）。</p>
<p>10.总结与分析</p>
<p>1）策略模式是一个比较容易理解和使用的设计模式，策略模式是对算法的封装，它把算法的责任和算法本身分割开，委派给不同的对象管理。策略模式通常把一个系列的算法封装到一系列的策略类里面，作为一个抽象策略类的子类。用一句话来说，就是“准备一组算法，并将每一个算法封装起来，使得它们可以互换”。<br>2）在策略模式中，应当由客户端自己决定在什么情况下使用什么具体策略角色。2）<br>3）策略模式仅仅封装算法，提供新算法插入到已有系统中，以及老算法从系统中“退休”的方便，策略模式并不决定在何时使用何种算法，算法的选择由客户端来决定。这在一定程度上提高了系统的灵活性，但是客户端需要理解所有具体策略类之间的区别，以便选择合适的算法，这也是策略模式的缺点之一，在一定程度上增加了客户端的使用难度。</p>
<p>转自：<a href="http://blog.csdn.net/hguisu/article/details/7558249" target="_blank" rel="external">http://blog.csdn.net/hguisu/article/details/7558249</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/21/investigate-on-cgcontext-and-implement-wifi-view/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/21/investigate-on-cgcontext-and-implement-wifi-view/" itemprop="url">
                  Investigate on CGContext and implement Wifi view
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-21T23:46:04+08:00">
              2014-08-21
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/21/investigate-on-cgcontext-and-implement-wifi-view/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/21/investigate-on-cgcontext-and-implement-wifi-view/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Today, I did some research on CGContext. And implement an animation graph and Wifi view. Please the code below.</p>
<p>Here is the screen shot. </p>
<img src="/uploads/2014/08/22/1.png" class="center" width="320" height="568">
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  TestView.m</span></div><div class="line"><span class="comment">//  Depression</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">//  Created by jn11585852 on 8/21/14.</span></div><div class="line"><span class="comment">//  Copyright (c) 2014 JiangNan. All rights reserved.</span></div><div class="line"><span class="comment">//</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TestView.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TestView</span> ()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> percent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">retain</span>) <span class="built_in">NSTimer</span>* timer;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> timeInterval;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TestView</span></span></div><div class="line"><span class="keyword">@synthesize</span> timer = _timer;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)didMoveToWindow</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> didMoveToWindow];</div><div class="line">    <span class="keyword">self</span>.percent = <span class="number">0.0</span>f;</div><div class="line">    <span class="keyword">self</span>.timeInterval = <span class="number">0.01</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)startAnimation</div><div class="line">&#123;</div><div class="line">    <span class="comment">// start a timer to re-render the view</span></div><div class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="keyword">self</span>.timeInterval target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(increaseAndRender) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)stopAnimation</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span>.timer invalidate];</div><div class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)increaseAndRender</div><div class="line">&#123;</div><div class="line">    <span class="comment">// called once time when time invoke it. so we need to increase the percent by  on step</span></div><div class="line">    <span class="built_in">CGFloat</span> step = <span class="keyword">self</span>.finalPercent / (<span class="number">1.0</span> / <span class="keyword">self</span>.timeInterval);</div><div class="line">    <span class="keyword">self</span>.percent += step;</div><div class="line">    <span class="comment">// if the percent is bigger than the final percent, we should stop the timer</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.percent &gt; <span class="keyword">self</span>.finalPercent) &#123;</div><div class="line">        [<span class="keyword">self</span>.timer invalidate];</div><div class="line">        <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span> setNeedsDisplay];</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// Only override drawRect: if you perform custom drawing.</span></div><div class="line"><span class="comment">// An empty implementation adversely affects performance during animation.</span></div><div class="line">- (<span class="keyword">void</span>)drawRect:(<span class="built_in">CGRect</span>)rect</div><div class="line">&#123;</div><div class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">UIGraphicsGetCurrentContext</span>();</div><div class="line">    <span class="built_in">CGContextSaveGState</span>(ctx);</div><div class="line">    </div><div class="line">    [<span class="keyword">self</span> drawRectangle:ctx];</div><div class="line">    [<span class="keyword">self</span> drawCircle:ctx];</div><div class="line">    [<span class="keyword">self</span> drawWifi:ctx];</div><div class="line">    </div><div class="line">    <span class="built_in">CGContextRestoreGState</span>(ctx);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)drawRectangle:(<span class="built_in">CGContextRef</span>)ctx</div><div class="line">&#123;</div><div class="line">    <span class="built_in">CGContextSetStrokeColorWithColor</span>(ctx, [[<span class="built_in">UIColor</span> greenColor] <span class="built_in">CGColor</span>]);</div><div class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, [[<span class="built_in">UIColor</span> lightGrayColor] <span class="built_in">CGColor</span>]);</div><div class="line">    <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">20</span>, <span class="number">50</span>);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">300</span>, <span class="number">50</span>);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">300</span>, <span class="number">60</span>);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">20</span>, <span class="number">60</span>);</div><div class="line">    <span class="built_in">CGContextClosePath</span>(ctx);</div><div class="line">    </div><div class="line">    <span class="built_in">CGPathRef</span> path = <span class="built_in">CGContextCopyPath</span>(ctx);</div><div class="line">    <span class="built_in">CGContextStrokePath</span>(ctx);</div><div class="line">    <span class="built_in">CGContextAddPath</span>(ctx, path);</div><div class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</div><div class="line">    </div><div class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, [[<span class="built_in">UIColor</span> redColor] <span class="built_in">CGColor</span>]);</div><div class="line">    <span class="built_in">CGContextMoveToPoint</span>(ctx, <span class="number">20</span>, <span class="number">50</span>);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">20</span> + <span class="number">280</span> * <span class="keyword">self</span>.percent, <span class="number">50</span>);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">20</span> + <span class="number">280</span> * <span class="keyword">self</span>.percent, <span class="number">60</span>);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, <span class="number">20</span>, <span class="number">60</span>);</div><div class="line">    <span class="built_in">CGContextClosePath</span>(ctx);</div><div class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)drawCircle:(<span class="built_in">CGContextRef</span>)ctx</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> drawCurve:ctx start:<span class="number">0</span> end:<span class="keyword">self</span>.percent color:[[<span class="built_in">UIColor</span> redColor] <span class="built_in">CGColor</span>]];</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.percent &gt; <span class="number">0.3</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> drawCurve:ctx start:<span class="number">0.3</span> end:<span class="keyword">self</span>.percent color:[[<span class="built_in">UIColor</span> greenColor] <span class="built_in">CGColor</span>]];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.percent &gt; <span class="number">0.6</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> drawCurve:ctx start:<span class="number">0.6</span> end:<span class="keyword">self</span>.percent color:[[<span class="built_in">UIColor</span> blackColor] <span class="built_in">CGColor</span>]];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)drawCurve:(<span class="built_in">CGContextRef</span>)ctx start:(<span class="built_in">CGFloat</span>)start end:(<span class="built_in">CGFloat</span>)end color:(<span class="built_in">CGColorRef</span>)color</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">self</span> drawCurve:ctx start:start end:end color:color radius:<span class="number">100</span> center:<span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>)];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)drawWifi:(<span class="built_in">CGContextRef</span>)ctx</div><div class="line">&#123;</div><div class="line">    <span class="comment">// it is very interesting here, we will draw it from outside to inside. final there is only a circle.</span></div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> radius = <span class="number">50</span>; radius &gt; <span class="number">0</span>; ) &#123;</div><div class="line">        [<span class="keyword">self</span> drawCurve:ctx start:<span class="number">0.625</span> end:<span class="number">0.875</span> color:[[<span class="built_in">UIColor</span> greenColor] <span class="built_in">CGColor</span>] radius:radius center:<span class="built_in">CGPointMake</span>(<span class="number">100</span>, <span class="number">400</span>)];</div><div class="line">        </div><div class="line">        radius -= <span class="number">20</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)drawCurve:(<span class="built_in">CGContextRef</span>)ctx start:(<span class="built_in">CGFloat</span>)start end:(<span class="built_in">CGFloat</span>)end color:(<span class="built_in">CGColorRef</span>)color radius:(<span class="built_in">CGFloat</span>)radius center:(<span class="built_in">CGPoint</span>)center</div><div class="line">&#123;</div><div class="line">    <span class="comment">// draw a big arc</span></div><div class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, color);</div><div class="line">    <span class="built_in">CGContextMoveToPoint</span>(ctx, center.x, center.y);</div><div class="line">    <span class="built_in">CGContextAddArc</span>(ctx, center.x, center.y, radius, <span class="number">2</span> * M_PI * start, <span class="number">2</span> * M_PI * end, <span class="number">0</span>);</div><div class="line">    <span class="built_in">CGContextClosePath</span>(ctx);</div><div class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</div><div class="line">    </div><div class="line">    <span class="comment">// then draw the inside small one</span></div><div class="line">    <span class="built_in">CGContextSetFillColorWithColor</span>(ctx, [[<span class="built_in">UIColor</span> whiteColor] <span class="built_in">CGColor</span>]);</div><div class="line">    <span class="built_in">CGContextMoveToPoint</span>(ctx, center.x, center.y);</div><div class="line">    <span class="built_in">CGContextAddLineToPoint</span>(ctx, center.x + radius - <span class="number">10</span>, center.y);</div><div class="line">    <span class="built_in">CGContextAddArc</span>(ctx, center.x, center.y, radius - <span class="number">10</span>, <span class="number">0</span>, <span class="number">2</span> * M_PI, <span class="number">0</span>);</div><div class="line">    <span class="built_in">CGContextClosePath</span>(ctx);</div><div class="line">    <span class="built_in">CGContextFillPath</span>(ctx);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/20/ctci-reverse-char-array-using-c/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/20/ctci-reverse-char-array-using-c/" itemprop="url">
                  [CTCI]-Homework Part 1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-20T20:21:26+08:00">
              2014-08-20
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/20/ctci-reverse-char-array-using-c/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/20/ctci-reverse-char-array-using-c/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##1.1 Implement an algorithm to determine if a string has all unique characters. What if you cannot use additional data structures?</p>
<p>####Solution 1. Use hash table<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">String testStr = <span class="string">"abca"</span>;</div><div class="line"><span class="keyword">boolean</span> lRepeatChar = <span class="keyword">false</span>;<span class="comment">// = repeatString(testStr);</span></div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; testStr.length(); i++)</div><div class="line">&#123;</div><div class="line">	String c = testStr.substring(i, i+<span class="number">1</span>);</div><div class="line">	<span class="keyword">if</span>(lTest.containsKey(c))</div><div class="line">	&#123;</div><div class="line">		lRepeatChar = <span class="keyword">true</span>;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		lTest.put(c, <span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>####Solution 2. Recursive<br>Not Recommend this one.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">repeatChar</span><span class="params">(<span class="keyword">char</span> c, String substr)</span></span></div><div class="line">&#123;	</div><div class="line">	<span class="keyword">if</span>(substr == <span class="keyword">null</span> || substr.length() == <span class="number">0</span>)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">char</span> next = substr.charAt(<span class="number">0</span>);</div><div class="line">	<span class="keyword">if</span>(next == c)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">boolean</span> lRepeatChar = repeatChar(c, substr.substring(<span class="number">1</span>));</div><div class="line">	<span class="keyword">if</span>(lRepeatChar == <span class="keyword">true</span>)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	<span class="keyword">else</span></div><div class="line">	&#123;</div><div class="line">		lRepeatChar = repeatChar(next, substr.substring(<span class="number">1</span>));</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="keyword">return</span> lRepeatChar;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">repeatString</span><span class="params">(String str)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(str == <span class="keyword">null</span> || str.length() == <span class="number">0</span>)</div><div class="line">		<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">char</span> c = str.charAt(<span class="number">0</span>);</div><div class="line">	String substr = str.substring(<span class="number">1</span>);</div><div class="line">	<span class="keyword">return</span> repeatChar(c, substr);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##1.2 Implement a function void reverse(char* str) in C or C++ which reverses a null- terminated string.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">reverseString</span><span class="params">(<span class="keyword">char</span>* str)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> n = <span class="number">0</span>;</div><div class="line">    <span class="comment">// find the end of the char[].</span></div><div class="line">    <span class="keyword">while</span> (str[n] != <span class="string">'\0'</span>) &#123;</div><div class="line">        n++;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// using 2 integer to index the char and reverse</span></div><div class="line">    <span class="keyword">int</span> i = <span class="number">0</span>, j = n - <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (i &lt; j) &#123;</div><div class="line">        <span class="keyword">char</span> t = str[i];</div><div class="line">        str[i] = str[j];</div><div class="line">        str[j] = t;</div><div class="line">        i++;</div><div class="line">        j--;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>##1.3 Given two strings, write a method to decide if one is a permutation of the other.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringComparer</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> String mString1;</div><div class="line">	<span class="keyword">private</span> String mString2;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">StringComparer</span><span class="params">(String iStr1, String iStr2)</span></span></div><div class="line">	&#123;</div><div class="line">		mString1 = iStr1;</div><div class="line">		mString2 = iStr2;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">// Solution 1, using hash table</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">couldRearrange</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(mString1 == <span class="keyword">null</span> || mString2 == <span class="keyword">null</span>)</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(mString1.length() != mString2.length())</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		</div><div class="line">		Hashtable&lt;String, Integer&gt; lCacheTable = <span class="keyword">new</span> Hashtable&lt;String, Integer&gt;();</div><div class="line">		</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mString1.length(); i++)</div><div class="line">		&#123;</div><div class="line">			String c = mString1.substring(i, i+<span class="number">1</span>);</div><div class="line">			Integer lCount = lCacheTable.get(c);</div><div class="line">			<span class="keyword">if</span>(lCount == <span class="keyword">null</span>)</div><div class="line">			&#123;</div><div class="line">				lCacheTable.put(c, <span class="number">1</span>);</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				lCacheTable.put(c, lCount+<span class="number">1</span>);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mString2.length(); i++)</div><div class="line">		&#123;</div><div class="line">			String c = mString2.substring(i, i+<span class="number">1</span>);</div><div class="line">			Integer lCount = lCacheTable.get(c);</div><div class="line">			<span class="keyword">if</span>(lCount == <span class="keyword">null</span> || lCount == <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				lCount -= <span class="number">1</span>;</div><div class="line">				<span class="keyword">if</span>(lCount == <span class="number">0</span>)</div><div class="line">				&#123;</div><div class="line">					lCacheTable.remove(c);</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">else</span></div><div class="line">				&#123;</div><div class="line">					lCacheTable.put(c, lCount);</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// solution 2, sort string</span></div><div class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">sort</span><span class="params">(String t)</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">char</span>[] s = t.toCharArray();</div><div class="line">		java.util.Arrays.sort(s);</div><div class="line">		<span class="keyword">return</span> <span class="keyword">new</span> String(s);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">couldRearrange2</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		String str1 = <span class="keyword">this</span>.sort(mString1);</div><div class="line">		String str2 = <span class="keyword">this</span>.sort(mString2);</div><div class="line">		<span class="keyword">if</span>(str1.compareTo(str2) == <span class="number">0</span>)</div><div class="line">			<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">		<span class="keyword">else</span></div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">// soltion 3. using array to store the char count</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">couldRearrange3</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(mString1 == <span class="keyword">null</span> || mString2 == <span class="keyword">null</span> ||  mString1.length() != mString2.length())</div><div class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">int</span> marks[] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>];</div><div class="line">		</div><div class="line">		<span class="keyword">char</span>[] s = mString1.toCharArray();</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">char</span> c: s)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> index = (<span class="keyword">int</span>)c;</div><div class="line">			marks[index]++;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mString2.length(); i++)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">int</span> index = (<span class="keyword">int</span>)mString2.charAt(i);</div><div class="line">			<span class="keyword">if</span>(marks[index] == <span class="number">0</span>)</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">			&#125;</div><div class="line">			<span class="keyword">else</span></div><div class="line">			&#123;</div><div class="line">				marks[index]--;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="1-4-Write-a-method-to-replace-all-spaces-in-a-string-with’-20’-You-may-assume-that-the-string-has-sufficient-space-at-the-end-of-the-string-to-hold-the-additional-characters-and-that-you-are-given-the-“true”-length-of-the-string-Note-if-imple-menting-in-Java-please-use-a-character-array-so-that-you-can-perform-this-opera-tion-in-place"><a href="#1-4-Write-a-method-to-replace-all-spaces-in-a-string-with’-20’-You-may-assume-that-the-string-has-sufficient-space-at-the-end-of-the-string-to-hold-the-additional-characters-and-that-you-are-given-the-“true”-length-of-the-string-Note-if-imple-menting-in-Java-please-use-a-character-array-so-that-you-can-perform-this-opera-tion-in-place" class="headerlink" title="1.4 Write a method to replace all spaces in a string with’%20’. You may assume that the string has sufficient space at the end of the string to hold the additional characters, and that you are given the “true” length of the string. (Note: if imple- menting in Java, please use a character array so that you can perform this opera- tion in place.)"></a>1.4 Write a method to replace all spaces in a string with’%20’. You may assume that the string has sufficient space at the end of the string to hold the additional characters, and that you are given the “true” length of the string. (Note: if imple- menting in Java, please use a character array so that you can perform this opera- tion in place.)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">replaceBlankTest</span><span class="params">(<span class="keyword">char</span>[] str, <span class="keyword">int</span> length)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(length == <span class="number">0</span>)</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> blankCount = <span class="number">0</span>;</div><div class="line">	<span class="keyword">while</span>(str[index] != <span class="string">'\0'</span> &amp;&amp; index &lt; length)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(str[index] == <span class="string">' '</span>) blankCount++;</div><div class="line">		index++;</div><div class="line">	&#125;</div><div class="line">	index--;</div><div class="line">	</div><div class="line">	<span class="keyword">int</span> externCount = blankCount * <span class="number">2</span>;</div><div class="line">	<span class="keyword">int</span> endIndex = index + externCount;</div><div class="line">	<span class="keyword">while</span>(index &gt;= <span class="number">0</span>)</div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(str[index] == <span class="string">' '</span>)</div><div class="line">		&#123;</div><div class="line">			blankCount--;</div><div class="line">			str[endIndex] = <span class="string">'0'</span>;</div><div class="line">			str[endIndex-<span class="number">1</span>] = <span class="string">'2'</span>;</div><div class="line">			str[endIndex-<span class="number">2</span>] = <span class="string">'%'</span>;</div><div class="line">			endIndex -= <span class="number">3</span>;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">else</span></div><div class="line">		&#123;</div><div class="line">			str[endIndex] = str[index];</div><div class="line">			endIndex--;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		index--;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/17/stringbuffer-simple-implementation-in-java/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/17/stringbuffer-simple-implementation-in-java/" itemprop="url">
                  [CTCI]-StringBuffer simple implementation in Java
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-17T08:45:50+08:00">
              2014-08-17
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/17/stringbuffer-simple-implementation-in-java/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/17/stringbuffer-simple-implementation-in-java/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Here is an implementation of String Buffer. It use an link list to store the appended string. If there is no enough space for the append string, it will create an new node for the new string.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBufferTest</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">    * Each node represent part of strings.</div><div class="line">    */</div><div class="line">    <span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span></span></div><div class="line">    &#123;</div><div class="line">          <span class="keyword">public</span> <span class="keyword">char</span>[] data;</div><div class="line">          <span class="keyword">public</span> Node next;</div><div class="line">         </div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="title">Node</span><span class="params">()</span></span></div><div class="line">          &#123;</div><div class="line">               data = <span class="keyword">new</span> <span class="keyword">char</span>[size];</div><div class="line">               next = <span class="keyword">null</span>;</div><div class="line">          &#125;</div><div class="line">    &#125;</div><div class="line">   </div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> size = <span class="number">5</span>;</div><div class="line">    <span class="keyword">private</span> Node first;</div><div class="line">    <span class="keyword">private</span> Node currentNode;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> index;</div><div class="line">   </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StringBufferTest</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">          first = <span class="keyword">new</span> Node();</div><div class="line">          currentNode = first;</div><div class="line">          index = <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">   </div><div class="line">   	<span class="comment">// Thanks for Robert C, Wang's improve the code.</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">append</span><span class="params">(String inputStr)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (inputStr == <span class="keyword">null</span>)</div><div class="line">               <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        <span class="comment">// Copy the string to the node data</span></div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; inputStr.length(); i++) &#123;</div><div class="line">            <span class="keyword">if</span>(index == size) &#123;	<span class="comment">// Create a new node at end</span></div><div class="line">                Node newNode = <span class="keyword">new</span> Node();</div><div class="line">                currentNode.next = newNode;</div><div class="line">                currentNode = currentNode.next;</div><div class="line">                index = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">            currentNode.data[index++] = inputStr.charAt(i);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">    	String result = <span class="string">""</span>;</div><div class="line">    	Node p = first;</div><div class="line">    	<span class="keyword">while</span>(p != <span class="keyword">null</span>)</div><div class="line">    	&#123;</div><div class="line">    		result += String.valueOf(p.data);</div><div class="line">    		p = p.next;</div><div class="line">    	&#125;</div><div class="line">    	<span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    * <span class="doctag">@param</span> args</div><div class="line">    */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">          StringBufferTest test = <span class="keyword">new</span> StringBufferTest();</div><div class="line">          test.append(<span class="string">"123456"</span>);</div><div class="line">          test.append(<span class="string">"789"</span>);</div><div class="line">          </div><div class="line">          String result = test.toString();</div><div class="line">          System.out.print(result);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/15/hashtablearray-using-java/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/15/hashtablearray-using-java/" itemprop="url">
                  [CTCI]-HashTableArray using Java
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-15T13:58:07+08:00">
              2014-08-15
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/15/hashtablearray-using-java/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/15/hashtablearray-using-java/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Using an array to store hash key/value.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.njiang.base;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HashTableArray</span>&lt;<span class="title">Key</span>, <span class="title">Value</span>&gt; </span></div><div class="line">&#123;	</div><div class="line">	</div><div class="line">	<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTEntity</span>&lt;<span class="title">Key</span>, <span class="title">Value</span>&gt;</span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">public</span> Key mKey;</div><div class="line">		<span class="keyword">public</span> Value mValue;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">HTEntity</span><span class="params">()</span></span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">this</span>.mKey = <span class="keyword">null</span>;</div><div class="line">			<span class="keyword">this</span>.mValue = <span class="keyword">null</span>;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="function"><span class="keyword">public</span> <span class="title">HTEntity</span><span class="params">(Key iKey, Value iValue)</span></span></div><div class="line">		&#123;</div><div class="line">			<span class="keyword">this</span>.mKey = iKey;</div><div class="line">			<span class="keyword">this</span>.mValue = iValue;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	HTEntity&lt;Key, Value&gt;[] mTable;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> mCapicity = <span class="number">5</span>;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> mCount;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> mSeed;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">HashTableArray</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		mTable = <span class="keyword">new</span> HTEntity[mCapicity];</div><div class="line">		mCount = <span class="number">0</span>;</div><div class="line">		mSeed = <span class="number">13</span>;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(<span class="keyword">final</span> Key iKey)</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">int</span> lIndex = (mSeed^iKey.hashCode()) % mCapicity;</div><div class="line">		<span class="keyword">return</span> lIndex;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Key iKey, Value iValue)</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(iKey == <span class="keyword">null</span> || iValue == <span class="keyword">null</span>)</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(mCount == mCapicity)</div><div class="line">		&#123;</div><div class="line">			HTEntity&lt;Key, Value&gt;[] mTmpTable = <span class="keyword">new</span> HTEntity[<span class="number">2</span>*mCapicity];</div><div class="line">			mCapicity = <span class="number">2</span> * mCapicity;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mCount; i++)</div><div class="line">			&#123;</div><div class="line">				Key lKey = mTable[i].mKey;</div><div class="line">				<span class="keyword">int</span> index = <span class="keyword">this</span>.hash(lKey);</div><div class="line">				<span class="keyword">while</span>(mTmpTable[index] != <span class="keyword">null</span>)</div><div class="line">				&#123;</div><div class="line">					index = (index + <span class="number">1</span>) % mCapicity;</div><div class="line">				&#125;</div><div class="line">					</div><div class="line">				mTmpTable[index] = mTable[i];</div><div class="line">			&#125;</div><div class="line">			mTable = mTmpTable;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">int</span> index = <span class="keyword">this</span>.hash(iKey);</div><div class="line">		<span class="keyword">while</span>(mTable[index] != <span class="keyword">null</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span> (mTable[index].mKey.equals(iKey))</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			</div><div class="line">			index = (index + <span class="number">1</span>) % mCapicity;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		mTable[index] = <span class="keyword">new</span> HTEntity(iKey, iValue);</div><div class="line">		mCount++;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">remove</span><span class="params">(Key iKey)</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">if</span>(iKey == <span class="keyword">null</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">int</span> index = <span class="keyword">this</span>.hash(iKey);</div><div class="line">		<span class="keyword">while</span>(mTable[index] != <span class="keyword">null</span>)</div><div class="line">		&#123;</div><div class="line">			<span class="keyword">if</span>(mTable[index].mKey.equals(iKey))</div><div class="line">			&#123;</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			&#125;</div><div class="line">			index = (index + <span class="number">1</span>) % mCapicity;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		<span class="keyword">if</span>(mTable[index] == <span class="keyword">null</span>)</div><div class="line">		&#123;</div><div class="line">			System.out.print(<span class="string">"There is no element with key "</span> + iKey);</div><div class="line">			<span class="keyword">return</span> ;</div><div class="line">		&#125;</div><div class="line">		mTable[index] = <span class="keyword">null</span>;</div><div class="line">		mCount--;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/13/cracking-the-coding-interview-technical-preparation-1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/13/cracking-the-coding-interview-technical-preparation-1/" itemprop="url">
                  [CTCI]-Technical Preparation(1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-13T22:31:33+08:00">
              2014-08-13
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/13/cracking-the-coding-interview-technical-preparation-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/13/cracking-the-coding-interview-technical-preparation-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###1. How to Practice a Question</p>
<ol>
<li>Try to solve the problem on your own.</li>
<li>Write the code for the algorithm on paper.</li>
<li>Test your code - on paper.</li>
<li>Type your paper code as-is into a computer.</li>
</ol>
<p>###2. What You need to Know</p>
<table>
<thead>
<tr>
<th>Data Structures</th>
<th>Algorithms</th>
<th>Concepts</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linked List</td>
<td>Breadth First Search</td>
<td>BitManipulation</td>
</tr>
<tr>
<td>Binary Trees</td>
<td>Depth First Search</td>
<td>Singleton Design Pattern</td>
</tr>
<tr>
<td>Tries</td>
<td>Binary Search</td>
<td>Factory Design Pattern</td>
</tr>
<tr>
<td>Stacks</td>
<td>Merge Sort</td>
<td>Memory (Stack vs. Heap)</td>
</tr>
<tr>
<td>Queues</td>
<td>Quick Sourt</td>
<td>Recursion</td>
</tr>
<tr>
<td>Vectors / ArrayList</td>
<td>Tree Insert / Find / e.t.c</td>
<td>Big-O Time</td>
</tr>
<tr>
<td>HashTables</td>
<td></td>
</tr>
</tbody>
</table>
<p>In Praticular, hash tables are an extremely important topic. You will find that you use them frequently in solving interview questions.</p>
<p>###3. Five Steps to a Technical Question</p>
<ol>
<li>Ask your interviewer questions to resolve ambiguity.</li>
<li>Design an Algorithm.</li>
<li>Write pseudocode first, but make sure to tell your interviewer that you’ll eventually write “real” code.</li>
<li>Write your code at a moderate pace.</li>
<li>Test your code and carefully fix any mistakes.</li>
</ol>
<p>The more problems you practice, the esier it will be to identify which approach to use!!!</p>
<p>####1. Ask Questions,<br>Good Questions might be ones like: what are the data types? How much data is there? What assumptions do you need to solve the problem? Who is the user?</p>
<p>####2. Design an Algorithm<br>Keep in mind:</p>
<ol>
<li>What are its space and time complexity?</li>
<li>What happens if there is a lot of data?</li>
<li>Does your design cause other issues? For example, if you’re creating a modified version of a binary search tree, did your design impact the time for insert, find, or delete?</li>
<li>If there are other issues or limitations, did you make the right trade-offs? For which scenarios might the trade-off be less optimal?</li>
<li>If they gave your specific data.</li>
</ol>
<p>####3. Pseudocode</p>
<p>####4. Code</p>
<ol>
<li>Use Data Structures Generously.</li>
<li>Don’t Crowd Your Coding.</li>
</ol>
<p>####5. Test</p>
<ol>
<li>Extreme cases:0, negative, null, maximums, minimums.</li>
<li>User error: what happens if the user passes in null or a negative value?</li>
<li>General cases: Test the normal case.</li>
</ol>
<p>###4.Five approaches</p>
<ol>
<li>Examplify</li>
<li>Pattern Matching</li>
<li>Simplify and Generalize</li>
<li>Base Case and Build</li>
<li>Data Structure Brainstorm</li>
</ol>
<p>###5. What Good Coding Looks Like</p>
<ol>
<li>Correct.</li>
<li>Efficient.</li>
<li>Simple.</li>
<li>Readable.</li>
<li>Maintainable.</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/08/ios-guan-yu-objective-cfang-fa-de-imp/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/08/ios-guan-yu-objective-cfang-fa-de-imp/" itemprop="url">
                  iOS 关于Objective-C方法的IMP
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-08T12:39:42+08:00">
              2014-08-08
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/08/ios-guan-yu-objective-cfang-fa-de-imp/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/08/ios-guan-yu-objective-cfang-fa-de-imp/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>###一.什么是IMP<br>IMP是”implementation”的缩写，它是objetive-C 方法(method)实现代码块的地址，可像C函数一样直接调用。通常情况下我们是通过[object method:parameter]或objc_msgSend()的方式向对象发送消息，然后Objective-C运行时(Objective-C runtime)寻找匹配此消息的IMP,然后调用它;但有些时候我们希望获取到IMP进行直接调用。</p>
<p>###二.Objetive-C中的Method结构<br>在Objecitve-C中，在类中对每一个方法有一个在运行时构建的数据结构，在Objective-C 2.0中，此结构对用户不可见，但仍在内部存在。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">struct</span> objc_method</div><div class="line">&#123;</div><div class="line">  SEL method_name;</div><div class="line">  <span class="keyword">char</span> * method_types;</div><div class="line">  IMP method_imp;</div><div class="line">&#125;;</div><div class="line"><span class="keyword">typedef</span> objc_method Method;</div></pre></td></tr></table></figure>
<p>每个方法有3个属性<br>方法名：方法名为此方法的签名，有着相同函数名和参数名的方法有着相同的方法名。<br>方法类型：方法类型描述了参数的类型。<br>IMP: IMP即函数指针，为方法具体实现代码块的地址，可像普通C函数调用一样使用IMP。<br>由于Method的内部结构不可见，所以不能通过method-&gt;method_name的方式访问其内部属性，只能Objective-C运行时提供的函数获取。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">SEL method_getName(Method method);</div><div class="line">IMP method_getImplementation(Method method);</div><div class="line"><span class="keyword">const</span> <span class="keyword">char</span> * ivar_getTypeEncoding(Ivar ivar);</div></pre></td></tr></table></figure>
<p>还有一些其他函数来获取方法的各种属性，具体可见Objective-C Runtime Reference。</p>
<p>###三.获取当前方法的默认IMP(default IMP)<br>NSObject对象提供了两个方法来获取的IMP</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (IMP)methodForSelector:(SEL)aSelector;</div><div class="line">+ (IMP)instanceMethodForSelector:(SEL)aSelector;</div></pre></td></tr></table></figure>
<p>使用<code>methodForSelector</code>方法时，若向类(class)发送消息，则aSelector应该是类方法(class method);若向实例对象(instance)发送消息，则aSelector应该为实例对象方法(instance method)。使用<code>instanceMethodForSelector</code>可向类请求实例方法的IMP。<br>那么获取当前方法的IMP,可使用self对象和隐含的_cmd参数。<br><code>IMP current = [self class] instanceMethodForSelector:_cmd];</code><br>methodForSelector返回的IMP是default IMP,即发送消息时会调用的IMP。但可能有其他情况不是这样的,但到底什么情况下呢?不懂，如下:</p>
<blockquote>
<p>methodForSelector: only returns the default IMP that will be invoked by a send message but you could have arrived at the current method through a super invocation, or a direct invocation of the IMP itself. The approach shown in this post gets the correct IMP no matter how it was invoked.</p>
</blockquote>
<p>###四. 另一种hack的方式获取当前方法IMP</p>
<p>GCC有个内建(build-in)函数,可获取当前栈帧的返回地址（参数0表示当前栈帧）。<br><code>__builtin_return_address(0)</code><br>这里有两个假设<br>方法的实现是连续的。<br>在方法中调用子函数，在子函数中调用<strong>builtin_return_address(0)得到的返回地址在当前方法实现的内部。<br>那么可以得出结论，当前方法实现的起始地址(即IMP)肯定在的子函数返回地址的前面，而且会比任何其他方法离的更近。则可通过如下方法寻找IMP。<br>当当前方法中，调用一个寻找IMP的子函数，将当前类和_cmd参数传递给子函数；<br>在子函数中使用</strong>builtin_return_address(0)获得返回地址，遍历当前类和当前父类的所有方法，寻找method_name与_cmd相等，而method_imp在__builtin_return_address(0)之前，且离其最近，则此IMP即为当前的的IMP。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/objc-class.h&gt;</span></span></div><div class="line">IMP impOfCallingMethod(<span class="keyword">id</span> lookupObject, SEL selector)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSUInteger</span> returnAddress = (<span class="built_in">NSUInteger</span>)__builtin_return_address(<span class="number">0</span>);</div><div class="line">    <span class="built_in">NSUInteger</span> closest = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">// Iterate over the class and all superclasses</span></div><div class="line">    Class currentClass = object_getClass(lookupObject);</div><div class="line">    <span class="keyword">while</span> (currentClass)</div><div class="line">    &#123;</div><div class="line">        <span class="comment">// Iterate over all instance methods for this class</span></div><div class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> methodCount;</div><div class="line">        Method *methodList = class_copyMethodList(currentClass, &amp;methodCount);</div><div class="line">        <span class="keyword">unsigned</span> <span class="keyword">int</span> i;</div><div class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; methodCount; i++)</div><div class="line">        &#123;</div><div class="line">            <span class="comment">// Ignore methods with different selectors</span></div><div class="line">            <span class="keyword">if</span> (method_getName(methodList[i]) != selector)</div><div class="line">            &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="comment">// If this address is closer, use it instead</span></div><div class="line">            <span class="built_in">NSUInteger</span> address = (<span class="built_in">NSUInteger</span>)method_getImplementation(methodList[i]);</div><div class="line">            <span class="keyword">if</span> (address &lt; returnAddress &amp;&amp; address &gt; closest)</div><div class="line">            &#123;</div><div class="line">                closest = address;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        free(methodList);</div><div class="line">        currentClass = class_getSuperclass(currentClass);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">return</span> (IMP)closest;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其使用方法为:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)myMethodWithParam1:(<span class="keyword">int</span>)someParameter andParam2:(<span class="keyword">int</span>)otherParameter</div><div class="line">&#123;</div><div class="line">   IMP myImplementation = impOfCallingInstanceMethod([<span class="keyword">self</span> <span class="keyword">class</span>], _cmd);</div><div class="line"></div><div class="line">   ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>另外还有更快速的方法:获取当前方法的返回地址,然后通过此地址回溯到父函数的IMP内部，在父函数IMP中寻找调用当前函数的位置，即可知道当前函数的IMP，不过此方法是平台相关的。<br>注:此方法假设IMP地址与子函数返回地址之间是连续的，中间不会有其他方法IMP。如果将impOfCallingMethod放到block代码中，则此条件不再满足，不再适用。(待验证)<br>参考：<br>IMP of the current method<br>Objective-C Runtime Reference<br>NSObject Class Reference</p>
<p>本文出自 清风徐来，水波不兴 的博客，转载时请注明出处及相应链接。<br>本文永久链接: <a href="http://www.winddisk.com/2012/06/13/objective-c-method-imp/" target="_blank" rel="external">http://www.winddisk.com/2012/06/13/objective-c-method-imp/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/08/02/iosbian-li-wei-zhi-dui-xiang/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/02/iosbian-li-wei-zhi-dui-xiang/" itemprop="url">
                  iOS遍历未知对象
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-08-02T13:29:53+08:00">
              2014-08-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/02/iosbian-li-wei-zhi-dui-xiang/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/02/iosbian-li-wei-zhi-dui-xiang/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">PropertyListing</span>)   </span></div><div class="line"></div><div class="line"><span class="comment">/* 获取对象的所有属性 */</span></div><div class="line">- (<span class="built_in">NSDictionary</span> *)properties_aps</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSMutableDictionary</span> *props = [<span class="built_in">NSMutableDictionary</span> dictionary];   </div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> outCount, i;   </div><div class="line">   objc_property_t *properties = class_copyPropertyList([<span class="keyword">self</span> <span class="keyword">class</span>], &amp;outCount);   </div><div class="line">   <span class="keyword">for</span> (i = <span class="number">0</span>; i&lt;outCount; i++)</div><div class="line">    &#123;</div><div class="line">       objc_property_t property = properties[i];</div><div class="line">       <span class="keyword">const</span> <span class="keyword">char</span>* char_f =property_getName(property);</div><div class="line">       <span class="built_in">NSString</span> *propertyName = [<span class="built_in">NSString</span> stringWithUTF8String:char_f];</div><div class="line">       <span class="keyword">id</span> propertyValue = [<span class="keyword">self</span> valueForKey:(<span class="built_in">NSString</span> *)propertyName];   </div><div class="line">       <span class="keyword">if</span> (propertyValue) [props setObject:propertyValue forKey:propertyName];   </div><div class="line">    &#125;   </div><div class="line">   free(properties);   </div><div class="line">   <span class="keyword">return</span> props;   </div><div class="line">&#125;   </div><div class="line"></div><div class="line"><span class="comment">/* 获取对象的所有方法 */</span></div><div class="line">-(<span class="keyword">void</span>)printMothList</div><div class="line">&#123;</div><div class="line">   <span class="keyword">unsigned</span> <span class="keyword">int</span> mothCout_f =<span class="number">0</span>;</div><div class="line">   Method* mothList_f = class_copyMethodList([<span class="keyword">self</span> <span class="keyword">class</span>],&amp;mothCout_f);</div><div class="line">   <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;mothCout_f;i++)</div><div class="line">    &#123;</div><div class="line">       Method temp_f = mothList_f[i];</div><div class="line">       IMP imp_f = method_getImplementation(temp_f);</div><div class="line">       SEL name_f = method_getName(temp_f);</div><div class="line">       <span class="keyword">const</span> <span class="keyword">char</span>* name_s =sel_getName(method_getName(temp_f));</div><div class="line">       <span class="keyword">int</span> arguments = method_getNumberOfArguments(temp_f);</div><div class="line">       <span class="keyword">const</span> <span class="keyword">char</span>* encoding =method_getTypeEncoding(temp_f);</div><div class="line">       <span class="built_in">NSLog</span>(<span class="string">@"方法名：%@,参数个数：%d,编码方式：%@"</span>,[<span class="built_in">NSString</span> stringWithUTF8String:name_s],</div><div class="line">                                            arguments,</div><div class="line">                            [<span class="built_in">NSString</span> stringWithUTF8String:encoding]);</div><div class="line">    &#125;</div><div class="line">   free(mothList_f);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar/avatar.jpg"
               alt="姜楠" />
          <p class="site-author-name" itemprop="name">姜楠</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">117</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/njiang1987" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">姜楠</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"njiang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
