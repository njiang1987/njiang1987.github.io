<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="天空の城">
<meta property="og:url" content="http://www.njiang.cn/page/9/index.html">
<meta property="og:site_name" content="天空の城">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天空の城">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.njiang.cn/page/9/"/>





  <title> 天空の城 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-43682645-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">天空の城</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">愤怒的程序员，梦想着有一天也能飞！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/02/19/objective-duo-xian-cheng-nsthread/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/02/19/objective-duo-xian-cheng-nsthread/" itemprop="url">
                  Objective-多线程NSThread
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-02-19T20:30:38+08:00">
              2014-02-19
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/02/19/objective-duo-xian-cheng-nsthread/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/19/objective-duo-xian-cheng-nsthread/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>iOS 支持多个层次的多线程编程，层次越高的抽象程度越高，使用起来也越方便，也是苹果最推荐使用的方法。下面根据抽象层次从低到高依次列出iOS所支持的多线程编程范式：</p>
<ol>
<li>Thread;</li>
<li>Cocoa operations;</li>
<li>Grand Central Dispatch (GCD) (iOS4 才开始支持)</li>
</ol>
<p>下面简要说明这三种不同范式：<br>Thread 是这三种范式里面相对轻量级的，但也是使用起来最负责的，你需要自己管理thread的生命周期，线程之间的同步。线程共享同一应用程序的部分内存空间，它们拥有对数据相同的访问权限。你得协调多个线程对同一数据的访问，一般做法是在访问之前加锁，这会导致一定的性能开销。在 iOS 中我们可以使用多种形式的 thread:</p>
<p>Cocoa threads: 使用NSThread 或直接从 NSObject 的类方法 performSelectorInBackground:withObject: 来创建一个线程。如果你选择thread来实现多线程，那么 NSThread 就是官方推荐优先选用的方式。<br>POSIX threads: 基于 C 语言的一个多线程库，</p>
<p>Cocoa operations是基于 Obective-C实现的，类 NSOperation 以面向对象的方式封装了用户需要执行的操作，我们只要聚焦于我们需要做的事情，而不必太操心线程的管理，同步等事情，因为NSOperation已经为我们封装了这些事情。 NSOperation 是一个抽象基类，我们必须使用它的子类。iOS 提供了两种默认实现：NSInvocationOperation 和 NSBlockOperation。</p>
<p>Grand Central Dispatch (GCD): iOS4 才开始支持，它提供了一些新的特性，以及运行库来支持多核并行编程，它的关注点更高：如何在多个 cpu 上提升效率。</p>
<p>有了上面的总体框架，我们就能清楚地知道不同方式所处的层次以及可能的效率，便利性差异。下面我们先来看看 NSThread 的使用，包括创建，启动，同步，通信等相关知识。这些与 win32/Java 下的 thread 使用非常相似。</p>
<p>###线程创建与启动<br>NSThread的创建主要有两种直接方式：<br><code>[NSThread detachNewThreadSelector:@selector(myThreadMainMethod:) toTarget:self withObject:nil];</code><br>和<br><code>NSThread* myThread = [[NSThread alloc] initWithTarget:self<br>selector:@selector(myThreadMainMethod:)<br>object:nil];<br>[myThread start];<br></code></p>
<p>这两种方式的区别是：前一种一调用就会立即创建一个线程来做事情；而后一种虽然你 alloc 了也 init了，但是要直到我们手动调用 start 启动线程时才会真正去创建线程。这种延迟实现思想在很多跟资源相关的地方都有用到。后一种方式我们还可以在启动线程之前，对线程进行配置，比如设置 stack 大小，线程优先级。</p>
<p>还有一种间接的方式，更加方便，我们甚至不需要显式编写 NSThread 相关代码。那就是利用 NSObject 的类方法 <code>performSelectorInBackground:withObject: </code>来创建一个线程：<code><br>[myObj performSelectorInBackground:@selector(myThreadMainMethod) withObject:nil];</code><br>其效果与 NSThread 的<code>detachNewThreadSelector:toTarget:withObject: </code>是一样的。</p>
<p>###线程同步<br>线程的同步方法跟其他系统下类似，我们可以用原子操作，可以用 mutex，lock等。<br>iOS的原子操作函数是以 OSAtomic开头的，比如：OSAtomicAdd32, OSAtomicOr32等等。这些函数可以直接使用，因为它们是原子操作。</p>
<p>iOS中的 mutex 对应的是 NSLock，它遵循 NSLooking协议，我们可以使用 lock, tryLock, lockBeforeData:来加锁，用 unLock来解锁。使用示例：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">BOOL</span> moreToDo = <span class="literal">YES</span>;</div><div class="line"><span class="built_in">NSLock</span> *theLock = [[<span class="built_in">NSLock</span> alloc] init];</div><div class="line"></div><div class="line"><span class="keyword">while</span> (moreToDo) &#123;</div><div class="line">	<span class="comment">// Do another increment of calculation</span></div><div class="line">	<span class="comment">// until there’s no more to do. </span></div><div class="line">	<span class="keyword">if</span> ([theLock tryLock]) &#123;</div><div class="line">		<span class="comment">//Update display used by all threads.</span></div><div class="line">		[theLock unlock];</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们可以使用指令 @synchronized 来简化 NSLock的使用，这样我们就不必显示编写创建NSLock,加锁并解锁相关代码。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)myMethod:(<span class="keyword">id</span>)anObj</div><div class="line">&#123;</div><div class="line">	<span class="keyword">@synchronized</span>(anObj)</div><div class="line">	&#123;</div><div class="line">		<span class="comment">// Everything between the braces is protected by the @synchronized directive.</span></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>还有其他的一些锁对象，比如：循环锁NSRecursiveLock，条件锁NSConditionLock，分布式锁NSDistributedLock等等，在这里就不一一介绍了，大家去看官方文档吧。</p>
<p>用NSCodition同步执行的顺序<br>NSCodition 是一种特殊类型的锁，我们可以用它来同步操作执行的顺序。它与 mutex 的区别在于更加精准，等待某个 NSCondtion 的线程一直被 lock，直到其他线程给那个 condition 发送了信号。下面我们来看使用示例：</p>
<p>某个线程等待着事情去做，而有没有事情做是由其他线程通知它的。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[cocoaCondition lock];</div><div class="line"><span class="keyword">while</span> (timeToDoWork &lt;= <span class="number">0</span>)</div><div class="line">[cocoaCondition wait];</div><div class="line"></div><div class="line">timeToDoWork–;</div><div class="line"><span class="comment">// Do real work here.</span></div><div class="line">[cocoaCondition unlock];</div></pre></td></tr></table></figure>
<p>其他线程发送信号通知上面的线程可以做事情了：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[cocoaCondition lock];</div><div class="line">timeToDoWork++;</div><div class="line">[cocoaCondition signal];</div><div class="line">[cocoaCondition unlock];</div></pre></td></tr></table></figure></p>
<p>线程间通信<br>线程在运行过程中，可能需要与其它线程进行通信。我们可以使用 NSObject 中的一些方法：<br>在应用程序主线程中做事情：<br><br><code>performSelectorOnMainThread:withObject:waitUntilDone:</code><br><code>performSelectorOnMainThread:withObject:waitUntilDone:modes:</code></p>
<p>在指定线程中做事情：<br><br><code>performSelector:onThread:withObject:waitUntilDone:</code><br><code>performSelector:onThread:withObject:waitUntilDone:modes:</code></p>
<p>在当前线程中做事情：<br><br><code>performSelector:withObject:afterDelay:</code><br><code>performSelector:withObject:afterDelay:inModes:</code></p>
<p>取消发送给当前线程的某个消息<br><br><code>cancelPreviousPerformRequestsWithTarget:</code><br><code>cancelPreviousPerformRequestsWithTarget:selector:object:</code></p>
<p>如在我们在某个线程中下载数据，下载完成之后要通知主线程中更新界面等等，可以使用如下接口：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)myThreadMainMethod</div><div class="line">&#123;</div><div class="line">	<span class="built_in">NSAutoreleasePool</span> *pool = [[<span class="built_in">NSAutoreleasePool</span> alloc] init];</div><div class="line">	<span class="comment">// to do something in your thread job</span></div><div class="line">	[<span class="keyword">self</span> performSelectorOnMainThread:<span class="keyword">@selector</span>(updateUI) withObject:<span class="literal">nil</span> waitUntilDone:<span class="literal">NO</span>];</div><div class="line">	[pool release];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###RunLoop</p>
<p>说到 NSThread 就不能不说起与之关系相当紧密的 NSRunLoop。Run loop 相当于 win32 里面的消息循环机制，它可以让你根据事件/消息（鼠标消息，键盘消息，计时器消息等）来调度线程是忙碌还是闲置。<br>系统会自动为应用程序的主线程生成一个与之对应的run loop来处理其消息循环。在触摸UIView时之所以能够激发touchesBegan/touchesMoved等等函数被调用，就是因为应用程序的主线程在UIApplicationMain里面有这样一个run loop在分发input或timer事件。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/01/23/guan-yu-shi-xian-ios7shang-mian-blurxiao-guo-de-shi-xian/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/01/23/guan-yu-shi-xian-ios7shang-mian-blurxiao-guo-de-shi-xian/" itemprop="url">
                  关于实现iOS7上面Blur效果的实现
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-01-23T18:13:00+08:00">
              2014-01-23
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/01/23/guan-yu-shi-xian-ios7shang-mian-blurxiao-guo-de-shi-xian/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/01/23/guan-yu-shi-xian-ios7shang-mian-blurxiao-guo-de-shi-xian/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前几个月iOS7发布，说实话界面扁平化，个人不是很喜欢，但是它的一些效果还是比较炫的，比如Blur效果，看下图 <br><br><img src="/uploads/2014-01-23/photo1_normal-169x300.png" alt="photo1_normal" width="169" height="300" class="alignnone size-medium wp-image-43"><br><img src="/uploads/2014-01-23/photo2_normal-169x300.png" alt="photo2_normal" width="169" height="300" class="alignnone size-medium wp-image-44"></p>
<p>右边的图片，有个Blur效果，最近PM正想将这个效果添加到我们的产品中，查看网上说，苹果是通过直接从GPU里面取出图片信息，然后render出来的，也没有公用的API可以调用。不过有类似的方法可以模拟这个效果，比如Gaussian Blur，这个是通过CoreImage.framework里面的CIFilter实现的，具体实现如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGImageCreateWithImageInRect</span>(image.CGImage, frame);</div><div class="line">    </div><div class="line"><span class="built_in">CIImage</span> *imageToBlur = [<span class="built_in">CIImage</span> imageWithCGImage:imageRef];</div><div class="line"><span class="built_in">CIFilter</span> *blurFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIGaussianBlur"</span>];</div><div class="line">[blurFilter setValue:imageToBlur forKey:<span class="string">@"inputImage"</span>];</div><div class="line">[blurFilter setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">0.1</span>f] forKey:<span class="string">@"inputRadius"</span>];</div><div class="line"><span class="built_in">CIImage</span>* result = [blurFilter valueForKey:<span class="string">@"outputImage"</span>];</div><div class="line">    </div><div class="line"><span class="built_in">CIContext</span>* context = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</div><div class="line"><span class="built_in">CGImageRef</span> cgImage = [context createCGImage:result fromRect:[imageToBlur extent]];</div><div class="line">    </div><div class="line"><span class="built_in">UIImage</span>* newImage = [<span class="built_in">UIImage</span> imageWithCGImage:cgImage];</div></pre></td></tr></table></figure><br>这样就可以得到一个模糊的效果。但是这种模糊有2个缺点：<br>1.如果设置的半径比较大，效率会很低<br>2.模糊以后的效果不好</p>
<p>后来在网上查到可以用boxblur算法，这个会用到Accelerate.framework里面的一个函数vImageBoxConvolve_ARGB8888，具体实现如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">UIImage</span>*)imageWithBoxBlur:(<span class="built_in">CGFloat</span>)blur withBoxSize:(<span class="keyword">int</span>)iSize</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (blur &lt; <span class="number">0.</span>f || blur &gt; <span class="number">1.</span>f) &#123;</div><div class="line">        blur = <span class="number">0.5</span>f;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">int</span> boxSize = (<span class="keyword">int</span>)(blur * iSize);</div><div class="line">    boxSize = boxSize - (boxSize % <span class="number">2</span>) + <span class="number">1</span>;</div><div class="line"></div><div class="line">    <span class="built_in">CGImageRef</span> img = <span class="keyword">self</span>.CGImage;</div><div class="line">    vImage_Buffer inBuffer, outBuffer;</div><div class="line">    vImage_Error error;</div><div class="line">    <span class="keyword">void</span> *pixelBuffer;</div><div class="line"></div><div class="line">    <span class="comment">//create vImage_Buffer with data from CGImageRef</span></div><div class="line">    <span class="built_in">CGDataProviderRef</span> inProvider = <span class="built_in">CGImageGetDataProvider</span>(img);</div><div class="line">    <span class="built_in">CFDataRef</span> inBitmapData = <span class="built_in">CGDataProviderCopyData</span>(inProvider);</div><div class="line"></div><div class="line">    inBuffer.width = <span class="built_in">CGImageGetWidth</span>(img);</div><div class="line">    inBuffer.height = <span class="built_in">CGImageGetHeight</span>(img);</div><div class="line">    inBuffer.rowBytes = <span class="built_in">CGImageGetBytesPerRow</span>(img);</div><div class="line"></div><div class="line">    inBuffer.data = (<span class="keyword">void</span>*)<span class="built_in">CFDataGetBytePtr</span>(inBitmapData);</div><div class="line"></div><div class="line">    <span class="comment">//create vImage_Buffer for output</span></div><div class="line">    pixelBuffer = malloc(<span class="built_in">CGImageGetBytesPerRow</span>(img) * <span class="built_in">CGImageGetHeight</span>(img));</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(pixelBuffer == <span class="literal">NULL</span>)</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"No pixelbuffer"</span>);</div><div class="line"></div><div class="line">    outBuffer.data = pixelBuffer;</div><div class="line">    outBuffer.width = <span class="built_in">CGImageGetWidth</span>(img);</div><div class="line">    outBuffer.height = <span class="built_in">CGImageGetHeight</span>(img);</div><div class="line">    outBuffer.rowBytes = <span class="built_in">CGImageGetBytesPerRow</span>(img);</div><div class="line"></div><div class="line">    <span class="comment">//perform convolution</span></div><div class="line">    error = vImageBoxConvolve_ARGB8888(&amp;inBuffer, &amp;outBuffer, <span class="literal">NULL</span>, <span class="number">0</span>, <span class="number">0</span>, boxSize, boxSize, <span class="literal">NULL</span>, kvImageEdgeExtend);</div><div class="line"></div><div class="line">    <span class="keyword">if</span> (error) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"error from convolution %ld"</span>, error);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</div><div class="line">    <span class="built_in">CGContextRef</span> ctx = <span class="built_in">CGBitmapContextCreate</span>(outBuffer.data,</div><div class="line">                                             outBuffer.width,</div><div class="line">                                             outBuffer.height,</div><div class="line">                                             <span class="number">8</span>,</div><div class="line">                                             outBuffer.rowBytes,</div><div class="line">                                             colorSpace,</div><div class="line">                                             (<span class="built_in">CGBitmapInfo</span>)kCGImageAlphaNoneSkipLast);</div><div class="line">    <span class="built_in">CGImageRef</span> imageRef = <span class="built_in">CGBitmapContextCreateImage</span> (ctx);</div><div class="line">    <span class="built_in">UIImage</span> *returnImage = [<span class="built_in">UIImage</span> imageWithCGImage:imageRef];</div><div class="line"></div><div class="line">    <span class="comment">//clean up</span></div><div class="line">    <span class="built_in">CGContextRelease</span>(ctx);</div><div class="line">    <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</div><div class="line"></div><div class="line">    free(pixelBuffer);</div><div class="line">    <span class="comment">//free(pixelBuffer2);</span></div><div class="line">    <span class="built_in">CFRelease</span>(inBitmapData);</div><div class="line"></div><div class="line">    <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</div><div class="line">    <span class="built_in">CGImageRelease</span>(imageRef);</div><div class="line"></div><div class="line">    <span class="keyword">return</span> returnImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure><br>这个boxblur有个2个优点：<br></p>
<ol>
<li>速度很快<br></li>
<li>模糊以后的效果很好<br><br>正好弥补了Gaussian Blur的缺点，但是这个boxblur也有个致命的缺点就是，如果一张图片既有深色区域又有浅色区域，模糊以后，深色区域的颜色就不对了。过几天我再来补图。<br>后来无意中发现，如果先用Gaussian blur以后，再用boxblur几次，效果比较好。还是过几天来补图，呵呵，这几天比较忙，一直在做PM的Spec，虽然都是界面的东西，对我一个计算机半路出家的人来说还是优点难度的。以下是效果图，外加公司的产品。</li>
</ol>
<p><img src="/uploads/2014-01-23/iOS-Simulator-Screen-shot-Sep-4-2013-7.43.34-PM-300x225.png" alt="blur以后的效果图" width="300" height="225" class="size-medium wp-image-48"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/01/13/guan-yu-calayerhe-uiview-animationtong-bu-wen-ti/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/01/13/guan-yu-calayerhe-uiview-animationtong-bu-wen-ti/" itemprop="url">
                  关于CALAYER和UIVIEW ANIMATION同步问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-01-13T18:08:00+08:00">
              2014-01-13
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/01/13/guan-yu-calayerhe-uiview-animationtong-bu-wen-ti/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/01/13/guan-yu-calayerhe-uiview-animationtong-bu-wen-ti/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>今天在做项目的时候, 同时用到了CABasicAnimation和UIView的animation， 发现会有问题，calayer的animation和uiview的animation不同步，比如CALayer设置position的animation</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CABasicAnimation</span>* animation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</div><div class="line">animation.fromValue = [<span class="built_in">NSValue</span> valueWithCGPoint:startpoint];</div><div class="line">animation.toValue = [<span class="built_in">NSValue</span> valueWithCGPoint:endpoint];</div><div class="line">animation.duration = INFO_WINDOW_SLIDE_ANIMATION_TIME;</div><div class="line">animation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</div><div class="line">[blurredLayer addAnimation:animation forKey:<span class="string">@"appear"</span>];</div></pre></td></tr></table></figure>
<p>UIView 的animation：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">backgroundView.frame = startframe;</div><div class="line">[<span class="built_in">UIView</span> animateWithDuration:INFO_WINDOW_SLIDE_ANIMATION_TIME delay:<span class="number">0</span> options:<span class="built_in">UIViewAnimationOptionCurveEaseIn</span> animations:^&#123;</div><div class="line">        backgroundView.frame = endframe;</div><div class="line">&#125; completion:<span class="literal">NULL</span>];</div></pre></td></tr></table></figure></p>
<p>blurredLayer会抖动。后来再stackoverflow上面找到解决方法是将CALayer的animation换成<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">blurredLayer.position = startpoint;</div><div class="line">[<span class="built_in">CATransaction</span> begin];</div><div class="line">[<span class="built_in">CATransaction</span> setAnimationDuration:INFO_WINDOW_SLIDE_ANIMATION_TIME];</div><div class="line">[<span class="built_in">CATransaction</span> setAnimationTimingFunction:[<span class="built_in">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn]];</div><div class="line">blurredLayer.position = endpoint;</div><div class="line">[<span class="built_in">CATransaction</span> commit];</div></pre></td></tr></table></figure><br>这样两个animation就同步了，具体原因不详。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/12/31/yuan-chuang-xie-zai-2013-nian-mo-wei/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/31/yuan-chuang-xie-zai-2013-nian-mo-wei/" itemprop="url">
                  [原创] 写在2013年末尾
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-31T00:00:00+08:00">
              2013-12-31
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生活/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/12/31/yuan-chuang-xie-zai-2013-nian-mo-wei/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/12/31/yuan-chuang-xie-zai-2013-nian-mo-wei/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><p style="text-align: center;"><a href="http://www.njiang1987.com/wp-content/uploads/2013/12/46497-5NM9UKf.jpg" target="_blank" rel="external"><img class="size-medium wp-image-233 aligncenter" title="我的女神Anglebaby" alt="46497-5NM9UKf" src="http://www.njiang1987.com/wp-content/uploads/2013/12/46497-5NM9UKf-300x191.jpg" width="300" height="191"></a></p><br>今天是2013年的最后一天，总觉得不写点东西的话今年就不完整。那就大体总结一下今年所获得的成就吧。<p></p>

<p>2013年成就：</p>

<p>1. 搭建起了自己的Blog，当时就是大家看的这个，购买域名，用WordPress搭建，购买服务器，这也许是我今年最大的成就了。</p>

<p>2. 今年6月份用3天半的时间、独自一人骑单车从杭州出发绕太湖环了一圈，总里程450公里。</p>

<p>3. 今年10月份，和斌哥、天师、xusheng骑自行车环千岛湖一圈，路程不是特别长，200公里，但是坡很多，2天下来也很累。</p>

<p>4. 工作上能有一点点起色，至少能独立做点小东西出来，transparent info window、selector iOS 7 redesign、info window redesign 还有NGB refactor， 东西虽然不大，但是慢慢积累下来，今年也学了不少东西。</p>

<p>5. 和老师、天师、神QEjunjuan，一起参加公司组织的Hackathon， 虽然没拿到什么奖，但是在短短的2天里面学到了怎么搭建webservice，还有怎么破解window login，mac自动登录（虽然是用脚本模拟键盘输入来实现自动登录）、在XCode里面用storyboard来创建view。</p>

<p>6. 用一个月的工资买了一台MacBook pro MD212，这对我来说算是比较大得开支，总觉得要对得起这个月的工资，以后要好好利用这台mbp做出点东西来。</p>

<p>7. 看完了5-6本书，看书对我来说已经是很奢侈的了，从小到大就不喜欢看书，一是看不进去；二是没有持之以恒的精神；三是总觉得回忘，索性就不看了。</p>

<p>8. 给爸妈买了台洗衣机，让他们能减轻点负担。</p>

<p>9. 终于从上一段感情挫败中走了出来，这花了我整整一年的时间，也许这就是人生，人生道路中总会碰到些形形色色的人，总会遇到点坎坷，不能因为这点挫折，就裹足不前。说不定前面还有更好的人等着你，期待明年转角的功夫就能遇到我命中注定的另一半。</p>

<p>10. 今年好好追了几部剧，《我们结婚吧》，看了《神探狄仁杰之神都龙王》，迷上了Anglebaby，块奔3的人了终于有了追星的冲动。</p>

<p>11. 学会了蛙泳，保命技能，以后掉水了还能捡回一条命。</p>

<p>12. 11月12日去上海参加了Apple 的iOS 7 tech talk，英文虽然没怎么听懂，但是回来又学到了许多知识。</p>

<p>2014年计划：</p>

<p>1. 环台湾岛一圈，具体时间再定，（护照及港澳台通行证已经办完）。</p>

<p>2. 至少读10本书，包括历史、地理、天文、小说，开阔下眼界。</p>

<p>3. 寻找提高工作效率的方法，能更快更好的完成工作，能抽出一点时间能学点自己技术领域以外的技术。</p>

<p>4. 至少开发2个App程序并提交到Appstore上面去，要免费，好玩。</p>

<p>5. 要运动，每天都要抽出一点时间来锻炼身体。</p>

<p>6. 好好看托福，明年考托福，以后每天下班要抽出1-2个小时来学习英语。</p>

<p>7. 学习linux内核，还有算法，争取明年topcoder能独立解决一部分题目。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/12/30/lldb-the-lldb-debugger/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/30/lldb-the-lldb-debugger/" itemprop="url">
                  [lldb] The LLDB Debugger
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-30T00:00:00+08:00">
              2013-12-30
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/12/30/lldb-the-lldb-debugger/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/12/30/lldb-the-lldb-debugger/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><h1>GDB TO LLDB COMMAND MAP</h1><br><div><p></p>

<p>Below is a table of GDB commands with the LLDB counterparts. The built in GDB-compatibility aliases in LLDB are also listed. The full lldb command names are often long, but any unique short form can be used. Instead of “<b>breakpoint set</b>“, “<b>br se</b>“ is also acceptable.</p>

<p><br><div></div><br></p><h1>EXECUTION COMMANDS</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Launch a process no arguments.</td><br></tr><br><tr><br><td><b>(gdb)</b> run<br><b>(gdb)</b> r</td><br><td><b>(lldb)</b> process launch<br><b>(lldb)</b> run<br><b>(lldb)</b> r</td><br></tr><br><tr><br><td colspan="2">Launch a process with arguments <code>&lt;args&gt;</code>.</td><br></tr><br><tr><br><td><b>(gdb)</b> run &lt;args&gt;<br><b>(gdb)</b> r &lt;args&gt;</td><br><td><b>(lldb)</b> process launch – &lt;args&gt;<br><b>(lldb)</b> r &lt;args&gt;</td><br></tr><br><tr><br><td colspan="2">Launch a process for with arguments <b><code>a.out 1 2 3</code></b> without having to supply the args every time.</td><br></tr><br><tr><br><td><b>%</b> gdb –args a.out 1 2 3<br><b>(gdb)</b> run<br><br>…<br><b>(gdb)</b> run<br><br>…</td><br><td><b>%</b> lldb – a.out 1 2 3<br><b>(lldb)</b> run<br><br>…<br><b>(lldb)</b> run<br><br>…</td><br></tr><br><tr><br><td colspan="2">Or:</td><br></tr><br><tr><br><td><b>(gdb)</b> set args 1 2 3<br><b>(gdb)</b> run<br><br>…<br><b>(gdb)</b> run<br><br>…</td><br><td><b>(lldb)</b> settings set target.run-args 1 2 3<br><b>(lldb)</b> run<br><br>…<br><b>(lldb)</b> run<br><br>…</td><br></tr><br><tr><br><td colspan="2">Launch a process with arguments in new terminal window (Mac OS X only).</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> process launch –tty – &lt;args&gt;<br><b>(lldb)</b> pro la -t – &lt;args&gt;</td><br></tr><br><tr><br><td colspan="2">Launch a process with arguments in existing terminal /dev/ttys006 (Mac OS X only).</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> process launch –tty=/dev/ttys006 – &lt;args&gt;<br><b>(lldb)</b> pro la -t/dev/ttys006 – &lt;args&gt;</td><br></tr><br><tr><br><td colspan="2">Set environment variables for process before launching.</td><br></tr><br><tr><br><td><b>(gdb)</b> set env DEBUG 1</td><br><td><b>(lldb)</b> settings set target.env-vars DEBUG=1<br><b>(lldb)</b> set se target.env-vars DEBUG=1<br><b>(lldb)</b> env DEBUG=1</td><br></tr><br><tr><br><td colspan="2">Show the arguments that will be or were passed to the program when run.</td><br></tr><br><tr><br><td><b>(gdb)</b> show args<br><br>Argument list to give program being debugged when it is started is “1 2 3”.</td><br><td><b>(lldb)</b> settings show target.run-args<br><br>target.run-args (array of strings) =<br><br>[0]: “1”<br><br>[1]: “2”<br><br>[2]: “3”</td><br></tr><br><tr><br><td colspan="2">Set environment variables for process and launch process in one command.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> process launch -v DEBUG=1</td><br></tr><br><tr><br><td colspan="2">Attach to a process with process ID 123.</td><br></tr><br><tr><br><td><b>(gdb)</b> attach 123</td><br><td><b>(lldb)</b> process attach –pid 123<br><b>(lldb)</b> attach -p 123</td><br></tr><br><tr><br><td colspan="2">Attach to a process named “a.out”.</td><br></tr><br><tr><br><td><b>(gdb)</b> attach a.out</td><br><td><b>(lldb)</b> process attach –name a.out<br><b>(lldb)</b> pro at -n a.out</td><br></tr><br><tr><br><td colspan="2">Wait for a process named “a.out” to launch and attach.</td><br></tr><br><tr><br><td><b>(gdb)</b> attach -waitfor a.out</td><br><td><b>(lldb)</b> process attach –name a.out –waitfor<br><b>(lldb)</b> pro at -n a.out -w</td><br></tr><br><tr><br><td colspan="2">Attach to a remote gdb protocol server running on system “eorgadd”, port 8000.</td><br></tr><br><tr><br><td><b>(gdb)</b> target remote eorgadd:8000</td><br><td><b>(lldb)</b> gdb-remote eorgadd:8000</td><br></tr><br><tr><br><td colspan="2">Attach to a remote gdb protocol server running on the local system, port 8000.</td><br></tr><br><tr><br><td><b>(gdb)</b> target remote localhost:8000</td><br><td><b>(lldb)</b> gdb-remote 8000</td><br></tr><br><tr><br><td colspan="2">Attach to a Darwin kernel in kdp mode on system “eorgadd”.</td><br></tr><br><tr><br><td><b>(gdb)</b> kdp-reattach eorgadd</td><br><td><b>(lldb)</b> kdp-remote eorgadd</td><br></tr><br><tr><br><td colspan="2">Do a source level single step in the currently selected thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> step<br><b>(gdb)</b> s</td><br><td><b>(lldb)</b> thread step-in<br><b>(lldb)</b> step<br><b>(lldb)</b> s</td><br></tr><br><tr><br><td colspan="2">Do a source level single step over in the currently selected thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> next<br><b>(gdb)</b> n</td><br><td><b>(lldb)</b> thread step-over<br><b>(lldb)</b> next<br><b>(lldb)</b> n</td><br></tr><br><tr><br><td colspan="2">Do an instruction level single step in the currently selected thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> stepi<br><b>(gdb)</b> si</td><br><td><b>(lldb)</b> thread step-inst<br><b>(lldb)</b> si</td><br></tr><br><tr><br><td colspan="2">Do an instruction level single step over in the currently selected thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> nexti<br><b>(gdb)</b> ni</td><br><td><b>(lldb)</b> thread step-inst-over<br><b>(lldb)</b> ni</td><br></tr><br><tr><br><td colspan="2">Step out of the currently selected frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> finish</td><br><td><b>(lldb)</b> thread step-out<br><b>(lldb)</b> finish</td><br></tr><br><tr><br><td colspan="2">Return immediately from the currently selected frame, with an optional return value.</td><br></tr><br><tr><br><td><b>(gdb)</b> return &lt;RETURN EXPRESSION&gt;</td><br><td><b>(lldb)</b> thread return &lt;RETURN EXPRESSION&gt;</td><br></tr><br><tr><br><td colspan="2">Backtrace and disassemble every time you stop.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> target stop-hook add<br><br>Enter your stop hook command(s). Type ‘DONE’ to end.<br><br>&gt; bt<br><br>&gt; disassemble –pc<br><br>&gt; DONE<br><br>Stop hook #1 added.</td><br></tr><br></tbody><br></table><br>&nbsp;</p>

<p><br><div></div><br></p><h1>BREAKPOINT COMMANDS</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint at all functions named <b>main</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> break main</td><br><td><b>(lldb)</b> breakpoint set –name main<br><b>(lldb)</b> br s -n main<br><b>(lldb)</b> b main</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint in file <b>test.c</b> at line <b>12</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> break test.c:12</td><br><td><b>(lldb)</b> breakpoint set –file test.c –line 12<br><b>(lldb)</b> br s -f test.c -l 12<br><b>(lldb)</b> b test.c:12</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint at all C++ methods whose basename is <b>main</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> break main<br><i>(Hope that there are no C funtions named <b>main</b>)</i>.</td><br><td><b>(lldb)</b> breakpoint set –method main<br><b>(lldb)</b> br s -M main</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint at and object C function: <b>-[NSString stringWithFormat:]</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> break -[NSString stringWithFormat:]</td><br><td><b>(lldb)</b> breakpoint set –name “-[NSString stringWithFormat:]”<br><b>(lldb)</b> b -[NSString stringWithFormat:]</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint at all Objective C methods whose selector is <b>count</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> break count<br><i>(Hope that there are no C or C++ funtions named<b>count</b>)</i>.</td><br><td><b>(lldb)</b> breakpoint set –selector count<br><b>(lldb)</b> br s -S count</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint by regular expression on function name.</td><br></tr><br><tr><br><td><b>(gdb)</b> rbreak regular-expression</td><br><td><b>(lldb)</b> breakpoint set –func-regex regular-expression<br><b>(lldb)</b> br s -r regular-expression</td><br></tr><br><tr><br><td colspan="2">Ensure that breakpoints by file and line work for #included .c/.cpp/.m files.</td><br></tr><br><tr><br><td><b>(gdb)</b> b foo.c:12</td><br><td><b>(lldb)</b> settings set target.inline-breakpoint-strategy always<br><b>(lldb)</b> br s -f foo.c -l 12</td><br></tr><br><tr><br><td colspan="2">Set a breakpoint by regular expression on source file contents.</td><br></tr><br><tr><br><td><b>(gdb)</b> shell grep -e -n pattern source-file<br><b>(gdb)</b> break source-file:CopyLineNumbers</td><br><td><b>(lldb)</b> breakpoint set –source-pattern regular-expression –file SourceFile<br><b>(lldb)</b> br s -p regular-expression -f file</td><br></tr><br><tr><br><td colspan="2">List all breakpoints.</td><br></tr><br><tr><br><td><b>(gdb)</b> info break</td><br><td><b>(lldb)</b> breakpoint list<br><b>(lldb)</b> br l</td><br></tr><br><tr><br><td colspan="2">Delete a breakpoint.</td><br></tr><br><tr><br><td><b>(gdb)</b> delete 1</td><br><td><b>(lldb)</b> breakpoint delete 1<br><b>(lldb)</b> br del 1</td><br></tr><br></tbody><br></table><br>&nbsp;</p>

<p><br><div></div><br></p><h1>WATCHPOINT COMMANDS</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Set a watchpoint on a variable when it is written to.</td><br></tr><br><tr><br><td><b>(gdb)</b> watch global_var</td><br><td><b>(lldb)</b> watchpoint set variable global_var<br><b>(lldb)</b> wa s v global_var</td><br></tr><br><tr><br><td colspan="2">Set a watchpoint on a memory location when it is written into. The size of the region to watch for defaults to the pointer size if no ‘-x byte_size’ is specified. This command takes raw input, evaluated as an expression returning an unsigned integer pointing to the start of the region, after the ‘–’ option terminator.</td><br></tr><br><tr><br><td><b>(gdb)</b> watch -location g_char_ptr</td><br><td><b>(lldb)</b> watchpoint set expression – my_ptr<br><b>(lldb)</b> wa s e – my_ptr</td><br></tr><br><tr><br><td colspan="2">Set a condition on a watchpoint.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> watch set var global<br><b>(lldb)</b> watchpoint modify -c ‘(global==5)’<br><b>(lldb)</b> c<br><br>…<br><b>(lldb)</b> bt<br><br>* thread #1: tid = 0x1c03, 0x0000000100000ef5 a.out<code>modify + 21 at main.cpp:16, stop reason = watchpoint 1&lt;br /&gt;
frame #0: 0x0000000100000ef5 a.out</code>modify + 21 at main.cpp:16<br><br>frame #1: 0x0000000100000eac a.out<code>main + 108 at main.cpp:25&lt;br /&gt;
frame #2: 0x00007fff8ac9c7e1 libdyld.dylib</code>start + 1<br><b>(lldb)</b> frame var global<br><br>(int32_t) global = 5</td><br></tr><br><tr><br><td colspan="2">List all watchpoints.</td><br></tr><br><tr><br><td><b>(gdb)</b> info break</td><br><td><b>(lldb)</b> watchpoint list<br><b>(lldb)</b> watch l</td><br></tr><br><tr><br><td colspan="2">Delete a watchpoint.</td><br></tr><br><tr><br><td><b>(gdb)</b> delete 1</td><br><td><b>(lldb)</b> watchpoint delete 1<br><b>(lldb)</b> watch del 1</td><br></tr><br></tbody><br></table><br>&nbsp;</p>

<p><br><div></div><br></p><h1>EXAMINING VARIABLES</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Show the arguments and local variables for the current frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> info args<br><br>and<br><b>(gdb)</b> info locals</td><br><td><b>(lldb)</b> frame variable<br><b>(lldb)</b> fr v</td><br></tr><br><tr><br><td colspan="2">Show the local variables for the current frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> info locals</td><br><td><b>(lldb)</b> frame variable –no-args<br><b>(lldb)</b> fr v -a</td><br></tr><br><tr><br><td colspan="2">Show the contents of local variable “bar”.</td><br></tr><br><tr><br><td><b>(gdb)</b> p bar</td><br><td><b>(lldb)</b> frame variable bar<br><b>(lldb)</b> fr v bar<br><b>(lldb)</b> p bar</td><br></tr><br><tr><br><td colspan="2">Show the contents of local variable “bar” formatted as hex.</td><br></tr><br><tr><br><td><b>(gdb)</b> p/x bar</td><br><td><b>(lldb)</b> frame variable –format x bar<br><b>(lldb)</b> fr v -f x bar</td><br></tr><br><tr><br><td colspan="2">Show the contents of global variable “baz”.</td><br></tr><br><tr><br><td><b>(gdb)</b> p baz</td><br><td><b>(lldb)</b> target variable baz<br><b>(lldb)</b> ta v baz</td><br></tr><br><tr><br><td colspan="2">Show the global/static variables defined in the current source file.</td><br></tr><br><tr><br><td>n/a</td><br><td><b>(lldb)</b> target variable<br><b>(lldb)</b> ta v</td><br></tr><br><tr><br><td colspan="2">Display a the variable “argc” and “argv” every time you stop.</td><br></tr><br><tr><br><td><b>(gdb)</b> display argc<br><b>(gdb)</b> display argv</td><br><td><b>(lldb)</b> target stop-hook add –one-liner “frame variable argc argv”<br><b>(lldb)</b> ta st a -o “fr v argc argv”<br><b>(lldb)</b> display argc<br><b>(lldb)</b> display argv</td><br></tr><br><tr><br><td colspan="2">Display a the variable “argc” and “argv” only when you stop in the function named <b>main</b>.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> target stop-hook add –name main –one-liner “frame variable argc argv”<br><b>(lldb)</b> ta st a -n main -o “fr v argc argv”</td><br></tr><br><tr><br><td colspan="2">Display the variable “<em>this” only when you stop in c class named <b>MyClass</b>.</em></td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> target stop-hook add –classname MyClass –one-liner “frame variable this”<br><b>(lldb)</b> ta st a -c MyClass -o “fr v *this”</td><br></tr><br></tbody><br></table><br>&nbsp;</p>

<p><br></p><h1>EVALUATING EXPRESSIONS</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Evaluating a generalized expression in the current frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> print (int) printf (“Print nine: %d.”, 4 + 5)<br><br>or if you don’t want to see void returns:<br><b>(gdb)</b> call (int) printf (“Print nine: %d.”, 4 + 5)</td><br><td><b>(lldb)</b> expr (int) printf (“Print nine: %d.”, 4 + 5)<br><br>or using the print alias:<br><b>(lldb)</b> print (int) printf (“Print nine: %d.”, 4 + 5)</td><br></tr><br><tr><br><td colspan="2">Creating and assigning a value to a convenience variable.</td><br></tr><br><tr><br><td><b>(gdb)</b> set $foo = 5<br><b>(gdb)</b> set variable $foo = 5<br><br>or using the print command<br><b>(gdb)</b> print $foo = 5<br><br>or using the call command<br><b>(gdb)</b> call $foo = 5<br><br>and if you want to specify the type of the variable:<b>(gdb)</b> set $foo = (unsigned int) 5</td><br><td>In lldb you evaluate a variable declaration expression as you would write it in C:<br><b>(lldb)</b> expr unsigned int $foo = 5</td><br></tr><br><tr><br><td colspan="2">Printing the ObjC “description” of an object.</td><br></tr><br><tr><br><td><b>(gdb)</b> po [SomeClass returnAnObject]</td><br><td><b>(lldb)</b> expr -o – [SomeClass returnAnObject]<br><br>or using the po alias:<br><b>(lldb)</b> po [SomeClass returnAnObject]</td><br></tr><br><tr><br><td colspan="2">Print the dynamic type of the result of an expression.</td><br></tr><br><tr><br><td><b>(gdb)</b> set print object 1<br><b>(gdb)</b> p someCPPObjectPtrOrReference<br><br>only works for C++ objects.</td><br><td><b>(lldb)</b> expr -d 1 – [SomeClass returnAnObject]<br><b>(lldb)</b> expr -d 1 – someCPPObjectPtrOrReference<br><br>or set dynamic type printing to be the default: <b>(lldb)</b>settings set target.prefer-dynamic run-target</td><br></tr><br><tr><br><td colspan="2">Calling a function so you can stop at a breakpoint in the function.</td><br></tr><br><tr><br><td><b>(gdb)</b> set unwindonsignal 0<br><b>(gdb)</b> p function_with_a_breakpoint()</td><br><td><b>(lldb)</b> expr -i 0 – function_with_a_breakpoint()</td><br></tr><br><tr><br><td colspan="2">Calling a function that crashes, and stopping when the function crashes.</td><br></tr><br><tr><br><td><b>(gdb)</b> set unwindonsignal 0<br><b>(gdb)</b> p function_which_crashes()</td><br><td><b>(lldb)</b> expr -u 0 – function_which_crashes()</td><br></tr><br></tbody><br></table><br>&nbsp;</p>

<p><br></p><h1>EXAMINING THREAD STATE</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Show the stack backtrace for the current thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> bt</td><br><td><b>(lldb)</b> thread backtrace<br><b>(lldb)</b> bt</td><br></tr><br><tr><br><td colspan="2">Show the stack backtraces for all threads.</td><br></tr><br><tr><br><td><b>(gdb)</b> thread apply all bt</td><br><td><b>(lldb)</b> thread backtrace all<br><b>(lldb)</b> bt all</td><br></tr><br><tr><br><td colspan="2">Backtrace the first five frames of the current thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> bt 5</td><br><td><b>(lldb)</b> thread backtrace -c 5<br><b>(lldb)</b> bt 5 (<i>lldb-169 and later</i>)<br><b>(lldb)</b> bt -c 5 (<i>lldb-168 and earlier</i>)</td><br></tr><br><tr><br><td colspan="2">Select a different stack frame by index for the current thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> frame 12</td><br><td><b>(lldb)</b> frame select 12<br><b>(lldb)</b> fr s 12<br><b>(lldb)</b> f 12</td><br></tr><br><tr><br><td colspan="2">List information about the currently selected frame in the current thread.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> frame info</td><br></tr><br><tr><br><td colspan="2">Select the stack frame that called the current stack frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> up</td><br><td><b>(lldb)</b> up<br><b>(lldb)</b> frame select –relative=1</td><br></tr><br><tr><br><td colspan="2">Select the stack frame that is called by the current stack frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> down</td><br><td><b>(lldb)</b> down<br><b>(lldb)</b> frame select –relative=-1<br><b>(lldb)</b> fr s -r-1</td><br></tr><br><tr><br><td colspan="2">Select a different stack frame using a relative offset.</td><br></tr><br><tr><br><td><b>(gdb)</b> up 2<br><b>(gdb)</b> down 3</td><br><td><b>(lldb)</b> frame select –relative 2<br><b>(lldb)</b> fr s -r2</td></tr></tbody></table></p>

<p><b>(lldb)</b> frame select –relative -3<br><b>(lldb)</b> fr s -r-3<br><br><tr><br><td colspan="2">Show the general purpose registers for the current thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> info registers</td><br><td><b>(lldb)</b> register read</td><br></tr><br><tr><br><td colspan="2">Write a new decimal value ‘123’ to the current thread register ‘rax’.</td><br></tr><br><tr><br><td><b>(gdb)</b> p $rax = 123</td><br><td><b>(lldb)</b> register write rax 123</td><br></tr><br><tr><br><td colspan="2">Skip 8 bytes ahead of the current program counter (instruction pointer). Note that we use backticks to evaluate an expression and insert the scalar result in LLDB.</td><br></tr><br><tr><br><td><b>(gdb)</b> jump *$pc+8</td><br><td><b>(lldb)</b> register write pc <code>$pc+8</code></td><br></tr><br><tr><br><td colspan="2">Show the general purpose registers for the current thread formatted as <b>signed decimal</b>. LLDB tries to use the same format characters as <b>printf(3)</b> when possible. Type “help format” to see the full list of format specifiers.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> register read –format i<br><b>(lldb)</b> re r -f i</td></tr></p>

<p><i>LLDB now supports the GDB shorthand format syntax but there can’t be space after the command:</i><br><b>(lldb)</b> register read/d<br><br><tr><br><td colspan="2">Show all registers in all register sets for the current thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> info all-registers</td><br><td><b>(lldb)</b> register read –all<br><b>(lldb)</b> re r -a</td><br></tr><br><tr><br><td colspan="2">Show the values for the registers named “rax”, “rsp” and “rbp” in the current thread.</td><br></tr><br><tr><br><td><b>(gdb)</b> info all-registers rax rsp rbp</td><br><td><b>(lldb)</b> register read rax rsp rbp</td><br></tr><br><tr><br><td colspan="2">Show the values for the register named “rax” in the current thread formatted as <b>binary</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> p/t $rax</td><br><td><b>(lldb)</b> register read –format binary rax<br><b>(lldb)</b> re r -f b rax</td></tr></p>

<p><i>LLDB now supports the GDB shorthand format syntax but there can’t be space after the command:</i><br><b>(lldb)</b> register read/t rax<br><b>(lldb)</b> p/t $rax<br><br><tr><br><td colspan="2">Read memory from address 0xbffff3c0 and show 4 hex uint32_t values.</td><br></tr><br><tr><br><td><b>(gdb)</b> x/4xw 0xbffff3c0</td><br><td><b>(lldb)</b> memory read –size 4 –format x –count 4 0xbffff3c0<br><b>(lldb)</b> me r -s4 -fx -c4 0xbffff3c0<br><b>(lldb)</b> x -s4 -fx -c4 0xbffff3c0</td></tr></p>

<p><i>LLDB now supports the GDB shorthand format syntax but there can’t be space after the command:</i><br><b>(lldb)</b> memory read/4xw 0xbffff3c0<br><b>(lldb)</b> x/4xw 0xbffff3c0<br><b>(lldb)</b> memory read –gdb-format 4xw 0xbffff3c0<br><br><tr><br><td colspan="2">Read memory starting at the expression “argv[0]”.</td><br></tr><br><tr><br><td><b>(gdb)</b> x argv[0]</td><br><td><b>(lldb)</b> memory read <code>argv[0]</code><br><i><b>NOTE:</b> any command can inline a scalar expression result (as long as the target is stopped) using backticks around any expression:</i><br><b>(lldb)</b> memory read –size <code>sizeof(int)</code> <code>argv[0]</code></td><br></tr><br><tr><br><td colspan="2">Read 512 bytes of memory from address 0xbffff3c0 and save results to a local file as <b>text</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> set logging on<br><b>(gdb)</b> set logging file /tmp/mem.txt<br><b>(gdb)</b> x/512bx 0xbffff3c0<br><b>(gdb)</b> set logging off</td><br><td><b>(lldb)</b> memory read –outfile /tmp/mem.txt –count 512 0xbffff3c0<br><b>(lldb)</b> me r -o/tmp/mem.txt -c512 0xbffff3c0<br><b>(lldb)</b> x/512bx -o/tmp/mem.txt 0xbffff3c0</td><br></tr><br><tr><br><td colspan="2">Save binary memory data starting at 0x1000 and ending at 0x2000 to a file.</td><br></tr><br><tr><br><td><b>(gdb)</b> dump memory /tmp/mem.bin 0x1000 0x2000</td><br><td><b>(lldb)</b> memory read –outfile /tmp/mem.bin –binary 0x1000 0x1200<br><b>(lldb)</b> me r -o /tmp/mem.bin -b 0x1000 0x1200</td><br></tr><br><tr><br><td colspan="2">Get information about a specific heap allocation (available on Mac OS X only).</td><br></tr><br><tr><br><td><b>(gdb)</b> info malloc 0x10010d680</td><br><td><b>(lldb)</b> command script import lldb.macosx.heap<br><b>(lldb)</b> process launch –environment MallocStackLogging=1 – [ARGS]<br><b>(lldb)</b> malloc_info –stack-history 0x10010d680</td><br></tr><br><tr><br><td colspan="2">Get information about a specific heap allocation and cast the result to any dynamic type that can be deduced (available on Mac OS X only)</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> command script import lldb.macosx.heap<br><b>(lldb)</b> malloc_info –type 0x10010d680</td><br></tr><br><tr><br><td colspan="2">Find all heap blocks that contain a pointer specified by an expression EXPR (available on Mac OS X only).</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> command script import lldb.macosx.heap<br><b>(lldb)</b> ptr_refs EXPR</td><br></tr><br><tr><br><td colspan="2">Find all heap blocks that contain a C string anywhere in the block (available on Mac OS X only).</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> command script import lldb.macosx.heap<br><b>(lldb)</b> cstr_refs CSTRING</td><br></tr><br><tr><br><td colspan="2">Disassemble the current function for the current frame.</td><br></tr><br><tr><br><td><b>(gdb)</b> disassemble</td><br><td><b>(lldb)</b> disassemble –frame<br><b>(lldb)</b> di -f</td><br></tr><br><tr><br><td colspan="2">Disassemble any functions named <b>main</b>.</td><br></tr><br><tr><br><td><b>(gdb)</b> disassemble main</td><br><td><b>(lldb)</b> disassemble –name main<br><b>(lldb)</b> di -n main</td><br></tr><br><tr><br><td colspan="2">Disassemble an address range.</td><br></tr><br><tr><br><td><b>(gdb)</b> disassemble 0x1eb8 0x1ec3</td><br><td><b>(lldb)</b> disassemble –start-address 0x1eb8 –end-address 0x1ec3<br><b>(lldb)</b> di -s 0x1eb8 -e 0x1ec3</td><br></tr><br><tr><br><td colspan="2">Disassemble 20 instructions from a given address.</td><br></tr><br><tr><br><td><b>(gdb)</b> x/20i 0x1eb8</td><br><td><b>(lldb)</b> disassemble –start-address 0x1eb8 –count 20<br><b>(lldb)</b> di -s 0x1eb8 -c 20</td><br></tr><br><tr><br><td colspan="2">Show mixed source and disassembly for the current function for the current frame.</td><br></tr><br><tr><br><td>n/a</td><br><td><b>(lldb)</b> disassemble –frame –mixed<br><b>(lldb)</b> di -f -m</td><br></tr><br><tr><br><td colspan="2">Disassemble the current function for the current frame and show the opcode bytes.</td><br></tr><br><tr><br><td>n/a</td><br><td><b>(lldb)</b> disassemble –frame –bytes<br><b>(lldb)</b> di -f -b</td><br></tr><br><tr><br><td colspan="2">Disassemble the current source line for the current frame.</td><br></tr><br><tr><br><td>n/a</td><br><td><b>(lldb)</b> disassemble –line<br><b>(lldb)</b> di -l</td><br></tr><br><br><br>&nbsp;</p>

<p><br><div></div><br></p><h1>EXECUTABLE AND SHARED LIBRARY QUERY COMMANDS</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">List the main executable and all dependent shared libraries.</td><br></tr><br><tr><br><td><b>(gdb)</b> info shared</td><br><td><b>(lldb)</b> image list</td><br></tr><br><tr><br><td colspan="2">Look up information for a raw address in the executable or any shared libraries.</td><br></tr><br><tr><br><td><b>(gdb)</b> info symbol 0x1ec4</td><br><td><b>(lldb)</b> image lookup –address 0x1ec4<br><b>(lldb)</b> im loo -a 0x1ec4</td><br></tr><br><tr><br><td colspan="2">Look up functions matching a regular expression in a binary.</td><br></tr><br><tr><br><td><b>(gdb)</b> info function &lt;FUNC_REGEX&gt;</td><br><td>This one finds debug symbols:<br><b>(lldb)</b> image lookup -r -n &lt;FUNC_REGEX&gt;</td></tr></tbody></table></p>

<p>This one finds non-debug symbols:<br><b>(lldb)</b> image lookup -r -s &lt;FUNC_REGEX&gt;</p>

<p>Provide a list of binaries as arguments to limit the search.<br><br><tr><br><td colspan="2">Find full souce line information.</td><br></tr><br><tr><br><td><b>(gdb)</b> info line 0x1ec4</td><br><td>This one is a bit messy at present. Do:</td></tr></p>

<p><b>(lldb)</b> image lookup -v –address 0x1ec4</p>

<p>and look for the LineEntry line, which will have the full source path and line range information.<br><br><tr><br><td colspan="2">Look up information for an address in <b>a.out</b> only.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> image lookup –address 0x1ec4 a.out<br><b>(lldb)</b> im loo -a 0x1ec4 a.out</td><br></tr><br><tr><br><td colspan="2">Look up information for for a type <code>Point</code> by name.</td><br></tr><br><tr><br><td><b>(gdb)</b> ptype Point</td><br><td><b>(lldb)</b> image lookup –type Point<br><b>(lldb)</b> im loo -t Point</td><br></tr><br><tr><br><td colspan="2">Dump all sections from the main executable and any shared libraries.</td><br></tr><br><tr><br><td><b>(gdb)</b> maintenance info sections</td><br><td><b>(lldb)</b> image dump sections</td><br></tr><br><tr><br><td colspan="2">Dump all sections in the <b>a.out</b> module.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> image dump sections a.out</td><br></tr><br><tr><br><td colspan="2">Dump all symbols from the main executable and any shared libraries.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> image dump symtab</td><br></tr><br><tr><br><td colspan="2">Dump all symbols in <b>a.out</b> and <b>liba.so</b>.</td><br></tr><br><tr><br><td></td><br><td><b>(lldb)</b> image dump symtab a.out liba.so</td><br></tr><br><br><br>&nbsp;</p>

<p><br><div></div><br></p><h1>MISCELLANEOUS</h1><br><div><p></p>

<p>&nbsp;<br><table width="620" cellspacing="0"><br><tbody><br><tr><br><td width="50%">GDB</td><br><td width="50%">LLDB</td><br></tr><br><tr><br><td colspan="2">Echo text to the screen.</td><br></tr><br><tr><br><td><b>(gdb)</b> echo Here is some text\n</td><br><td><b>(lldb)</b> script print “Here is some text”</td><br></tr><br><tr><br><td colspan="2">Remap source file pathnames for the debug session. If your source files are no longer located in the same location as when the program was built — maybe the program was built on a different computer — you need to tell the debugger how to find the sources at their local file path instead of the build system’s file path.</td><br></tr><br><tr><br><td><b>(gdb)</b> set pathname-substitutions /buildbot/path /my/path</td><br><td><b>(lldb)</b> settings set target.source-map /buildbot/path /my/path</td><br></tr><br><tr><br><td colspan="2">Supply a catchall directory to search for source files in.</td><br></tr><br><tr><br><td><b>(gdb)</b> directory /my/path</td><br><td>(<i>No equivalent command - use the source-map instead.)<br></i></td><br></tr><br></tbody><br></table><br></p>
</div></div></div></div></div></div></div></div></div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/12/09/google-objective-c-style-guide-zhong-wen-ban/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/09/google-objective-c-style-guide-zhong-wen-ban/" itemprop="url">
                  Google Objective-C Style Guide 中文版
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-09T00:00:00+08:00">
              2013-12-09
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/12/09/google-objective-c-style-guide-zhong-wen-ban/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/12/09/google-objective-c-style-guide-zhong-wen-ban/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><header><br><h1>本文档不再作更新，开源的版本目前在<a href="https://github.com/zh-google-styleguide/zh-google-styleguide" target="_blank">Github</a>托管。</h1><br></header><br><div><br><h2>译者的话：</h2><br>一直想翻译这个<a href="http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml" target="_blank">style guide</a>，终于在周末花了7个小时的时间用vim敲出了HTML。很多术语的翻译很难，平时看的中文技术类书籍有限，对很多术语的中文译法不是很清楚，难免有不恰当之处，请读者指出并帮我改进。</div></p>

<p>王轲”ewangke at gmail.com” 2011.03.27<br></p><h2>目录</h2><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#examples" target="_blank" rel="external">例子</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#space_and_formating" target="_blank" rel="external">空格与格式</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#space_vs_tabs" target="_blank" rel="external">空格与制表符</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#line_length" target="_blank" rel="external">行宽</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#method_declarations_and_definations" target="_blank" rel="external">方法声明与定义</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#method_invocations" target="_blank" rel="external">方法调用</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#public_and_private" target="_blank" rel="external">@public与@private</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#exceptions" target="_blank" rel="external">异常</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#protocols" target="_blank" rel="external">协议</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#naming" target="_blank" rel="external">命名</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#file_names" target="_blank" rel="external">文件名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#objective_cplusplus" target="_blank" rel="external">Objective-C++</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#class_names" target="_blank" rel="external">类名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#category_names" target="_blank" rel="external">分类名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#objective_c_method_names" target="_blank" rel="external">Objective-C方法名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#variable_names" target="_blank" rel="external">变量名</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#comments" target="_blank" rel="external">注释</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#file_comments" target="_blank" rel="external">文件注释</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#declaration_comments" target="_blank" rel="external">声明注释</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#implementation_comments" target="_blank" rel="external">实现注释</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#object_ownership" target="_blank" rel="external">对象所有权</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#cocoa_and_objective_c_features" target="_blank" rel="external">Cocoa与Objective-C特性</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#member_variables_should_be_private" target="_blank" rel="external">成员变量应该为@private</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#identify_designated_initializer" target="_blank" rel="external">指明指定的初始化器</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#override_designated_initializer" target="_blank" rel="external">重写指定的初始化器</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#avoid_new" target="_blank" rel="external">避免使用+new</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#keep_the_public_api_simple" target="_blank" rel="external">保持公有的API尽量简单</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#import_and_include" target="_blank" rel="external">#import与#include</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#use_root_frameworks" target="_blank" rel="external">使用根框架</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#prefer_to_autorelease_at_time_of_creation" target="_blank" rel="external">创建对象时尽量使用autorelease</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#autorelease_and_retain" target="_blank" rel="external">Autorelease之后retain</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#dealloc_should_process_instance_variables_in_declaration_order" target="_blank" rel="external">Dealloc中应该按声明的顺序处理成员变量</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#setters_copy_nsstrings" target="_blank" rel="external">Setters中对NSString进行copy</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#avoid_throwning_exceptions" target="_blank" rel="external">避免抛出异常</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#nil_checking" target="_blank" rel="external">nil的检查</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#bool_pitfalls" target="_blank" rel="external">BOOL陷阱</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#properties" target="_blank" rel="external">属性</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#cocoa_patterns" target="_blank" rel="external">Cocoa模式</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#delegate_pattern" target="_blank" rel="external">委托模式</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#model_view_controller" target="_blank" rel="external">模型-视图-控制器</a></li><br></ul><br></li><br></ul><br><h2>背景介绍</h2><br>Objective-C是一种动态的面向对象的语言，它是C的扩展。它被设计成具有易读易用的，支持复杂的面向对象设计的编程语言。它是Mac OS X以及iPhone的主要开发语言<p></p>

<p>Cocoa是Mac OS X的主要的应用程序框架。它由一组支持Mac OS X全部特性的，并可用于快速开发的Objective-C类构成。</p>

<p>苹果公司已经撰写了非常全面的Objective-C编码指南。Google也为C++写了类型的编码指南。这个Objective-C指南是苹果和Google最佳实践的结合。因此，在阅读本指南之前，请确定你已经读过以下内容：<br><ul><br>    <li><a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/index.html" target="_blank">Apple’s Cocoa Coding Guidelines</a></li><br>    <li><a href="http://google-styleguide.googlecode.com/svn/trunk/plainguide.xml" target="_blank">Google’s Open Source C++ Style Guide</a></li><br></ul><br>&nbsp;</p>

<p>注意：所有在Google的C++编码指南中所禁止的事情，如未有特殊提及，也同样不能在Objective-C++中使用。</p>

<p>本文档的目的在于为所有的Mac OS X的代码提供编程指南及最佳实践。许多指南是在实际的项目及小组中经过长期的演进及验证的。Google开发的开源项目遵从本指南的要求。</p>

<p>Google已经发布了<a href="http://code.google.com/p/google-toolbox-for-mac/" target="_blank">Google Toolbox for Mac project</a>的部分开源代码，这些代码遵从本指南。跨多个项目的代码是这个库中的较好候选。</p>

<p>请注意，本指南不是Objective-C的教程。我们假定读者已经对Objective-C非常熟悉。如果你刚刚接触Objective-C或者需要提高，请阅读<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/index.html" target="_blank">The Objective-C Programming Language</a>。</p>

<p>&nbsp;<br></p><h2><a name="examples"></a>例子</h2><br>一个例子顶上一千句话，我们就从这样的一个例子开始，来感受一下编码的风格、空格以及命名等等。<p></p>

<p></p><p>一个头文件的例子，展示了在@interface声明中如何进行正确的注释以及空格。</p><p></p>
<p>&nbsp;<br><pre>//  GTMFoo.h<br>//  FooProject<br>//<br>//  Created by Greg Miller on 6/13/08.<br>//  Copyright 2008 Google, Inc. All rights reserved.<br>//</pre></p>

<p>#import </p>

<p>// A sample class demonstrating good Objective-C style. All interfaces,<br><br>// categories, and protocols (read: all top-level declarations in a header)<br><br>// MUST be commented. Comments must also be adjacent to the object they’re<br><br>// documenting.<br><br>//<br><br>// (no blank line between this comment and the interface)<br><br>@interface GTMFoo : NSObject {<br><br>@private<br><br>    NSString <em>foo_;<br><br>    NSString </em>bar_;<br><br>}</p>

<p>// Returns an autoreleased instance of GMFoo. See -initWithString: for details<br><br>// about the argument.<br><br>+ (id)fooWithString:(NSString *)string;</p>

<p>// Designated initializer. |string| will be copied and assigned to |foo_|.<br><br>- (id)initWithString:(NSString *)string;</p>

<p>// Gets and sets the string for |foo_|.<br><br>- (NSString <em>)foo;<br><br>- (void)setFoo:(NSString </em>)newFoo;</p>

<p>// Does some work on |blah| and returns YES if the work was completed<br><br>// successfuly, and NO otherwise.<br><br>- (BOOL)doWorkWithString:(NSString *)blah;</p>

<p></p><p>@end<br>&nbsp;</p><p></p>
<p></p><p>一个实现文件的例子，展示了@implementation部分如何进行正确的注释、空格。同时也包括了基于引用实现的一些重要方法，如getters、setters、init以及dealloc。</p><p></p>
<p>&nbsp;<br><pre>//<br>//  GTMFoo.m<br>//  FooProject<br>//<br>//  Created by Greg Miller on 6/13/08.<br>//  Copyright 2008 Google, Inc. All rights reserved.<br>//</pre></p>

<p>#import “GTMFoo.h”</p>

<p></p><p>@implementation GTMFoo</p><p></p>
<p>+ (id)fooWithString:(NSString *)string {<br><br>    return [[[self alloc] initWithString:string] autorelease];<br><br>}</p>

<p>// Must always override super’s designated initializer.<br><br>- (id)init {<br><br>    return [self initWithString:nil];<br><br>}</p>

<p>- (id)initWithString:(NSString *)string {<br><br>    if ((self = [super init])) {<br><br>        foo<em> = [string copy];<br><br>        bar</em> = [[NSString alloc] initWithFormat:@”hi %d”, 3];<br><br>    }<br><br>    return self;  <br><br>}</p>

<p>- (void)dealloc {<br><br>    [foo<em> release];<br><br>    [bar</em> release];<br><br>    [super dealloc];<br><br>}</p>

<p>- (NSString *)foo {<br><br>    return foo_;<br><br>}</p>

<p>- (void)setFoo:(NSString *)newFoo {<br><br>    [foo<em> autorelease];<br><br>    foo</em> = [newFoo copy];  <br><br>}</p>

<p>- (BOOL)doWorkWithString:(NSString *)blah {<br><br>    // …<br><br>    return NO;<br><br>}</p>

<p></p><p>@end<br>&nbsp;</p>
<p></p><h2><a name="space_and_formating"></a>空格与格式</h2><br>&nbsp;<p></p>
<p></p><h3><a name="space_vs_tabs"></a>空格与制表符</h3><br>&nbsp;<p></p><p></p>
<p>我们使用空格进行缩进。不要在代码中使用制表符。你应该将你的文本编辑器设置成自动将制表符替换成空格。</p>

<p>总结：只使用空格，每次缩进两个空格。</p>

<p>&nbsp;<br></p><h3><a name="line_length"></a>行宽</h3><br>&nbsp;<p></p>

<p>即使Objective-C比C++更加冗长，为了保证本指南的可操作性，我们决定保持每行宽度为80列。这比你想的要简单。</p>

<p>我们意识到这条规则是有争议的，但很多已经存在的代码坚持了本规则，因此我们觉得保证一致性更重要。</p>

<p>通过设置Xcode&gt;Preferences&gt;Text Editing&gt;Show page guide，来使越界更容易被发现。</p>

<p>总结：代码中的每行最多有80个字符。</p>

<p>&nbsp;<br></p><h3><a name="method_declarations_and_definations"></a>方法声明与定义</h3><br>&nbsp;<p></p>

<p>方法应该像这样</p>

<p>&nbsp;<br><pre>- (void)doSomethingWithString:(NSString *)theString {<br>    …<br>}</pre><br>&nbsp;</p>

<p>星号前的空格是可选的。当写新的代码时，要与原的代码一致。</p>

<p>如果一行有非常多的参数，更好的方式是将每个参数单独拆成一行。如果使用多行，将每个参数前的冒号对齐。</p>

<p>&nbsp;<br><pre>- (void)doSomethingWith:(GTMFoo *)theFoo<br>                   rect:(NSRect)theRect<br>               interval:(float)theInterval {<br>    …<br>}</pre><br>&nbsp;</p>

<p>当第一个关键字比其它的短时，保证下一行至少有4个空格的缩进。这样可以使关键字垂直对齐，而不是使用冒号对齐：</p>

<p>&nbsp;<br><pre>- (void)short:(GTMFoo *)theFoo<br>    longKeyword:(NSRect)theRect<br>    evenLongerKeyword:(float)theInterval {<br>    …<br>}</pre><br>&nbsp;</p>

<p>总结：-或者+与返回类型之间，需要有空格。参数列表中，只有参数之间有空格。</p>

<p>&nbsp;<br></p><h3><a name="method_invocations"></a>方法调用</h3><br>&nbsp;<p></p>

<p>方法调用时，所有参数应该在同一行。</p>

<p>&nbsp;<br><pre>[myObject doFooWith:arg1 name:arg2 error:arg3];</pre><br>&nbsp;</p>

<p>或者每行一个参数，以冒号对齐：</p>

<p>&nbsp;<br><pre>[myObject doFooWith:arg1<br>               name:arg2<br>              error:arg3];</pre><br>&nbsp;</p>

<p>不要使用下面的缩进风格：</p>

<p>&nbsp;<br><pre>[myObject doFooWith:arg1 name:arg2  // some lines with &gt;1 arg<br>              error:arg3];</pre></p>

<p>[myObject doFooWith:arg1<br><br>               name:arg2 error:arg3];</p>

<p>[myObject doFooWith:arg1<br><br>          name:arg2  // aligning keywords instead of colons<br><br>          error:arg3];<br>&nbsp;</p>

<p>方法定义与方法声明一样，当关键字的长度不足以以冒号对齐时，下一行都要以四个空格进行缩进。</p>

<p>&nbsp;<br><pre>[myObj short:arg1<br>    longKeyword:arg2<br>    evenLongerKeyword:arg3];</pre><br>&nbsp;</p>

<p>总结：方法定义的格式与方法声明的格式非常相似。当格式的风格有多种选择时，新的代码要与已经存在的代码保持一致。</p>

<p>&nbsp;<br></p><h3><a name="public_and_private"></a>@public与@private</h3><br>&nbsp;<p></p>

<p>与C++中的public, private以及protected非常相似。</p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @public<br>    …<br> @private<br>    …<br>}<br>@end</pre><br>&nbsp;</p>

<p></p><p>总结：@public以及@private访问标识符应该以一个空格缩进。</p><p></p>
<p>&nbsp;<br></p><h3><a name="exceptions"></a>异常</h3><br>&nbsp;<p></p>

<p>如果你必须使用Objective-C的异常，按下面的格式进行编码代码。然后，请参见<a href="http://www.iwangke.me/objc-style-guide/#avoid_throwning_exceptions" target="_blank" rel="external">避免抛出异常</a>来了解不应该使用异常的原因。</p>

<p>&nbsp;<br><pre>@try {<br>    foo();<br>}<br>@catch (NSException *ex) {<br>    bar(ex);<br>}<br>@finally {<br>    baz();<br>}</pre><br>&nbsp;</p>

<p></p><p>总结：每个@标签应该有独立的一行，在@与{}之间需要有一个空格。@catch与被捕捉到的异常对象的声明之间也要有一个空格。</p><p></p>
<p>&nbsp;<br></p><h3><a name="protocols"></a>协议</h3><br>&nbsp;<p></p>

<p>这条规则也同样适用于类声明、成员变量以及方法声明。例如：</p>

<p>&nbsp;<br><pre>@interface MyProtocoledClass : NSObject {<br> @private<br>    id delegate_;<br>}<br>- (void)setDelegate:(id)aDelegate;<br>@end</pre><br>&nbsp;</p>

<p>总结：尖括号所包括的协议名称与前面的类型标识之间不应该有空格。<br></p><h2><a name="naming"></a>命名</h2><br>对于可维护的代码，命名规则非常重要。 Objective-C的方法名往往十分长，但代码块读起来就像散文一样，不需要太多的注释修饰。<p></p>

<p>当编写纯Objective-C代码时，我们基本遵守标准的<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html" target="_blank">Objective-C naming rules</a>，这些命名规则可能与C++风格指南中的大相径庭。例如，Google的C++风格指南中推荐使用下划线分隔的单词作为变量名，而(苹果的)风格指南则使用camel命名法，这在Objective-C社区中非常普遍。</p>

<p>任何的类、分类、方法以及变量的名字中都使用<a href="http://en.wikipedia.org/wiki/Initialism" target="_blank">全大写缩写</a>。这遵守了苹果的标准命名方式，如URL、TIFF以及EXIF。</p>

<p>当编写Objective-C++代码时，事情就不这么简单了。许多的项目需要实现跨平台的C++代码，并与Objective-C以及Cocoa混合编写。或者以C++作为后端，Cocoa作为前端。这就导致了两种命名方式直接不统一。</p>

<p></p><p>我们的解决方案是：编码风格取决于方法/函数以哪种语言实现。如果在一个@implementation语句块中，就使用Objective-C的风格。如果实现一个C++的类，请使用C++的风格。这避免了成员变量与局部变量使用混合的命名风格，这会严重地影响可读性。</p><p></p>
<p>&nbsp;<br></p><h3><a name="file_names"></a>文件名</h3><br>&nbsp;<p></p>

<p>文件的扩展名应该如下：<br><ul><br>    <li>.h, C/C++/Objective-C的头文件</li><br>    <li>.m, Ojbective-C实现文件</li><br>    <li>.mm, Ojbective-C++的实现文件</li><br>    <li>.cc, 纯C++的实现文件</li><br>    <li>.c, 纯C的实现文件</li><br></ul><br>&nbsp;</p>

<p>分类的文件名应该包含被扩展的类的名字，如：GTMNSString+Utils.h或GTMNSTextView+Autocomplete.h。</p>

<p>总结：文件名应该反映了它实现了什么类。遵守你的项目的惯例。</p>

<p>&nbsp;<br></p><h3><a name="objective_cplusplus"></a>Objective-C++</h3><br>&nbsp;<p></p>

<p>为了最小化Cocoa/Objective-C与C++之间的命名风格的冲突，按照下面方法实现的风格编写代码。在实现@implementation语句块时，使用Objective-C的命名规则；如果实现一个C++的类，就使用C++命名规则。</p>

<p>&nbsp;<br><pre>// file: cross_platform_header.h</pre></p>

<p>class CrossPlatformAPI {<br><br> public:<br><br>    …<br><br>    int DoSomethingPlatformSpecific();  // impl on each platform<br><br> private:<br><br>    int an_instance<em>var</em>;<br><br>};</p>

<p>// file: mac_implementation.mm<br><br>#include “cross_platform_header.h”</p>

<p>// A typical Objective-C class, using Objective-C naming.<br><br>@interface MyDelegate : NSObject {<br><br> @private<br><br>    int instanceVar<em>;<br><br>    CrossPlatformAPI* backEndObject</em>;<br><br>}<br>- (void)respondToSomething:(id)something;<br><br>@end<br><br>@implementation MyDelegate<br><br>- (void)respondToSomething:(id)something {<br><br>    // bridge from Cocoa through our C++ backend<br><br>    instanceVar<em> = backEndObject-&gt;DoSomethingPlatformSpecific();<br><br>    NSString* tempString = [NSString stringWithInt:instanceVar</em>];<br><br>    NSLog(@”%@”, tempString);<br><br>}<br>@end</p>

<p>// The platform-specific implementation of the C++ class, using<br><br>// C++ naming.<br><br>int CrossPlatformAPI::DoSomethingPlatformSpecific() {<br><br>    NSString* temp_string = [NSString stringWithInt:an_instance<em>var</em>];<br><br>    NSLog(@”%@”, temp_string);<br><br>    return [temp_string intValue];<br><br>}<br>&nbsp;</p>

<p>总结：当编写源代码时，Ojbective-C++应该采用你正在实现的方法/函数的风格。</p>

<p>&nbsp;<br></p><h3><a name="class_names"></a>类名</h3><br>&nbsp;<p></p>

<p>应用程序级的代码，应该尽量避免不必要的前缀。为每个类都添加前缀不会提高任何的可读性。当设计跨不同应用程序的代码时，应该使用前缀，例如：GTMSendMessage。</p>

<p>总结：类名、分类名、协议名应该以大写字母开始，并混合小写字母来分隔单词。(Camel命名法)</p>

<p>&nbsp;<br></p><h3><a name="category_names"></a>分类名</h3><br>&nbsp;<p></p>

<p>例如，录我们要创建一个NSString的类别以解析时，我们将把类别放在一个名为GTMNSString+Parsing.h的文件中。类别名本身的名字是GTMStringParsingAdditions（是的，我们知道类别名和文件名不一样，但是这个文件中可能存在多个不同的与解析有关类别）。类别中的方法应该以gtm_myCategoryMethodOnAString为前缀以避免命名冲突，因为Objective-C只有一个命名空间。如果代码不会被分享并且不会被运行在不同的地址空间中，方法名字就不那么重要。</p>

<p>类名与包含类别名的括号之间，应该以一个空格分隔。</p>

<p>总结：类别名应该有两三个字母的前缀以表示类别是项目的一部分或者该类别是通用的。类别应该包含它所扩展的类的名字。</p>

<p>&nbsp;<br></p><h3><a name="objective_c_method_names"></a>Objective-C方法名</h3><br>&nbsp;<p></p>

<p>方法名应该读起来就像句子，这表示你应该选择与方法名连在一起读起来通顺的参数名。(例如，convertPoint:fromRect: or replaceCharactersInRange:withString:)参见<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/Articles/NamingMethods.html#//apple_ref/doc/uid/20001282-BCIGIJJF" target="_blank">Apple’s Guide to Naming Methods</a>。</p>

<p>访问器方法应该与他们getting的的成员变量的名字一样，但不应该以get作为前缀。例如：</p>

<p>&nbsp;<br><pre>- (id)getDelegate;  // AVOID<br>- (id)delegate;    // GOOD</pre><br>&nbsp;</p>

<p>这仅限于Objective-C的方法名。C++的方法与函数的命名规则应该遵从C++风格指南中的规则。</p>

<p>总结：方法名应该以小写字母开头，并混合大小写（Camel命名法）。每个命名的参数也应该以小写字母开头。</p>

<p>&nbsp;<br></p><h3><a name="variable_names"></a>变量名</h3><br>&nbsp;<p></p>

<p>常用变量名</p>

<p>对于静态的类别，如int以及指针等，不要使用匈牙利命名法。要为变量起一个描述性的名字。不要担心浪费列宽，因为让新的代码阅读者立即理解你的代码更重要。例如：</p>

<p>错误的命名：</p>

<p>&nbsp;<br><pre>int w;<br>int nerr;<br>int nCompConns;<br>tix = [[NSMutableArray alloc] init];<br>obj = [someObject object];<br>p = [network port];</pre><br>&nbsp;</p>

<p>正确的命名：</p>

<p>&nbsp;<br><pre>int numErrors;<br>int numCompletedConnections;<br>tickets = [[NSMutableArray alloc] init];<br>userInfo = [someObject object];<br>port = [network port];</pre><br>&nbsp;</p>

<p>成员变量</p>

<p>成员变量应该混合大小写，并以下划线作为后缀，如usernameTextField_。然而，如果不能使用Objective-C 2.0（操作系统版本的限制），并且使用KVO/KVC绑定成员变量时，我们允许这个例外（译者注：KVO=Key Value Observing，KVC=Key Value Coding）。这种情况下，可以以一个下划线作为成员变量名字的前缀，这是苹果所接受的键/值命名惯例。如果可以使用Objective-C 2.0，@property以及@synthesize提供了遵从这一命名规则的解决方案。</p>

<p>常量</p>

<p>常量名（如宏、枚举、静态局部变量等）应该以小写字母k开头，使用混合大小写的格式来分隔单词，如：kInvalidHandle，kWritePerm。</p>

<p>总结：变量名应该以小写字母开头，并混合大小写。类的成员变量应该以下划线作为后缀。例如：myLocalVariable、myInstanceVariable_。如果不能使用Objective-C 2.0的@property，使用KVO/KVC绑定的成员变量可以以一个下划线作为前缀。<br></p><h2><a name="comments"></a>注释</h2><br>虽然写起来很痛苦，但注释是保证代码可读性的关键。下面的规则给出了你应该什么时候、在哪进行注释。记住：尽量注释很重要，但最好的代码应该自成文档。与其给类型及变量起一个晦涩难懂的名字，再为它写注释，不如直接起一个有意义的名字。<p></p>

<p>当你写注释的时候，记得你在给你的听众写，即下一个需要阅读你的代码的代码贡献者。大方一点，下一个读代码的人可能就是你！</p>

<p>记住所有C++风格指南里的规则在这里也同样适用，不同的地方会在下面指出</p>

<p>&nbsp;<br></p><h3><a name="file_comments"></a>文件注释</h3><br>&nbsp;<p></p>

<p>版权信息及作者</p>

<p>每个文件应该按顺序包括如下内容：<br><ul><br>    <li>版权信息声明（如：Copyright 2008 Google Inc.）</li><br>    <li>授权样版。选择一个合适的项目所使用的授权样板（例如，Apache 2.0, BSD, LGPL, GPL）。</li><br></ul><br>如果你对其他人的原始代码作出重大的修改，请把你的名字添加到作者里面。当另外一个代码贡献者对文件有问题时，他需要知道怎么联系你，这十分有用。</p>

<p>总结：以版权信息作为文件头部，开始每一个文件，后接文件内容的描述。</p>

<p>&nbsp;<br></p><h3><a name="declaration_comments"></a>声明注释</h3><br>&nbsp;<p></p>

<p>&nbsp;<br><pre>// A delegate for NSApplication to handle notifications about app<br>// launch and shutdown. Owned by the main app controller.<br>@interface MyAppDelegate : NSObject {<br>    …<br>}<br>@end</pre><br>&nbsp;</p>

<p>如果你已经在文件头部详细描述了接口，可以直接说明“完整的描述请参见文件头部”，但是一定要有这部分注释。</p>

<p>另外，公共接口的每个方法，都应该有注释来解释它的作用、参数、返回值以及其它影响。</p>

<p>为类的线程安全性作注释，如果有的话。如果类的实例可以被多个线程访问，记得注释多线程条件下的使用规则。</p>

<p>总结：每个接口、类别以及协议应该注释，以描述它的目的及作用。</p>

<p>&nbsp;<br></p><h3><a name="implementation_comments"></a>实现注释</h3><br>&nbsp;<p></p>

<p>这会避免二义性，尤其是当符号是一个常用词汇，这使用语句读起来很糟糕。例如，对于符号”count”：</p>

<p>&nbsp;<br><pre>// Sometimes we need |count| to be less than zero.</pre><br>&nbsp;</p>

<p>或者当引用已经包含引号的符号：</p>

<p>&nbsp;<br><pre>// Remember to call |StringWithoutSpaces(“foo bar baz”)|</pre><br>&nbsp;</p>

<p>总结：使用|来引用注释中的变量名及符号名而不是使用引号。</p>

<p>&nbsp;<br></p><h3><a name="object_ownership"></a>对象所有权</h3><br>&nbsp;<p></p>

<p>继承自NSObject的成员变量指针，通常被假定是强引用关系（retained）。如果它有没被类retained，应该注释为弱引用（weak）。然而，以IBOutlets作为标签的成员变量默认是不会被类retained的。如果是强引用关系，应该注释。</p>

<p>当成员变量指向CoreFoundation、C++或者其它非Objective-C对象时，无论是强引用还是弱引用，都需要注释说明。注意：Objective-C对象中的C++对象的自动封装，默认情况下是不允许的，参见。</p>

<p>强引用及弱引用注释的例子：</p>

<p>&nbsp;<br><pre>@interface MyDelegate : NSObject {<br> @private<br>        IBOutlet NSButton<em> okButton_;  // normal NSControl<br>        IBOutlet NSMenu</em> myContextMenu_;  // manually-loaded menu (strong)</pre></p>

<p>        AnObjcObject<em> doohickey_;  // my doohickey<br><br>        MyController</em> controller_;  // so we can send msgs back (weak, owns me)</p>

<p>        // non-NSObject pointers…<br><br>        CWackyCPPClass<em> wacky_;  // some cross-platform object (strong)<br><br>        CFDictionaryRef</em> dict_;  // (strong)<br><br>}<br>@end<br>&nbsp;</p>

<p>强引用：对象被类retained。</p>

<p>弱引用：对象没有被类retained。（如委托）</p>

<p>总结：当与Objective-C最通常的作法不同时，尽量使用指针的所有权模型尽量直观。<br></p><h2><a name="cocoa_and_objective_c_features"></a>Cocoa以及Objective-C特性</h2><br>&nbsp;<br><h3><a name="member_variables_should_be_private"></a>成员变量应该为@private</h3><br>&nbsp;<p></p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @private<br>    id myInstanceVariable_;<br>}<br>// public accessors, setter takes ownership<br>- (id)myInstanceVariable;<br>- (void)setMyInstanceVariable:(id)theVar;<br>@end</pre><br>&nbsp;</p>

<p>总结：成员变量应该声明为私有。</p>

<p>&nbsp;<br></p><h3><a name="identify_designated_initializer"></a>指明指定的初始化器</h3><br>&nbsp;<p></p>

<p>对于需要继承你的类的人来说，指定的初始化器十分重要。这样他们就可以只重写一个初始化器（可能是几个）来保证他们的子类的初始化器会被调用。这也有助于将来别人调试你的类时，理解初始化代码的工作流程。</p>

<p>总结：注释并且明确指出你的类的指定的初始化器。</p>

<p>&nbsp;<br></p><h3><a name="override_designated_initializer"></a>重写指定的初始化器</h3><br>&nbsp;<p></p>

<p>如果我没有重写父类的指定的初始化器，你的初始化器有时可能不会被调用，这会导致很微妙而且难以解决的bug。</p>

<p>总结：当你写子类的时候，如果需要init…方法，记得重写父类的指定的初始化器。</p>

<p>&nbsp;<br></p><h3><a name="initialization"></a>初始化</h3><br>&nbsp;<p></p>

<p>刚分配的对象，默认值都是0。除了isa指针（译者注：NSObject的isa指针，用于标识对象的类型）。所以不要在初始化器里面写一堆将成员初始化为0或者nil的代码。</p>

<p>总结：不要在init方法中，将成员变量初始化为0或者nil，这是冗余的。</p>

<p>&nbsp;<br></p><h3><a name="avoid_new"></a>避免使用+new</h3><br>&nbsp;<p></p>

<p>现代的Ojbective-C代码通过调用alloc和init方法来创建并且retain一个对象。由于类方法new很少被使用，这使得有关内存分配的代码审查更困难。</p>

<p>总结：不要调用NSObject类的类方法new，也不要在子类重写。相反，你应该使用alloc和init方法来创建并初始化一个对象。</p>

<p>&nbsp;<br></p><h3><a name="keep_the_public_api_simple"></a>保持公有的API尽量简单</h3><br>&nbsp;<p></p>

<p>与C++不同，Objective-C没有方法来区分公有的方法和私有的方法，所有的方法都是公有的（译者注：这取决于Objective-C运行时的方法调用的消息机制）。因此，除非客户端的代码期望使用某个方法，不要把这个方法放进公有的API中。这降低了你不希望被调用的方法被调用的可能性。这包括重写父类的方法。对于内部实现所需要的方法，在实现的文件中定义一个类别，而不是把它们放进公有的头文件中。</p>

<p>&nbsp;<br><pre>// GTMFoo.m<br>#import “GTMFoo.h”</pre></p>

<p></p><p>@interface GTMFoo (PrivateDelegateHandling)<br></p>
<ul>
<li>(NSString *)doSomethingWithDelegate;  // Declare private method<br><br>@end<p></p></li>
</ul>
<p></p><p>@implementation GTMFoo(PrivateDelegateHandling)<br><br>…<br></p>
<ul>
<li>(NSString *)doSomethingWithDelegate {<br><br>  // Implement this method<br><br>}<br>…<br><br>@end<br>&nbsp;<p></p></li>
</ul>
<p>在Objective-C 2.0之前，如果你在私有的@interface中声明了某个方法，但在@implementation中忘记定义了这个方法，编译器不会反对（这是因为你没有在其它的类别中实现这个私有的方法）。解决文案是将方法放进指定类别的@implemenation中。</p>

<p>如果你在使用Objective-C 2.0，相反你应该使用类扩展来声明你的私有类别，例如：</p>

<p>&nbsp;<br><pre>@interface GMFoo () { … }</pre><br>&nbsp;</p>

<p></p><p>这会保证如果声明的方法如果没有在@implementation中实现，会产生一个编译器警告。</p><p></p>
<p>再次说明，私有的方法其实不是私有的。你有时可能不小心重写了父类的私有方法，这很难调试。通常，私有的方法应该有一个相当特殊的名字以防止子类无意地重写它们。</p>

<p>Ojbective-C的类别是一种很好的方法来将一个大的@implementation拆分成更容易理解的小块。同时，类别可以为最适合的类添加新的、基于特定应用程序的功能。例如，当添加一个“middle truncation”方法时，创建一个NSString的新类别并把方法放在里面，比创建任意的一个新类把方法放进里面要好得多。</p>

<p>&nbsp;<br></p><h3><a name="import_and_include"></a>#import与#include</h3><br>&nbsp;<p></p>

<p>基于你所包括的头文件的编程语言，选择使用#import还是#include：</p>

<p>&nbsp;<br><ul><br>    <li>当包含一个使用Objective-C、Objective-C++的头文件时，使用#import。</li><br>    <li>当包含一个使用标准C、C++头文件时，使用#include。头文件应该提供自己的。</li><br></ul><br>&nbsp;</p>

<p>一些Ojbective-C的头文件缺少#define保护，只期望被使用#import的方式包含。由于Objective-C的头文件只会被Objective-C的源文件及头文件包含，广泛地使用#import是可以的。</p>

<p>文件中没有Objective-C的标准C、C++的头文件，可能会被普通的C、C++包含。既然标准的C、C++里面没有#import的用法，这些文件将被#include包含。Objective-C源文件中使用#include包含，意味着这些头文件会永远以相同的语义被包含。</p>

<p>这条规则帮助跨平台的项目中产生无意的错误。一个忘记使用#define保护的Mac开发者，在引用了新的C、C++头文件时，如果新的头文件使用#import被引用，在Mac上会没有问题。但在其它使用#include平台上可能会使构造失败。一致地在所有的平台上使用#include，意味着构造更可能一致地成功或者失败。这避免了文件只能在某些平台上使用的尴尬。</p>

<p>下面是正确的使用方式：</p>

<p>&nbsp;<br><pre>#import<br>#include<br>#import “GTMFoo.h”<br>#include “base/basictypes.h”</pre><br>&nbsp;</p>

<p>总结：#import Ojbective-C/Objective-C++头文件，#include C/C++头文件。</p>

<p>&nbsp;<br></p><h3><a name="use_root_frameworks"></a>使用根框架</h3><br>&nbsp;<p></p>

<p>当你试图从框架（如Cocoa或者Foundation）中包含单独的系统头文件时，实际上包含顶级根框架编译器要作更少的工作。根框架通常被预编译，并且加载得更快。另外记得使用#import而不是#include来包含Objective-C的框架。</p>

<p>正确的做法：</p>

<p>&nbsp;<br><pre>#import      // good</pre><br>&nbsp;</p>

<p>错误的做法：</p>

<p>&nbsp;<br><pre>#import         // avoid<br>#import<br>…</pre><br>&nbsp;</p>

<p>总结：包含根框架而不是单独的文件。</p>

<p>&nbsp;<br></p><h3><a name="prefer_to_autorelease_at_time_of_creation"></a>创建对象时尽量使用autorelease</h3><br>&nbsp;<p></p>

<p>尽管运行效率会差一点，这避免了意外地删除了release或者插入return语句而产生内存泄露的可能。例如：</p>

<p>错误的做法：</p>

<p>&nbsp;<br><pre>// AVOID (unless you have a compelling performance reason)<br>MyController* controller = [[MyController alloc] init];<br>// … code here that might return …<br>[controller release];</pre><br>&nbsp;</p>

<p>正确的做法：</p>

<p>&nbsp;<br><pre>// BETTER<br>MyController* controller = [[[MyController alloc] init] autorelease];</pre><br>&nbsp;</p>

<p>总结：当创建临时对象时，在同一行使用autolease，而不是在同一个方法的后面语句中使用一个单独的release。</p>

<p>&nbsp;<br></p><h3><a name="autorelease_and_retain"></a>Autolease之后retain</h3><br>&nbsp;<p></p>

<p>当给一个变量赋值新的对象时，必须先释放掉旧的对象以避免内存泄露。有一些正确的方法来处理它。我们选择autorelease之后retain的方法因为事实证明它更少地出错。注意大的循环会填满autorelease pool，并且可能效率上会差一点，但这点折衷我们认为是可以接受的。</p>

<p>&nbsp;<br><pre>- (void)setFoo:(GMFoo *)aFoo {<br>    [foo<em> autorelease];  // Won’t dealloc if |foo</em>| == |aFoo|<br>    foo_ = [aFoo retain];<br>}</pre><br>&nbsp;</p>

<p>总结：给对象赋值时遵守autorelease之后retain的模式。</p>

<p>&nbsp;<br></p><h3><a name="dealloc_should_process_instance_variables_in_declaration_order"></a>Dealloc中应该按声明的顺序处理成员变量</h3><br>&nbsp;<p></p>

<p>代码审查者在审查新的或者修改过的dealloc实现时，需要保证每个retained的对象都得到了释放。</p>

<p>为了简单的审查dealloc，对象被释放的顺序应该与他们在@interface中声明的顺序一致。如果dealloc调用了其它方法释放成员变量，注释这个方法处理了哪些成员变量的释放。</p>

<p>总结：dealloc中对象被释放的顺序应该与他们在@interface中声明的顺序一致，这有助于代码审查。</p>

<p>&nbsp;<br></p><h3><a name="setters_copy_nsstrings"></a>Setters中对NSString进行copy</h3><br>&nbsp;<p></p>

<p>永远不要仅仅retain一个字符串。这避免了调用者在你不知道的情况下对字符串作出了修改。不要作出那样的假设：你接受的对象是一个NSString对象而不是NSMutableString对象。</p>

<p>&nbsp;<br><pre>- (void)setFoo:(NSString *)aFoo {<br>    [foo<em> autorelease];<br>    foo</em> = [aFoo copy];<br>}</pre><br>&nbsp;</p>

<p>总结：接受NSString作为参数的setter，应该copy它所接受的字符串。</p>

<p>&nbsp;<br></p><h3><a name="avoid_throwning_exceptions"></a>避免抛出异常</h3><br>&nbsp;<p></p>

<p>我们确实在编译时允许-fobjc-exceptions（主要我们得到了使用@synchronized的好处），但我们不使用@throw。当正确地使用第三方的代码时，使用@try、@catch、和@finally是允许的。如果你确实使用了异常，请注释你期望什么方法抛出异常。</p>

<p>不要使用NS_DURING, NS_HANDLER, NS_ENDHANDLER, NS_VALUERETURN 和 NS_VOIDRETURN 这些宏，除非你写的代码需要在Mac OS X 10.2或者之前的操作系统中运行。</p>

<p>注意：当使用Objective-C++写基于栈的对象的代码时，如果抛出Objective-C异常，对象不会被清理。例如：</p>

<p>&nbsp;<br><pre>class exceptiontest {<br> public:<br>    exceptiontest() { NSLog(@”Created”); }<br>    ~exceptiontest() { NSLog(@”Destroyed”); }<br>};</pre></p>

<p>void foo() {<br><br>    exceptiontest a;<br><br>    NSException *exception = [NSException exceptionWithName:@”foo”<br><br>                                               reason:@”bar”<br><br>                                             userInfo:nil];<br><br>    @throw exception;<br><br>}</p>

<p>int main(int argc, char <em>argv[]) {<br><br>    GMAutoreleasePool pool;<br><br>    @try {<br><br>    foo();<br><br>    }<br><br>    @catch(NSException </em>ex) {<br><br>    NSLog(@”exception raised”);<br><br>    }<br><br>    return 0;<br><br>}<br>&nbsp;</p>

<p>会输出：</p>

<p>&nbsp;<br><pre>2006-09-28 12:34:29.244 exceptiontest[23661] Created<br>2006-09-28 12:34:29.244 exceptiontest[23661] exception raised</pre><br>&nbsp;</p>

<p>注意：这里析构函数从未被调用。这主要会影响基于栈的对象如shared_ptr、linked_ptr和所有你可能使用的STL对象。你永远不应该重新抛出Objective-C异常，也不应该在@try, @catch, @finally 语句块中使用基于栈的C++对象。</p>

<p>总结：不要抛出Objective-C异常，但准备从第三方的调用或者系统调用捕捉异常。</p>

<p>&nbsp;<br></p><h3><a name="nil_checking"></a>nil的检查</h3><br>&nbsp;<p></p>

<p>使用nil的检查来检查应用程序的逻辑，而不是避免崩溃。Objective-C运行时会处理向一个nil的对象发送消息的情况。如果方法没有返回值，就没关系。如果有返回值，可能由于运行时架构、返回值类型以及OS X版本的不同而不同，参见<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_2_section_3.html#//apple_ref/doc/uid/TP30001163-CH11-SW7" target="_blank">Apple’s documentation</a>。</p>

<p>注意，这与检查C/C++的指针是否为NULL非常不同，运行时不会检查空的情况，并导致你的应用程序崩溃。你仍然需要保证你不会对一个C/C++的空指针解引用。</p>

<p>总结：nil检查只用于逻辑流的判断。</p>

<p>&nbsp;<br></p><h3><a name="bool_pitfalls"></a>BOOL陷阱</h3><br>&nbsp;<p></p>

<p>Ojbective-C中定义BOOL为无符号字符型，这意味着BOOL类型可以有不同于YES(1)或者NO(0）的值。不要直接把整形转换成BOOL。常见的错误包括将数组的大小、指针值及位运算的结果直接转换成BOOL，这取决于整型结果的最后一个字节，可能产生一个NO的值。当转换整形至BOOL时，使用三目操作符来返回YES或者NO。(译者注：读者可以试一下任意的256的整数的转换结果，如256、512…)</p>

<p>你可以安全在BOOL, _Bool以及bool之间转换（参见C++ Std 4.7.4, 4.12 and C99 Std 6.3.1.2）。你不能安全在BOOL以及Boolean之间转换，因此请把Boolean当作一个普通的整形，就像我产在上面讨论的那样。Objective-C的方法签名中，只使用BOOL。</p>

<p>对BOOL使用逻辑运算符（&amp;&amp;, || 和!）是合法的，返回值也可以安全地转换成BOOL，不需要使用三目操作符。</p>

<p>错误的用法：</p>

<p>&nbsp;<br><pre>- (BOOL)isBold {<br>    return [self fontTraits] &amp; NSFontBoldTrait;<br>}<br>- (BOOL)isValid {<br>    return [self stringValue];<br>}</pre><br>&nbsp;</p>

<p>正确的用法：</p>

<p>&nbsp;<br><pre>- (BOOL)isBold {<br>    return ([self fontTraits] &amp; NSFontBoldTrait) ? YES : NO;<br>}<br>- (BOOL)isValid {<br>    return [self stringValue] != nil;<br>}<br>- (BOOL)isEnabled {<br>    return [self isValid] &amp;&amp; [self isBold];<br>}</pre><br>&nbsp;</p>

<p>同样的，不要直接比较BOOL变量与YES/NO。不仅仅这影响可读性，结果可能与你想的不同。</p>

<p>错误的用法：</p>

<p>&nbsp;<br><pre>BOOL great = [foo isGreat];<br>if (great == YES)<br>    // …be great!</pre><br>&nbsp;</p>

<p>正确的用法</p>

<p>&nbsp;<br><pre>BOOL great = [foo isGreat];<br>if (great)<br>    // …be great!</pre><br>&nbsp;</p>

<p>总结：将常规整形转换成BOOL时要小心，不要直接将BOOL值与YES进行比较。</p>

<p>&nbsp;<br></p><h3><a name="properties"></a>属性</h3><br>&nbsp;<p></p>

<p>命名</p>

<p>属性所关联的成员变量的命名必须遵守以下划线作为后缀的规则。属性的名字应该与成员变量去掉下划线后缀的名字一模一样。</p>

<p></p><p>使用@synthesize指示符来正确地重命名属性</p><p></p>
<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @private<br>    NSString <em>name_;<br>}<br>@property(copy, nonatomic) NSString </em>name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>@synthesize name = name_;<br><br>@end<br>&nbsp;</p><p></p>
<p>位置</p>

<p></p><p>类接口中的属性的声明必须紧跟着成员变量语句块。属性的定义必须在@implementation的类定义的最上方。他们的缩进与包含他们的@interface以及@implementation语句一样。</p><p></p>
<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @private<br>    NSString <em>name_;<br>}<br>@property(copy, nonatomic) NSString </em>name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>@synthesize name = name_;<br></p>
<ul>
<li>(id)init {<br><br>  …<br><br>}<br>@end<br>&nbsp;<p></p></li>
</ul>
<p>NSString使用copy特性</p>

<p>NSString属性应该永远被声明为copy特性。</p>

<p>这从逻辑上遵守了NSString的setter必须使用copy而不是retain。</p>

<p>不要synthesize CFType的属性</p>

<p>CFType应该永远使用@dynamic实现指示符。</p>

<p>尽管CFType不能使用retain属性特性，开发者必须自己处理retain和release。很少有情况你需要仅仅对它进行赋值，因此最好显示地实现getter和setter，并作出注释说明。</p>

<p>列出所有的实现指示符</p>

<p></p><p>尽管@dynamic是默认的，显示列出它以及其它的实现指示符会提高可读性，代码阅读者可以一眼就知道类的每个属性是如何实现的。</p><p></p>
<p>错误的做法：</p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject<br>@property(readonly) NSString *name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>.<br>.<br><br>.</p>
<ul>
<li>(NSString*)name {<br><br>  return @”foo”;<br><br>}<br>@end<br>&nbsp;<p></p></li>
</ul>
<p>正确的做法：</p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject<br>@property(readonly) NSString *name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>@dynamic name;<br><br>.<br>.<br><br>.</p>
<ul>
<li>(NSString*)name {<br><br>  return @”foo”;<br><br>}<br>@end<br>&nbsp;<p></p></li>
</ul>
<p>原子性</p>

<p>一定要注意属性的开销。所有synthesize的setter和getter都是原子的。这会给每个get或者set带来一定的同步开销。显示将你的属性声明为nonatomic除非你需要原子操作。</p>

<p>点引用</p>

<p>点引用是地道的Objective-C 2.0的风格。它被使用于简单的属性set、get操作，但对象的其它行为不应该使用它。</p>

<p>正确的做法：</p>

<p>&nbsp;<br><pre>NSString *oldName = myObject.name;<br>myObject.name = @”Alice”;</pre><br>&nbsp;</p>

<p>错误的做法：</p>

<p>&nbsp;<br><pre>NSArray *array = [[NSArray arrayWithObject:@”hello”] retain];</pre></p>

<p>NSUInteger numberOfItems = array.count;  // not a property<br><br>array.release;                           // not a property<br>&nbsp;</p>

<p>总结：需要注意的是，使用点引用语法必须需要Objective-C 2.0的支持，这意味着你的代码只能运行于iPhone或者Mac OS X 10.5(Leopard)及以后的版本。点引用只允许访问声明的属性。<br></p><h2><a name="cocoa_patterns"></a>Cocoa模式</h2><br>&nbsp;<br><h3><a name="delegate_pattern"></a>委托模式</h3><br>&nbsp;<p></p>

<p>实现委托模式的类应该：<br><ul><br>    <li>拥有一个名为delegate<em>的成员变量来引用委托。</em></li><br>    <li>因此，访问器方法应该名为delegate和setDelegate:。</li><br>    <li>delegate对象不应该被retained。</li><br></ul><br>总结：委托对象不应该被retained。</p>

<p>&lt;p<br></p><h3><a name="model_view_controller"></a>模型-视图-控制器</h3><br>&nbsp;<br><ul><br>    <li>模型与视图分离：不要假设模型或者数据源的表示方法。保持数据源与表示层之间的接口抽象。视图不需要了解模型的逻辑（主要的规则是问问你自己，对于数据源的一个实例，有没有可能有多种不同状态的表示方法）。</li><br>    <li>控制器与模型、视图分离：不要把所有的“领域逻辑”放进跟视图有关的类中。这命名得代码非常难以重用。使用控制器来写这些代码，但保证控制器不需要了解太多表示层的逻辑。</li><br>    <li>使用@protocol来定义回调API，如果不是所有的方法都必须实现，使用@optional（例外：当使用Objective-C 1.0，@optional不可用，因此请使用类别来定义“非正式的协议”）。</li><br></ul><br>总结：分离模型与视图。分离控制器与视图、模型。回调API使用@protocol。<p></p>

<p>[转自]: <a href="http://www.iwangke.me/objc-style-guide/" target="_blank" rel="external">http://www.iwangke.me/objc-style-guide/</a></p>

<p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/12/09/google-objective-c-style-guide-中文版/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/09/google-objective-c-style-guide-中文版/" itemprop="url">
                  Google Objective-C Style Guide 中文版
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-09T00:00:00+08:00">
              2013-12-09
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/12/09/google-objective-c-style-guide-中文版/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/12/09/google-objective-c-style-guide-中文版/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><header><br><h1>本文档不再作更新，开源的版本目前在<a href="https://github.com/zh-google-styleguide/zh-google-styleguide" target="_blank">Github</a>托管。</h1><br></header><br><div><br><h2>译者的话：</h2><br>一直想翻译这个<a href="http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml" target="_blank">style guide</a>，终于在周末花了7个小时的时间用vim敲出了HTML。很多术语的翻译很难，平时看的中文技术类书籍有限，对很多术语的中文译法不是很清楚，难免有不恰当之处，请读者指出并帮我改进。</div></p>

<p>王轲”ewangke at gmail.com” 2011.03.27<br></p><h2>目录</h2><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#examples" target="_blank" rel="external">例子</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#space_and_formating" target="_blank" rel="external">空格与格式</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#space_vs_tabs" target="_blank" rel="external">空格与制表符</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#line_length" target="_blank" rel="external">行宽</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#method_declarations_and_definations" target="_blank" rel="external">方法声明与定义</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#method_invocations" target="_blank" rel="external">方法调用</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#public_and_private" target="_blank" rel="external">@public与@private</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#exceptions" target="_blank" rel="external">异常</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#protocols" target="_blank" rel="external">协议</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#naming" target="_blank" rel="external">命名</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#file_names" target="_blank" rel="external">文件名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#objective_cplusplus" target="_blank" rel="external">Objective-C++</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#class_names" target="_blank" rel="external">类名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#category_names" target="_blank" rel="external">分类名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#objective_c_method_names" target="_blank" rel="external">Objective-C方法名</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#variable_names" target="_blank" rel="external">变量名</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#comments" target="_blank" rel="external">注释</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#file_comments" target="_blank" rel="external">文件注释</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#declaration_comments" target="_blank" rel="external">声明注释</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#implementation_comments" target="_blank" rel="external">实现注释</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#object_ownership" target="_blank" rel="external">对象所有权</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#cocoa_and_objective_c_features" target="_blank" rel="external">Cocoa与Objective-C特性</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#member_variables_should_be_private" target="_blank" rel="external">成员变量应该为@private</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#identify_designated_initializer" target="_blank" rel="external">指明指定的初始化器</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#override_designated_initializer" target="_blank" rel="external">重写指定的初始化器</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#avoid_new" target="_blank" rel="external">避免使用+new</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#keep_the_public_api_simple" target="_blank" rel="external">保持公有的API尽量简单</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#import_and_include" target="_blank" rel="external">#import与#include</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#use_root_frameworks" target="_blank" rel="external">使用根框架</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#prefer_to_autorelease_at_time_of_creation" target="_blank" rel="external">创建对象时尽量使用autorelease</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#autorelease_and_retain" target="_blank" rel="external">Autorelease之后retain</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#dealloc_should_process_instance_variables_in_declaration_order" target="_blank" rel="external">Dealloc中应该按声明的顺序处理成员变量</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#setters_copy_nsstrings" target="_blank" rel="external">Setters中对NSString进行copy</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#avoid_throwning_exceptions" target="_blank" rel="external">避免抛出异常</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#nil_checking" target="_blank" rel="external">nil的检查</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#bool_pitfalls" target="_blank" rel="external">BOOL陷阱</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#properties" target="_blank" rel="external">属性</a></li><br></ul><br></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#cocoa_patterns" target="_blank" rel="external">Cocoa模式</a><br><ul><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#delegate_pattern" target="_blank" rel="external">委托模式</a></li><br>    <li><a href="http://www.iwangke.me/objc-style-guide/#model_view_controller" target="_blank" rel="external">模型-视图-控制器</a></li><br></ul><br></li><br></ul><br><h2>背景介绍</h2><br>Objective-C是一种动态的面向对象的语言，它是C的扩展。它被设计成具有易读易用的，支持复杂的面向对象设计的编程语言。它是Mac OS X以及iPhone的主要开发语言<p></p>

<p>Cocoa是Mac OS X的主要的应用程序框架。它由一组支持Mac OS X全部特性的，并可用于快速开发的Objective-C类构成。</p>

<p>苹果公司已经撰写了非常全面的Objective-C编码指南。Google也为C++写了类型的编码指南。这个Objective-C指南是苹果和Google最佳实践的结合。因此，在阅读本指南之前，请确定你已经读过以下内容：<br><ul><br>    <li><a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/index.html" target="_blank">Apple’s Cocoa Coding Guidelines</a></li><br>    <li><a href="http://google-styleguide.googlecode.com/svn/trunk/plainguide.xml" target="_blank">Google’s Open Source C++ Style Guide</a></li><br></ul><br>&nbsp;</p>

<p>注意：所有在Google的C++编码指南中所禁止的事情，如未有特殊提及，也同样不能在Objective-C++中使用。</p>

<p>本文档的目的在于为所有的Mac OS X的代码提供编程指南及最佳实践。许多指南是在实际的项目及小组中经过长期的演进及验证的。Google开发的开源项目遵从本指南的要求。</p>

<p>Google已经发布了<a href="http://code.google.com/p/google-toolbox-for-mac/" target="_blank">Google Toolbox for Mac project</a>的部分开源代码，这些代码遵从本指南。跨多个项目的代码是这个库中的较好候选。</p>

<p>请注意，本指南不是Objective-C的教程。我们假定读者已经对Objective-C非常熟悉。如果你刚刚接触Objective-C或者需要提高，请阅读<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/index.html" target="_blank">The Objective-C Programming Language</a>。</p>

<p>&nbsp;<br></p><h2><a name="examples"></a>例子</h2><br>一个例子顶上一千句话，我们就从这样的一个例子开始，来感受一下编码的风格、空格以及命名等等。<p></p>

<p></p><p>一个头文件的例子，展示了在@interface声明中如何进行正确的注释以及空格。</p><p></p>
<p>&nbsp;<br><pre>//  GTMFoo.h<br>//  FooProject<br>//<br>//  Created by Greg Miller on 6/13/08.<br>//  Copyright 2008 Google, Inc. All rights reserved.<br>//</pre></p>

<p>#import </p>

<p>// A sample class demonstrating good Objective-C style. All interfaces,<br><br>// categories, and protocols (read: all top-level declarations in a header)<br><br>// MUST be commented. Comments must also be adjacent to the object they’re<br><br>// documenting.<br><br>//<br><br>// (no blank line between this comment and the interface)<br><br>@interface GTMFoo : NSObject {<br><br>@private<br><br>    NSString <em>foo_;<br><br>    NSString </em>bar_;<br><br>}</p>

<p>// Returns an autoreleased instance of GMFoo. See -initWithString: for details<br><br>// about the argument.<br><br>+ (id)fooWithString:(NSString *)string;</p>

<p>// Designated initializer. |string| will be copied and assigned to |foo_|.<br><br>- (id)initWithString:(NSString *)string;</p>

<p>// Gets and sets the string for |foo_|.<br><br>- (NSString <em>)foo;<br><br>- (void)setFoo:(NSString </em>)newFoo;</p>

<p>// Does some work on |blah| and returns YES if the work was completed<br><br>// successfuly, and NO otherwise.<br><br>- (BOOL)doWorkWithString:(NSString *)blah;</p>

<p></p><p>@end<br>&nbsp;</p><p></p>
<p></p><p>一个实现文件的例子，展示了@implementation部分如何进行正确的注释、空格。同时也包括了基于引用实现的一些重要方法，如getters、setters、init以及dealloc。</p><p></p>
<p>&nbsp;<br><pre>//<br>//  GTMFoo.m<br>//  FooProject<br>//<br>//  Created by Greg Miller on 6/13/08.<br>//  Copyright 2008 Google, Inc. All rights reserved.<br>//</pre></p>

<p>#import “GTMFoo.h”</p>

<p></p><p>@implementation GTMFoo</p><p></p>
<p>+ (id)fooWithString:(NSString *)string {<br><br>    return [[[self alloc] initWithString:string] autorelease];<br><br>}</p>

<p>// Must always override super’s designated initializer.<br><br>- (id)init {<br><br>    return [self initWithString:nil];<br><br>}</p>

<p>- (id)initWithString:(NSString *)string {<br><br>    if ((self = [super init])) {<br><br>        foo<em> = [string copy];<br><br>        bar</em> = [[NSString alloc] initWithFormat:@”hi %d”, 3];<br><br>    }<br><br>    return self;  <br><br>}</p>

<p>- (void)dealloc {<br><br>    [foo<em> release];<br><br>    [bar</em> release];<br><br>    [super dealloc];<br><br>}</p>

<p>- (NSString *)foo {<br><br>    return foo_;<br><br>}</p>

<p>- (void)setFoo:(NSString *)newFoo {<br><br>    [foo<em> autorelease];<br><br>    foo</em> = [newFoo copy];  <br><br>}</p>

<p>- (BOOL)doWorkWithString:(NSString *)blah {<br><br>    // …<br><br>    return NO;<br><br>}</p>

<p></p><p>@end<br>&nbsp;</p>
<p></p><h2><a name="space_and_formating"></a>空格与格式</h2><br>&nbsp;<p></p>
<p></p><h3><a name="space_vs_tabs"></a>空格与制表符</h3><br>&nbsp;<p></p><p></p>
<p>我们使用空格进行缩进。不要在代码中使用制表符。你应该将你的文本编辑器设置成自动将制表符替换成空格。</p>

<p>总结：只使用空格，每次缩进两个空格。</p>

<p>&nbsp;<br></p><h3><a name="line_length"></a>行宽</h3><br>&nbsp;<p></p>

<p>即使Objective-C比C++更加冗长，为了保证本指南的可操作性，我们决定保持每行宽度为80列。这比你想的要简单。</p>

<p>我们意识到这条规则是有争议的，但很多已经存在的代码坚持了本规则，因此我们觉得保证一致性更重要。</p>

<p>通过设置Xcode&gt;Preferences&gt;Text Editing&gt;Show page guide，来使越界更容易被发现。</p>

<p>总结：代码中的每行最多有80个字符。</p>

<p>&nbsp;<br></p><h3><a name="method_declarations_and_definations"></a>方法声明与定义</h3><br>&nbsp;<p></p>

<p>方法应该像这样</p>

<p>&nbsp;<br><pre>- (void)doSomethingWithString:(NSString *)theString {<br>    …<br>}</pre><br>&nbsp;</p>

<p>星号前的空格是可选的。当写新的代码时，要与原的代码一致。</p>

<p>如果一行有非常多的参数，更好的方式是将每个参数单独拆成一行。如果使用多行，将每个参数前的冒号对齐。</p>

<p>&nbsp;<br><pre>- (void)doSomethingWith:(GTMFoo *)theFoo<br>                   rect:(NSRect)theRect<br>               interval:(float)theInterval {<br>    …<br>}</pre><br>&nbsp;</p>

<p>当第一个关键字比其它的短时，保证下一行至少有4个空格的缩进。这样可以使关键字垂直对齐，而不是使用冒号对齐：</p>

<p>&nbsp;<br><pre>- (void)short:(GTMFoo *)theFoo<br>    longKeyword:(NSRect)theRect<br>    evenLongerKeyword:(float)theInterval {<br>    …<br>}</pre><br>&nbsp;</p>

<p>总结：-或者+与返回类型之间，需要有空格。参数列表中，只有参数之间有空格。</p>

<p>&nbsp;<br></p><h3><a name="method_invocations"></a>方法调用</h3><br>&nbsp;<p></p>

<p>方法调用时，所有参数应该在同一行。</p>

<p>&nbsp;<br><pre>[myObject doFooWith:arg1 name:arg2 error:arg3];</pre><br>&nbsp;</p>

<p>或者每行一个参数，以冒号对齐：</p>

<p>&nbsp;<br><pre>[myObject doFooWith:arg1<br>               name:arg2<br>              error:arg3];</pre><br>&nbsp;</p>

<p>不要使用下面的缩进风格：</p>

<p>&nbsp;<br><pre>[myObject doFooWith:arg1 name:arg2  // some lines with &gt;1 arg<br>              error:arg3];</pre></p>

<p>[myObject doFooWith:arg1<br><br>               name:arg2 error:arg3];</p>

<p>[myObject doFooWith:arg1<br><br>          name:arg2  // aligning keywords instead of colons<br><br>          error:arg3];<br>&nbsp;</p>

<p>方法定义与方法声明一样，当关键字的长度不足以以冒号对齐时，下一行都要以四个空格进行缩进。</p>

<p>&nbsp;<br><pre>[myObj short:arg1<br>    longKeyword:arg2<br>    evenLongerKeyword:arg3];</pre><br>&nbsp;</p>

<p>总结：方法定义的格式与方法声明的格式非常相似。当格式的风格有多种选择时，新的代码要与已经存在的代码保持一致。</p>

<p>&nbsp;<br></p><h3><a name="public_and_private"></a>@public与@private</h3><br>&nbsp;<p></p>

<p>与C++中的public, private以及protected非常相似。</p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @public<br>    …<br> @private<br>    …<br>}<br>@end</pre><br>&nbsp;</p>

<p></p><p>总结：@public以及@private访问标识符应该以一个空格缩进。</p><p></p>
<p>&nbsp;<br></p><h3><a name="exceptions"></a>异常</h3><br>&nbsp;<p></p>

<p>如果你必须使用Objective-C的异常，按下面的格式进行编码代码。然后，请参见<a href="http://www.iwangke.me/objc-style-guide/#avoid_throwning_exceptions" target="_blank" rel="external">避免抛出异常</a>来了解不应该使用异常的原因。</p>

<p>&nbsp;<br><pre>@try {<br>    foo();<br>}<br>@catch (NSException *ex) {<br>    bar(ex);<br>}<br>@finally {<br>    baz();<br>}</pre><br>&nbsp;</p>

<p></p><p>总结：每个@标签应该有独立的一行，在@与{}之间需要有一个空格。@catch与被捕捉到的异常对象的声明之间也要有一个空格。</p><p></p>
<p>&nbsp;<br></p><h3><a name="protocols"></a>协议</h3><br>&nbsp;<p></p>

<p>这条规则也同样适用于类声明、成员变量以及方法声明。例如：</p>

<p>&nbsp;<br><pre>@interface MyProtocoledClass : NSObject {<br> @private<br>    id delegate_;<br>}<br>- (void)setDelegate:(id)aDelegate;<br>@end</pre><br>&nbsp;</p>

<p>总结：尖括号所包括的协议名称与前面的类型标识之间不应该有空格。<br></p><h2><a name="naming"></a>命名</h2><br>对于可维护的代码，命名规则非常重要。 Objective-C的方法名往往十分长，但代码块读起来就像散文一样，不需要太多的注释修饰。<p></p>

<p>当编写纯Objective-C代码时，我们基本遵守标准的<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/CodingGuidelines.html" target="_blank">Objective-C naming rules</a>，这些命名规则可能与C++风格指南中的大相径庭。例如，Google的C++风格指南中推荐使用下划线分隔的单词作为变量名，而(苹果的)风格指南则使用camel命名法，这在Objective-C社区中非常普遍。</p>

<p>任何的类、分类、方法以及变量的名字中都使用<a href="http://en.wikipedia.org/wiki/Initialism" target="_blank">全大写缩写</a>。这遵守了苹果的标准命名方式，如URL、TIFF以及EXIF。</p>

<p>当编写Objective-C++代码时，事情就不这么简单了。许多的项目需要实现跨平台的C++代码，并与Objective-C以及Cocoa混合编写。或者以C++作为后端，Cocoa作为前端。这就导致了两种命名方式直接不统一。</p>

<p></p><p>我们的解决方案是：编码风格取决于方法/函数以哪种语言实现。如果在一个@implementation语句块中，就使用Objective-C的风格。如果实现一个C++的类，请使用C++的风格。这避免了成员变量与局部变量使用混合的命名风格，这会严重地影响可读性。</p><p></p>
<p>&nbsp;<br></p><h3><a name="file_names"></a>文件名</h3><br>&nbsp;<p></p>

<p>文件的扩展名应该如下：<br><ul><br>    <li>.h, C/C++/Objective-C的头文件</li><br>    <li>.m, Ojbective-C实现文件</li><br>    <li>.mm, Ojbective-C++的实现文件</li><br>    <li>.cc, 纯C++的实现文件</li><br>    <li>.c, 纯C的实现文件</li><br></ul><br>&nbsp;</p>

<p>分类的文件名应该包含被扩展的类的名字，如：GTMNSString+Utils.h或GTMNSTextView+Autocomplete.h。</p>

<p>总结：文件名应该反映了它实现了什么类。遵守你的项目的惯例。</p>

<p>&nbsp;<br></p><h3><a name="objective_cplusplus"></a>Objective-C++</h3><br>&nbsp;<p></p>

<p>为了最小化Cocoa/Objective-C与C++之间的命名风格的冲突，按照下面方法实现的风格编写代码。在实现@implementation语句块时，使用Objective-C的命名规则；如果实现一个C++的类，就使用C++命名规则。</p>

<p>&nbsp;<br><pre>// file: cross_platform_header.h</pre></p>

<p>class CrossPlatformAPI {<br><br> public:<br><br>    …<br><br>    int DoSomethingPlatformSpecific();  // impl on each platform<br><br> private:<br><br>    int an_instance<em>var</em>;<br><br>};</p>

<p>// file: mac_implementation.mm<br><br>#include “cross_platform_header.h”</p>

<p>// A typical Objective-C class, using Objective-C naming.<br><br>@interface MyDelegate : NSObject {<br><br> @private<br><br>    int instanceVar<em>;<br><br>    CrossPlatformAPI* backEndObject</em>;<br><br>}<br>- (void)respondToSomething:(id)something;<br><br>@end<br><br>@implementation MyDelegate<br><br>- (void)respondToSomething:(id)something {<br><br>    // bridge from Cocoa through our C++ backend<br><br>    instanceVar<em> = backEndObject-&gt;DoSomethingPlatformSpecific();<br><br>    NSString* tempString = [NSString stringWithInt:instanceVar</em>];<br><br>    NSLog(@”%@”, tempString);<br><br>}<br>@end</p>

<p>// The platform-specific implementation of the C++ class, using<br><br>// C++ naming.<br><br>int CrossPlatformAPI::DoSomethingPlatformSpecific() {<br><br>    NSString* temp_string = [NSString stringWithInt:an_instance<em>var</em>];<br><br>    NSLog(@”%@”, temp_string);<br><br>    return [temp_string intValue];<br><br>}<br>&nbsp;</p>

<p>总结：当编写源代码时，Ojbective-C++应该采用你正在实现的方法/函数的风格。</p>

<p>&nbsp;<br></p><h3><a name="class_names"></a>类名</h3><br>&nbsp;<p></p>

<p>应用程序级的代码，应该尽量避免不必要的前缀。为每个类都添加前缀不会提高任何的可读性。当设计跨不同应用程序的代码时，应该使用前缀，例如：GTMSendMessage。</p>

<p>总结：类名、分类名、协议名应该以大写字母开始，并混合小写字母来分隔单词。(Camel命名法)</p>

<p>&nbsp;<br></p><h3><a name="category_names"></a>分类名</h3><br>&nbsp;<p></p>

<p>例如，录我们要创建一个NSString的类别以解析时，我们将把类别放在一个名为GTMNSString+Parsing.h的文件中。类别名本身的名字是GTMStringParsingAdditions（是的，我们知道类别名和文件名不一样，但是这个文件中可能存在多个不同的与解析有关类别）。类别中的方法应该以gtm_myCategoryMethodOnAString为前缀以避免命名冲突，因为Objective-C只有一个命名空间。如果代码不会被分享并且不会被运行在不同的地址空间中，方法名字就不那么重要。</p>

<p>类名与包含类别名的括号之间，应该以一个空格分隔。</p>

<p>总结：类别名应该有两三个字母的前缀以表示类别是项目的一部分或者该类别是通用的。类别应该包含它所扩展的类的名字。</p>

<p>&nbsp;<br></p><h3><a name="objective_c_method_names"></a>Objective-C方法名</h3><br>&nbsp;<p></p>

<p>方法名应该读起来就像句子，这表示你应该选择与方法名连在一起读起来通顺的参数名。(例如，convertPoint:fromRect: or replaceCharactersInRange:withString:)参见<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/CodingGuidelines/Articles/NamingMethods.html#//apple_ref/doc/uid/20001282-BCIGIJJF" target="_blank">Apple’s Guide to Naming Methods</a>。</p>

<p>访问器方法应该与他们getting的的成员变量的名字一样，但不应该以get作为前缀。例如：</p>

<p>&nbsp;<br><pre>- (id)getDelegate;  // AVOID<br>- (id)delegate;    // GOOD</pre><br>&nbsp;</p>

<p>这仅限于Objective-C的方法名。C++的方法与函数的命名规则应该遵从C++风格指南中的规则。</p>

<p>总结：方法名应该以小写字母开头，并混合大小写（Camel命名法）。每个命名的参数也应该以小写字母开头。</p>

<p>&nbsp;<br></p><h3><a name="variable_names"></a>变量名</h3><br>&nbsp;<p></p>

<p>常用变量名</p>

<p>对于静态的类别，如int以及指针等，不要使用匈牙利命名法。要为变量起一个描述性的名字。不要担心浪费列宽，因为让新的代码阅读者立即理解你的代码更重要。例如：</p>

<p>错误的命名：</p>

<p>&nbsp;<br><pre>int w;<br>int nerr;<br>int nCompConns;<br>tix = [[NSMutableArray alloc] init];<br>obj = [someObject object];<br>p = [network port];</pre><br>&nbsp;</p>

<p>正确的命名：</p>

<p>&nbsp;<br><pre>int numErrors;<br>int numCompletedConnections;<br>tickets = [[NSMutableArray alloc] init];<br>userInfo = [someObject object];<br>port = [network port];</pre><br>&nbsp;</p>

<p>成员变量</p>

<p>成员变量应该混合大小写，并以下划线作为后缀，如usernameTextField_。然而，如果不能使用Objective-C 2.0（操作系统版本的限制），并且使用KVO/KVC绑定成员变量时，我们允许这个例外（译者注：KVO=Key Value Observing，KVC=Key Value Coding）。这种情况下，可以以一个下划线作为成员变量名字的前缀，这是苹果所接受的键/值命名惯例。如果可以使用Objective-C 2.0，@property以及@synthesize提供了遵从这一命名规则的解决方案。</p>

<p>常量</p>

<p>常量名（如宏、枚举、静态局部变量等）应该以小写字母k开头，使用混合大小写的格式来分隔单词，如：kInvalidHandle，kWritePerm。</p>

<p>总结：变量名应该以小写字母开头，并混合大小写。类的成员变量应该以下划线作为后缀。例如：myLocalVariable、myInstanceVariable_。如果不能使用Objective-C 2.0的@property，使用KVO/KVC绑定的成员变量可以以一个下划线作为前缀。<br></p><h2><a name="comments"></a>注释</h2><br>虽然写起来很痛苦，但注释是保证代码可读性的关键。下面的规则给出了你应该什么时候、在哪进行注释。记住：尽量注释很重要，但最好的代码应该自成文档。与其给类型及变量起一个晦涩难懂的名字，再为它写注释，不如直接起一个有意义的名字。<p></p>

<p>当你写注释的时候，记得你在给你的听众写，即下一个需要阅读你的代码的代码贡献者。大方一点，下一个读代码的人可能就是你！</p>

<p>记住所有C++风格指南里的规则在这里也同样适用，不同的地方会在下面指出</p>

<p>&nbsp;<br></p><h3><a name="file_comments"></a>文件注释</h3><br>&nbsp;<p></p>

<p>版权信息及作者</p>

<p>每个文件应该按顺序包括如下内容：<br><ul><br>    <li>版权信息声明（如：Copyright 2008 Google Inc.）</li><br>    <li>授权样版。选择一个合适的项目所使用的授权样板（例如，Apache 2.0, BSD, LGPL, GPL）。</li><br></ul><br>如果你对其他人的原始代码作出重大的修改，请把你的名字添加到作者里面。当另外一个代码贡献者对文件有问题时，他需要知道怎么联系你，这十分有用。</p>

<p>总结：以版权信息作为文件头部，开始每一个文件，后接文件内容的描述。</p>

<p>&nbsp;<br></p><h3><a name="declaration_comments"></a>声明注释</h3><br>&nbsp;<p></p>

<p>&nbsp;<br><pre>// A delegate for NSApplication to handle notifications about app<br>// launch and shutdown. Owned by the main app controller.<br>@interface MyAppDelegate : NSObject {<br>    …<br>}<br>@end</pre><br>&nbsp;</p>

<p>如果你已经在文件头部详细描述了接口，可以直接说明“完整的描述请参见文件头部”，但是一定要有这部分注释。</p>

<p>另外，公共接口的每个方法，都应该有注释来解释它的作用、参数、返回值以及其它影响。</p>

<p>为类的线程安全性作注释，如果有的话。如果类的实例可以被多个线程访问，记得注释多线程条件下的使用规则。</p>

<p>总结：每个接口、类别以及协议应该注释，以描述它的目的及作用。</p>

<p>&nbsp;<br></p><h3><a name="implementation_comments"></a>实现注释</h3><br>&nbsp;<p></p>

<p>这会避免二义性，尤其是当符号是一个常用词汇，这使用语句读起来很糟糕。例如，对于符号”count”：</p>

<p>&nbsp;<br><pre>// Sometimes we need |count| to be less than zero.</pre><br>&nbsp;</p>

<p>或者当引用已经包含引号的符号：</p>

<p>&nbsp;<br><pre>// Remember to call |StringWithoutSpaces(“foo bar baz”)|</pre><br>&nbsp;</p>

<p>总结：使用|来引用注释中的变量名及符号名而不是使用引号。</p>

<p>&nbsp;<br></p><h3><a name="object_ownership"></a>对象所有权</h3><br>&nbsp;<p></p>

<p>继承自NSObject的成员变量指针，通常被假定是强引用关系（retained）。如果它有没被类retained，应该注释为弱引用（weak）。然而，以IBOutlets作为标签的成员变量默认是不会被类retained的。如果是强引用关系，应该注释。</p>

<p>当成员变量指向CoreFoundation、C++或者其它非Objective-C对象时，无论是强引用还是弱引用，都需要注释说明。注意：Objective-C对象中的C++对象的自动封装，默认情况下是不允许的，参见。</p>

<p>强引用及弱引用注释的例子：</p>

<p>&nbsp;<br><pre>@interface MyDelegate : NSObject {<br> @private<br>        IBOutlet NSButton<em> okButton_;  // normal NSControl<br>        IBOutlet NSMenu</em> myContextMenu_;  // manually-loaded menu (strong)</pre></p>

<p>        AnObjcObject<em> doohickey_;  // my doohickey<br><br>        MyController</em> controller_;  // so we can send msgs back (weak, owns me)</p>

<p>        // non-NSObject pointers…<br><br>        CWackyCPPClass<em> wacky_;  // some cross-platform object (strong)<br><br>        CFDictionaryRef</em> dict_;  // (strong)<br><br>}<br>@end<br>&nbsp;</p>

<p>强引用：对象被类retained。</p>

<p>弱引用：对象没有被类retained。（如委托）</p>

<p>总结：当与Objective-C最通常的作法不同时，尽量使用指针的所有权模型尽量直观。<br></p><h2><a name="cocoa_and_objective_c_features"></a>Cocoa以及Objective-C特性</h2><br>&nbsp;<br><h3><a name="member_variables_should_be_private"></a>成员变量应该为@private</h3><br>&nbsp;<p></p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @private<br>    id myInstanceVariable_;<br>}<br>// public accessors, setter takes ownership<br>- (id)myInstanceVariable;<br>- (void)setMyInstanceVariable:(id)theVar;<br>@end</pre><br>&nbsp;</p>

<p>总结：成员变量应该声明为私有。</p>

<p>&nbsp;<br></p><h3><a name="identify_designated_initializer"></a>指明指定的初始化器</h3><br>&nbsp;<p></p>

<p>对于需要继承你的类的人来说，指定的初始化器十分重要。这样他们就可以只重写一个初始化器（可能是几个）来保证他们的子类的初始化器会被调用。这也有助于将来别人调试你的类时，理解初始化代码的工作流程。</p>

<p>总结：注释并且明确指出你的类的指定的初始化器。</p>

<p>&nbsp;<br></p><h3><a name="override_designated_initializer"></a>重写指定的初始化器</h3><br>&nbsp;<p></p>

<p>如果我没有重写父类的指定的初始化器，你的初始化器有时可能不会被调用，这会导致很微妙而且难以解决的bug。</p>

<p>总结：当你写子类的时候，如果需要init…方法，记得重写父类的指定的初始化器。</p>

<p>&nbsp;<br></p><h3><a name="initialization"></a>初始化</h3><br>&nbsp;<p></p>

<p>刚分配的对象，默认值都是0。除了isa指针（译者注：NSObject的isa指针，用于标识对象的类型）。所以不要在初始化器里面写一堆将成员初始化为0或者nil的代码。</p>

<p>总结：不要在init方法中，将成员变量初始化为0或者nil，这是冗余的。</p>

<p>&nbsp;<br></p><h3><a name="avoid_new"></a>避免使用+new</h3><br>&nbsp;<p></p>

<p>现代的Ojbective-C代码通过调用alloc和init方法来创建并且retain一个对象。由于类方法new很少被使用，这使得有关内存分配的代码审查更困难。</p>

<p>总结：不要调用NSObject类的类方法new，也不要在子类重写。相反，你应该使用alloc和init方法来创建并初始化一个对象。</p>

<p>&nbsp;<br></p><h3><a name="keep_the_public_api_simple"></a>保持公有的API尽量简单</h3><br>&nbsp;<p></p>

<p>与C++不同，Objective-C没有方法来区分公有的方法和私有的方法，所有的方法都是公有的（译者注：这取决于Objective-C运行时的方法调用的消息机制）。因此，除非客户端的代码期望使用某个方法，不要把这个方法放进公有的API中。这降低了你不希望被调用的方法被调用的可能性。这包括重写父类的方法。对于内部实现所需要的方法，在实现的文件中定义一个类别，而不是把它们放进公有的头文件中。</p>

<p>&nbsp;<br><pre>// GTMFoo.m<br>#import “GTMFoo.h”</pre></p>

<p></p><p>@interface GTMFoo (PrivateDelegateHandling)<br></p>
<ul>
<li>(NSString *)doSomethingWithDelegate;  // Declare private method<br><br>@end<p></p></li>
</ul>
<p></p><p>@implementation GTMFoo(PrivateDelegateHandling)<br><br>…<br></p>
<ul>
<li>(NSString *)doSomethingWithDelegate {<br><br>  // Implement this method<br><br>}<br>…<br><br>@end<br>&nbsp;<p></p></li>
</ul>
<p>在Objective-C 2.0之前，如果你在私有的@interface中声明了某个方法，但在@implementation中忘记定义了这个方法，编译器不会反对（这是因为你没有在其它的类别中实现这个私有的方法）。解决文案是将方法放进指定类别的@implemenation中。</p>

<p>如果你在使用Objective-C 2.0，相反你应该使用类扩展来声明你的私有类别，例如：</p>

<p>&nbsp;<br><pre>@interface GMFoo () { … }</pre><br>&nbsp;</p>

<p></p><p>这会保证如果声明的方法如果没有在@implementation中实现，会产生一个编译器警告。</p><p></p>
<p>再次说明，私有的方法其实不是私有的。你有时可能不小心重写了父类的私有方法，这很难调试。通常，私有的方法应该有一个相当特殊的名字以防止子类无意地重写它们。</p>

<p>Ojbective-C的类别是一种很好的方法来将一个大的@implementation拆分成更容易理解的小块。同时，类别可以为最适合的类添加新的、基于特定应用程序的功能。例如，当添加一个“middle truncation”方法时，创建一个NSString的新类别并把方法放在里面，比创建任意的一个新类把方法放进里面要好得多。</p>

<p>&nbsp;<br></p><h3><a name="import_and_include"></a>#import与#include</h3><br>&nbsp;<p></p>

<p>基于你所包括的头文件的编程语言，选择使用#import还是#include：</p>

<p>&nbsp;<br><ul><br>    <li>当包含一个使用Objective-C、Objective-C++的头文件时，使用#import。</li><br>    <li>当包含一个使用标准C、C++头文件时，使用#include。头文件应该提供自己的。</li><br></ul><br>&nbsp;</p>

<p>一些Ojbective-C的头文件缺少#define保护，只期望被使用#import的方式包含。由于Objective-C的头文件只会被Objective-C的源文件及头文件包含，广泛地使用#import是可以的。</p>

<p>文件中没有Objective-C的标准C、C++的头文件，可能会被普通的C、C++包含。既然标准的C、C++里面没有#import的用法，这些文件将被#include包含。Objective-C源文件中使用#include包含，意味着这些头文件会永远以相同的语义被包含。</p>

<p>这条规则帮助跨平台的项目中产生无意的错误。一个忘记使用#define保护的Mac开发者，在引用了新的C、C++头文件时，如果新的头文件使用#import被引用，在Mac上会没有问题。但在其它使用#include平台上可能会使构造失败。一致地在所有的平台上使用#include，意味着构造更可能一致地成功或者失败。这避免了文件只能在某些平台上使用的尴尬。</p>

<p>下面是正确的使用方式：</p>

<p>&nbsp;<br><pre>#import<br>#include<br>#import “GTMFoo.h”<br>#include “base/basictypes.h”</pre><br>&nbsp;</p>

<p>总结：#import Ojbective-C/Objective-C++头文件，#include C/C++头文件。</p>

<p>&nbsp;<br></p><h3><a name="use_root_frameworks"></a>使用根框架</h3><br>&nbsp;<p></p>

<p>当你试图从框架（如Cocoa或者Foundation）中包含单独的系统头文件时，实际上包含顶级根框架编译器要作更少的工作。根框架通常被预编译，并且加载得更快。另外记得使用#import而不是#include来包含Objective-C的框架。</p>

<p>正确的做法：</p>

<p>&nbsp;<br><pre>#import      // good</pre><br>&nbsp;</p>

<p>错误的做法：</p>

<p>&nbsp;<br><pre>#import         // avoid<br>#import<br>…</pre><br>&nbsp;</p>

<p>总结：包含根框架而不是单独的文件。</p>

<p>&nbsp;<br></p><h3><a name="prefer_to_autorelease_at_time_of_creation"></a>创建对象时尽量使用autorelease</h3><br>&nbsp;<p></p>

<p>尽管运行效率会差一点，这避免了意外地删除了release或者插入return语句而产生内存泄露的可能。例如：</p>

<p>错误的做法：</p>

<p>&nbsp;<br><pre>// AVOID (unless you have a compelling performance reason)<br>MyController* controller = [[MyController alloc] init];<br>// … code here that might return …<br>[controller release];</pre><br>&nbsp;</p>

<p>正确的做法：</p>

<p>&nbsp;<br><pre>// BETTER<br>MyController* controller = [[[MyController alloc] init] autorelease];</pre><br>&nbsp;</p>

<p>总结：当创建临时对象时，在同一行使用autolease，而不是在同一个方法的后面语句中使用一个单独的release。</p>

<p>&nbsp;<br></p><h3><a name="autorelease_and_retain"></a>Autolease之后retain</h3><br>&nbsp;<p></p>

<p>当给一个变量赋值新的对象时，必须先释放掉旧的对象以避免内存泄露。有一些正确的方法来处理它。我们选择autorelease之后retain的方法因为事实证明它更少地出错。注意大的循环会填满autorelease pool，并且可能效率上会差一点，但这点折衷我们认为是可以接受的。</p>

<p>&nbsp;<br><pre>- (void)setFoo:(GMFoo *)aFoo {<br>    [foo<em> autorelease];  // Won’t dealloc if |foo</em>| == |aFoo|<br>    foo_ = [aFoo retain];<br>}</pre><br>&nbsp;</p>

<p>总结：给对象赋值时遵守autorelease之后retain的模式。</p>

<p>&nbsp;<br></p><h3><a name="dealloc_should_process_instance_variables_in_declaration_order"></a>Dealloc中应该按声明的顺序处理成员变量</h3><br>&nbsp;<p></p>

<p>代码审查者在审查新的或者修改过的dealloc实现时，需要保证每个retained的对象都得到了释放。</p>

<p>为了简单的审查dealloc，对象被释放的顺序应该与他们在@interface中声明的顺序一致。如果dealloc调用了其它方法释放成员变量，注释这个方法处理了哪些成员变量的释放。</p>

<p>总结：dealloc中对象被释放的顺序应该与他们在@interface中声明的顺序一致，这有助于代码审查。</p>

<p>&nbsp;<br></p><h3><a name="setters_copy_nsstrings"></a>Setters中对NSString进行copy</h3><br>&nbsp;<p></p>

<p>永远不要仅仅retain一个字符串。这避免了调用者在你不知道的情况下对字符串作出了修改。不要作出那样的假设：你接受的对象是一个NSString对象而不是NSMutableString对象。</p>

<p>&nbsp;<br><pre>- (void)setFoo:(NSString *)aFoo {<br>    [foo<em> autorelease];<br>    foo</em> = [aFoo copy];<br>}</pre><br>&nbsp;</p>

<p>总结：接受NSString作为参数的setter，应该copy它所接受的字符串。</p>

<p>&nbsp;<br></p><h3><a name="avoid_throwning_exceptions"></a>避免抛出异常</h3><br>&nbsp;<p></p>

<p>我们确实在编译时允许-fobjc-exceptions（主要我们得到了使用@synchronized的好处），但我们不使用@throw。当正确地使用第三方的代码时，使用@try、@catch、和@finally是允许的。如果你确实使用了异常，请注释你期望什么方法抛出异常。</p>

<p>不要使用NS_DURING, NS_HANDLER, NS_ENDHANDLER, NS_VALUERETURN 和 NS_VOIDRETURN 这些宏，除非你写的代码需要在Mac OS X 10.2或者之前的操作系统中运行。</p>

<p>注意：当使用Objective-C++写基于栈的对象的代码时，如果抛出Objective-C异常，对象不会被清理。例如：</p>

<p>&nbsp;<br><pre>class exceptiontest {<br> public:<br>    exceptiontest() { NSLog(@”Created”); }<br>    ~exceptiontest() { NSLog(@”Destroyed”); }<br>};</pre></p>

<p>void foo() {<br><br>    exceptiontest a;<br><br>    NSException *exception = [NSException exceptionWithName:@”foo”<br><br>                                               reason:@”bar”<br><br>                                             userInfo:nil];<br><br>    @throw exception;<br><br>}</p>

<p>int main(int argc, char <em>argv[]) {<br><br>    GMAutoreleasePool pool;<br><br>    @try {<br><br>    foo();<br><br>    }<br><br>    @catch(NSException </em>ex) {<br><br>    NSLog(@”exception raised”);<br><br>    }<br><br>    return 0;<br><br>}<br>&nbsp;</p>

<p>会输出：</p>

<p>&nbsp;<br><pre>2006-09-28 12:34:29.244 exceptiontest[23661] Created<br>2006-09-28 12:34:29.244 exceptiontest[23661] exception raised</pre><br>&nbsp;</p>

<p>注意：这里析构函数从未被调用。这主要会影响基于栈的对象如shared_ptr、linked_ptr和所有你可能使用的STL对象。你永远不应该重新抛出Objective-C异常，也不应该在@try, @catch, @finally 语句块中使用基于栈的C++对象。</p>

<p>总结：不要抛出Objective-C异常，但准备从第三方的调用或者系统调用捕捉异常。</p>

<p>&nbsp;<br></p><h3><a name="nil_checking"></a>nil的检查</h3><br>&nbsp;<p></p>

<p>使用nil的检查来检查应用程序的逻辑，而不是避免崩溃。Objective-C运行时会处理向一个nil的对象发送消息的情况。如果方法没有返回值，就没关系。如果有返回值，可能由于运行时架构、返回值类型以及OS X版本的不同而不同，参见<a href="http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_2_section_3.html#//apple_ref/doc/uid/TP30001163-CH11-SW7" target="_blank">Apple’s documentation</a>。</p>

<p>注意，这与检查C/C++的指针是否为NULL非常不同，运行时不会检查空的情况，并导致你的应用程序崩溃。你仍然需要保证你不会对一个C/C++的空指针解引用。</p>

<p>总结：nil检查只用于逻辑流的判断。</p>

<p>&nbsp;<br></p><h3><a name="bool_pitfalls"></a>BOOL陷阱</h3><br>&nbsp;<p></p>

<p>Ojbective-C中定义BOOL为无符号字符型，这意味着BOOL类型可以有不同于YES(1)或者NO(0）的值。不要直接把整形转换成BOOL。常见的错误包括将数组的大小、指针值及位运算的结果直接转换成BOOL，这取决于整型结果的最后一个字节，可能产生一个NO的值。当转换整形至BOOL时，使用三目操作符来返回YES或者NO。(译者注：读者可以试一下任意的256的整数的转换结果，如256、512…)</p>

<p>你可以安全在BOOL, _Bool以及bool之间转换（参见C++ Std 4.7.4, 4.12 and C99 Std 6.3.1.2）。你不能安全在BOOL以及Boolean之间转换，因此请把Boolean当作一个普通的整形，就像我产在上面讨论的那样。Objective-C的方法签名中，只使用BOOL。</p>

<p>对BOOL使用逻辑运算符（&amp;&amp;, || 和!）是合法的，返回值也可以安全地转换成BOOL，不需要使用三目操作符。</p>

<p>错误的用法：</p>

<p>&nbsp;<br><pre>- (BOOL)isBold {<br>    return [self fontTraits] &amp; NSFontBoldTrait;<br>}<br>- (BOOL)isValid {<br>    return [self stringValue];<br>}</pre><br>&nbsp;</p>

<p>正确的用法：</p>

<p>&nbsp;<br><pre>- (BOOL)isBold {<br>    return ([self fontTraits] &amp; NSFontBoldTrait) ? YES : NO;<br>}<br>- (BOOL)isValid {<br>    return [self stringValue] != nil;<br>}<br>- (BOOL)isEnabled {<br>    return [self isValid] &amp;&amp; [self isBold];<br>}</pre><br>&nbsp;</p>

<p>同样的，不要直接比较BOOL变量与YES/NO。不仅仅这影响可读性，结果可能与你想的不同。</p>

<p>错误的用法：</p>

<p>&nbsp;<br><pre>BOOL great = [foo isGreat];<br>if (great == YES)<br>    // …be great!</pre><br>&nbsp;</p>

<p>正确的用法</p>

<p>&nbsp;<br><pre>BOOL great = [foo isGreat];<br>if (great)<br>    // …be great!</pre><br>&nbsp;</p>

<p>总结：将常规整形转换成BOOL时要小心，不要直接将BOOL值与YES进行比较。</p>

<p>&nbsp;<br></p><h3><a name="properties"></a>属性</h3><br>&nbsp;<p></p>

<p>命名</p>

<p>属性所关联的成员变量的命名必须遵守以下划线作为后缀的规则。属性的名字应该与成员变量去掉下划线后缀的名字一模一样。</p>

<p></p><p>使用@synthesize指示符来正确地重命名属性</p><p></p>
<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @private<br>    NSString <em>name_;<br>}<br>@property(copy, nonatomic) NSString </em>name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>@synthesize name = name_;<br><br>@end<br>&nbsp;</p><p></p>
<p>位置</p>

<p></p><p>类接口中的属性的声明必须紧跟着成员变量语句块。属性的定义必须在@implementation的类定义的最上方。他们的缩进与包含他们的@interface以及@implementation语句一样。</p><p></p>
<p>&nbsp;<br><pre>@interface MyClass : NSObject {<br> @private<br>    NSString <em>name_;<br>}<br>@property(copy, nonatomic) NSString </em>name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>@synthesize name = name_;<br></p>
<ul>
<li>(id)init {<br><br>  …<br><br>}<br>@end<br>&nbsp;<p></p></li>
</ul>
<p>NSString使用copy特性</p>

<p>NSString属性应该永远被声明为copy特性。</p>

<p>这从逻辑上遵守了NSString的setter必须使用copy而不是retain。</p>

<p>不要synthesize CFType的属性</p>

<p>CFType应该永远使用@dynamic实现指示符。</p>

<p>尽管CFType不能使用retain属性特性，开发者必须自己处理retain和release。很少有情况你需要仅仅对它进行赋值，因此最好显示地实现getter和setter，并作出注释说明。</p>

<p>列出所有的实现指示符</p>

<p></p><p>尽管@dynamic是默认的，显示列出它以及其它的实现指示符会提高可读性，代码阅读者可以一眼就知道类的每个属性是如何实现的。</p><p></p>
<p>错误的做法：</p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject<br>@property(readonly) NSString *name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>.<br>.<br><br>.</p>
<ul>
<li>(NSString*)name {<br><br>  return @”foo”;<br><br>}<br>@end<br>&nbsp;<p></p></li>
</ul>
<p>正确的做法：</p>

<p>&nbsp;<br><pre>@interface MyClass : NSObject<br>@property(readonly) NSString *name;<br>@end</pre></p>

<p></p><p>@implementation MyClass<br><br>@dynamic name;<br><br>.<br>.<br><br>.</p>
<ul>
<li>(NSString*)name {<br><br>  return @”foo”;<br><br>}<br>@end<br>&nbsp;<p></p></li>
</ul>
<p>原子性</p>

<p>一定要注意属性的开销。所有synthesize的setter和getter都是原子的。这会给每个get或者set带来一定的同步开销。显示将你的属性声明为nonatomic除非你需要原子操作。</p>

<p>点引用</p>

<p>点引用是地道的Objective-C 2.0的风格。它被使用于简单的属性set、get操作，但对象的其它行为不应该使用它。</p>

<p>正确的做法：</p>

<p>&nbsp;<br><pre>NSString *oldName = myObject.name;<br>myObject.name = @”Alice”;</pre><br>&nbsp;</p>

<p>错误的做法：</p>

<p>&nbsp;<br><pre>NSArray *array = [[NSArray arrayWithObject:@”hello”] retain];</pre></p>

<p>NSUInteger numberOfItems = array.count;  // not a property<br><br>array.release;                           // not a property<br>&nbsp;</p>

<p>总结：需要注意的是，使用点引用语法必须需要Objective-C 2.0的支持，这意味着你的代码只能运行于iPhone或者Mac OS X 10.5(Leopard)及以后的版本。点引用只允许访问声明的属性。<br></p><h2><a name="cocoa_patterns"></a>Cocoa模式</h2><br>&nbsp;<br><h3><a name="delegate_pattern"></a>委托模式</h3><br>&nbsp;<p></p>

<p>实现委托模式的类应该：<br><ul><br>    <li>拥有一个名为delegate<em>的成员变量来引用委托。</em></li><br>    <li>因此，访问器方法应该名为delegate和setDelegate:。</li><br>    <li>delegate对象不应该被retained。</li><br></ul><br>总结：委托对象不应该被retained。</p>

<p>&lt;p<br></p><h3><a name="model_view_controller"></a>模型-视图-控制器</h3><br>&nbsp;<br><ul><br>    <li>模型与视图分离：不要假设模型或者数据源的表示方法。保持数据源与表示层之间的接口抽象。视图不需要了解模型的逻辑（主要的规则是问问你自己，对于数据源的一个实例，有没有可能有多种不同状态的表示方法）。</li><br>    <li>控制器与模型、视图分离：不要把所有的“领域逻辑”放进跟视图有关的类中。这命名得代码非常难以重用。使用控制器来写这些代码，但保证控制器不需要了解太多表示层的逻辑。</li><br>    <li>使用@protocol来定义回调API，如果不是所有的方法都必须实现，使用@optional（例外：当使用Objective-C 1.0，@optional不可用，因此请使用类别来定义“非正式的协议”）。</li><br></ul><br>总结：分离模型与视图。分离控制器与视图、模型。回调API使用@protocol。<p></p>

<p>[转自]: <a href="http://www.iwangke.me/objc-style-guide/" target="_blank" rel="external">http://www.iwangke.me/objc-style-guide/</a></p>

<p></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/12/02/yuan-chuang-use-of-undeclared-identifier-uistatusbarstylelightcontent/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/02/yuan-chuang-use-of-undeclared-identifier-uistatusbarstylelightcontent/" itemprop="url">
                  [原创]Use of undeclared identifier 'UIStatusBarStyleLightContent'
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-02T00:00:00+08:00">
              2013-12-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/12/02/yuan-chuang-use-of-undeclared-identifier-uistatusbarstylelightcontent/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/12/02/yuan-chuang-use-of-undeclared-identifier-uistatusbarstylelightcontent/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>These are iOS 7 features that won’t compile in XCode 4.6.3 which is trying to compile against iOS 6. You need to conditionally compile them out.</p>

<p>Wrap the offending code with:<br><pre><code>#if __IPHONE_OS_VERSION_MAX_ALLOWED &gt;= 70000<br>    //iOS 7 only stuff here<br>#endif </code></pre></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/12/02/yuan-chuang-edgesforextendedlayout/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/02/yuan-chuang-edgesforextendedlayout/" itemprop="url">
                  [StackOverflow]edgesForExtendedLayout
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-12-02T00:00:00+08:00">
              2013-12-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/12/02/yuan-chuang-edgesforextendedlayout/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/12/02/yuan-chuang-edgesforextendedlayout/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Starting in iOS7, the view controllers use full-screen layout by default. At the same time, you have more control over how it lays out its views, and that’s done with those properties:</p>

<p><strong>edgesForExtendedLayout</strong></p>

<p>Basically, with this property you set which sides of your view can be extended to cover the whole screen. Imagine that you push a <code>UIViewController</code> into a <code>UINavigationController</code>, when the view of that view controller is laid out, it will start where the navigation bar ends, but this property will set which sides of the view (top, left, right, bottom) can be extended to fill the whole screen.</p>

<p>Let see it with an example:<br><pre><code>UIViewController <em>viewController = [[UIViewController alloc] init];<br>viewController.view.backgroundColor = [UIColor redColor];<br>UINavigationController </em>mainNavigationController = [[UINavigationController alloc] initWithRootViewController:viewController];</code></pre><br>Here you are not setting the value of edgesForExtendedLayout, therefore the default value is taken (UIRectEdgeAll), so the view extends its layout to fill the whole screen.</p>

<p>This is the result:</p>

<p><img alt="enter image description here" src="http://i.stack.imgur.com/MOB6v.png"></p>

<p>As you can see, the red background extends behind the navigation bar and the status bar.</p>

<p>Now, you are going to set that value to UIRectEdgeNone, so you are telling the view controller to not extend the view to cover the screen:<br><pre><code>UIViewController <em>viewController = [[UIViewController alloc] init];<br>viewController.view.backgroundColor = [UIColor redColor];<br>viewController.edgesForExtendedLayout = UIRectEdgeNone;<br>UINavigationController </em>mainNavigationController = [[UINavigationController alloc] initWithRootViewController:viewController];</code></pre><br>And the result:</p>

<p><img alt="enter image description here" src="http://i.stack.imgur.com/ojAvO.png"></p>

<p><strong>automaticallyAdjustsScrollViewInsets</strong></p>

<p>This property is used when your view is a <code>UIScrollView</code> or similar, like a <code>UITableView</code>. You want your table to start where the navigation bar ends, because you wont see the whole content if not, but at the same time you want your table to cover the whole screen when scrolling. In that case, setting edgesForExtendedLayout to None won’t work because your table will start scrolling where the navigation bar ends and it wont go behind it.</p>

<p>Here is where this property comes handy, if you let the view controller automatically adjust the insents (setting this property to YES, also the default value) it will add inset to the top of the table, so the table will start where the navigation bar ends, but the scroll will cover the whole screen.</p>

<p>This is when is set to NO:</p>

<p><img alt="enter image description here" src="http://i.stack.imgur.com/9Iapl.png"></p>

<p>And YES (by default):</p>

<p><img alt="enter image description here" src="http://i.stack.imgur.com/VVQHQ.png"></p>

<p>In both cases, the table scrolls behind the navigation bar, but in the second case (YES), it will start from below the navigation bar.</p>

<p><strong>extendedLayoutIncludesOpaqueBars</strong></p>

<p>This value is just an addition to the previous ones. If the status bar is opaque, the views won’t be extended to include the status bar too, unless this parameter is YES.</p>

<p>So, if you extend your view to cover the navigation bar (edgesForExtendedLayout to UIRectEdgeAll) and the parameter is NO (default) it wont covert the status bar if it’s opaque.</p>

<p>If something is not clear, write a comment and I’ll answer to it.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2013/11/26/zhuan-nsfilemanager/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/11/26/zhuan-nsfilemanager/" itemprop="url">
                  [转]NSFileManager
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2013-11-26T00:00:00+08:00">
              2013-11-26
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2013/11/26/zhuan-nsfilemanager/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2013/11/26/zhuan-nsfilemanager/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>NSFileManager</code> is Foundation’s high-level API for working with file systems. It abstracts Unix and Finder internals, providing a convenient way to create, read, move, copy, and delete files &amp; directories on local or networked drives, as well as iCloud ubiquitous containers.</p>

<p>File systems are a complex topic, with decades of history, vestigial complexities, and idiosyncrasies, and is well outside the scope of a single article. And since most applications don’t often interact with the file system much beyond simple file operations, one can get away with only knowing the basics.</p>

<p>What follows are some code samples for your copy-pasting pleasure. Use them as a foundation for understanding how to adjust parameters to your particular use case:<br></p><h2>Common Tasks</h2><br><blockquote>Throughout the code samples is the magical incantation<code>NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES)</code>. This may be tied with KVO as one of the worst APIs in Cocoa. Just know that this returns an array containing the user documents directory as the first object. Thank goodness for the inclusion of <code>NSArray -firstObject</code>.</blockquote><br><h3>Determining If A File Exists</h3><br><div><br><pre><code data-lang="objective-c">NSFileManager <em>fileManager = [NSFileManager defaultManager];<br>NSString </em>documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];<br>NSString <em>filePath = [documentsPath stringByAppendingPathComponent:@”file.txt”];<br>BOOL fileExists = [fileManager fileExistsAtPath:filePath];<br></em></code></pre><br></div><br><h3>Listing All Files In A Directory</h3><br><div><br><pre><code data-lang="objective-c">NSFileManager fileManager = [NSFileManager defaultManager];<br>NSURL <em>bundleURL = [[NSBundle mainBundle] bundleURL];<br>NSArray </em>contents = [fileManager contentsOfDirectoryAtURL:bundleURL<br>                               includingPropertiesForKeys:@[]<br>                                                  options:NSDirectoryEnumerationSkipsHiddenFiles<br>                                                    error:nil];</code></pre></div><p></p>

<p>NSPredicate <em>predicate = [NSPredicate predicateWithFormat:@”pathExtension ENDSWITH ‘.png’”];<br><br>for (NSString </em>path in [contents filteredArrayUsingPredicate:predicate]) {<br><br>    // Enumerate each .png file in directory<br><br>}<br><br><br></p><h2>Recursively Enumerating Files In A Directory</h2><br><div><br><pre><code data-lang="objective-c">NSFileManager <em>fileManager = [NSFileManager defaultManager];<br>NSURL </em>bundleURL = [[NSBundle mainBundle] bundleURL];<br>NSDirectoryEnumerator <em>enumerator = [fileManager enumeratorAtURL:bundleURL<br>                                      includingPropertiesForKeys:@[NSURLNameKey, NSURLIsDirectoryKey]<br>                                                         options:NSDirectoryEnumerationSkipsHiddenFiles<br>                                                    errorHandler:^BOOL(NSURL </em>url, NSError *error)<br>{<br>    NSLog(@”[Error] %@ (%@)”, error, url);<br>}];</code></pre></div><p></p>

<p>NSMutableArray <em>mutableFileURLs = [NSMutableArray array];<br><br>for (NSURL </em>fileURL in enumerator) {<br><br>    NSString *filename;<br><br>    [fileURL getResourceValue:&amp;filename forKey:NSURLNameKey error:nil];</p>

<p>    NSNumber *isDirectory;<br><br>    [fileURL getResourceValue:&amp;isDirectory forKey:NSURLIsDirectoryKey error:nil];</p>

<p>    // Skip directories with ‘<em>‘ prefix, for example<br><br>    if ([filename hasPrefix:@”</em>“] &amp;&amp; [isDirectory boolValue]) {<br><br>        [enumerator skipDescendants];<br><br>        continue;<br><br>    }</p>

<p>    if (![isDirectory boolValue]) {<br><br>        [mutableFileURLs addObject:fileURL];<br><br>    }<br><br>}<br><br><br></p><h3>Create a Directory</h3><br><div><br><pre><code data-lang="objective-c">NSFileManager <em>fileManager = [NSFileManager defaultManager];<br>NSString </em>documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];<br>NSString <em>imagesPath = [documentsPath stringByAppendingPathComponent:@”images”];<br>if (![fileManager fileExistsAtPath:imagesPath]) {<br>    [fileManager createDirectoryAtPath:imagesPath withIntermediateDirectories:NO attributes:nil error:nil];<br>}<br></em></code></pre><br></div><br><h3>Deleting a File</h3><br><div><br><pre><code data-lang="objective-c">NSFileManager fileManager = [NSFileManager defaultManager];<br>NSString <em>documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];<br>NSString </em>filePath = [documentsPath stringByAppendingPathComponent:@”image.png”];<br>NSError *error = nil;</code></pre></div><p></p>

<p>if (![fileManager removeItemAtPath:filePath error:&amp;error]) {<br><br>    NSLog(@”[Error] %@ (%@)”, error, filePath);<br><br>}<br><br><br></p><h3>Determine the Creation Date of a File</h3><br><div><br><pre><code data-lang="objective-c">NSFileManager <em>fileManager = [NSFileManager defaultManager];<br>NSString </em>documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];<br>NSString *filePath = [documentsPath stringByAppendingPathComponent:@”Document.pages”];</code></pre></div><p></p>

<p>NSDate <em>creationDate = nil;<br><br>if ([fileManager fileExistsAtPath:filePath]) {<br><br>    NSDictionary </em>attributes = [fileManager attributesOfItemAtPath:filePath error:nil];<br><br>    creationDate = attributes[NSFileCreationDate];<br><br>}<br><br><br>There are a number of file attributes that are made accessible through <code>NSFileManager</code>, which can be fetched with <code>-attributesOfItemAtPath:error:</code>, and other methods:<br></p><h4>File Attribute Keys</h4><br><blockquote><br><ul><br>    <li><code>NSFileAppendOnly</code>: The key in a file attribute dictionary whose value indicates whether the file is read-only.</li><br>    <li><code>NSFileBusy</code>: The key in a file attribute dictionary whose value indicates whether the file is busy.</li><br>    <li><code>NSFileCreationDate</code>: The key in a file attribute dictionary whose value indicates the file’s creation date.</li><br>    <li><code>NSFileOwnerAccountName</code>: The key in a file attribute dictionary whose value indicates the name of the file’s owner.</li><br>    <li><code>NSFileGroupOwnerAccountName</code>: The key in a file attribute dictionary whose value indicates the group name of the file’s owner.</li><br>    <li><code>NSFileDeviceIdentifier</code>: The key in a file attribute dictionary whose value indicates the identifier for the device on which the file resides.</li><br>    <li><code>NSFileExtensionHidden</code>: The key in a file attribute dictionary whose value indicates whether the file’s extension is hidden.</li><br>    <li><code>NSFileGroupOwnerAccountID</code>: The key in a file attribute dictionary whose value indicates the file’s group ID.</li><br>    <li><code>NSFileHFSCreatorCode</code>: The key in a file attribute dictionary whose value indicates the file’s HFS creator code.</li><br>    <li><code>NSFileHFSTypeCode</code>: The key in a file attribute dictionary whose value indicates the file’s HFS type code.</li><br>    <li><code>NSFileImmutable</code>: The key in a file attribute dictionary whose value indicates whether the file is mutable.</li><br>    <li><code>NSFileModificationDate</code>: The key in a file attribute dictionary whose value indicates the file’s last modified date.</li><br>    <li><code>NSFileOwnerAccountID</code>: The key in a file attribute dictionary whose value indicates the file’s owner’s account ID.</li><br>    <li><code>NSFilePosixPermissions</code>: The key in a file attribute dictionary whose value indicates the file’s Posix permissions.</li><br>    <li><code>NSFileReferenceCount</code>: The key in a file attribute dictionary whose value indicates the file’s reference count.</li><br>    <li><code>NSFileSize</code>: The key in a file attribute dictionary whose value indicates the file’s size in bytes.</li><br>    <li><code>NSFileSystemFileNumber</code>: The key in a file attribute dictionary whose value indicates the file’s filesystem file number.</li><br>    <li><code>NSFileType</code>: The key in a file attribute dictionary whose value indicates the file’s type.</li><br>    <li><code>NSDirectoryEnumerationSkipsSubdirectoryDescendants</code>: Perform a shallow enumeration; do not descend into directories.</li><br>    <li><code>NSDirectoryEnumerationSkipsPackageDescendants</code>: Do not descend into packages.</li><br>    <li><code>NSDirectoryEnumerationSkipsHiddenFiles</code>: Do not enumerate hidden files.</li><br></ul><br></blockquote><br><h2>NSFileManagerDelegate</h2><br><code>NSFileManager</code> may optionally set a delegate to verify that it should perform a particular file operation. This allows the business logic of, for instance, which files to protect from deletion, to be factored out of the controller.<p></p>

<p>There are four kinds of methods in the <code>&lt;NSFileManagerDelegate&gt;</code> protocol, each with a variation for working with paths, as well as methods for error handling.<br><ul><br>    <li><code>-fileManager:shouldMoveItemAtURL:toURL:</code></li><br>    <li><code>-fileManager:shouldCopyItemAtURL:toURL:</code></li><br>    <li><code>-fileManager:shouldRemoveItemAtURL:</code></li><br>    <li><code>-fileManager:shouldLinkItemAtURL:toURL:</code></li><br></ul><br>If you were wondering when you might <code>alloc init</code> your own <code>NSFileManager</code> rather than using the shared instance, this is it. As per the documentation:<br><blockquote>If you use a delegate to receive notifications about the status of move, copy, remove, and link operations, you should create a unique instance of the file manager object, assign your delegate to that object, and use that file manager to initiate your operations.</blockquote><br><div><br><pre><code data-lang="objective-c">NSFileManager *fileManager = [[NSFileManager alloc] init];<br>fileManager.delegate = delegate;</code></pre></div></p>

<p>NSURL <em>bundleURL = [[NSBundle mainBundle] bundleURL];<br><br>NSArray </em>contents = [fileManager contentsOfDirectoryAtURL:bundleURL<br><br>                               includingPropertiesForKeys:@[]<br><br>                                                  options:NSDirectoryEnumerationSkipsHiddenFiles<br><br>                                                    error:nil];</p>

<p>for (NSString *filePath in contents) {<br><br>    [fileManager removeItemAtPath:filePath error:nil];<br><br>}<br><br><br></p><h4>CustomFileManagerDelegate.m</h4><br><div><br><pre><code data-lang="objective-c">#pragma mark - NSFileManagerDelegate</code></pre></div><p></p>

<p>- (BOOL)fileManager:(NSFileManager <em>)fileManager<br><br>shouldRemoveItemAtURL:(NSURL </em>)URL<br><br>{<br>    return ![[[URL lastPathComponent] pathExtension] isEqualToString:@”pdf”];<br><br>}<br><br><br></p><h2>Ubiquitous Storage</h2><br>Documents can also be moved to iCloud. If you guessed that this would be anything but straight forward, you’d be 100% correct.<p></p>

<p>This is another occasion when you’d <code>alloc init</code> your own <code>NSFileManager</code> rather than using the shared instance. Because <code>URLForUbiquityContainerIdentifier:</code> and<code>setUbiquitous:itemAtURL:destinationURL:error:</code> are blocking calls, this entire operation needs to be dispatched to a background queue.<br></p><h3>Move Item to Ubiquitous Storage</h3><br><div><br><pre><code data-lang="objective-c">dispatch_async(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_BACKGROUND, 0), ^{<br>    NSFileManager <em>fileManager = [[NSFileManager alloc] init];<br>    NSString </em>documentsPath = [NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES) firstObject];<br>    NSURL *fileURL = [NSURL fileURLWithPath:[documentsPath stringByAppendingPathComponent:@”Document.pages”]];</code></pre></div><p></p>

<p>    // Defaults to first listed in entitlements when <code>nil</code>; should replace with real identifier<br><br>    NSString *identifier = nil;</p>

<p>    NSURL <em>ubiquitousContainerURL = [fileManager URLForUbiquityContainerIdentifier:identifier];<br><br>    NSURL </em>ubiquitousFileURL = [ubiquitousContainerURL URLByAppendingPathComponent:@”Document.pages”];</p>

<p>    NSError *error = nil;<br><br>    BOOL success = [fileManager setUbiquitous:YES<br><br>                                    itemAtURL:fileURL<br><br>                               destinationURL:ubiquitousFileURL<br><br>                                        error:&amp;error];<br><br>    if (!success) {<br><br>        NSLog(@”[Error] %@ (%@) (%@)”, error, fileURL, ubiquitousFileURL);<br><br>    }<br><br>});<br><br><br><blockquote>You can find more information about ubiquitous document storage in Apple’s “iCloud File Management” document.</blockquote><br>[转自]：<a href="http://nshipster.com/nsfilemanager/" target="_blank" rel="external">http://nshipster.com/nsfilemanager/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar/avatar.jpg"
               alt="姜楠" />
          <p class="site-author-name" itemprop="name">姜楠</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">115</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/njiang1987" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">姜楠</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"njiang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
