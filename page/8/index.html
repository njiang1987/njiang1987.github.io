<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="天空の城">
<meta property="og:url" content="http://www.njiang.cn/page/8/index.html">
<meta property="og:site_name" content="天空の城">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天空の城">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.njiang.cn/page/8/"/>





  <title> 天空の城 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-43682645-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">天空の城</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">愤怒的程序员，梦想着有一天也能飞！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/20/zhuan-zai-ios-shang-shi-yong-zi-qian-ming-de-ssl-zheng-shu/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/20/zhuan-zai-ios-shang-shi-yong-zi-qian-ming-de-ssl-zheng-shu/" itemprop="url">
                  [转]在iOS上使用自签名的SSL证书
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-20T00:00:00+08:00">
              2014-03-20
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/20/zhuan-zai-ios-shang-shi-yong-zi-qian-ming-de-ssl-zheng-shu/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/20/zhuan-zai-ios-shang-shi-yong-zi-qian-ming-de-ssl-zheng-shu/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[转]<a href="http://beyondvincent.com/blog/2014/03/17/five-tips-for-using-self-signed-ssl-certificates-with-ios/" target="_blank" rel="external">http://beyondvincent.com/blog/2014/03/17/five-tips-for-using-self-signed-ssl-certificates-with-ios/</a></p>

<p>上周苹果release了iOS 7.1，用户升级至此版本，去下载企业级应用时，如果应用不是用https部署的，那么会提示服务器上的证书无效，如下图所示：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/11.PNG" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/11.PNG"></a></p>

<p>小引:</p>

<p>在iOS 7.1中需要将plists文件的url路径设置为https才能下载安装，如果之前是用http部署的，这就需要对服务器做一些修改。网上流传着(<a href="http://stackoverflow.com/questions/20276907/enterprise-app-deployment-doesnt-work-on-ios-7-1/22325916#22325916" target="_blank" rel="external">Enterprise app deployment doesn’t work on iOS 7.1</a>)把plist放到公开的具有https功能的文件服务器上即可(dropbox或SkyDrive)，经试验，都是可行的。不过如要企业内部的网络无法访问外网，这又如何是好呢？网上也流传需要受信任的证书才行，这样一来对于某些企业的内部部署就比较麻烦了(局域网、主机名变动等都会引起很麻烦的事情)，各区域可能还要用不同的证书(对应不同的host name)。</p>

<p>经查苹果的相关文档(2014年2月份)，是可以使用http或者https的，后来打电话咨询苹果技术支持人员，告知文档还没来得及更新，不过自签名的证书也可以使用，最好首先要把证书(最好是CA根证书)通过mail或者配置工具安装到iOS设备上，然后根据这个CA构建web 服务器上用到的证书，这样当iOS设备访问web服务器来安装app时，就可以正常进行了。这样的话，我们只需要根据不同的服务器制作对应的自签名证书即可，有问题也方便修改跟进。</p>

<p>下面这篇文章就是介绍如何在iOS上面使用自签名的SSL证书。</p>

<p>先来看看目录：<br><ol><br>    <li>在iPhone或者iPad上的Safari中不要接受自签名证书</li><br>    <li>像安装iOS的Configuration Profile一样安装自签名证书</li><br>    <li>不要用IIS创建自签名证书</li><br>    <li>利用OpenSSL创建自签名证书</li><br>    <li>创建自己的证书颁发机构(CA)</li><br></ol><br>虽说SSL证书的购买价格不是太贵，不过有时候我们自行创建的话要更加方便一些，例如我们需要在开发环境配置SSL时、我们的测试服务器有不同的主机名或者开发的系统只有本地局域网才能访问。</p>

<p>实际上我们可以免费的创建<a href="http://en.wikipedia.org/wiki/Self-signed_certificate" target="_blank" rel="external">自签名SSL证书</a>，并不需要给证书颁发机构(CA)支付任何费用，也不需要遵守任何审计要求。</p>

<p>使用自签名SSL证书的缺点就是浏览器不会自动的信任相关的站点。如果用iPhone或者iPad上的Safari打开相关站点，会看到如下提示界面：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/01.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/01.png"></a></p>

<p>这里的HttpWatch iOS app还会有更详细的提示内容：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/02.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/02.png"></a></p>

<p>本文剩余内容将介绍如何对iOS做配置，以避免上面遇到的问题，以及如何方便的创建和管理自签名证书。<br></p><h2>在iPhone或者iPad上的Safari中不要接受自签名证书</h2><br>当在Safari中第一次访问自签名证书的站点时，会有如下提示(Continue或Details-&gt;Accept)：<p></p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/03.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/03.png"></a></p>

<p>如果你照着选择的话，是可以在Safari中打开站点的，不过这样会有两个明显的缺点：<br><ol><br>    <li>在Safari中接受证书只会添加一个<code>SSL例外</code>：防止Safari对此站点做出的警告提示。实际上并不会将证书安装到iOS中，以成为可信任的证书。同台设备的其它程序在连接该站点时仍然会失败。</li><br>    <li>一旦将<code>SSL例外</code>添加到iOS 7中了，就无法从iOS 7中移除。在之前的版本还可以通过Settings-&gt;Safari，选中”Clear Cookies and Data”进行删除。在iOS 7中这好像没有效果。———除非<code>General &gt; Reset &gt; Reset Settings</code>。</li><br></ol><br>当然，苹果官方也提供了一个工具<a href="http://support.apple.com/downloads/#iphone%20configuration%20utility" target="_blank" rel="external">iPhone configuration utility for Mac and PC</a>，通过该工具可以把证书安装至设备中。如果邮件不可用，或者要批量安装的话，这是一个好方法。<br></p><h2>像安装iOS的Configuration Profile一样安装自签名证书</h2><br>要想把SSL证书在iOS设备上安装为可信任的，可以通过发邮件到设备上，并将证书以附件的形式带在邮件中：<p></p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/04.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/04.png"></a></p>

<p>选择邮件中的附件，以将证书安装至iOS设备中。选择附件之后，选择<code>Install</code>来安装证书。完成安装之后，再在Safari或者其它iOS应用中使用该证书时，就不会有相关提醒了。</p>

<p>并且这与Safari添加的<code>SSL例外</code>有一个很大的区别，你可以在任意时刻通过<code>Settings-&gt;General-&gt;Profiles</code>来查看相关证书，如果有必要的话，还可以将其移除：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/05.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/05.png"></a></p>

<p>当然，苹果也提供了一个工具<a href="http://support.apple.com/downloads/#iphone%20configuration%20utility" target="_blank" rel="external">iPhone configuration utility for Mac and PC</a>，通过该工具可以把证书安装到设备中，如果邮件不可用，或者要批量安装证书的话，可以用这个工具。<br></p><h2>不要用IIS创建自签名证书</h2><br>在IIS中创建自签名证书非常的简单。只需要选择菜单中的<code>Create Self-Signed Certificate</code>即可：<p></p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/06.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/06.png"></a></p>

<p>不过IIS简单的使用计算机名称当做证书的主机名：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/07.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/07.png"></a></p>

<p>大多数时候，计算机名称与主机名是不匹配的，这样的话自签名的证书永远都不会受信任——即使已经安装至iOS设备中：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/08.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/08.png"></a></p>

<p>要修复这个问题可以安装并运行IIS 6 Toolkit中的SelfSSL。不过，要是使用OpenSSL则非常简单，下面我们就来看看吧。<br></p><h2>利用OpenSSL创建自签名证书</h2><br>创建自签名证书最简单的一种方法就是使用<a href="http://www.openssl.org/related/binaries.html" target="_blank" rel="external">OpenSSL命令行工具</a>，这个工具在许多平台上面都可以使用，并且在Mac OSX上面是默认安装好了的。<p></p>

<p>首先，创建一个私钥文件：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1</pre><br></td><br><td><br><pre><code>openssl genrsa -out myselfsigned.key 2048</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>然后创建自签名证书：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1<br>2</pre><br></td><br><td><br><pre><code>openssl req -new -x509 -key myselfsigned.key -out myselfsigned.cer -days 365<br>-subj /CN=www.mysite.com</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>上面的命令中，关于私钥和证书(cer)的文件名可以是任意的。其中<code>CN</code>参数需要设置为主机名(例如<a href="https://www.mysite.com/" target="_blank" rel="external">https://www.mysite.com</a>)。而<code>days</code>参数则指定证书从创建开始的有效天数。</p>

<p>在Apache服务器上面可以直接使用私钥和证书文件(做相关的SSL配置即可)。在IIS中需要一个PFX文件，通过该文件，可以将证书导入至IIS的Server Certificates中。当然通过OpenSSL可以创建PFX文件：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1<br>2</pre><br></td><br><td><br><pre><code>openssl pkcs12 -export -out myselfsigned.pfx -inkey myselfsigned.key<br>-in myselfsigned.cer</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure><br></p><h2>创建自己的证书颁发机构(CA)</h2><br>使用自签名证书会有这样的问题：需要为每台设备中用到的每个证书设置相关的信任关系。有一个解决办法就是创建自己的证书颁发机构(CA)根证书，然后基于该根证书创建别的证书。<p></p>

<p>这样一来就是自己扮演着CA，取代了商业性质的CA。这样做的好处就是自己的CA证书只需要在每台设备上安装一次即可。之后，设备会自动的信任基于CA根证书创建的证书。</p>

<p>创建CA证书只需要两个步骤即可，首先是创建私钥文件(跟之前的一样)：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1</pre><br></td><br><td><br><pre><code>openssl genrsa -out myCA.key 2048</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>然后是创建证书：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1<br>2</pre><br></td><br><td><br><pre><code>openssl req -x509 -new -key myCA.key -out myCA.cer -days 730<br>-subj /CN=”My Custom CA”</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>上面创建的证书(myCA.key)可以公开发布出去，并安装在iOS或者其它OS上，以此当做内置的受信任根CA。自制的CA证书存储在<code>General-&gt;Settings-&gt;Profile</code>：</p>

<p><a title="" href="http://beyondvincent.com/images/2014/03/10.png" rel="external" target="_blank"><img alt="" src="http://beyondvincent.com/images/2014/03/10.png"></a></p>

<p>其中私钥文件(myCA.key)只用是再创建新的SSL证书时使用。</p>

<p>上面的CA创建好之后，我们可以基于该证书创建许多证书。注意，这里多了一个步骤：必须创建一个CSR(客户端证书请求文件)——就像购买商业的SSL证书一样。</p>

<p>首先需要创建一个私钥文件：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1</pre><br></td><br><td><br><pre><code>openssl genrsa -out mycert1.key 2048</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>然后是创建CSR:</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1</pre><br></td><br><td><br><pre><code>openssl req -new -out mycert1.req -key mycert1.key -subj /CN=www2.mysite.com</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>接着用这个CSR创建证书：</p>

<p><figure><br><div><br><table><br><tbody><br><tr><br><td><br><pre>1<br>2</pre><br></td><br><td><br><pre><code>openssl x509 -req -in mycert1.req -out mycert1.cer -CAkey myCA.key<br>-CA myCA.cer -days 365 -CAcreateserial -CAserial serial</code></pre><br></td><br></tr><br></tbody><br></table><br></div><br></figure>这里创建的证书(mycert.cer)可以安装在一台web服务器上，并且已经安装了相关CA证书的iOS设备都可以访问该web服务器。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/20/iis7-download-cer-file/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/20/iis7-download-cer-file/" itemprop="url">
                  IIS7 download cer file
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-20T00:00:00+08:00">
              2014-03-20
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/20/iis7-download-cer-file/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/20/iis7-download-cer-file/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>To add a file type CER IIS7 and allow it to download, you have to make these changes:<br><ol><br>    <li>Add MIME type: .cer - application/x-x509-ca-cert</li><br>    <li>Remove Handler Mappings: SecurityCertificate *.cer</li><br></ol></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/19/zhuan-zhao-gong-zuo-de-yi-xie-gan-wu-qian-duan-xiao-cai-de-cheng-zhang/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/19/zhuan-zhao-gong-zuo-de-yi-xie-gan-wu-qian-duan-xiao-cai-de-cheng-zhang/" itemprop="url">
                  [转]找工作的一些感悟——前端小菜的成长
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-19T00:00:00+08:00">
              2014-03-19
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/生活/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/19/zhuan-zhao-gong-zuo-de-yi-xie-gan-wu-qian-duan-xiao-cai-de-cheng-zhang/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/19/zhuan-zhao-gong-zuo-de-yi-xie-gan-wu-qian-duan-xiao-cai-de-cheng-zhang/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[转]：<a href="http://www.cnblogs.com/dolphinX/p/3510346.html" target="_blank" rel="external">http://www.cnblogs.com/dolphinX/p/3510346.html</a></p>

<p>前些日子辞掉了工作，比较轻松，有大把的时间写博客神马的，陆续面了几个不错的互联网公司，有成功的也有失败的，阿里的面试及offer都来的很意外，还没来得及投百度，由于阿里给的条件及工作内容都让我很满意了，唯一的遗憾是得离开北京去杭州，不知道现在还要不要投投其他的也试试。</p>

<p>至于为什么选在年前离职，其实这并不在我的计划内，从毕业起就在这个很小的公司工作，只有六、七个开发人员，但是感觉自己学到了很多东西，工作内容也很有创造性，但最近半年来对老板给公司制定的方向感觉不是很认同，还有非常多的因素就不多说了，让我工作效率很低，有时候带着抵触情绪工作，这样做出来的东西可想而知。继续做下去只能是耗着，耗到年终拿个年终奖然后年后辞职？自己不能接受，所以在网上投了些简历，向公司提了离职。<br></p><h3><strong>写在前面</strong></h3><br>本文虽然是在说面试感受，但不含面试题，以后会多少总结一些面试的知识点，但希望从本文中看到面试题神马的可以Ctrl+W了。然后虽然找到了自己满意的工作，但本人并不是成功人士，也不是技术大牛，但凡读过我两篇博客的人都可以看出来，我只是前端小菜一枚，自然不会高屋建瓴、口吐莲花，文中说的只是一些自己工作不到三年来经过面试洗礼后的一些认识与感受，和大家见解不同还望多多指教。<br><h3><strong>自己没有想象的那么好</strong></h3><br>扯淡的东西完了，说一些找工作的感受。开始找工作对我最大的冲击就是人家问的东西太多自己没接触过的。大家都说技术人员到一个公司两到三年是一个瓶颈期，工作内容、使用的技术已经轻车熟路，不在有学习的压力，习惯了舒适，我来公司不到三年，面试过程中越来越多的意识到这个问题。之前因为能够很快完成工作内容，出了bug也能很快解决，对自己的技术很自信，随着不断的面试越来越没有自信，因为开始是别人问的东西自己一知半解，然后是闻所未闻。<p></p>

<p>可能也是由于面试的都是一些相对不错的公司，对技术的要求比较高，但自己认真反思了一下，觉得有几个问题，发现很多初级的<a title="程序员的本质" href="http://blog.jobbole.com/821/" target="_blank">程序员</a>也都有这些问题<br></p><h3><strong>对工作用不到的技术漠不关心</strong></h3><br>我开始的时候觉得自己是对技术很有兴趣的人，总会逛一些技术博客、网上回答一些技术问题、给公司新人进行技术培训，现在回头看看自己总是在自己的舒适区，都是围绕着目前工作的技术转圈，对一些工作用不到的技术进去看两眼就出来了，不会耐下性子去学习。<p></p>

<p>很多时候我们会发现自己的技术面很窄，实际上我们有的只是一些孤立的知识点，没有形成面，很多问题的解决方案使用的技术我们看了后会懂，但是自己却想不出来，我觉得这是因为知识的不连贯导致的，如果读博客的同学也意识到了自己有此类问题，建议平时在逛论坛、博客的时候关注一下自己不熟悉的相关知识，会有很大收获。<br></p><h3><strong>三天打鱼两天晒网</strong></h3><br>这个和上面的恰恰相反，但也是有害的，很多同学技术方面兴趣很广泛，对数据库、<a title="1" href="http://www.amazon.cn/gp/product/B001130JN8/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;camp=536&amp;creative=3200&amp;creativeASIN=B001130JN8" target="_blank" rel="nofollow">设计模式</a>、前端等等都有研究，者没什么问题，是好事儿，我工作一年的时候还在立志做架构师，天天读面向对象和设计模式等方面的书，后来觉得算法和数据结构很重要又买了很多书去学习，然后感觉<a title="8种Nosql数据库系统对比" href="http://blog.jobbole.com/1344/" target="_blank">NoSQL</a>很流行，又在网上搜了很多相关的博客作为书签保存了下来，之后又看到了Memcache、Redis、Hadoop。。。<p></p>

<p>到最后除了工作一直在用的技术，这些我都没有学会。相信有很多我这样的同学，会经常关注<a title="如何选择语言和编程语言排名相关文章" href="http://blog.jobbole.com/tag/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" target="_blank" rel="external">编程语言</a>排行榜、十大热门技术。。。，然后上网搜相关博客，买书立志要学习这些人们技术，然后就跳到大公司甚至BAT、工资翻倍神马的。在网上看到一些大牛的博客惊羡一番后，存到自己的书签后者粘到自己的笔记中，告诫自己一定要学习这些知识。或者在网上下了几百G的教学视频、电子书。。。半年后发现那些都变成了封存，除了激励了我们三分钟的学习热情，给我们个心里安慰，什么作用都没有。</p>

<p>我所说的三天打鱼，两天晒网，并不是指我们学习了两天就去玩儿了，而是指我们在学习过程中没有恒心把一项知识搞明白就去看另外的知识去了，对技术都是浅尝辄止，最后导致什么都没学好。面试的时候问到相关知识，觉得自己研究过，但回答的千疮百孔。在学习新知识的时候我们需要量力而为，把一个兴趣经过一定时间的学习、研究转化为自己的知识后再去转向下一个兴趣，，甚至做到学而时习之，这样才可以年年有鱼，年年有余。</p>

<p>其实我们在浏览一些技术博客、论坛的时候可以做个简单的check list，把感兴趣知识记下来，每周或每月看看自己的check list，看看自己进展到哪项了，循序渐进一步步来。<br></p><h3><strong>试图一蹴而就，而后高枕无忧</strong></h3><br>曾经有那么一个阶段我每天学习Linux及Linux C编程，主要是看了某份调查报告搞这个很挣钱，自己要是学会了立马能变高大上、直接空降到BAT，买了一些书一目十行看完，觉得看完后就对Linux有深入认识了，结果可想而知，如今仍然是对Linux一知半解，Linux C编程只能呵呵了。<p></p>

<p>不少同学也会有这毛病，认准一个目标不错，Linux C编程确实很重要也很挣钱，但是首先这个目标适不适合自己，如果自己并不感兴趣，也没有相应的努力在里面，只是奔着挣大钱那么学习的效率应该不会很高，至少不会主动去接受很多相关知识。</p>

<p>然后目标适合自己后很多同学都会有一种急躁情绪，试图一蹴而就，看书一目十行，看视频用1.8倍速率，觉得看完某些书、写出某个例子等就会掌握XXX了，这样的结果就是只是都是零散而模糊的，当工作需要或者别人问起的时候，似懂非懂、做不出正确决定。</p>

<p>作为技术人员，要熟知的一点儿是计算机领域技术日新月异，不可能学会某项技术以后就能轻松躺着领钱了，我们不如静下心来，把知识钻研明白，给自己做个坚实的基础，有新知识来临的时候我们也可以应对自如了<br></p><h3><strong>自卑</strong></h3><br>最近和很多同学同事聊天发现在技术人员身上有个隐藏很深的问题——自卑！没错，就是自卑。这里的自卑并不是指衣着不光鲜，觉得不好意思哪种。有些做的不错的同学偶尔都会流露出自己学校不怎么出名，再怎么努力也不会有很多进入国际知名企业的机会，我有个很好的朋友对设计很感兴趣，学过美术，也很有品味，当我们聊职业规划时说既然对工业设计感兴趣可以去奔驰、苹果去试试嘛，当然有开玩笑的意思，让我始料不及的是他第一时间的反应是这怎么可能，而不是说人家需要什么条件他达不到。<p></p>

<p>在很多刚入行的技术人员身上我们都可以看到这样自卑的影子，在未经了解的情况下就否定了自己，觉得自己不可能做到某事，自然也不会有这方面针对性的努力，想都不会去想，能做到的希望就更小了。一年前有次冲动想离职，让朋友帮我推荐职位，朋友问我希望什么样的工作，我说工资到XXX就行，朋友说可以去百度试试，我心里第一反应就是，这怎么可能，我就一普通本科生，人家多少985研究生都进不去，我怎么可能。</p>

<p>事后我看了一下百度对前端的要求，并没有我想象的那样离谱的高，自己平时也就搜集了一些互联网公司对前端的要求，针对性的学习了一些，感觉进步比较大（这也在一定程度上造成了文章开头是说的过分自信）。</p>

<p>其实很多时候看起来遥不可及的目标并没有那么远，很多次我们都是被自己的幻想和恐惧吓住了，甚至连第一步都没有敢迈出去<br></p><h3><strong>怎么成长</strong></h3><br>说了这么多问题，让我回首，如果有一次<a title="重来" href="http://www.amazon.cn/gp/product/B0048EKQS0/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0048EKQS0" target="_blank" rel="nofollow">重来</a>的机会的话我会这样过<p></p>

<p>对自己有清晰的定位，当然这得在一定尝试之后才可以，并不是所有刚毕业的人就对自己的技术、职业有着清晰的了解，但工作两年后应该对自己有一个定位了<br><ul><br>    <li>是否对从事技术感兴趣</li><br>    <li>喜欢什么工作</li><br>    <li>讨厌什么工作</li><br></ul><br>最近几个月不愉快的工作经历让我更深知，要做自己认同、觉得有追求意义的工作，这样才能最大程度激发个人的创造力，如果工作了两年还不明白自己喜欢什么，除了工资追求什么的同学需要好好想想了</p>

<p>对自己有清晰的定位以后就可以尝试一些有挑战的事情了，无论是在公司工作还是想跳槽试试其他机会，给自己定一个目标并为之努力，千万不要今天觉得hadoop工资高去学hadoop，明天觉得nodejs流行又去学nodejs，太过贪婪有时候反而让我们一无所获。</p>

<p>相信做到了上面两点的同学每年肯定都会有很大收获，啰嗦了这么多感觉都是虚的，说一下自己从小白到小菜的过程（好有成就感。。。）<br></p><h3><strong>我的炼狱</strong></h3><br>有些人大学一路学霸，有些人成了游戏高手，我则平平凡凡过了四年，除了斗地主和CS没玩过其它游戏几乎，没挂过科也没拿过一等奖学金，对编程也是一知半解，没打工赚过钱，毕业前没有任何项目经验，没做过任何作业外的程序设计。把大部分时间都泡在图书馆看历史书，360度无死角平常人一个，现在看有些在校生的博客都汗颜，自己上学那时就知道在CSDN上下载源代码，除了课本上的知识没主动学习过任何东西，应付考试就行。<p></p>

<p>工作后突然感觉好多东西不会，开始看一些业界推荐的好书，一年后开始在CSDN上回答问题，答了半年在博客园上写博客，中间的各种经历上面也提到过，学了很多乱七八糟的东西，最近一年找到了自己的兴趣所在——前端，看了《<a title="JavaScript高级程序设计" href="http://www.amazon.cn/mn/detailApp/ref=as_li_qf_sp_asin_tl?_encoding=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;asin=B003V42XZW&amp;camp=536&amp;creative=3200&amp;creativeASIN=B003V42XZW" target="_blank" rel="nofollow">JavaScript高级程序设计</a>》、《<a title="CSS权威指南" href="http://www.amazon.cn/gp/product/B0011F5SIC/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0011F5SIC" target="_blank" rel="nofollow">CSS权威指南</a>》，还有博客园上很多前端大牛的博客成长了很多。</p>

<p>每个人都有自己的学习方式，研究流行库函数的源码、分析淘宝等网站的源码、读好书等等，我这里只写一些认为对自己帮助比较大的方式（仅仅是前端学习）</p>

<p><strong>1.读好书</strong></p>

<p>尤其对于初入门的同学读好书尤为重要，开始学习前端的时候我下载了很多JavaScript经典代码100段等类似的东西，也试图做出一些精美的网页，但抄人家的代码确实能够出来效果，自己却不知道为什么可以，而且稍微想改动一下就束手无策，代码出了一些小问题也让人感觉莫名其妙，只能瞎改一通。</p>

<p>这是因为我们还没有建立知识基础，有很多原理性的东西不明白，对于前端入门学习，个人觉得有几本好书和资源值得推荐<br><ul><br>    <li><a href="http://w3schools.com/" target="_blank" rel="external">http://w3schools.com/</a> 这个网站就不多说了，web学习基本的东西都可以找到</li><br>    <li>《JavaScript高级程序设计》 在javaScript经典书籍中这本和犀牛书《<a title="JavaScript权威指南" href="http://www.amazon.cn/mn/detailApp/ref=as_li_qf_sp_asin_tl?_encoding=UTF8&amp;tag=vastwork-23&amp;linkCode=as2&amp;asin=B0012UMVYA&amp;camp=536&amp;creative=3200&amp;creativeASIN=B0012UMVYA" target="_blank" rel="nofollow">JavaScript权威指南</a>》尤为耀眼，但我觉得前者更适合初学者，因为它是按照教程的方式由浅入深，一步步教人学会JavaScript，有一定基础了可以看看后者，使自己JavaScript方面知识更全面</li><br>    <li>《<a title="JavaScript语言精粹" href="http://click.union.360buy.com/JdClick/?unionId=16231&amp;to=http://book.360buy.com/10067180.html" target="_blank" rel="nofollow">JavaScript语言精粹</a>》 虽然里面每章都引用一些几乎和内容无关的莎士比亚的戏剧让人觉得这是卖弄，但这本书确实值得人一看，对改善自己的代码，更加深入理解JavaScript语言特性有很大帮助</li><br>    <li>《CSS权威指南》 这本书不是在告诉你每个CSS属性，而是简单却又深入的阐述的CSS一些原理性知识</li><br>    <li>园子里汤姆大叔的 <a id="ctl01_lnkTitle" href="http://www.cnblogs.com/TomXu/archive/2011/12/15/2288411.html" target="_blank">深入理解JavaScript系列</a> 虽然这不是JavaScript入门的作品，但是非常值得一看</li><br>    <li>张鑫旭的<a href="http://www.zhangxinxu.com/wordpress/" target="_blank">个人博客</a> 这哥们知识渊博，很多问题都讲的非常深入，而且文风很幽默，相信看了会有很大收获</li><br></ul><br><strong> 2.自己动手写博客</strong></p>

<p>没有诋毁回答问题的意思，毕竟StackOverflow都那么强大了，但是对于小白和小菜而言个人觉得写博客是个很不错的提高方式，很多知识看一遍觉得自己明白了，和自己能够应用知识实现某个功能之间有很大差距，实现功能到写出博客说明白某个技术的前世今生又是很大一个进步。</p>

<p>建议大家都自己写写博客，梳理一下自己知识，有时候我们希望写一个技术点，但发现我们还需要很多相关知识才能说明白，就会去了解这些知识，我们写的是一个点，收获的是一条线甚至一个面。在写作过程中会得到大家的鼓励、批评、意见，这些都是让人进步的动力，而且把自己学到的知识分享出来可能会帮到很多人，何乐而不为呢。</p>

<p><strong>3.临渊羡鱼不如退而<a title="结网：互联网产品经理改变世界" href="http://www.amazon.cn/gp/product/B004GTOHKA/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=536&amp;creative=3200&amp;creativeASIN=B004GTOHKA&amp;linkCode=as2&amp;tag=vastwork-23" target="_blank" rel="nofollow">结网</a></strong></p>

<p>不知道大家有没有这样的感觉在网上看到一些技术大神的履历后觉得人家是天才，心里还能安慰过去，看到园子中很多在校生对知识都理解的那么深入，汗颜不已觉得自己还不如人家没工作的，觉得自己学晚了，要是大学的时候多努力，现在就多牛逼了，等等直接打击的没有了学习的动力。或者是看到同学的工资几乎是自己两倍心里论着急，觉得时运不济，没给自己个好机遇，就这样沉落下去。</p>

<p>我有一段时间是这样度过的，现在看看自己那段日子虽然无数次立志要抓紧学习了，可是急躁，没有静下心学习任何东西，技术上的进步反而不如天天陪我女朋友广北京免费公园的日子。我们把太多精力用在了和别人比来比去，心急气躁打乱了自己持续的学习节奏，这样反而是有害的。心里平复后看看自己上个月写的博客，觉得自己学习了这么多知识一个月，也算是很大的进步了，临渊羡鱼不如退而结网，自己踏踏实实，一步一个脚印做到比昨天的自己更优秀就可以了。<br></p><h3><strong>最后</strong></h3><br>啰嗦了这么多缺陷和自己的想法，不知道是不是对同样处于小白到小菜挣扎的同学们有帮助，再回到最开始说一下自己的面试经历。决定要走了就在网上投了一些简历，因为大家都盛年后是公司招人的高峰期，所以自己想年前试几个并不是非常了解的公司，不行的话就当练练手，总结经验全力准备年后投百度，没想到起初的面试虽然给自己了些打击，但从反馈上来看还算不错。于是投了一些大公司的简历，那天在博客园的右上角看到一些招聘信息，进去后发现是个专门做互联网招聘的网站，感觉还不错（防止广告嫌疑，不说名字了，其实这个招聘网站也在招人，我还去试了，因为公司离得比较近，约好下班后过去，结果人家忘了这回事儿，去的时候面试官下班走人了），在上面看到阿里巴巴的招聘信息，看了一下觉得要求并不是很高，就投了，当时并没有抱多大希望，没想到一天后阿里就给了联系安排了两轮<a title="Google的面试题，电话面试和招聘流程介绍" href="http://forum.jobbole.com/showthread.php/3620" target="_blank">电话面试</a>、两轮HR面试，都是电话进行的，然后就通知说过了，体检完就给发offer了，回想起来好不真实，但也在面试过程中学习到了很多。<p></p>

<p>前前后后面试了不少，但给感觉值得总结的不多，大概有老罗的锤子科技、网易、京东和阿里，以后有时间总结出来和大家分享一下。说了这么多做个总结：</p>

<p>梦想太遥远很多时候都是我们被吓倒了，没有尝试迈出第一步，也有时候是因为我们没有足够的耐心一步步走完，总是想快跑到彼岸，却在迷失了方向。个人能给和我一样同处小白或小菜阶段的程序员的建议就是，对自己有定位找到合适目标后，为目标持之以恒的努力，不被其它诱惑干扰。</p>

<p>在前进的路上与君共勉！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/07/git-ignore-file-git增加忽略文件/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/07/git-ignore-file-git增加忽略文件/" itemprop="url">
                  git ignore file, Git增加忽略文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-07T00:00:00+08:00">
              2014-03-07
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/07/git-ignore-file-git增加忽略文件/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/07/git-ignore-file-git增加忽略文件/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><h1><span style="font-size: 16px; font-weight: 400; line-height: 1.5;">最简单的方法在项目根目录与.git目录同一位置创建一个文件: .gitignore</span></h1><br><div><br><div id="cnblogs_post_body"></div><p></p>

<p>touch .gitignore<br><br>vi .gitignore<br><br>:wq</p>

<p>注:如果要忽略的文件已被git管理,需要先移除,命令如下:</p>

<p>e.g.:<br><br>git rm -r –cached  WebRoot/WEB-INF/classes/<em>*/</em><br><br>-r:递归<br><br>git commit</p>

<p>然后.gitignore中的忽略,起作用以下参考//——————-</p>

<p>from:</p>

<p><a href="http://gitready.com/beginner/2009/01/19/ignoring-files.html" target="_blank" rel="external">http://gitready.com/beginner/2009/01/19/ignoring-files.html</a></p>

<p>The easiest and simplest way is to create a <code>.gitignore</code> file in your project’s root directory. The files you choose to ignore here take affect for all directories in your project, unless if they include their own <code>.gitignore</code> file. This is nice since you have one place to configure ignores unlike SVN’s svn:ignore which must be set on every folder. Also, the file itself can be versioned, which is definitely good.</p>

<p>Here’s a basic <code>.gitignore</code>:<br><pre>$ cat .gitignore</pre></p>

<p># Can ignore specific files<br><br>.DS_Store</p>

<p># Use wildcards as well<br><br><em>~<br>
</em>.swp</p>

<p># Can also ignore all directories and files in a directory.<br><br>tmp/<em>*/</em><br>Of course, this could get a lot more complex. You can also add exceptions to ignore rules by starting the line with <code>!</code>. See an example of this at the <a href="http://github.com/guides/ignore-for-git" target="_blank" rel="external">GitHub guide on ignores</a>.</p>

<p>Two things to keep in mind with ignoring files: First, if a file is already being tracked by Git, adding the file to <code>.gitignore</code> won’t stop Git from tracking it. You’ll need to do <code>git rm –cached &lt;file&gt;</code> to keep the file in your tree and then ignore it. Secondly, empty directories do not get tracked by Git. If you want them to be tracked, they need to have something in them. Usually doing a <code>touch .gitignore</code> is enough to keep the folder tracked.</p>

<p>You can also open up <code>$GIT_DIR/info/exclude</code> (<code>$GIT_DIR</code> is usually your <code>.git</code> folder) and edit that file for project-only ignores. The problem with this is that those changes aren’t checked in, so use this only if you have some personal files that don’t need to be shared with others on the same project.</p>

<p>Your final option with ignoring folders is adding a per-user ignore by setting up a<code>core.excludesfiles</code> option in your config file. You can set up a <code>.gitignore</code> file in yourHOME directory that will affect all of your repositories by running this command:</p>

<p><code>git config –global core.excludesfile ~/.gitignore</code></p>

<p>Read up on the <a href="http://www.kernel.org/pub/software/scm/git/docs/gitignore.html" target="_blank" rel="external">manpage</a> if you’d like to learn more about how ignores work. As always, if you have other ignore-related tips let us know in the comments.</p>

<p><br></p>
</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/07/git-ignore-file-git-zeng-jia-hu-lve-wen-jian/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/07/git-ignore-file-git-zeng-jia-hu-lve-wen-jian/" itemprop="url">
                  git ignore file, Git增加忽略文件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-07T00:00:00+08:00">
              2014-03-07
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/07/git-ignore-file-git-zeng-jia-hu-lve-wen-jian/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/07/git-ignore-file-git-zeng-jia-hu-lve-wen-jian/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p></p><h1><span style="font-size: 16px; font-weight: 400; line-height: 1.5;">最简单的方法在项目根目录与.git目录同一位置创建一个文件: .gitignore</span></h1><br><div><br><div id="cnblogs_post_body"></div><p></p>

<p>touch .gitignore<br><br>vi .gitignore<br><br>:wq</p>

<p>注:如果要忽略的文件已被git管理,需要先移除,命令如下:</p>

<p>e.g.:<br><br>git rm -r –cached  WebRoot/WEB-INF/classes/<em>*/</em><br><br>-r:递归<br><br>git commit</p>

<p>然后.gitignore中的忽略,起作用以下参考//——————-</p>

<p>from:</p>

<p><a href="http://gitready.com/beginner/2009/01/19/ignoring-files.html" target="_blank" rel="external">http://gitready.com/beginner/2009/01/19/ignoring-files.html</a></p>

<p>The easiest and simplest way is to create a <code>.gitignore</code> file in your project’s root directory. The files you choose to ignore here take affect for all directories in your project, unless if they include their own <code>.gitignore</code> file. This is nice since you have one place to configure ignores unlike SVN’s svn:ignore which must be set on every folder. Also, the file itself can be versioned, which is definitely good.</p>

<p>Here’s a basic <code>.gitignore</code>:<br><pre>$ cat .gitignore</pre></p>

<p># Can ignore specific files<br><br>.DS_Store</p>

<p># Use wildcards as well<br><br><em>~<br>
</em>.swp</p>

<p># Can also ignore all directories and files in a directory.<br><br>tmp/<em>*/</em><br>Of course, this could get a lot more complex. You can also add exceptions to ignore rules by starting the line with <code>!</code>. See an example of this at the <a href="http://github.com/guides/ignore-for-git" target="_blank" rel="external">GitHub guide on ignores</a>.</p>

<p>Two things to keep in mind with ignoring files: First, if a file is already being tracked by Git, adding the file to <code>.gitignore</code> won’t stop Git from tracking it. You’ll need to do <code>git rm –cached &lt;file&gt;</code> to keep the file in your tree and then ignore it. Secondly, empty directories do not get tracked by Git. If you want them to be tracked, they need to have something in them. Usually doing a <code>touch .gitignore</code> is enough to keep the folder tracked.</p>

<p>You can also open up <code>$GIT_DIR/info/exclude</code> (<code>$GIT_DIR</code> is usually your <code>.git</code> folder) and edit that file for project-only ignores. The problem with this is that those changes aren’t checked in, so use this only if you have some personal files that don’t need to be shared with others on the same project.</p>

<p>Your final option with ignoring folders is adding a per-user ignore by setting up a<code>core.excludesfiles</code> option in your config file. You can set up a <code>.gitignore</code> file in yourHOME directory that will affect all of your repositories by running this command:</p>

<p><code>git config –global core.excludesfile ~/.gitignore</code></p>

<p>Read up on the <a href="http://www.kernel.org/pub/software/scm/git/docs/gitignore.html" target="_blank" rel="external">manpage</a> if you’d like to learn more about how ignores work. As always, if you have other ignore-related tips let us know in the comments.</p>

<p><br></p>
</div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/07/git-chuang-jian-shan-chu-ku-fen-zhi-guan-li/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/07/git-chuang-jian-shan-chu-ku-fen-zhi-guan-li/" itemprop="url">
                  git创建、删除库，分支管理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-07T00:00:00+08:00">
              2014-03-07
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/07/git-chuang-jian-shan-chu-ku-fen-zhi-guan-li/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/07/git-chuang-jian-shan-chu-ku-fen-zhi-guan-li/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><div><span style="font-family: 'Arial Black';"><b>一、创建库</b></span></div><br><div><span style="color: #008080; font-family: 'Arial Black';"><b>git init &lt;库名&gt;</b></span></div><br><span style="font-family: 'Arial Black';"><b>二、创建分支 </b>(打开刚创建的库: <span style="color: #800080;">cd &lt;库名&gt;</span>)</span><br><div><span style="color: #008080; font-family: 'Arial Black';">git branch &lt;分支名&gt;</span></div><br><div><span style="font-family: 'Arial Black';">注：如果创建分支失败，建立一个测试文本文件即可。</span></div><br><div><span style="font-family: 'Arial Black';">1) <span style="color: #008080;">git add .</span></span></div><br><div><span style="font-family: 'Arial Black';">2) <span style="color: #008080;">git commit -a -m “test”</span></span></div><br><div><span style="font-family: 'Arial Black';"><b>三、切换分支</b></span></div><br><div><br><div><span style="color: #008080; font-family: 'Arial Black';">git checkout &lt;分支名&gt; </span></div><br><div><span style="font-family: 'Arial Black';">该语句和上一个语句可以和起来用一个语句表示：<span style="color: #008080;">git checkout -b &lt;分支名&gt;</span></span></div><br></div><br><div><span style="font-family: 'Arial Black';"><b>四、查看当前库所有分支</b></span></div><br><div><span style="font-family: 'Arial Black';"><span style="color: #008080;">git branch</span></span></div><br><div><br><div><span style="font-family: 'Arial Black';"><b>五、分支合并</b></span></div><br><div><span style="font-family: 'Arial Black';">比如，如果要将当前的分支<span style="color: #800080;">develop</span>，合并到主分支<span style="color: #800080;">master</span></span></div><br><div><span style="font-family: 'Arial Black';">首先我们需要切换到<span style="color: #800080;">master</span>主分支：<span style="color: #008080;">git checkout master</span></span></div><br><div><span style="font-family: 'Arial Black';">然后执行合并操作：<span style="color: #008080;">git merge develop</span></span></div><br><div><span style="font-family: 'Arial Black';">如果有冲突，会提示你，调用<span style="color: #008080;">git status</span>查看冲突文件。 </span></div><br><div><span style="font-family: 'Arial Black';">解决冲突，然后调用<span style="color: #008080;">git add</span>或<span style="color: #008080;">git rm</span>将解决后的文件暂存。 </span></div><br><div><span style="font-family: 'Arial Black';">所有冲突解决后，<span style="color: #008080;">git commit </span>提交更改。</span></div><br><div><span style="font-family: 'Arial Black';"><b>六、分支衍合</b></span></div><br><div><span style="font-family: 'Arial Black';">分支衍合和分支合并的差别在于，分支衍合不会保留合并的日志，不留痕迹，而 分支合并则会保留合并的日志。 </span></div><br><div><span style="font-family: 'Arial Black';">要将开发中的分支<span style="color: #800080;">develop</span>，衍合到主分支<span style="color: #800080;">master</span></span></div><br><div><span style="font-family: 'Arial Black';">首先切换的<span style="color: #800080;">master</span>分支：<span style="color: #008080;">git checkout master</span></span></div><br><div><span style="font-family: 'Arial Black';">然后执行衍和操作：<span style="color: #008080;">git rebase develop</span></span></div><br><div><span style="font-family: 'Arial Black';">如果有冲突，会提示你，调用<span style="color: #008080;">git status</span>查看冲突文件。 </span></div><br><div><span style="font-family: 'Arial Black';">解决冲突，然后调用<span style="color: #008080;">git add</span>或<span style="color: #008080;">git rm</span>将解决后的文件暂存。 </span></div><br><div><span style="font-family: 'Arial Black';">所有冲突解决后，<span style="color: #008080;">git rebase –continue</span> 提交更改。</span></div><br><div><span style="font-family: 'Arial Black';"><b>七、删除分支</b></span></div><br><div><span style="color: #008080; font-family: 'Arial Black';">git branch -d &lt;分支名&gt; </span></div><br><div><span style="font-family: 'Arial Black';">如果该分支没有合并到主分支会报错，可以用以下命令强制删除<span style="color: #008080;">git branch -D &lt;分支名&gt;</span></span></div><br></div><br><div><span style="font-family: 'Arial Black';"><b>八、删除库</b></span></div><br><div><span style="color: #008080; font-family: 'Arial Black';">rm -rf &lt;库名&gt;</span></div></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/03/zhuan-cgcontextaddarc-de-shi-yong/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/03/zhuan-cgcontextaddarc-de-shi-yong/" itemprop="url">
                  [转]CGContextAddArc的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-03T00:00:00+08:00">
              2014-03-03
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/03/zhuan-cgcontextaddarc-de-shi-yong/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/03/zhuan-cgcontextaddarc-de-shi-yong/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[转自]：<a href="http://differentisnotdifferent.diandian.com/post/2012-07-30/40032320467" target="_blank" rel="external">http://differentisnotdifferent.diandian.com/post/2012-07-30/40032320467</a></p>

<p>这个函数让我在纸上画了半天才搞明白，把我的理解给大家分享下。</p>

<p>void CGContextAddArc(CGContextRef c, CGFloat x, CGFloat y, CGFloat radius, CGFloat startAngle, CGFloat endAngle, int clockwise)</p>

<p>CGContextRef不解释了，x,y为圆点坐标，startAngle为开始的弧度，endAngle为 结束的弧度，clockwise 0为顺时针，1为逆时针。</p>

<p>CGContextAddArc(context, 160, 200, 100, 0, 45*(M_PI/180), 0);</p>

<p>所以对上面这对代码的解释是这样的：</p>

<p>1）startAngle为0,绿色箭头的地方。</p>

<p>2）endAngle为45,黄色箭头的地方。</p>

<p>3）clockwise为0,按照红色箭头往下绘制图形。</p>

<p>4）所以效果就是红色的扇形。</p>

<p>补充：如果clockwise为1，则是蓝色部分区域。</p>

<p><img alt="" src="http://m1.img.papaapp.com/farm5/d/2012/0730/19/0D826787916C7D216CCD2D012DE49C2E_B500_900_286_260.JPEG" width="286" height="260"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/03/02/nsoperationhe-dispatch-asyncde-qu-bie/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/03/02/nsoperationhe-dispatch-asyncde-qu-bie/" itemprop="url">
                  NSOperation和dispatch_async的区别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-03-02T17:20:33+08:00">
              2014-03-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/03/02/nsoperationhe-dispatch-asyncde-qu-bie/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/03/02/nsoperationhe-dispatch-asyncde-qu-bie/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>NSOperation*</code> classes are the higher level api. They hide GCD’s lower level api from you so that you can concentrate on getting the task done.</p>
<p>The rule of thumb is: <strong>Use the api of the highest level first and then degrade based on what you need to accomplish.</strong></p>
<p>The advantage of this approach is that your code stays most agnostic to the specific implementation the vendor provides. In this example, using <code>NSOperation</code>, you’ll be using Apple’s implementation of execution queueing (using GCD). Should Apple ever decide to change the details of implementation behind the scenes they can do so without breaking your application’s code.<br>One such example would be Apple deprecating GCD and using a completely different library (which is unlikely because Apple created GCD and everybody seems to love it).</p>
<p>Regarding the matter i recommend consulting the following resources:</p>
<ul><br>    <li><a href="http://cocoasamurai.blogspot.de/2009/09/guide-to-blocks-grand-central-dispatch.html" target="_blank" rel="external">http://cocoasamurai.blogspot.de/2009/09/guide-to-blocks-grand-central-dispatch.html</a></li><br>    <li><a href="http://cocoasamurai.blogspot.de/2009/09/making-nsoperation-look-like-gcd.html" target="_blank" rel="external">http://cocoasamurai.blogspot.de/2009/09/making-nsoperation-look-like-gcd.html</a></li><br>    <li><a href="http://www.raywenderlich.com/19788/how-to-use-nsoperations-and-nsoperationqueues" target="_blank" rel="external">http://www.raywenderlich.com/19788/how-to-use-nsoperations-and-nsoperationqueues</a></li><br>    <li><a href="https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/NSOperationQueue_class/Reference/Reference.html" target="_blank" rel="external">https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/NSOperationQueue_class/Reference/Reference.html</a></li><br></ul>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/02/27/iosduo-xian-cheng-bian-cheng-xian-cheng-tong-bu/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/02/27/iosduo-xian-cheng-bian-cheng-xian-cheng-tong-bu/" itemprop="url">
                  iOS多线程编程-线程同步
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-02-27T18:58:58+08:00">
              2014-02-27
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/02/27/iosduo-xian-cheng-bian-cheng-xian-cheng-tong-bu/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/27/iosduo-xian-cheng-bian-cheng-xian-cheng-tong-bu/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <div><br>应用程序里面多个线程的存在引发了多个执行线程安全访问资源的潜在问题。两个线程同时修改同一资源有可能以意想不到的方式互相干扰。比如，一个线程可能覆盖其他线程改动的地方，或让应用程序进入一个未知的潜在无效状态。如果你幸运的话，受损的资源可能会导致明显的性能问题或崩溃，这样比较容易跟踪并修复它。然而如果你不走运，资源受损可能导致微妙的错误，这些错误不会立即显现出来，而是很久之后才出现，或者导致其他可能需要一个底层的编码来显著修复的错误。<br><br>但涉及到线程安全时，一个好的设计是最好的保护。避免共享资源，并尽量减少线程间的相互作用，这样可以让它们减少互相的干扰。但是一个完全无干扰的设计是不可能的。在线程必须交互的情况下，你需要使用同步工具，来确保当它们交互的时候是安全的。<br><br>Mac OS X和iOS提供了你可以使用的多个同步工具，从提供互斥访问你程序的有序的事件的工具等。以下个部分介绍了这些工具和如何在代码中使用他们来影响安全的访问程序的资源。<br><h2>1.1        同步工具</h2><br>为了防止不同线程意外修改数据，你可以设计你的程序没有同步问题，或你也可以使用同步工具。尽管完全避免出现同步问题相对更好一点，但是几乎总是无法实现。以下个部分介绍了你可以使用的同步工具的基本类别。<br><h3>1.1.1    原子操作</h3><br>原子操作是同步的一个简单的形式，它处理简单的数据类型。原子操作的优势是它们不妨碍竞争的线程。对于简单的操作，比如递增一个计数器，原子操作比使用锁具有更高的性能优势。<br><br>Mac OS X和iOS包含了许多在32位和64位执行基本的数学和逻辑运算的操作。这些操作都使用了原子版本来操作比较和交换，测试和设置，测试和清理等。查看支持原子操作的列表，参阅/user/include/libkern/OSAtomic.h头文件和参见atomic主页。<br><h3>1.1.2    内存屏障和 Volatile 变量</h3><br>为了达到最佳性能，编译器通常会对汇编基本的指令进行重新排序来尽可能保持处理器的指令流水线。作为优化的一部分，编译器有可能对访问主内存的指令，如果它认为这有可能产生不正确的数据时，将会对指令进行重新排序。不幸的是，靠编译器检测到所有可能内存依赖的操作几乎总是不太可能的。如果看似独立的变量实际上是相互影响，那么编译器优化有可能把这些变量更新位错误的顺序，导致潜在不不正确结果。<br><br>内存屏障（memory barrier）是一个使用来确保内存操作按照正确的顺序工作的非阻塞的同步工具。内存屏障的作用就像一个栅栏，迫使处理器来完成位于障碍前面的任何加载和存储操作，才允许它执行位于屏障之后的加载和存储操作。内存屏障同样使用来确保一个线程（但对另外一个线程可见）的内存操作总是按照预定的顺序完成。如果在这些地方缺少内存屏障有可能让其他线程看到看似不可能的结果（比如，内存屏障的维基百科条目）。为了使用一个内存屏障，你只要在你代码里面需要的地方简单的调用OSMemoryBarrier函数。<br><br>Volatile 变量适用于独立变量的另一个内存限制类型。编译器优化代码通过加载这些变量的值进入寄存器。对于本地变量，这通常不会有什么问题。但是如果一个变量对另外一个线程可见，那么这种优化可能会阻止其他线程发现变量的任何变化。在变量之前加上关键字volatile可以强制编译器每次使用变量的时候都从内存里面加载。如果一个变量的值随时可能给编译器无法检测的外部源更改，那么你可以把该变量声明为volatile变量。<br><br>因为内存屏障和volatile变量降低了编译器可执行的优化，因此你应该谨慎使用它们，只在有需要的地方时候，以确保正确性。关于更多使用内存屏障的信息，参阅OSMemoryBarrier主页。<br><h3>1.1.3    锁</h3><br>锁是最常用的同步工具。你可以是使用锁来保护临界区(<strong>critical section</strong>)，这些代码段在同一个时间只能允许被一个线程访问。比如，一个临界区可能会操作一个特定的数据结构，或使用了每次只能一个客户端访问的资源。<br><br>表4-1列出了程序最常使用的锁。Mac OS X和iOS提供了这些锁里面大部分类型的实现，但是并不是全部实现。对于不支持的锁类型，说明列解析了为什么这些锁不能直接在平台上面实现的原因。<br><p align="center"><strong>Table 4-1</strong>  Lock types</p><br><br><table border="1" cellspacing="0" cellpadding="0"><br><tbody><br><tr><br><td valign="top" width="150px">Lock</td><br><td valign="top">Description</td><br></tr><br><tr><br><td>Mutex[互斥锁]</td><br><td>A mutually exclusive (or <strong>mutex</strong>) lock acts as a protective barrier around a resource. A mutex is a type of semaphore that grants access to only one thread at a time. If a mutex is in use and another thread tries to acquire it, that thread blocks until the mutex is released by its original holder. If multiple threads compete for the same mutex, only one at a time is allowed access to it.</td><br></tr><br><tr><br><td>Recursive lock[递归锁]</td><br><td>A recursive lock is a variant on the mutex lock. A recursive lock allows a single thread to acquire the lock multiple times before releasing it. Other threads remain blocked until the owner of the lock releases the lock the same number of times it acquired it. Recursive locks are used during recursive iterations primarily but may also be used in cases where multiple methods each need to acquire the lock separately.</td><br></tr><br><tr><br><td>Read-write lock<br>[读写锁]</td><br><td>A read-write lock is also referred to as a shared-exclusive lock. This type of lock is typically used in larger-scale operations and can significantly improve performance if the protected data structure is read frequently and modified only occasionally. During normal operation, multiple readers can access the data structure simultaneously. When a thread wants to write to the structure, though, it blocks until all readers release the lock, at which point it acquires the lock and can update the structure. While a writing thread is waiting for the lock, new reader threads block until the writing thread is finished. The system supports read-write locks using POSIX threads only. For more information on how to use these locks, see the <a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/pthread.3.html#//apple_ref/doc/man/3/pthread" target="_blank" rel="external">pthread</a> man page.</td><br></tr><br><tr><br><td>Distributed lock<br>[分布锁]</td><br><td>A distributed lock provides mutually exclusive access at the process level. Unlike a true mutex, a distributed lock does not block a process or prevent it from running. It simply reports when the lock is busy and lets the process decide how to proceed.</td><br></tr><br><tr><br><td>Spin lock<br>[自旋锁]</td><br><td>A spin lock polls its lock condition repeatedly until that condition becomes true. Spin locks are most often used on multiprocessor systems where the expected wait time for a lock is small. In these situations, it is often more efficient to poll than to block the thread, which involves a context switch and the updating of thread data structures. The system does not provide any implementations of spin locks because of their polling nature, but you can easily implement them in specific situations. For information on implementing spin locks in the kernel, see<em>Kernel Programming Guide</em>.</td><br></tr><br><tr><br><td>Double-checked lock<br>[双重检查锁]</td><br><td>A double-checked lock is an attempt to reduce the overhead of taking a lock by testing the locking criteria prior to taking the lock. Because double-checked locks are potentially unsafe, the system does not provide explicit support for them and their use is discouraged.[注意系统不显式支持该锁类型]</td><br></tr><br></tbody><br></table><br><blockquote><strong>注意：</strong><em>大部分锁类型都合并了内存屏障来确保在进入临界区之前它前面的加载和存储指令都已经完成。</em></blockquote><br>关于如何使用锁的信息，参阅”使用锁”部分。<br><h3>1.1.4    条件</h3><br>条件是<strong>信号量</strong>的另外一个形式，它允许在条件为真的时候线程间互相发送信号。条件通常被使用来说明资源可用性，或用来确保任务以特定的顺序执行。当一个线程测试一个条件时，它会被阻塞直到条件为真。它会一直阻塞直到其他线程显式的修改信号量的状态。条件和互斥锁(mutex lock)的区别在于多个线程被允许同时访问一个条件。条件更多是允许不同线程根据一些指定的标准通过的守门人。<br><br>一个方式是你使用条件来管理挂起事件的池。事件队列可能使用条件变量来给等待线程发送信号，此时它们在事件队列中的时候。如果一个事件到达时，队列将给条件发送合适信号。如果一个线程已经处于等待，它会被唤醒，届时它将会取出事件并处理它。如果两个事件到达队列的时间大致相同，队列将会发送两次信号唤醒两个线程。<br><br>系统通过几个不同的技术来支持条件。然而正确实现条件需要仔细编写代码，因此你应该在你自己代码中使用条件之前查看”使用条件”部分的例子。<br><h3>1.1.5    执行Selector例程</h3><br>Cocoa程序包含了一个在一个线程以同步的方式传递消息的方便方法。NSObject类声明方法来在应用的一个活动线程上面执行selector的方法。这些方法允许你的线程以异步的方式来传递消息，以确保它们在同一个线程上面执行是同步的。比如，你可以通过执行selector消息来把一个从你分布计算的结果传递给你的应用的主线程或其他目标线程。每个执行selector的请求都会被放入一个目标线程的run loop的队列里面，然后请求会按照它们到达的顺序被目标线程有序的处理。<br><br>关于执行selector例程的总结和更多关于如何使用它们的信息，参阅Cocoa执行Selector源。<br><h2>1.2        同步的成本和性能</h2><br>同步帮助确保你代码的正确性，但同时将会牺牲部分性能。甚至在无争议的情况下，同步工具的使用将在后面介绍。锁和原子操作通常包含了内存屏障和内核级别同步的使用来确保代码正确被保护。如果，发生锁的争夺，你的线程有可能进入阻塞，在体验上会产生更大的迟延。<br><br>表4-2列出了在无争议情况下使用互斥锁和原子操作的近似的相关成本。这些测试的平均值是使用了上千的样本分析出的结果。随着线程创建时间的推移，互斥采集时间（即使在无争议情况下）可能相差也很大，这依赖于进程的加载，计算机的处理速度和系统和程序现有可用的内存。<br><p align="center"><strong>Table 4-2</strong>  Mutex and atomic operation costs</p><br><br><table border="1" cellspacing="0" cellpadding="0"><br><tbody><br><tr><br><td valign="top" width="150px">Item</td><br><td valign="top" width="200px">Approximate cost</td><br><td valign="top">Notes</td><br></tr><br><tr><br><td>Mutex acquisition time</td><br><td>Approximately 0.2 microseconds<br>[0.2微秒]</td><br><td>This is the lock acquisition time in an uncontested case. If the lock is held by another thread, the acquisition time can be much greater. The figures were determined by analyzing the mean and median values generated during mutex acquisition on an Intel-based iMac with a 2 GHz Core Duo processor and 1 GB of RAM running Mac OS X v10.5.</td><br></tr><br><tr><br><td>Atomic compare-and-swap</td><br><td>Approximately 0.05 microseconds<br>[0.05微秒]</td><br><td>This is the compare-and-swap time in an uncontested case. The figures were determined by analyzing the mean and median values for the operation and were generated on an Intel-based iMac with a 2 GHz Core Duo processor and 1 GB of RAM running Mac OS X v10.5.</td><br></tr><br></tbody><br></table><br>当设计你的并发任务时，正确性是最重要的因素，但是也要考虑性能因素。代码在多个线程下面正确执行，但比相同代码在当线程执行慢，这是难以改善的。如果你是改造已有的单线程应用，你应该始终给关键任务的性能设置测量基线。当增加额外线程后，对相同的任务你应该采取新的测量方法并比较多线程和单线程情况下的性能状况。在改变代码之后，线程并没有提高性能，你应该需要重新考虑具体的实现或同时使用线程。<br><br>关于性能的信息和收集指标的工具，参阅Performance Overview。关于锁原子成本的特定信息，参阅”线程成本”部分。<br><h2>1.3        线程安全和信号量</h2><br>当涉及到多线程应用程序时，没有什么比处理信号量更令人恐惧和困惑的了。信号量是底层BSD机制，它可以用来传递信息给进程或以某种方式操纵它。一些应用程序使用信号量来检测特定事件，比如子进程的消亡。系统使用信号量来终止失控进程，和作为其他类型的通信消息。<br><br>使用信号量的问题并不是你要做什么，而是当你程序是多线程的时候它们的行为。在当线程应用程序里面，所有的信号量处理都在主线程进行。在多线程应用程序里面，信号量被传递到恰好运行的线程，而不依赖于特定的硬件错误（比如非法指令）。如果多个线程同时运行，信号量被传递到任何一个系统挑选的线程。换而言之，信号量可以传递给你应用的任何线程。<br><br>在你应用程序里面实现信号量处理的第一条规则是避免假设任一线程处理信号量。如果一个指定的线程想要处理给定的信号，你需要通过某些方法来通知该线程信号何时到达。你不能只是假设该线程的一个信号处理例程的安装会导致信号被传递到同一线程里面。<br><br>关于更多信号量的信息和信号量处理例程的安装信息，参见signal和sigaction主页。<br><h2>1.4        线程安全设计的技巧</h2><br>同步工具是让你代码安全的有用方法，但是它们并非灵丹妙药。使用太多锁和其他同步的类型原语和非多线程相比明显会降低你应用的线程性能。在性能和安全之间寻找平衡是一门需要经验的艺术。以下各部分提供帮助你为你应用选择合适的同步级别的技巧。<br><h3>1.4.1    完全避免同步</h3><br>对于你新的项目，甚至已有项目，设计你的代码和数据结构来避免使用同步是一个很好的解决办法。虽然锁和其他类型同步工具很有用，但是它们会影响任何应用的性能。而且如果整体设计导致特定资源的高竞争，你的线程可能需要等待更长时间。<br><br>实现并发最好的方法是减少你并发任务之间的交互和相互依赖。如果每个任务在它自己的数据集上面操作，那它不需要使用锁来保护这些数据。甚至如果两个任务共享一个普通数据集，你可以查看分区方法，它们设置或提供拷贝每一项任务的方法。当然，拷贝数据集本身也需要成本，所以在你做出决定前，你需要权衡这些成本和使用同步工具造成的成本那个更可以接受。<br><h3>1.4.2    了解同步的限制</h3><br>同步工具只有当它们被用在应用程序中的所有线程是一致时才是有效的。如果你创建了互斥锁来限制特定资源的访问，你所有线程都必须在试图操纵资源前获得同一互斥锁。如果不这样做导致破坏一个互斥锁提供的保护，这是编程的错误。<br><h3>1.4.3    注意对代码正确性的威胁</h3><br>当你使用锁和内存屏障时，你应该总是小心的把它们放在你代码正确的地方。即使有条件的锁（似乎很好放置）也可能会让你产生一个虚假的安全感。以下一系列例子试图通过指出看似无害的代码的漏洞来举例说明该问题。其基本前提是你有一个可变的数组，它包含一组不可变的对象集。假设你想要调用数组中第一个对象的方法。你可能会做类似下面那样的代码：<br><pre>NSLock<em> arrayLock = GetArrayLock();<br>NSMutableArray</em> myArray = GetSharedArray();<br>id anObject;<br><br>[arrayLock lock];<br>anObject = [myArray objectAtIndex:0];<br>[arrayLock unlock];<br><br>[anObject doSomething];</pre><br><div align="center"></div><br>因为数组是可变的，所有数组周围的锁防止其他线程修改该数组直到你获得了想要的对象。而且因为对象限制它们本身是不可更改的，所以在调用对象的doSomething方法周围不需要锁。<br><br>但是上面显式的例子有一个问题。如果当你释放该锁，而在你有机会执行doSomething方法前其他线程到来并从数组中删除所有对象，那会发生什么呢？对于没有使用垃圾回收的应用程序，你代码用户的对象可能已经释放了，让anObject对象指向一个非法的内存地址。了修正该问题，你可能决定简单的重新安排你的代码，让它在调用doSomething之后才释放锁，如下所示：<br><div align="center"></div><br><pre>NSLock<em> arrayLock = GetArrayLock();<br>NSMutableArray</em> myArray = GetSharedArray();<br>id anObject;<br><br>[arrayLock lock];<br>anObject = [myArray objectAtIndex:0];<br>[anObject doSomething];<br>[arrayLock unlock];</pre><br>通过把doSomething的调用移到锁的内部，你的代码可以保证该方法被调用的时候该对象还是有效的。不幸的是，如果doSomething方法需要耗费很长的时间，这有可能导致你的代码保持拥有该锁很长时间，这会产生一个性能瓶颈。<br><br>该代码的问题不是关键区域定义不清，而是实际问题是不可理解的。真正的问题是由其他线程引发的内存管理的问题。因为它可以被其他线程释放，最好的解决办法是在释放锁之前retain anObject。该解决方案涉及对象被释放，并没有引发一个强制的性能损失。<br><div align="center"></div><br><pre>NSLock<em> arrayLock = GetArrayLock();<br>NSMutableArray</em> myArray = GetSharedArray();<br>id anObject;<br><br>[arrayLock lock];<br>anObject = [myArray objectAtIndex:0];<br>[anObject retain];<br>[arrayLock unlock];<br><br>[anObject doSomething];<br>[anObject release];</pre><br>尽管前面的例子非常简单，它们说明了非常重要的一点。当它涉及到正确性时，你需要考虑不仅仅是问题的表面。内存管理和其他影响你设计的因子都有可能因为出现多个线程而受到影响，所以你必须考虑从上到下考虑这些问题。此外，你应该在涉及安全的时候假设编译器总是出现最坏的情况。这种意识和警惕性，可以帮你避免潜在的问题，并确保你的代码运行正确。<br><br>关于更多介绍如何让你应用程序安全的额外例子，参阅Technical Note TN2059:”Using Collection Classes Safely in Multithreaded Application”。<br><h3>1.4.4    当心死锁（Deadlocks）和活锁(Livelocks)</h3><br>任何时候线程试图同时获得多于一个锁，都有可能引发潜在的死锁。当两个不同的线程分别保持一个锁（而该锁是另外一个线程需要的）又试图获得另外线程保持的锁时就会发生死锁。结果是每个线程都会进入持久性阻塞状态，因为它永远不可能获得另外那个锁。<br><br>一个活锁和死锁类似，当两个线程竞争同一个资源的时候就可能发生活锁。在发生活锁的情况里，一个线程放弃它的第一个锁并试图获得第二个锁。一旦它获得第二个锁，它返回并试图再次获得一个锁。线程就会被锁起来，因为它花费所有的时间来释放一个锁，并试图获取其他锁，而不做实际的工作。<br><br>避免死锁和活锁的最好方法是同一个时间只拥有一个锁。如果你必须在同一时间获取多于一个锁，你应该确保其他线程没有做类似的事情。<br><h3>1.4.5    正确使用Volatile变量</h3><br>如果你已经使用了一个互斥锁来保护一个代码段，不要自动假设你需要使用关键词volatile来保护该代码段的重要的变量。一个互斥锁包含了内存屏障来确保加载和存储操作是按照正确顺序的。在一个临界区添加关键字volatile到变量上面会强制每次访问该变量的时候都要从内存里面从加载。这两种同步技巧的组合使用在一些特定区域是必须的，但是同样会导致显著的性能损失。如果单独使用互斥锁已经可以保护变量，那么忽略关键字volatile。<br><br>为了避免使用互斥锁而不使用volatile变量同样很重要。通常情况下，互斥锁和其他同步机制是比volatile变量更好的方式来保护数据结构的完整性。关键字volatile只是确保从内存加载变量而不是使用寄存器里面的变量。它不保证你代码访问变量是正确的。<br><h2>1.5        使用原子操作</h2><br>非阻塞同步的方式是用来执行某些类型的操作而避免扩展使用锁。尽管锁是同步两个线程的很好方式，获取一个锁是一个很昂贵的操作，即使在无竞争的状态下。相比，许多原子操作花费很少的时间来完成操作也可以达到和锁一样的效果。<br><br>原子操作可以让你在32位或64位的处理器上面执行简单的数学和逻辑的运算操作。这些操作依赖于特定的硬件设施（和可选的内存屏障）来保证给定的操作在影响内存再次访问的时候已经完成。在多线程情况下，你应该总是使用原子操作，它和内存屏障组合使用来保证多个线程间正确的同步内存。<br><br>表4-3列出了可用的原子运算和本地操作和相应的函数名。这些函数声明在/usr/include/libkern/OSAtomic.h头文件里面，在那里你也可以找到完整的语法。这些函数的64-位版本只能在64位的进程里面使用。<br><p align="center"><strong>Table 4-3</strong>  Atomic math and logic operations</p><br><br><div align="center"><br><table border="1" cellspacing="0" cellpadding="0"><br><tbody><br><tr><br><td valign="top" width="150px">Operation</td><br><td valign="top" width="300px">Function name</td><br><td valign="top">Description</td><br></tr><br><tr><br><td>Add</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicAdd32.3.html#//apple_ref/doc/man/3/OSAtomicAdd32" target="_blank" rel="external">OSAtomicAdd32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicAdd32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicAdd32Barrier" target="_blank" rel="external">OSAtomicAdd32Barrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicAdd64.3.html#//apple_ref/doc/man/3/OSAtomicAdd64" target="_blank" rel="external">OSAtomicAdd64</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicAdd64Barrier.3.html#//apple_ref/doc/man/3/OSAtomicAdd64Barrier" target="_blank" rel="external">OSAtomicAdd64Barrier</a></td><br><td>Adds two integer values together and stores the result in one of the specified variables.</td><br></tr><br><tr><br><td>Increment</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicIncrement32.3.html#//apple_ref/doc/man/3/OSAtomicIncrement32" target="_blank" rel="external">OSAtomicIncrement32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicIncrement32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicIncrement32Barrier" target="_blank" rel="external">OSAtomicIncrement32Barrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicIncrement64.3.html#//apple_ref/doc/man/3/OSAtomicIncrement64" target="_blank" rel="external">OSAtomicIncrement64</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicIncrement64Barrier.3.html#//apple_ref/doc/man/3/OSAtomicIncrement64Barrier" target="_blank" rel="external">OSAtomicIncrement64Barrier</a></td><br><td>Increments the specified integer value by 1.</td><br></tr><br><tr><br><td>Decrement</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicDecrement32.3.html#//apple_ref/doc/man/3/OSAtomicDecrement32" target="_blank" rel="external">OSAtomicDecrement32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicDecrement32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicDecrement32Barrier" target="_blank" rel="external">OSAtomicDecrement32Barrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicDecrement64.3.html#//apple_ref/doc/man/3/OSAtomicDecrement64" target="_blank" rel="external">OSAtomicDecrement64</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicDecrement64Barrier.3.html#//apple_ref/doc/man/3/OSAtomicDecrement64Barrier" target="_blank" rel="external">OSAtomicDecrement64Barrier</a></td><br><td>Decrements the specified integer value by 1.</td><br></tr><br><tr><br><td>Logical OR</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicOr32.3.html#//apple_ref/doc/man/3/OSAtomicOr32" target="_blank" rel="external">OSAtomicOr32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicOr32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicOr32Barrier" target="_blank" rel="external">OSAtomicOr32Barrier</a></td><br><td>Performs a logical OR between the specified 32-bit value and a 32-bit mask.</td><br></tr><br><tr><br><td>Logical AND</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicAnd32.3.html#//apple_ref/doc/man/3/OSAtomicAnd32" target="_blank" rel="external">OSAtomicAnd32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicAnd32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicAnd32Barrier" target="_blank" rel="external">OSAtomicAnd32Barrier</a></td><br><td>Performs a logical AND between the specified 32-bit value and a 32-bit mask.</td><br></tr><br><tr><br><td>Logical XOR</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicXor32.3.html#//apple_ref/doc/man/3/OSAtomicXor32" target="_blank" rel="external">OSAtomicXor32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicXor32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicXor32Barrier" target="_blank" rel="external">OSAtomicXor32Barrier</a></td><br><td>Performs a logical XOR between the specified 32-bit value and a 32-bit mask.</td><br></tr><br><tr><br><td>Compare and swap</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwap32.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwap32" target="_blank" rel="external">OSAtomicCompareAndSwap32</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwap32Barrier.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwap32Barrier" target="_blank" rel="external">OSAtomicCompareAndSwap32Barrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwap64.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwap64" target="_blank" rel="external">OSAtomicCompareAndSwap64</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwap64Barrier.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwap64Barrier" target="_blank" rel="external">OSAtomicCompareAndSwap64Barrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwapPtr.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwapPtr" target="_blank" rel="external">OSAtomicCompareAndSwapPtr</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwapPtrBarrier.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwapPtrBarrier" target="_blank" rel="external">OSAtomicCompareAndSwapPtrBarrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwapInt.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwapInt" target="_blank" rel="external">OSAtomicCompareAndSwapInt</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwapIntBarrier.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwapIntBarrier" target="_blank" rel="external">OSAtomicCompareAndSwapIntBarrier</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwapLong.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwapLong" target="_blank" rel="external">OSAtomicCompareAndSwapLong</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicCompareAndSwapLongBarrier.3.html#//apple_ref/doc/man/3/OSAtomicCompareAndSwapLongBarrier" target="_blank" rel="external">OSAtomicCompareAndSwapLongBarrier</a></td><br><td>Compares a variable against the specified old value. If the two values are equal, this function assigns the specified new value to the variable; otherwise, it does nothing. The comparison and assignment are done as one atomic operation and the function returns a Boolean value indicating whether the swap actually occurred.</td><br></tr><br><tr><br><td>Test and set</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicTestAndSet.3.html#//apple_ref/doc/man/3/OSAtomicTestAndSet" target="_blank" rel="external">OSAtomicTestAndSet</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicTestAndSetBarrier.3.html#//apple_ref/doc/man/3/OSAtomicTestAndSetBarrier" target="_blank" rel="external">OSAtomicTestAndSetBarrier</a></td><br><td>Tests a bit in the specified variable, sets that bit to 1, and returns the value of the old bit as a Boolean value. Bits are tested according to the formula (0×80 &gt;&gt; (n &amp; 7)) of byte((char<em>)address + (n &gt;&gt; 3)) where n is the bit number and address is a pointer to the variable. This formula effectively breaks up the variable into 8-bit sized chunks and orders the bits in each chunk in reverse. For example, to test the lowest-order bit (bit 0) of a 32-bit integer, you would actually specify 7 for the bit number; similarly, to test the highest order bit (bit 32), you would specify 24 for the bit number.</em></td><br></tr><br><tr><br><td>Test and clear</td><br><td><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicTestAndClear.3.html#//apple_ref/doc/man/3/OSAtomicTestAndClear" target="_blank" rel="external">OSAtomicTestAndClear</a><br><a href="http://developer.apple.com/library/ios/documentation/System/Conceptual/ManPages_iPhoneOS/man3/OSAtomicTestAndClearBarrier.3.html#//apple_ref/doc/man/3/OSAtomicTestAndClearBarrier" target="_blank" rel="external">OSAtomicTestAndClearBarrier</a></td><br><td>Tests a bit in the specified variable, sets that bit to 0, and returns the value of the old bit as a Boolean value. Bits are tested according to the formula (0×80 &gt;&gt; (n &amp; 7)) of byte((char)address + (n &gt;&gt; 3)) where n is the bit number and address is a pointer to the variable. This formula effectively breaks up the variable into 8-bit sized chunks and orders the bits in each chunk in reverse. For example, to test the lowest-order bit (bit 0) of a 32-bit integer, you would actually specify 7 for the bit number; similarly, to test the highest order bit (bit 32), you would specify 24 for the bit number.</td><br></tr><br></tbody><br></table><br></div><br>&nbsp;<br><br>大部分原子函数的行为是相对简单的并应该是你想要的。然而列表4-1显式了测试-设置和比较-交换操作的原子行为，它们相对复杂一点。OSAtomicTestAndSet 第一次调用展示了如何对一个整形值进行位运算操作，而它的结果和你预期的有差异。最后两次调用OSAtomicCompareAndSwap32显式它的行为。所有情况下，这些函数都是无竞争的下调用的，此时没有其他线程试图操作这些值。<br><br>&nbsp;<br><p align="center"><strong>Listing 4-1</strong>  Performing atomic operations</p><br><br><div align="center"></div><br><pre>int32_t  theValue = 0;<br>OSAtomicTestAndSet(0, &amp;theValue);<br>// theValue is now 128.<br><br>theValue = 0;<br>OSAtomicTestAndSet(7, &amp;theValue);<br>// theValue is now 1.<br><br>theValue = 0;<br>OSAtomicTestAndSet(15, &amp;theValue)<br>// theValue is now 256.<br><br>OSAtomicCompareAndSwap32(256, 512, &amp;theValue);<br>// theValue is now 512.<br><br>OSAtomicCompareAndSwap32(256, 1024, &amp;theValue);<br>// theValue is still 512.</pre><br><p align="left">关于原子操作的更多信息，参见atomic的主页和/usr/include/libkern/OSAtomic.h头文件。</p><br><br><h2>1.6        使用锁</h2><br>锁是线程编程同步工具的基础。锁可以让你很容易保护代码中一大块区域以便你可以确保代码的正确性。Mac OS X和iOS都位所有类型的应用程序提供了互斥锁，而Foundation框架定义一些特殊情况下互斥锁的额外变种。以下个部分显式了如何使用这些锁的类型。<br><h3>1.6.1    使用POSIX互斥锁</h3><br>POSIX互斥锁在很多程序里面很容易使用。为了新建一个互斥锁，你声明并初始化一个pthread_mutex_t的结构。为了锁住和解锁一个互斥锁，你可以使用pthread_mutex_lock和pthread_mutex_unlock函数。列表4-2显式了要初始化并使用一个POSIX线程的互斥锁的基础代码。当你用完一个锁之后，只要简单的调用pthread_mutex_destroy来释放该锁的数据结构。<br><p align="center"><strong>Listing 4-2</strong>  Using a mutex lock</p><br><br><div align="center"></div><br><pre>pthread_mutex_t mutex;<br>void MyInitFunction()<br>{<br>    pthread_mutex_init(&amp;mutex, NULL);<br>}<br><br>void MyLockingFunction()<br>{<br>    pthread_mutex_lock(&amp;mutex);<br>    // Do work.<br>    pthread_mutex_unlock(&amp;mutex);<br>}</pre><br><blockquote><strong>注意：</strong><em>上面的代码只是简单的显式了使用一个POSIX线程互斥锁的步骤。你自己的代码应该检查这些函数返回的错误码，并适当的处理它们。</em></blockquote><br><h3>1.6.2    使用NSLock类</h3><br>在Cocoa程序中NSLock中实现了一个简单的互斥锁。所有锁（包括NSLock）的接口实际上都是通过NSLocking协议定义的，它定义了lock和unlock方法。你使用这些方法来获取和释放该锁。<br><br>除了标准的锁行为，NSLock类还增加了tryLock和lockBeforeDate:方法。方法tryLock试图获取一个锁，但是如果锁不可用的时候，它不会阻塞线程。相反，它只是返回NO。而lockBeforeDate:方法试图获取一个锁，但是如果锁没有在规定的时间内被获得，它会让线程从阻塞状态变为非阻塞状态（或者返回NO）。<br><br>下面的例子显式了你可以是NSLock对象来协助更新一个可视化显式，它的数据结构被多个线程计算。如果线程没有立即获的锁，它只是简单的继续计算直到它可以获得锁再更新显式。<br><pre>BOOL moreToDo = YES;<br>NSLock <em>theLock = [[NSLock alloc] init];<br>…<br>while (moreToDo) {<br>    /</em> Do another increment of calculation <em>/<br>    /</em> until there’s no more to do. <em>/<br>    if ([theLock tryLock]) {<br>        /</em> Update display used by all threads. <em>/<br>        [theLock unlock];<br>    }<br>}</em></pre><br><div align="center"></div><br><h3>1.6.3    使用@synchronized指令</h3><br>@synchronized指令是在Objective-C代码中创建一个互斥锁非常方便的方法。@synchronized指令做和其他互斥锁一样的工作（它防止不同的线程在同一时间获取同一个锁）。然而在这种情况下，你不需要直接创建一个互斥锁或锁对象。相反，你只需要简单的使用Objective-C对象作为锁的令牌，如下面例子所示：<br><div align="center"></div><br><pre>- (void)myMethod:(id)anObj<br>{<br>    @synchronized(anObj)<br>    {<br>        // Everything between the braces is protected by the @synchronized directive.<br>    }<br>}</pre><br>创建给@synchronized指令的对象是一个用来区别保护块的唯一标示符。如果你在两个不同的线程里面执行上述方法，每次在一个线程传递了一个不同的对象给anObj参数，那么每次都将会拥有它的锁，并持续处理，中间不被其他线程阻塞。然而，如果你传递的是同一个对象，那么多个线程中的一个线程会首先获得该锁，而其他线程将会被阻塞直到第一个线程完成它的临界区。<br><br>作为一种预防措施，@synchronized块隐式的添加一个异常处理例程来保护代码。该处理例程会在异常抛出的时候自动的释放互斥锁。这意味着为了使用@synchronized指令，你必须在你的代码中启用异常处理。了如果你不想让隐式的异常处理例程带来额外的开销，你应该考虑使用锁的类。<br><br>关于更多@synchronized指令的信息，参阅The Objective-C Programming Language。<br><h3>1.6.4    使用其他Cocoa锁</h3><br>以下个部分描述了使用Cocoa其他类型的锁。<br><br>&nbsp;<br><br><strong>使用NSRecursiveLock对象</strong><br><br>NSRecursiveLock类定义的锁可以在同一线程多次获得，而不会造成死锁。一个递归锁会跟踪它被多少次成功获得了。每次成功的获得该锁都必须平衡调用锁住和解锁的操作。只有所有的锁住和解锁操作都平衡的时候，锁才真正被释放给其他线程获得。<br><br>正如它名字所言，这种类型的锁通常被用在一个递归函数里面来防止递归造成阻塞线程。你可以类似的在非递归的情况下使用他来调用函数，这些函数的语义要求它们使用锁。以下是一个简单递归函数，它在递归中获取锁。如果你不在该代码里使用NSRecursiveLock对象，当函数被再次调用的时候线程将会出现死锁。<br><div align="center"></div><br><pre>NSRecursiveLock theLock = [[NSRecursiveLock alloc] init];<br><br>void MyRecursiveFunction(int value)<br>{<br>    [theLock lock];<br>    if (value != 0)<br>    {<br>        –value;<br>        MyRecursiveFunction(value);<br>    }<br>    [theLock unlock];<br>}<br><br>MyRecursiveFunction(5);</pre><br><blockquote><strong>注意：</strong><em>因为一个递归锁不会被释放直到所有锁的调用平衡使用了解锁操作，所以你必须仔细权衡是否决定使用锁对性能的潜在影响。长时间持有一个锁将会导致其他线程阻塞直到递归完成。如果你可以重写你的代码来消除递归或消除使用一个递归锁，你可能会获得更好的性能。<strong></strong></em></blockquote><br><strong> </strong><br><br><strong>使用NSConditionLock对象</strong><br><br>NSConditionLock对象定义了一个互斥锁，可以使用特定值来锁住和解锁。不要把该类型的锁和条件（参见“条件”部分）混淆了。它的行为和条件有点类似，但是它们的实现非常不同。<br><br>通常，当多线程需要以特定的顺序来执行任务的时候，你可以使用一个NSConditionLock对象，比如当一个线程生产数据，而另外一个线程消费数据。生产者执行时，消费者使用由你程序指定的条件来获取锁（条件本身是一个你定义的整形值）。当生产者完成时，它会解锁该锁并设置锁的条件为合适的整形值来唤醒消费者线程，之后消费线程继续处理数据。<br><br>NSConditionLock的锁住和解锁方法可以任意组合使用。比如，你可以使用unlockWithCondition:和lock消息，或使用lockWhenCondition:和unlock消息。当然，后面的组合可以解锁一个锁但是可能没有释放任何等待某特定条件值的线程。<br><br>下面的例子显示了生产者-消费者问题如何使用条件锁来处理。想象一个应用程序包含一个数据的队列。一个生产者线程把数据添加到队列，而消费者线程从队列中取出数据。生产者不需要等待特定的条件，但是它必须等待锁可用以便它可以安全的把数据添加到队列。<br><div align="center"></div><br><pre>id condLock = [[NSConditionLock alloc] initWithCondition:NO_DATA];<br><br>while(true)<br>{<br>    [condLock lock];<br>    /<em> Add data to the queue. </em>/<br>    [condLock unlockWithCondition:HAS_DATA];<br>}</pre><br>因为初始化条件锁的值为NO_DATA，生产者线程在初始化的时候可以毫无问题的获取该锁。它会添加队列数据，并把条件设置为HAS_DATA。在随后的迭代中，生产者线程可以把到达的数据添加到队列，无论队列是否为空或依然有数据。唯一让它进入阻塞的情况是当一个消费者线程充队列取出数据的时候。<br><br>因为消费者线程必须要有数据来处理，它会使用一个特定的条件来等待队列。当生产者把数据放入队列时，消费者线程被唤醒并获取它的锁。它可以从队列中取出数据，并更新队列的状态。下列代码显示了消费者线程处理循环的基本结构。<br><pre>while (true)<br>{<br>    [condLock lockWhenCondition:HAS_DATA];<br>    /<em> Remove data from the queue. </em>/<br>    [condLock unlockWithCondition:(isEmpty ? NO_DATA : HAS_DATA)];<br><br>    // Process the data locally.<br>}</pre><br><div align="center"></div><br>&nbsp;<br><br><strong>使用NSDistributedLock对象</strong><br><br>NSDistributedLock类可以被多台主机上的多个应用程序使用来限制对某些共享资源的访问，比如一个文件。锁本身是一个高效的互斥锁，它使用文件系统项目来实现，比如一个文件或目录。对于一个可用的NSDistributedLock对象，锁必须由所有使用它的程序写入。这通常意味着把它放在文件系统，该文件系统可以被所有运行在计算机上面的应用程序访问。<br><br>不像其他类型的锁，NSDistributedLock并没有实现NSLocking协议，所有它没有lock方法。一个lock方法将会阻塞线程的执行，并要求系统以预定的速度轮询锁。以其在你的代码中实现这种约束，NSDistributedLock提供了一个tryLock方法，并让你决定是否轮询。<br><br>因为它使用文件系统来实现，一个NSDistributedLock对象不会被释放除非它的拥有者显式的释放它。如果你的程序在用户一个分布锁的时候崩溃了，其他客户端简无法访问该受保护的资源。在这种情况下，你可以使用breadLock方法来打破现存的锁以便你可以获取它。但是通常应该避免打破锁，除非你确定拥有进程已经死亡并不可能再释放该锁。<br><br>和其他类型的锁一样，当你使用NSDistributedLock对象时，你可以通过调用unlock方法来释放它。<br><h2>1.7        使用条件</h2><br>条件是一个特殊类型的锁，你可以使用它来同步操作必须处理的顺序。它们和互斥锁有微妙的不同。一个线程等待条件会一直处于阻塞状态直到条件获得其他线程显式发出的信号。<br><br>由于微妙之处包含在操作系统实现上，条件锁被允许返回伪成功，即使实际上它们并没有被你的代码告知。为了避免这些伪信号操作的问题，你应该总是在你的条件锁里面使用一个断言。该断言是一个更好的方法来确定是否安全让你的线程处理。条件简单的让你的线程保持休眠直到断言被发送信号的线程设置了。<br><br>以下部分介绍了如何在你的代码中使用条件。<br><h3>1.7.1    使用NSCondition类</h3><br>NSCondition类提供了和POSIX条件相同的语义，但是它把锁和条件数据结构封装在一个单一对象里面。结果是一个你可以像互斥锁那样使用的对象，然后等待特定条件。<br><br>列表4-3显示了一个代码片段，它展示了为等待一个NSCondition对象的事件序列。cocaoCondition变量包含了一个NSCondition对象，而timeToDoWork变量是一个整形，它在其他线程里面发送条件信号时立即递增。<br><p align="center"><strong>Listing 4-3</strong>  Using a Cocoa condition</p><br><br><pre>[cocoaCondition lock];<br>while (timeToDoWork &lt;= 0)<br>    [cocoaCondition wait];<br><br>timeToDoWork–;<br><br>// Do real work here.<br><br>[cocoaCondition unlock];</pre><br>列表4-4显示了用于给Cocoa条件发送信号的代码，并递增他断言变量。你应该在给它发送信号前锁住条件。<br><p align="center"><strong>Listing 4-4</strong>  Signaling a Cocoa condition</p><br><br><pre>[cocoaCondition lock];<br>timeToDoWork++;<br>[cocoaCondition signal];<br>[cocoaCondition unlock];</pre><br><h3>1.7.2    使用POSIX条件</h3><br>POSIX线程条件锁要求同时使用条件数据结构和一个互斥锁。经管两个锁结构是分开的，互斥锁在运行的时候和条件结构紧密联系在一起。多线程等待某一信号应该总是一起使用相同的互斥锁和条件结构。修改该成双结构将会导致错误。<br><br>列表4-5显示了基本初始化过程，条件和断言的使用。在初始化之后，条件和互斥锁，使用ready_to_go变量作为断言等待线程进入一个while循环。仅当断言被设置并且随后的条件信号等待线程被唤醒和开始工作。<br><p align="center"><strong>Listing 4-5</strong>  Using a POSIX condition</p><br><br><pre>pthread_mutex_t mutex;<br>pthread_cond_t condition;<br>Boolean     ready_to_go = true;<br><br>void MyCondInitFunction()<br>{<br>    pthread_mutex_init(&amp;mutex);<br>    pthread_cond_init(&amp;condition, NULL);<br>}<br><br>void MyWaitOnConditionFunction()<br>{<br>    // Lock the mutex.<br>    pthread_mutex_lock(&amp;mutex);<br><br>    // If the predicate is already set, then the while loop is bypassed;<br>    // otherwise, the thread sleeps until the predicate is set.<br>    while(ready_to_go == false)<br>    {<br>        pthread_cond_wait(&amp;condition, &amp;mutex);<br>    }<br><br>    // Do work. (The mutex should stay locked.)<br><br>    // Reset the predicate and release the mutex.<br>    ready_to_go = false;<br>    pthread_mutex_unlock(&amp;mutex);<br>}</pre><br>信号线程负责设置断言和发送信号给条件锁。列表4-6显示了实现该行为的代码。在该例子中，条件被互斥锁内被发送信号来防止等待条件的线程间发生竞争条件。<br><p align="center"><strong>Listing 4-6</strong>  Signaling a condition lock</p><br><br><pre>void SignalThreadUsingCondition()<br>{<br>    // At this point, there should be work for the other thread to do.<br>    pthread_mutex_lock(&amp;mutex);<br>    ready_to_go = true;<br><br>    // Signal the other thread to begin work.<br>    pthread_cond_signal(&amp;condition);<br><br>    pthread_mutex_unlock(&amp;mutex);<br>}</pre><br><br><blockquote><strong>注意：</strong><em>上述代码是显示使用POSIX线程条件函数的简单例子。你自己的代码应该检测这些函数返回错误码并恰当的处理它们。</em></blockquote><br></div>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/02/26/zhuan-ruby-gem-ming-ling-xiang-jie/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/02/26/zhuan-ruby-gem-ming-ling-xiang-jie/" itemprop="url">
                  [转]Ruby Gem命令详解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-02-26T00:00:00+08:00">
              2014-02-26
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/02/26/zhuan-ruby-gem-ming-ling-xiang-jie/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/02/26/zhuan-ruby-gem-ming-ling-xiang-jie/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[转自]<a href="http://hi.baidu.com/mcspring/item/08545f14808bd0ddbf9042bc" target="_blank" rel="external">http://hi.baidu.com/mcspring/item/08545f14808bd0ddbf9042bc</a></p>

<p><strong>Gem介绍：</strong></p>

<p><strong></strong>Gem是一个管理Ruby库和程序的标准包，它通过Ruby Gem（如 <a href="http://rubygems.org/" target="_blank">http://rubygems.org/</a> ）源来查找、安装、升级和卸载软件包，非常的便捷。</p>

<p>Ruby 1.9.2版本默认已安装Ruby Gem，如果你使用其它发行版本，请参考“<a href="http://docs.rubygems.org/read/chapter/3" target="_blank">如何安装Ruby Gem</a>”。</p>

<p>&nbsp;</p>

<p><strong>Ruby gem包的安装方式：</strong></p>

<p><strong></strong>所有的gem包，会被安装到 /[Ruby root]/lib/ruby/gems/[ver]/ 目录下，这其中包括了Cache、doc、gems、specifications 4个目录，cache下放置下载的原生gem包，gems下则放置的是解压过的gem包。<br><br>当安装过程中遇到问题时，可以进入这些目录，手动删除有问题的gem包，然后重新运行 gem install [gemname] 命令即可。</p>

<p><strong>Ruby Gem命令详解：</strong></p>

<p><strong></strong># 更新Gem自身<br><br># 注意：在某些linux发行版中为了系统稳定性此命令禁止执行<br><br>$ gem update –system</p>

<p># 从Gem源安装gem包<br><br>$ gem install [gemname]</p>

<p># 从本机安装gem包<br><br>$ gem install -l [gemname].gem</p>

<p># 安装指定版本的gem包<br><br>$ gem install [gemname] –version=[ver]</p>

<p># 更新所有已安装的gem包<br><br>$ gem update</p>

<p># 更新指定的gem包<br><br># 注意：gem update [gemname]不会升级旧版本的包，此时你可以使用 gem install [gemname] –version=[ver]代替<br><br>$ gem update [gemname]</p>

<p># 删除指定的gem包，注意此命令将删除所有已安装的版本<br><br>$ gem uninstall [gemname]</p>

<p># 删除某指定版本gem<br><br>$ gem uninstall [gemname] –version=[ver]</p>

<p># 查看本机已安装的所有gem包<br><br>$ gem list [–local]</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar/avatar.jpg"
               alt="姜楠" />
          <p class="site-author-name" itemprop="name">姜楠</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">116</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/njiang1987" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">姜楠</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"njiang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
