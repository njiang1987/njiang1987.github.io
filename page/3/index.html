<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="天空の城">
<meta property="og:url" content="http://www.njiang.cn/page/3/index.html">
<meta property="og:site_name" content="天空の城">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天空の城">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.njiang.cn/page/3/"/>





  <title> 天空の城 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-43682645-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">天空の城</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">愤怒的程序员，梦想着有一天也能飞！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2015/04/27/-iOS-导入静态库工程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/27/-iOS-导入静态库工程/" itemprop="url">
                  [iOS]创建静态库文件简明教程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-04-27T11:41:21+08:00">
              2015-04-27
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/04/27/-iOS-导入静态库工程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/04/27/-iOS-导入静态库工程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/heliu.jpg" rel="gallery_cizqx3fli008h4htir3ox8lfk"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/heliu.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##开始<br>运行XCode，选择<code>File\New\Project</code>，当选在template的对话框的时候，选择<code>iOS\Framework &amp; Library\Cocoa Touch Static Library</code>，如下所示：<br><img src="/uploads/2015/04/27/2.png" alt=""></p>
<p>点击<code>Next</code>，再工程选项的对话框中，选择<code>ImageFilters</code>作为产品的名字。然后输入统一的公司标示还有确保<code>Use Automatic Reference Counting</code>是被选中状态，<code>Include Unit Tests</code>不是被选中状态，如下：<br><img src="/uploads/2015/04/27/3.png" alt=""></p>
<p>点击<code>Next</code>。最后，选择一个位置用来存储新的工程，然后点击<code>Create</code>。</p>
<p>##Image Filters<br>这个库是为iOS设计而且会用的UIKit，所以首先我们需要在头文件中引入UIKit。打开<code>ImageFilters.h</code> 然后添加以下代码<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#import <span class="meta-string">&lt;UIKit/UIKit.h&gt;</span></span></div></pre></td></tr></table></figure></p>
<p>接下来，在<code>@Interface ImageFilters:NSObject</code>的下面，粘贴以下声明：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">readonly</span>) <span class="built_in">UIImage</span> *originalImage;</div><div class="line">- (<span class="keyword">id</span>)initWithImage:(<span class="built_in">UIImage</span> *)image;</div><div class="line">- (<span class="built_in">UIImage</span> *)grayScaleImage;</div><div class="line">- (<span class="built_in">UIImage</span> *)oldImageWithIntensity:(<span class="built_in">CGFloat</span>)level;</div></pre></td></tr></table></figure></p>
<p>这些头文件中的声明，定义了这个类的公共的接口。接下来是添加实现。打开<code>ImageFilters.m</code>，然后粘贴以下代码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ImageFilters</span>()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">CIContext</span>  *context;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>,<span class="keyword">strong</span>) <span class="built_in">CIImage</span>    *beginImage;</div><div class="line"> </div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)initWithImage:(<span class="built_in">UIImage</span> *)image</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</div><div class="line">        _originalImage  = image;</div><div class="line">        _context        = [<span class="built_in">CIContext</span> contextWithOptions:<span class="literal">nil</span>];</div><div class="line">        _beginImage     = [[<span class="built_in">CIImage</span> alloc] initWithImage:_originalImage];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (<span class="built_in">UIImage</span>*)imageWithCIImage:(<span class="built_in">CIImage</span> *)ciImage</div><div class="line">&#123;</div><div class="line">    <span class="built_in">CGImageRef</span> cgiImage = [<span class="keyword">self</span>.context createCGImage:ciImage fromRect:ciImage.extent];</div><div class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithCGImage:cgiImage];</div><div class="line">    <span class="built_in">CGImageRelease</span>(cgiImage);</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> image;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (<span class="built_in">UIImage</span> *)grayScaleImage</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( !<span class="keyword">self</span>.originalImage)</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line"> </div><div class="line">    <span class="built_in">CIImage</span> *grayScaleFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorControls"</span> keysAndValues:kCIInputImageKey, <span class="keyword">self</span>.beginImage, <span class="string">@"inputBrightness"</span>, [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">0.0</span>], <span class="string">@"inputContrast"</span>, [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">1.1</span>], <span class="string">@"inputSaturation"</span>, [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">0.0</span>], <span class="literal">nil</span>].outputImage;</div><div class="line"> </div><div class="line">    <span class="built_in">CIImage</span> *output = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIExposureAdjust"</span> keysAndValues:kCIInputImageKey, grayScaleFilter, <span class="string">@"inputEV"</span>, [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">0.7</span>], <span class="literal">nil</span>].outputImage;</div><div class="line"> </div><div class="line">    <span class="built_in">UIImage</span> *filteredImage = [<span class="keyword">self</span> imageWithCIImage:output];</div><div class="line">    <span class="keyword">return</span> filteredImage;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (<span class="built_in">UIImage</span> *)oldImageWithIntensity:(<span class="built_in">CGFloat</span>)intensity</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span>( !<span class="keyword">self</span>.originalImage )</div><div class="line">        <span class="keyword">return</span> <span class="literal">nil</span>;</div><div class="line"> </div><div class="line">    <span class="built_in">CIFilter</span> *sepia = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CISepiaTone"</span>];</div><div class="line">    [sepia setValue:<span class="keyword">self</span>.beginImage forKey:kCIInputImageKey];</div><div class="line">    [sepia setValue:@(intensity) forKey:<span class="string">@"inputIntensity"</span>];</div><div class="line"> </div><div class="line">    <span class="built_in">CIFilter</span> *random = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIRandomGenerator"</span>];</div><div class="line"> </div><div class="line">    <span class="built_in">CIFilter</span> *lighten = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIColorControls"</span>];</div><div class="line">    [lighten setValue:random.outputImage forKey:kCIInputImageKey];</div><div class="line">    [lighten setValue:@(<span class="number">1</span> - intensity) forKey:<span class="string">@"inputBrightness"</span>];</div><div class="line">    [lighten setValue:@<span class="number">0.0</span> forKey:<span class="string">@"inputSaturation"</span>];</div><div class="line"> </div><div class="line">    <span class="built_in">CIImage</span> *croppedImage = [lighten.outputImage imageByCroppingToRect:[<span class="keyword">self</span>.beginImage extent]];</div><div class="line"> </div><div class="line">    <span class="built_in">CIFilter</span> *composite = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIHardLightBlendMode"</span>];</div><div class="line">    [composite setValue:sepia.outputImage forKey:kCIInputImageKey];</div><div class="line">    [composite setValue:croppedImage forKey:kCIInputBackgroundImageKey];</div><div class="line"> </div><div class="line">    <span class="built_in">CIFilter</span> *vignette = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIVignette"</span>];</div><div class="line">    [vignette setValue:composite.outputImage forKey:kCIInputImageKey];</div><div class="line">    [vignette setValue:@(intensity * <span class="number">2</span>) forKey:<span class="string">@"inputIntensity"</span>];</div><div class="line">    [vignette setValue:@(intensity * <span class="number">30</span>) forKey:<span class="string">@"inputRadius"</span>];</div><div class="line"> </div><div class="line">    <span class="built_in">UIImage</span> *filteredImage = [<span class="keyword">self</span> imageWithCIImage:vignette.outputImage];</div><div class="line"> </div><div class="line">    <span class="keyword">return</span> filteredImage;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在，我们就有了一个包含3个公共接口<code>ImageFilters</code>类：<br><code>initWithImage</code>:用来出事话滤镜类<br><code>grayScaleImage</code>:创建灰度的图片<br><code>oldImageWithIntensity</code>:用来创建旧照片的类</p>
<p>现在编译然后运行这个库，XCode会生成的并不是<code>.app</code>或者<code>.ipa</code>文件，而是生成了一个<code>.a</code>后缀名的静态库。你可以再<code>Products</code>的文件夹地下找到这个文件。你可以通过右击再Finder显示用来查看这个文件：</p>
<p><img src="/uploads/2015/04/27/4.png" alt=""></p>
<p>用XCode打开这个文件夹，你可以看到如下的结构：<br><img src="/uploads/2015/04/27/5.png" alt=""></p>
<p>这个静态库一共包含2个部分：<br><code>Header files</code>:在<code>Include</code>文件夹地下，你可以找到公有的头文件。<br><code>Binary Library</code>:静态库文件</p>
<p>如果需要用的时候，需要将这2部分都要导入到工程文件里面；你可以简单的将framework的头文和代码连结到工程里面。</p>
<p>默认情况下，这个库文件只编译支持当前的结构。如果你编译的模拟器的版本，这个库会包含支持i386结构的代码；如果编译的是真机的版本，库的代码只支持ARM的架构。如果你需要两个版本的库，接下来就需要做如下步骤</p>
<p>##通用的文件（Universal Binaries）<br>一个通用的库文件是一个特殊类型的二进制文件，包含了多个平台的代码。可以用<code>lipo</code>工具来生成通用的库文件。</p>
<p><code>lipo</code>是一个命令行的工具，它允许你针对通用的文件做些修改（创建通用的二进制文件，连结通用文件的内容或者更多）。</p>
<p>一个集合的工程，可以用来调用命令行的脚本，在菜单中选择<code>File/New/Target</code>，选择<code>iOS/Other</code>然后选择<code>Aggregate</code>,如下所示：<br><img src="/uploads/2015/04/27/6.png" alt=""></p>
<p>将这个目标工程命名为<code>UniversalLib</code>，确保选中的工程是<code>ImageFilters</code>，如下所示：<br><img src="/uploads/2015/04/27/7.png" alt=""></p>
<p>点击<code>ImageFilters</code>的工程，然后选择<code>UniversalLib</code>的目标工程，切换到<code>Build Phases</code>选项卡；这就是用来设置编译工程所用的脚本文件的地方。</p>
<p>点击<code>Add Build Phase</code>按钮，然后选择<code>Add Run Script</code>：<br><img src="/uploads/2015/04/27/8.png" alt=""></p>
<p>现在你可以设置一个脚本文件，展开<code>Run Script</code>模块，然后再Shell命令行里面粘贴一下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># define output folder environment variable</div><div class="line">UNIVERSAL_OUTPUTFOLDER=$&#123;BUILD_DIR&#125;/$&#123;CONFIGURATION&#125;-universal</div><div class="line"> </div><div class="line"># Step 1. Build Device and Simulator versions</div><div class="line">xcodebuild -target ImageFilters ONLY_ACTIVE_ARCH=NO -configuration $&#123;CONFIGURATION&#125; -sdk iphoneos  BUILD_DIR=&quot;$&#123;BUILD_DIR&#125;&quot; BUILD_ROOT=&quot;$&#123;BUILD_ROOT&#125;&quot;</div><div class="line">xcodebuild -target ImageFilters -configuration $&#123;CONFIGURATION&#125; -sdk iphonesimulator -arch i386 BUILD_DIR=&quot;$&#123;BUILD_DIR&#125;&quot; BUILD_ROOT=&quot;$&#123;BUILD_ROOT&#125;&quot;</div><div class="line"> </div><div class="line"># make sure the output directory exists</div><div class="line">mkdir -p &quot;$&#123;UNIVERSAL_OUTPUTFOLDER&#125;&quot;</div><div class="line"> </div><div class="line"># Step 2. Create universal binary file using lipo</div><div class="line">lipo -create -output &quot;$&#123;UNIVERSAL_OUTPUTFOLDER&#125;/lib$&#123;PROJECT_NAME&#125;.a&quot; &quot;$&#123;BUILD_DIR&#125;/$&#123;CONFIGURATION&#125;-iphoneos/lib$&#123;PROJECT_NAME&#125;.a&quot; &quot;$&#123;BUILD_DIR&#125;/$&#123;CONFIGURATION&#125;-iphonesimulator/lib$&#123;PROJECT_NAME&#125;.a&quot;</div><div class="line"> </div><div class="line"># Last touch. copy the header files. Just for convenience</div><div class="line">cp -R &quot;$&#123;BUILD_DIR&#125;/$&#123;CONFIGURATION&#125;-iphoneos/include&quot; &quot;$&#123;UNIVERSAL_OUTPUTFOLDER&#125;/&quot;</div></pre></td></tr></table></figure></p>
<p>以上脚本所做的工作如下：</p>
<ul>
<li><code>UNIVERSAL_OUTPUTFOLDER</code>表示导出库文件的文件夹位置“Debug-universal”</li>
<li><code>Step 1</code> 在第2行，你可以调用<code>xcodebuild</code>去编译ARM平台的二进制(<code>-sdk iphoneos</code>)</li>
<li>接下来一行再次调用<code>xcodebuild</code>，去编译用在模拟器上的库文件，这个关键参数就是<code>-sdk iphonesimulator -arch i386</code>。</li>
<li><code>Step 2</code> 现在你已经有了2个后缀名为<code>.a</code>的库文件，现在你只需要调用<code>lipo -create</code>去创建一个通用的库文件。</li>
<li>最后一行，用命令<code>cp</code>，将头文件复制到通用文件夹地下</li>
</ul>
<p>最后shell脚本窗口如下所示：<br><img src="/uploads/2015/04/27/9.png" alt=""></p>
<p>现在你可以编译通用的库文件了，选择目标工程<code>UniversalLib</code>,<br><img src="/uploads/2015/04/27/10.png" alt=""></p>
<p>点击<code>Play</code>按钮。如果想看结果，可以用<code>Show in Finder</code>，然后切换到Finder的列选项视窗，你会看到一个文件夹叫做<code>Debug-Universal</code>或者是<code>Release-Universal</code>。<br><img src="/uploads/2015/04/27/11.png" alt=""></p>
<p>以上就是创建通用静态库的所有步骤。如果想在你的工程中调用这个静态库文件，需要做如下步骤：</p>
<p>##程序中调用静态库<br>从库中调用<code>ImageFilters</code>和直接从源代码调用它，没有太大区别：你需要引入这个头文件，然后用它就可以了。现在关键问题是，XCode不知道这个头文件和二进制文件在什么地方。</p>
<p>这里有2个方法将库文件引入到工程里面：</p>
<ul>
<li><code>方法一</code>：添加头文件和二进制文件的引用(<code>.a</code>)</li>
<li><code>方法二</code>：将库工程添加到当前工程作为子工程</li>
</ul>
<p>###引用头文件和库的二进制文件<br>你可以从这里<a href="/uploads/2015/04/27/CoreImageFun.staticlib.zip">CoreImageFun</a>下载这个工程。等你压缩玩这个文件，你可以看到如下结构：<br><img src="/uploads/2015/04/27/12.png" alt=""></p>
<p>打开这个工程，然后编译运行这个程序，你会看到如下错误：<br><img src="/uploads/2015/04/27/13.png" alt=""></p>
<p>这个错误是因为程序不知道从哪里寻找头文件，为了解决这个问题，你需要在<code>Header Search Path</code>添加头文件所在的位置。</p>
<p>如下图所示，点击工程的根节点，然后选择<code>CoreImageFun</code>，然后选择<code>Build Settings</code>，然后定位到<code>Header Search Paths</code>。<br><img src="/uploads/2015/04/27/14.png" alt=""></p>
<p>双击<code>Header Search Paths</code>，再弹窗里面点击<code>+</code>按钮，然后填入如下代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$SOURCE_ROOT/include</div></pre></td></tr></table></figure></p>
<p>如下图所示：<br><img src="/uploads/2015/04/27/15.png" alt=""></p>
<p><code>$SOURCE_ROOT</code>是XCode的运行变量，这个指向工程的根目录。取消掉弹窗，你会看到如下的结果：<br><img src="/uploads/2015/04/27/16.png" alt=""></p>
<p>编译运行程序，你会看到如下链接错误：<br><img src="/uploads/2015/04/27/17.png" alt=""></p>
<p>这个错误的原因，是因为你没有告诉XCode去哪里查找这个库文件。按照如下的截图，回到<code>CoreImageFun</code>的<code>Build Settings</code>，选择<code>Build Phases</code>选项卡，然后展开<code>Link Binary With Libraries</code>，点击<code>+</code>按钮。<br><img src="/uploads/2015/04/27/18.png" alt=""></p>
<p>在弹出的窗口里面，选择<code>Add Other...</code>按钮，然后找到<code>libImageFilters.a</code>的库文件，<br><img src="/uploads/2015/04/27/19.png" alt=""></p>
<p>当所有的设置完成以后，设置的内容如下：<br><img src="/uploads/2015/04/27/20.png" alt=""></p>
<p>最后一步是添加链接的标签<code>-Objc</code>。链接器为了效率考虑，只会引入必要的代码，所以有时会屏蔽静态库文件。用这个标签，可以导入库中所有的类，关于更多细节，可以参考苹果的文档<a href="http://developer.apple.com/library/mac/#qa/qa1490/_index.html" target="_blank" rel="external">Technical Q&amp;A QA1490</a></p>
<p>点击<code>Build Settings</code>选项卡，定位到<code>Other linker Flags</code>，如下所示：<br><img src="/uploads/2015/04/27/21.png" alt=""></p>
<p>在弹出框中，点击<code>+</code>,输入<code>-Objc</code>,如下图所示：<br><img src="/uploads/2015/04/27/22.png" alt=""></p>
<p>最后你可以编译运行你的程序了。</p>
<p>###作为子工程<br>关于这个部分的教程，你可以在这里<a href="/uploads/2015/04/27/CoreImageFun.subproject.zip">CoreImageFun</a>下载工程。解压完以后，如下图所示：<br><img src="/uploads/2015/04/27/23.png" alt=""></p>
<p>在开始之前，你可以先编译运行一下这个工程，会报如下错误：<br><img src="/uploads/2015/04/27/24.png" alt=""></p>
<p>接下来需要将库的工程导入到当前工程，你需要将库工程拖拽到当前工程，如果库工程已经再XCode中打开，这一步就会失败。如下图所示：<br><img src="/uploads/2015/04/27/25.png" alt=""></p>
<p>完成以上操作，你就可以看到如下的结构：<br><img src="/uploads/2015/04/27/26.png" alt=""></p>
<p>接下来，就需要让XCode知道这个库工程，你需要添加工程依赖关系。这就意味着，在编译主程序之前，XCode需要先保证这个库是最新的。</p>
<p>点击工程的根节点，然后选择<code>CoreImageFun</code>，然后点击<code>Build Phases</code>，然后展开<code>Target Dependencies</code>，如下图所示：<br><img src="/uploads/2015/04/27/27.png" alt=""></p>
<p>点击<code>+</code>按钮，然后添加新的依赖关系，如下图所示，确保选中的<code>ImageFilters</code>，<br><img src="/uploads/2015/04/27/28.png" alt=""></p>
<p>添加完成以后，依赖关如下图所示：<br><img src="/uploads/2015/04/27/29.png" alt=""></p>
<p>最后一步，配置工程，让程序链接这个静态库，展开<code>Link Binary With Libraries</code>，然后点击<code>+</code>，如下图所示：<br><img src="/uploads/2015/04/27/30.png" alt=""></p>
<p>选择<code>libImageFilters.a</code>,然后点击<code>Add</code>：<br><img src="/uploads/2015/04/27/31.png" alt=""></p>
<p>添加完成之后，<code>Link Binary with Libraries</code>应该如下图所示：<br><img src="/uploads/2015/04/27/32.png" alt=""></p>
<p>跟第一种方法一样，需要添加链接标签<code>-ObjC</code>，点击<code>Build Settings</code>然后定位到<code>Other linker Flags</code>，如下图所示：<br><img src="/uploads/2015/04/27/33.png" alt=""></p>
<p>这就是怎样制作以及添加静态库文件。</p>
<p>原文地址：<a href="http://www.raywenderlich.com/41377/creating-a-static-library-in-ios-tutorial" target="_blank" rel="external">http://www.raywenderlich.com/41377/creating-a-static-library-in-ios-tutorial</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2015/03/16/-iOS-如何创建证书/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/03/16/-iOS-如何创建证书/" itemprop="url">
                  [iOS]如何创建证书
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2015-03-16T11:30:36+08:00">
              2015-03-16
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/03/16/-iOS-如何创建证书/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/03/16/-iOS-如何创建证书/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/heliu.jpg" rel="gallery_cizqx3flh008e4hti0pkq30xe"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/heliu.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>近期在做Apple Watch的项目，需要在iServer上面安装相应地证书以及应用HTTPS来搭建信任的链接。现在主要是用到了OpenSSL来创建证书。分以下步骤：</p>
<p>##创建自己的证书颁发机构（CA）<br>使用自签名证书会有这样的问题：需要为每台设备中用到的每个证书设置相关的信任关系。有一个解决办法就是创建自己的证书颁发机构(CA)根证书，然后基于该根证书创建别的证书。<br>这样一来就是自己扮演着CA，取代了商业性质的CA。这样做的好处就是自己的CA证书只需要在每台设备上安装一次即可。之后，设备会自动的信任基于CA根证书创建的证书。<br>创建CA证书只需要两个步骤即可，首先是创建私钥文件(跟之前的一样)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl genrsa -out myCA.key 2048</div></pre></td></tr></table></figure></p>
<p>然后是创建证书：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl req -x509 -new -key myCA.key -out myCA.cer -days 730 -subj /CN=10.197.32.112</div></pre></td></tr></table></figure></p>
<blockquote>
<p>其中10.197.32.112是所要签名的主机名或IP地址</p>
</blockquote>
<p>上面创建的证书(myCA.key)可以公开发布出去，并安装在iOS或者其它OS上，以此当做内置的受信任根CA。自制的CA证书存储在General-&gt;Settings-&gt;Profile：<br><img src="/uploads/2015/03/16/IMG_0006.jpg" alt=""></p>
<p>##创建私有证书<br>其中私钥文件(myCA.key)只用是再创建新的SSL证书时使用。<br>上面的CA创建好之后，我们可以基于该证书创建许多证书。注意，这里多了一个步骤：必须创建一个CSR(客户端证书请求文件)——就像购买商业的SSL证书一样。<br>首先需要创建一个私钥文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl genrsa -out mycert1.key 2048</div></pre></td></tr></table></figure></p>
<p>然后是创建CSR:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl req -new -out mycert1.req -key mycert1.key -subj /CN=10.197.32.112</div></pre></td></tr></table></figure></p>
<p>接着用这个CSR创建证书：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl x509 -req -in mycert1.req -out mycert1.cer -CAkey myCA.key -CA myCA.cer -days 365 -CAcreateserial -CAserial serial</div></pre></td></tr></table></figure></p>
<p>在Apache服务器上面可以直接使用私钥和证书文件(做相关的SSL配置即可)。在IIS中需要一个PFX文件，通过该文件，可以将证书导入至IIS的Server Certificates中。当然通过OpenSSL可以创建PFX文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -export -out mycert1.pfx -inkey mycert1.key -in mycert1.cer</div></pre></td></tr></table></figure></p>
<p>摘自：<a href="http://beyondvincent.com/2014/03/17/2014-03-17-five-tips-for-using-self-signed-ssl-certificates-with-ios/" target="_blank" rel="external">http://beyondvincent.com/2014/03/17/2014-03-17-five-tips-for-using-self-signed-ssl-certificates-with-ios/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/12/01/-iOS-探究iOS-Block编程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/12/01/-iOS-探究iOS-Block编程/" itemprop="url">
                  [iOS]探究iOS Block编程
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-12-01T16:43:32+08:00">
              2014-12-01
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/12/01/-iOS-探究iOS-Block编程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/12/01/-iOS-探究iOS-Block编程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/heliu.jpg" rel="gallery_cizqx3flf008b4htiq88x0yob"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/heliu.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##开始使用Block<br>需要用<code>^</code>来生命一个block，如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> multiplier = <span class="number">7</span>;</div><div class="line"><span class="keyword">int</span> (^myBlock)(<span class="keyword">int</span>) = ^(<span class="keyword">int</span> num) &#123;</div><div class="line">    <span class="keyword">return</span> num * multiplier;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p><img src="/uploads/2014/12/01/blocks.jpg" alt=""></p>
<p>###直接使用Block<br>代码如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">char</span> *myCharacters[<span class="number">3</span>] = &#123; <span class="string">"TomJohn"</span>, <span class="string">"George"</span>, <span class="string">"Charles Condomine"</span> &#125;;</div><div class="line"> </div><div class="line">qsort_b(myCharacters, <span class="number">3</span>, <span class="keyword">sizeof</span>(<span class="keyword">char</span> *), ^(<span class="keyword">const</span> <span class="keyword">void</span> *l, <span class="keyword">const</span> <span class="keyword">void</span> *r) &#123;</div><div class="line">    <span class="keyword">char</span> *left = *(<span class="keyword">char</span> **)l;</div><div class="line">    <span class="keyword">char</span> *right = *(<span class="keyword">char</span> **)r;</div><div class="line">    <span class="keyword">return</span> strncmp(left, right, <span class="number">1</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>###Cocoa中的Block<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSComparator</span> finderSortBlock = ^(<span class="keyword">id</span> string1, <span class="keyword">id</span> string2) &#123;</div><div class="line"> </div><div class="line">    <span class="built_in">NSRange</span> string1Range = <span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [string1 length]);</div><div class="line">    <span class="keyword">return</span> [string1 compare:string2 options:comparisonOptions range:string1Range locale:currentLocale];</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="built_in">NSArray</span> *finderSortArray = [stringsArray sortedArrayUsingComparator:finderSortBlock];</div></pre></td></tr></table></figure></p>
<p>###__block修饰符<br>block里面可以修改外面的变量。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">__block <span class="built_in">NSUInteger</span> orderedSameCount = <span class="number">0</span>;</div><div class="line"><span class="built_in">NSArray</span> *diacriticInsensitiveSortArray = [stringsArray sortedArrayUsingComparator:^(<span class="keyword">id</span> string1, <span class="keyword">id</span> string2) &#123;</div><div class="line"> </div><div class="line">    <span class="built_in">NSRange</span> string1Range = <span class="built_in">NSMakeRange</span>(<span class="number">0</span>, [string1 length]);</div><div class="line">    <span class="built_in">NSComparisonResult</span> comparisonResult = [string1 compare:string2 options:<span class="built_in">NSDiacriticInsensitiveSearch</span> range:string1Range locale:currentLocale];</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> (comparisonResult == <span class="built_in">NSOrderedSame</span>) &#123;</div><div class="line">        orderedSameCount++;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> comparisonResult;</div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<p>##Block的概念<br>Block再其他语言中，也被称为闭包”Closure”。</p>
<p>###Block的函数功能</p>
<ol>
<li>有类型参数，就跟函数一样。</li>
<li>有内涵的或声明的返回参数。</li>
<li>可以根据词汇声明的范围，知道其状态。</li>
<li>可以修改当前的状态。</li>
<li>可以共享</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">永远都要顺着趋势</div><div class="line">价格不会高到不能买进，也不会低到不能卖出</div><div class="line">始终要用止损单</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">按照小时的K线，找出趋势线，还要查看角度趋势线</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/28/-iOS-探究iOS并行编程（二）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/28/-iOS-探究iOS并行编程（二）/" itemprop="url">
                  [iOS]探究iOS并行编程（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-28T11:26:28+08:00">
              2014-11-28
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/28/-iOS-探究iOS并行编程（二）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/28/-iOS-探究iOS并行编程（二）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/heliu.jpg" rel="gallery_cizqx3fld00884hti7k4yq6gx"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/heliu.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Dispatch Queues<br>创建并管理Dispatch Queue：<br>获取全局的并行队列：系统会提供4个全局的并行队列，可以通过<code>dispatch_get_global_queue</code>来获取，<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> aQueue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div></pre></td></tr></table></figure></p>
<p>后面可以指定优先级的全局队列，<code>DISPATCH_QUEUE_PRIORITY_HIGH</code>, <code>DISPATCH_QUEUE_PRIORITY_LOW</code>和<code>DISPATCH_QUEUE_PRIORITY_BACKGROUND</code>。</p>
<p>创建串行的队列：<br>可以用串行的队列来替代锁来保护共享的资源或可更改数据结构。必须显式的创建和管理队列，<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue;</div><div class="line">queue = dispatch_queue_create(<span class="string">"com.example.MyQueue"</span>, <span class="literal">NULL</span>);</div></pre></td></tr></table></figure></p>
<p>运行时获取普通队列：<br><code>dispatch_get_current_queue</code>获取当前队列，如果在block里面执行，会获取block所在的队列。<br><code>dispatch_get_main_queue</code>获取程序的主进程。<br><code>dispatch_get_global_queue</code>用来获取全局的并行队列。</p>
<p>保存Context信息：<br>所有dispatch的东西，都可以通过<code>dispatch_set_context</code>和<code>dispatch_get_context</code>来保存信息。</p>
<p>为队列提供清理函数：<br>用<code>dispatch_set_finalizer_f</code>设置清理函数，</p>
<p>###向队列添加任务<br>分同步和异步两种方式添加任务。<br>异步：<code>dispatch_async</code>和<code>dispatch_async_f</code>，同步：<code>dispatch_sync</code>和<code>dispatch_sync_f</code></p>
<p>可以并行运行循环：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line">dispatch_apply(count, queue, ^(size_t i) &#123;</div><div class="line">   printf(<span class="string">"%u\n"</span>,i);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>监听文件系统：<br>可以利用<code>DISPATCH_SOURCE_TYPE_VNODE</code>来监听文件系统，获取修改的消息（删除，写入，重命名）。一般来说，程序会用<code>sigaction</code>函数来添加信号处理的函数，这个是与信号是同步的。不能异步的处理dispatch sources。</p>
<p>监视进程：<br>父进程可以利用dispatch source监视其子进程。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">MonitorParentProcess</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">   <span class="keyword">pid_t</span> parentPID = getppid();</div><div class="line"> </div><div class="line">   <span class="keyword">dispatch_queue_t</span> <span class="built_in">queue</span> = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line">   <span class="keyword">dispatch_source_t</span> source = dispatch_source_create(DISPATCH_SOURCE_TYPE_PROC,</div><div class="line">                                                      parentPID, DISPATCH_PROC_EXIT, <span class="built_in">queue</span>);</div><div class="line">   <span class="keyword">if</span> (source)</div><div class="line">   &#123;</div><div class="line">      dispatch_source_set_event_handler(source, ^&#123;</div><div class="line">         MySetAppExitFlag();</div><div class="line">         dispatch_source_cancel(source);</div><div class="line">         dispatch_release(source);</div><div class="line">      &#125;);</div><div class="line">      dispatch_resume(source);</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###取消Dispatch Source<br>必须要用<code>dispatch_source_cancel</code>去显示的取消他们，必须立即释放他们，因为他们不会触发事件。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> RemoveDispatchSource(dispatch_source_t mySource)</div><div class="line">&#123;</div><div class="line">   dispatch_source_cancel(mySource);</div><div class="line">   dispatch_release(mySource);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>取消的操作是异步的。虽然取消source以后，不会触发任何事件，但是正在执行的会运行完毕。可以用取消的函数来清理内存或者其他资源。</p>
<p>###挂起和恢复Dispatch source<br>可以用<code>dispatch_suspend</code>和<code>dispatch_resume</code>，2个函数调用必须平衡。在队列挂起的时候，触发的事件会放到队列里面，直到source再次被唤醒。</p>
<p>##替换Thread的方法<br>运用dispatch queue和operation queue的优点：</p>
<ol>
<li>减小内存使用</li>
<li>根据code的大小来创建和配置线程</li>
<li>评估code，然后去管理和调配任务</li>
<li>简化代码</li>
</ol>
<p>如果用线程的话，有以下情形：</p>
<ol>
<li>单个线程：等任务完成，就要释放这个线程。</li>
<li>工作线程：可以创建一个或多个工作线程。</li>
<li>线程池：创建一个线程池，然后为每个线程创建一个循环。当有新任务，选择一个线程然后指派任务给它。如果没有空得线程，就将任务添加到队列里面，然后等待有空得线程。</li>
</ol>
<p>可以用queue来替换lock：</p>
<ol>
<li>如果任务执行需要特定的顺序，将他们添加到串行的队列里面。</li>
<li>如果用lock来保护资源，可以创建一个串行的队列来执行修改资源的任务。</li>
<li>如果需要等待背景任务完成，可以用dispatch group。或者用NSblockOperation来设置完成的函数。</li>
<li>如果实现生产者-消费者模型来空值资源，可以考虑改变<a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/ConcurrencyProgrammingGuide/ThreadMigration/ThreadMigration.html#//apple_ref/doc/uid/TP40008091-CH105-SW7" target="_blank" rel="external">生产者消费者的实现</a>。</li>
<li>如果用线程来读写或者监视文件操作，可以用<a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/ConcurrencyProgrammingGuide/GCDWorkQueues/GCDWorkQueues.html#//apple_ref/doc/uid/TP40008091-CH103-SW1" target="_blank" rel="external">dispatch source</a></li>
</ol>
<p>###消除基于锁的代码<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_async</span>(obj-&gt;serial_queue, ^&#123;</div><div class="line">   <span class="comment">// Critical section</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>串行执行关键代码：<br><code>dispatch_sync</code>会将代码添加到dispatch队列中，并将现在执行的thread停调。这个队列，即可以是串行的，也可以是并行的。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_sync</span>(my_queue, ^&#123;</div><div class="line">   <span class="comment">// Critical section</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>###改善循环代码<br>可以考虑用<code>dispatch_apply</code>或者<code>dispatch_apply_f</code>，这两个函数会将循环中得每个iterator添加到dispatch队列中。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line">dispatch_apply(count, queue, ^(size_t i) &#123;</div><div class="line">   printf(<span class="string">"%u\n"</span>, i);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>可以再每个block里面执行更大跨度的代码。例如：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> stride = <span class="number">137</span>;</div><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</div><div class="line"> </div><div class="line">dispatch_apply(count / stride, queue, ^(size_t idx)&#123;</div><div class="line">    size_t j = idx * stride;</div><div class="line">    size_t j_stop = j + stride;</div><div class="line">    <span class="keyword">do</span> &#123;</div><div class="line">       printf(<span class="string">"%u\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)j++);</div><div class="line">    &#125;<span class="keyword">while</span> (j &lt; j_stop);</div><div class="line">&#125;);</div><div class="line"> </div><div class="line">size_t i;</div><div class="line"><span class="keyword">for</span> (i = count - (count % stride); i &lt; count; i++)</div><div class="line">   printf(<span class="string">"%u\n"</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i);</div></pre></td></tr></table></figure></p>
<p>###替换链接线程<br>可以用dispatch groups来完成类似链接线程的工作，dispatch group会等待所有子任务同时完成，因为是用得dispatch queue，所以效率非常高。</p>
<p>如果用dispatch group，需要做如下工作：</p>
<ol>
<li>创建一个新的dispatch group，<code>dispatch_group_create</code>。</li>
<li>往group里面添加任务，<code>dispatch_group_async</code>或<code>dispatch_group_async_f</code>。</li>
<li>如果当前线程等待group完成，<code>dispatch_group_wait</code>。</li>
</ol>
<p>###改变生产者-消费者实现<br>运用条件，生产者的线程做如下事情：</p>
<ol>
<li>锁住跟条件有关的互斥锁(<code>pthread_mutex_lock</code>)。</li>
<li>生产一些资源。</li>
<li>给这个条件变量法消息（<code>pthread_cond_signal</code>）。</li>
<li>释放互斥锁(<code>pthread_mutex_unlock</code>)。</li>
</ol>
<p>相反，对应的消费者需要做如下工作：</p>
<ol>
<li>锁住条件相关的互斥锁(<code>pthread_mutex_lock</code>)。</li>
<li>设置一个<code>while</code>的循环，做如下事情：<br> a. 查看是否有任务需要做<br> b. 如果没有任务，调用<code>pthread_cond_wait</code>锁住当前的线程，知道有一个信号出现。</li>
<li>获取提供者提供的任务。</li>
<li>解锁互斥锁(<code>pthread_mutex_unlock</code>)。</li>
<li>执行这个任务。</li>
</ol>
<p>如果是用dispatch queue，就可以用如下代码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</div><div class="line">   <span class="comment">// Process a work item.</span></div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/27/-iOS-探究iOS并行编程/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/27/-iOS-探究iOS并行编程/" itemprop="url">
                  [iOS]探究iOS并行编程（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-27T14:36:40+08:00">
              2014-11-27
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/27/-iOS-探究iOS并行编程/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/27/-iOS-探究iOS并行编程/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/heliu.jpg" rel="gallery_cizqx3flc00854htiycz1qjac"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/heliu.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##术语解释：<br>线程：用来表示炉里运行的代码块，OS X底层实现是基于POSIX协议。<br>进程：用来表示可以运行的代码，它可以包含多个线程。<br>任务：用来表示抽象的工作。</p>
<p>##并行程序设计<br>一般实现并行编码都是通过多核去创建多个线程，但是随着核数增加，线程可能分配的不够均匀。不像线程，OS X和iOS利用asynchronous design approach方法来解决并行问题。一般来说，需要背景线程，然后再背景线程做哪些工作，做完以后，再发一个notification告诉调用者（通常来说是一个回调函数）。</p>
<p>其中一种创建异步任务的技术就是Grand Central Dispatch (GCD)。GCD负责负责线程的管理工作，由于GCD体统了全局的方法来管理任务调度和执行，所以会比传统的线程更有效。</p>
<p>Operation queues是Objective-C的类，与dispatch queue很类似。</p>
<p>###Dispatch Queues<br>Dispatch Queues总是按照先进先出的顺序执行，它即可以并行又可以串行。有以下几个优点：</p>
<ol>
<li>提供简单的借口可以调用</li>
<li>提供自动的整体的线程池来管理</li>
<li>提供运行速度的信息</li>
<li>更好的利用内存（线程的栈是不在程序的内存块中）</li>
<li>运行时不会阻塞kernel</li>
<li>分派的任务，不会让队列死锁</li>
<li>串行的队列提供了更效率的阻塞方案</li>
</ol>
<p>在队列中得任务必须放在一个函数或者block中。当提交一个block进入队列的时候，会copy一份出来到堆上面。</p>
<p>###Dispatch Sources<br>Dispatch Sources是基于C语言的，用来异步处理系统的事件。Dispatch Sources可以封装系统事件信息，当事件发生时，提交一个block或函数到dispatch queue。可以监听以下系统事件：</p>
<ol>
<li>Timers - 时间</li>
<li>Signal handlers - 信号</li>
<li>Discriptor-related events - 描述相关事件</li>
<li>Process-related events - 进程相关事件</li>
<li>Mach port events - 相关端口事件</li>
<li>Custom events - 自定义事件</li>
</ol>
<p>###Operation Queues<br>Operation Queues是Cocoa的，等价于并行dispatch queue。提交到Operation Queues的必须是NSOperation类型的实例。Operation Object会触发KVO notifications。可以用来监视任务进度。</p>
<p>###异步设计技术</p>
<p>首先，需要知道开始的任务，还需要考虑到其他事件，比如timer-based任务。然后将任务分成小块，还需要注意不同任务间的依赖关系。<br>其次要确定每个子任务的依赖关系，确定需要执行的队列。</p>
<p>###其他技术<br>在OS X里面，Open Computing Language (OpenCL)是运用电脑显卡进行并行计算的技术。如果需要更好的控制代码在背景线程运行的时机，线程还是一个很好地选择。</p>
<p>##Operation Queues<br>在Foundation framework中，有如下几种Operation：</p>
<ol>
<li>NSINvocationOperation</li>
<li>NSBlockOperation</li>
<li>NSOPeration<br>以上operation都会支持一下特性：</li>
<li>支持基于graph操作的依赖关系。</li>
<li>支持定义结束的block。</li>
<li>支持监视操作的执行状态。</li>
<li>支持定义操作的优先级。</li>
<li>支持取消操作。</li>
</ol>
<p>###并行VS非并行<br>NSOperation里面有个函数<code>isConcurrent</code>，表明此operation是并行的还是非并行的。如果这个函数返回no，直接调用start函数，那么此操作还是串行的。<br>默认的，如果一个操作添加到了队列里面，这个队列会创建一个线程去调用这些操作的start函数。因此，一个非并行的操作添加到队列里面，还是可以非并行执行。</p>
<p>###创建NSInvocationOperation<br><code>INSInvocationOperation</code>可以触发定义好的selector函数。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSInvocationOperation</span>* theOp = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span></div><div class="line">                   selector:<span class="keyword">@selector</span>(myTaskMethod:) object:data];</div></pre></td></tr></table></figure></p>
<p>###创建NSBlockOperation<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSBlockOperation</span>* theOp = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock: ^&#123;</div><div class="line">     <span class="built_in">NSLog</span>(<span class="string">@"Beginning operation.\n"</span>);</div><div class="line">     <span class="comment">// Do some work.</span></div><div class="line">  &#125;];</div></pre></td></tr></table></figure></p>
<p>如果创建出来了，可以调用函数<code>addExecutionBlock:</code>添加更多的block。</p>
<p>###创建自定义Operation<br>创建串行的操作要简单，定义main函数里面的任务，并需要考虑取消的操作。<br>为了实现operation，至少需要实现以下2个方法：</p>
<ol>
<li>自定义的<code>initializaiton</code>方法：需要再里面设置operation的状态。</li>
<li><code>main</code>函数：定义主要的任务。</li>
</ol>
<p>###支持取消操作<br>只要再自己的函数里面检查<code>isCancelled</code>，如果是yes的话，立即返回。可以将检查代码放在如下3个地方：</p>
<ol>
<li>在将要执行新的任务前面。</li>
<li>至少已经执行了一次循环。</li>
<li>代码中比较容易退出操作的地方。</li>
</ol>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)main &#123;</div><div class="line">   <span class="keyword">@try</span> &#123;</div><div class="line">      <span class="built_in">BOOL</span> isDone = <span class="literal">NO</span>;</div><div class="line"> </div><div class="line">      <span class="keyword">while</span> (![<span class="keyword">self</span> isCancelled] &amp;&amp; !isDone) &#123;</div><div class="line">          <span class="comment">// Do some work and set isDone to YES when finished</span></div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">@catch</span>(...) &#123;</div><div class="line">      <span class="comment">// Do not rethrow exceptions.</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###创建并行操作<br>需要重写以下几个方法:<br><img src="/uploads/2014/11/27/2.png" alt=""></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)start &#123;</div><div class="line">   <span class="comment">// Always check for cancellation before launching the task.</span></div><div class="line">   <span class="keyword">if</span> ([<span class="keyword">self</span> isCancelled])</div><div class="line">   &#123;</div><div class="line">      <span class="comment">// Must move the operation to the finished state if it is canceled.</span></div><div class="line">      [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"isFinished"</span>];</div><div class="line">      finished = <span class="literal">YES</span>;</div><div class="line">      [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"isFinished"</span>];</div><div class="line">      <span class="keyword">return</span>;</div><div class="line">   &#125;</div><div class="line"> </div><div class="line">   <span class="comment">// If the operation is not canceled, begin executing the task.</span></div><div class="line">   [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"isExecuting"</span>];</div><div class="line">   [<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(main) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</div><div class="line">   executing = <span class="literal">YES</span>;</div><div class="line">   [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"isExecuting"</span>];</div><div class="line">&#125;</div><div class="line">- (<span class="keyword">void</span>)main &#123;</div><div class="line">   <span class="keyword">@try</span> &#123;</div><div class="line"> </div><div class="line">       <span class="comment">// Do the main work of the operation here.</span></div><div class="line"> </div><div class="line">       [<span class="keyword">self</span> completeOperation];</div><div class="line">   &#125;</div><div class="line">   <span class="keyword">@catch</span>(...) &#123;</div><div class="line">      <span class="comment">// Do not rethrow exceptions.</span></div><div class="line">   &#125;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (<span class="keyword">void</span>)completeOperation &#123;</div><div class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"isFinished"</span>];</div><div class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"isExecuting"</span>];</div><div class="line"> </div><div class="line">    executing = <span class="literal">NO</span>;</div><div class="line">    finished = <span class="literal">YES</span>;</div><div class="line"> </div><div class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"isExecuting"</span>];</div><div class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"isFinished"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>支持如下几个key patch的observing （KVO）：<br>isCancelled, isConcurrent, isExecuting, isFinished, isReady, dependencies, queuePriority, completionBlock。</p>
<p>如果需要改变线程的优先级，需要在start函数里面调用<code>setThreadPriority:</code>来设置线程的优先级，这个优先级只有再main函数执行过程中起作用。</p>
<p>往队列里面添加操作有如下3中方法：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[aQueue addOperation:anOp]; <span class="comment">// Add a single operation</span></div><div class="line">[aQueue addOperations:anArrayOfOps waitUntilFinished:<span class="literal">NO</span>]; <span class="comment">// Add multiple operations</span></div><div class="line">[aQueue addOperationWithBlock:^&#123;</div><div class="line">   <span class="comment">/* Do something. */</span></div><div class="line">&#125;];</div></pre></td></tr></table></figure></p>
<p>可以通过函数<code>setMaxConcurrentOperationCount:</code> = 1领队列成为串行的，队列默认是并行的。</p>
<p>也可以手动启动操作，前提是<code>isReady</code>返回是YES。</p>
<p>等到操作完成，可以通过设置<code>waitUntilFinished</code> = YES，让代码等待操作完成。</p>
<p>中止队列：它不会中止正在执行的操作，只会中止那些还没执行的操作。</p>
<p>##Dispatch Queues<br>Dispatch Queue实质上是一个用来管理任务调度的数据结构。可以创建串行、并行（<code>DISPATCH_QUEUE_CONCURRENT</code>）队列。还要注意一下几点：</p>
<ol>
<li>dispatch queues在执行的时候，会考虑其他的队列。</li>
<li>系统决定再同一时间执行的任务数量。</li>
<li>在选择哪个任务需要执行时，会考虑任务的优先级。</li>
<li>任务在添加到队列的时候，状态必须是ready的。</li>
<li>私有的队列也是会被rentain计数的，当有dispatch source添加到队列的时候，会增加队列的retain计数。</li>
</ol>
<p>###与Queue相关的技术<br>Dispatch groups，dispatch semaphores，dispatch sources</p>
<p>###有关Block<br>Block其实是一个数据结构，是有编译器创建和管理的。运用block的优点就是，可以调用外部的变量。block是串行的，可以修改具有<code>__Block</code>标明的变量，即使这个变量在block的外部。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/24/-LeetCode-Exercise-Day8/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/24/-LeetCode-Exercise-Day8/" itemprop="url">
                  [LeetCode]Exercise(Day8)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-24T17:47:56+08:00">
              2014-11-24
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/24/-LeetCode-Exercise-Day8/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/24/-LeetCode-Exercise-Day8/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cizqx3flb00824htigirp9133"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Remove Duplicates from Sorted List</p>
<p>###问题描述<br>Given a sorted linked list, delete all duplicates such that each element appear only once.</p>
<p>For example,<br>Given <code>1-&gt;1-&gt;2</code>, return <code>1-&gt;2</code>.<br>Given <code>1-&gt;1-&gt;2-&gt;3-&gt;3</code>, return <code>1-&gt;2-&gt;3</code>.</p>
<p>###解决方法<br>方法很简单，直接上代码：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function">ListNode *<span class="title">deleteDuplicates</span><span class="params">(ListNode *head)</span> </span>&#123;</div><div class="line">       ListNode* result = head;</div><div class="line">       </div><div class="line">       ListNode* preNode = <span class="literal">NULL</span>;</div><div class="line">       ListNode* curNode = head;</div><div class="line">       </div><div class="line">       <span class="keyword">while</span> (curNode != <span class="literal">NULL</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (preNode == <span class="literal">NULL</span>) &#123;</div><div class="line">               preNode = curNode;</div><div class="line">               curNode = curNode-&gt;next;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               <span class="keyword">if</span> (preNode-&gt;val == curNode-&gt;val) &#123;</div><div class="line">                   ListNode* tmp = curNode;</div><div class="line">                   curNode = curNode-&gt;next;</div><div class="line">                   <span class="keyword">delete</span> tmp;</div><div class="line">                   preNode-&gt;next = curNode;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   preNode = curNode;</div><div class="line">                   curNode = curNode-&gt;next;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Pow(x, n)</p>
<p>###问题描述<br>Implement pow(x, n).</p>
<p>###解决方法<br>运用二分查找法进行分治，代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">pow2</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (n &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1.0</span> / power(x, -n);</div><div class="line">       <span class="keyword">else</span> <span class="keyword">return</span> power(x, n);</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function"><span class="keyword">double</span> <span class="title">power</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">       <span class="keyword">double</span> v = power(x, n / <span class="number">2</span>);</div><div class="line">       <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> v*v;</div><div class="line">       <span class="keyword">else</span> <span class="keyword">return</span> v*v*x;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>之前写了一个比较笨得函数<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">double</span> <span class="title">pow</span><span class="params">(<span class="keyword">double</span> x, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span>(n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">       <span class="keyword">if</span> (x == <span class="number">0</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (n &lt; <span class="number">0</span>) <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">           <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (x == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">       <span class="keyword">if</span> (x == <span class="number">-1</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (n % <span class="number">2</span> == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> N = <span class="built_in">abs</span>(n);</div><div class="line">       <span class="keyword">double</span> result = <span class="number">1</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">           <span class="keyword">if</span> (n &gt; <span class="number">0</span>) &#123;</div><div class="line">               result *= x;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               result /= x;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (<span class="built_in">fabs</span>(result) &lt; <span class="number">0.000001</span>) &#123;</div><div class="line">               result = <span class="number">0</span>;</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##First Missing Positive</p>
<p>###问题描述<br>Given an unsorted integer array, find the first missing positive integer.</p>
<p>For example,<br>Given <code>[1,2,0]</code> return <code>3</code>,<br>and <code>[3,4,-1,1]</code> return <code>2</code>.</p>
<p>Your algorithm should run in O(n) time and uses constant space.</p>
<p>###解决方法<br>首先可以确定算法的时间复杂度需要O(n)，就需要O(n)的空间复杂度来实现，首先创建大小为n的数组，遍历数组，如果这个数大于0，就将他加到数组相应的位置，然后再遍历此数组查找第一个缺失的数字。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">firstMissingPositive</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">       <span class="keyword">int</span> record[n];</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">           record[i] = <span class="number">-1</span>;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="comment">//记录大于0的值</span></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">           <span class="keyword">if</span> (A[i] &gt; <span class="number">0</span> &amp;&amp; A[i] &lt;= n) &#123;</div><div class="line">               record[A[i] - <span class="number">1</span>] = A[i];</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="comment">//查找第一个缺失的大于0的数字</span></div><div class="line">       <span class="keyword">int</span> result = <span class="number">-1</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">           <span class="keyword">if</span> (record[i] == <span class="number">-1</span>) &#123;</div><div class="line">               result = i+<span class="number">1</span>;</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (result == <span class="number">-1</span>) &#123;</div><div class="line">           result = n+<span class="number">1</span>;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>###扩展阅读<br>桶排序:<br>无序数组有个要求,就是成员隶属于固定(有限的)的区间,如范围为<a href="考试分数为1-100等">0-9</a></p>
<p>例如待排数字[6 2 4 1 5 9]</p>
<p>准备10个空桶,最大数个空桶</p>
<p>[6 2 4 1 5 9]           待排数组</p>
<p>[0 0 0 0 0 0 0 0 0 0]   空桶</p>
<p>[0 1 2 3 4 5 6 7 8 9]   桶编号(实际不存在)</p>
<p>1,顺序从待排数组中取出数字,首先6被取出,然后把6入6号桶,这个过程类似这样:空桶[ 待排数组[ 0 ] ] = 待排数组[ 0 ]</p>
<p>[6 2 4 1 5 9]           待排数组</p>
<p>[0 0 0 0 0 0 <code>6</code> 0 0 0]   空桶</p>
<p>[0 1 2 3 4 5 <code>6</code> 7 8 9]   桶编号(实际不存在)</p>
<p>2,顺序从待排数组中取出下一个数字,此时2被取出,将其放入2号桶,是几就放几号桶</p>
<p>[6 2 4 1 5 9]           待排数组</p>
<p>[0 0 <code>2</code> 0 0 0 6 0 0 0]   空桶</p>
<p>[0 1 <code>2</code> 3 4 5 6 7 8 9]   桶编号(实际不存在)</p>
<p>3,4,5,6省略,过程一样,全部入桶后变成下边这样</p>
<p>[6 2 4 1 5 9]           待排数组</p>
<p>[0 <code>1</code> <code>2</code> 0 <code>4</code> <code>5</code> <code>6</code> 0 0 <code>9</code>]   空桶</p>
<p>[0 <code>1</code> <code>2</code> 3 <code>4</code> <code>5</code> <code>6</code> 7 8 <code>9</code>]   桶编号(实际不存在)</p>
<p>0表示空桶,跳过,顺序取出即可:1 2 4 5 6 9</p>
<p><img src="/uploads/2014/11/27/1.png" alt=""></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/22/-LeetCode-Exercise-Day7/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/22/-LeetCode-Exercise-Day7/" itemprop="url">
                  [LeetCode]Exercise(Day7)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-22T18:57:32+08:00">
              2014-11-22
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/22/-LeetCode-Exercise-Day7/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/22/-LeetCode-Exercise-Day7/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cizqx3fl9007z4htin87yzvwf"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Wildcard Matching</p>
<p>###问题描述<br>Implement wildcard pattern matching with support for ‘?’ and ‘*’.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">&apos;?&apos; Matches any single character.</div><div class="line">&apos;*&apos; Matches any sequence of characters (including the empty sequence).</div><div class="line"></div><div class="line">The matching should cover the entire input string (not partial).</div><div class="line"></div><div class="line">The function prototype should be:</div><div class="line">bool isMatch(const char *s, const char *p)</div><div class="line"></div><div class="line">Some examples:</div><div class="line">isMatch(&quot;aa&quot;,&quot;a&quot;) → false</div><div class="line">isMatch(&quot;aa&quot;,&quot;aa&quot;) → true</div><div class="line">isMatch(&quot;aaa&quot;,&quot;aa&quot;) → false</div><div class="line">isMatch(&quot;aa&quot;, &quot;*&quot;) → true</div><div class="line">isMatch(&quot;aa&quot;, &quot;a*&quot;) → true</div><div class="line">isMatch(&quot;ab&quot;, &quot;?*&quot;) → true</div><div class="line">isMatch(&quot;aab&quot;, &quot;c*a*b&quot;) → false</div></pre></td></tr></table></figure></p>
<p>###解决方法<br>开始想着用动态规划，但是没有想到点子上，不知道怎么下手，这里借用戴方勤的解题思路：主要是在匹配‘<em>’，p每遇到一个‘</em>’，就保留住当前‘*’的坐标和s的坐标，然后s从前往后扫描，如果不成功，则s++，重新扫描。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isMatch</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s, <span class="keyword">const</span> <span class="keyword">char</span> *p)</span> </span>&#123;</div><div class="line">       <span class="keyword">bool</span> star = <span class="literal">false</span>;</div><div class="line">       <span class="keyword">const</span> <span class="keyword">char</span> *str, *ptr;</div><div class="line">       <span class="keyword">for</span> (str = s, ptr = p; *str != <span class="string">'\0'</span>; str++, ptr++) &#123;</div><div class="line">           <span class="keyword">switch</span> (*ptr) &#123;</div><div class="line">               <span class="keyword">case</span> <span class="string">'?'</span>:</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">               <span class="keyword">case</span> <span class="string">'*'</span>:</div><div class="line">               	<span class="comment">//标记，前面有‘*’出现</span></div><div class="line">                   star = <span class="literal">true</span>;</div><div class="line">                   <span class="comment">//将s，p置到新的位置上面</span></div><div class="line">                   s = str, p = ptr;</div><div class="line">                   <span class="keyword">while</span> (*p == <span class="string">'*'</span>) p++;</div><div class="line">                   <span class="comment">//如果p，后面只有'*',直接返回true</span></div><div class="line">                   <span class="keyword">if</span> (*p == <span class="string">'\0'</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">                   <span class="comment">//否则将str，ptr置到s，p的初始位置</span></div><div class="line">                   str = s - <span class="number">1</span>;</div><div class="line">                   ptr = p - <span class="number">1</span>;</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">               <span class="keyword">default</span>:</div><div class="line">               	<span class="comment">//如果当前两个字母不相同</span></div><div class="line">                   <span class="keyword">if</span> (*str != *ptr) &#123;</div><div class="line">                   	<span class="comment">//如果前面没有‘*’出现，那么直接返回false</span></div><div class="line">                       <span class="keyword">if</span> (!star) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">                       <span class="comment">//否则，将s++，移到下个字母上面，p回到初始位置，再进行比较</span></div><div class="line">                       s++;</div><div class="line">                       str = s - <span class="number">1</span>;</div><div class="line">                       ptr = p - <span class="number">1</span>;</div><div class="line">                   &#125;</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">while</span> (*ptr == <span class="string">'*'</span>) ptr++;</div><div class="line">       <span class="keyword">return</span> (*ptr == <span class="string">'\0'</span>);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Scramble String</p>
<p>###问题描述<br>Given a string s1, we may represent it as a binary tree by partitioning it to two non-empty substrings recursively.</p>
<p>Below is one possible representation of s1 = <code>&quot;great&quot;</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    great</div><div class="line">   /    \</div><div class="line">  gr    eat</div><div class="line"> / \    /  \</div><div class="line">g   r  e   at</div><div class="line">           / \</div><div class="line">          a   t</div></pre></td></tr></table></figure></p>
<p>To scramble the string, we may choose any non-leaf node and swap its two children.</p>
<p>For example, if we choose the node <code>&quot;gr&quot;</code> and swap its two children, it produces a scrambled string <code>&quot;rgeat&quot;</code>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    rgeat</div><div class="line">   /    \</div><div class="line">  rg    eat</div><div class="line"> / \    /  \</div><div class="line">r   g  e   at</div><div class="line">           / \</div><div class="line">          a   t</div></pre></td></tr></table></figure></p>
<p>We say that <code>&quot;rgeat&quot;</code> is a scrambled string of <code>&quot;great&quot;</code>.</p>
<p>Similarly, if we continue to swap the children of nodes <code>&quot;eat&quot;</code> and <code>&quot;at&quot;</code>, it produces a scrambled string <code>&quot;rgtae&quot;</code>.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">    rgtae</div><div class="line">   /    \</div><div class="line">  rg    tae</div><div class="line"> / \    /  \</div><div class="line">r   g  ta  e</div><div class="line">       / \</div><div class="line">      t   a</div></pre></td></tr></table></figure></p>
<p>We say that <code>&quot;rgtae&quot;</code> is a scrambled string of <code>&quot;great&quot;</code>.</p>
<p>Given two strings s1 and s2 of the same length, determine if s2 is a scrambled string of s1.</p>
<p>###解决方法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isScramble2</span><span class="params">(<span class="built_in">string</span> s1, <span class="built_in">string</span> s2)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (s1.length() != s2.length()) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">       <span class="keyword">if</span> (s1.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">const</span> <span class="keyword">int</span> N = (<span class="keyword">int</span>)s1.length();</div><div class="line">       </div><div class="line">       <span class="keyword">bool</span> f[N+<span class="number">1</span>][N][N];</div><div class="line">       fill_n(&amp;f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>], (N+<span class="number">1</span>)*(N)*(N), <span class="literal">false</span>);</div><div class="line">       </div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++) &#123;</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; N; j++) &#123;</div><div class="line">               f[<span class="number">1</span>][i][j] = s1[i] == s2[j];</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//由于此题，递归的话，会重复调用低阶的比对，比如1个字母的比较，调用2^n，所以此处用动态规划</span></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> n = <span class="number">1</span>; n &lt;= N; n++) &#123;</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i + n &lt;= N; i++) &#123;</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j + n &lt;= N; j++) &#123;</div><div class="line">                   <span class="keyword">for</span>(<span class="keyword">int</span> k = <span class="number">1</span>; k &lt; n; k++)&#123;</div><div class="line">                   	<span class="comment">//分两种情况来处理，s2的话要拆分成2种情况来处理</span></div><div class="line">                       <span class="keyword">if</span> ((f[k][i][j] &amp;&amp; f[n-k][i+k][j+k]) || (f[k][i][j + n - k] &amp;&amp; f[n-k][i+k][j])) &#123;</div><div class="line">                           f[n][i][j] = <span class="literal">true</span>;</div><div class="line">                       &#125;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       </div><div class="line">       <span class="keyword">return</span> f[N][<span class="number">0</span>][<span class="number">0</span>];</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>自己写了个巨慢的方法：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isScramble</span><span class="params">(<span class="built_in">string</span> s1, <span class="built_in">string</span> s2)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (s1.length() != s2.length()) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">       <span class="keyword">if</span> (s1.length() == <span class="number">0</span> &amp;&amp; s2.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">const</span> <span class="keyword">int</span> n = (<span class="keyword">int</span>)s1.length();</div><div class="line">       <span class="keyword">if</span> (n == <span class="number">1</span>) &#123;</div><div class="line">           <span class="keyword">return</span> s1 == s2;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (s1 == s2) &#123;</div><div class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="comment">//就用的递归</span></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">           <span class="built_in">string</span> sub1_first = s1.substr(<span class="number">0</span>, i);</div><div class="line">           <span class="built_in">string</span> sub1_last = s1.substr(i);</div><div class="line">           </div><div class="line">           <span class="built_in">string</span> sub2_first = s2.substr(<span class="number">0</span>, i);</div><div class="line">           <span class="built_in">string</span> sub2_last = s2.substr(i);</div><div class="line">           </div><div class="line">           <span class="keyword">bool</span> is_scramble = isScramble(sub1_first, sub2_first) &amp;&amp; isScramble(sub1_last, sub2_last);</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (is_scramble) &#123;</div><div class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           sub2_first = s2.substr(<span class="number">0</span>, n - i);</div><div class="line">           sub2_last = s2.substr(n - i);</div><div class="line"></div><div class="line">           is_scramble = isScramble(sub1_first, sub2_last) &amp;&amp; isScramble(sub1_last, sub2_first);</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (is_scramble) &#123;</div><div class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/14/-iOS-Core-Animation-读书笔记/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/14/-iOS-Core-Animation-读书笔记/" itemprop="url">
                  [iOS]Core Animation 读书笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-14T16:42:38+08:00">
              2014-11-14
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/14/-iOS-Core-Animation-读书笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/14/-iOS-Core-Animation-读书笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cizqx3fl8007w4htijye2jufd"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##摘要<br>Core Animation的核心是layer objects，它被用来控制并操作显示的内容。Layer其实是内容的到bitmap得映射，这个bitmap很容易被硬件操作。<br>如果修改layer的property，例如opacity，会触发隐式动画(implicit animation)，也可以设置显示的动画。隐式的动画是通过action object来实现的。在OS X上面的程序，需要显示的激活layer。<br>Core Animation位于AppKit和UIKit之下，<br><img src="/uploads/2014/11/14/ca_architecture_2x.png" alt=""></p>
<p>##Core Animation基本知识</p>
<p>###Layer提供了渲染以及动画的基本逻辑<br>layer objects表面是2d的，但从从组织形式上是3d的。<br>    与view的共同点：位置，内容，和虚拟的属性。<br>    与view的不同点：layer不会定义他们自己的样子。</p>
<p>基于layer的渲染模型：<br>layer也可以叫做backing store，它会将内容备份到bitmap里面。等需要触发动画时，Core Animation会将layer的bitmap和状态信息发送给图像硬件，根据最新的信息，由图像硬件来负责渲染，这个要比软件实现动画要快很多。如下图显示：<br><img src="/uploads/2014/11/14/basics_layer_rendering_2x.png" alt=""></p>
<p>基于view的渲染，通过在drawRect：里面读取状态值来画content，代价非常高。</p>
<p>基于layer的动画：L<br>只需要设置开始与结束的状态信息，Core Animation来负责一帧一帧的渲染。<br><img src="/uploads/2014/11/14/basics_animation_types_2x.png" alt=""></p>
<p>###Layer Objects用自己的几何位置<br>layer的一个职责就是来管理内容的虚拟位置，可使用基于点坐标系统和统一的坐标系统。在iOS和Mac OS上面用得不同的坐标系，<br>基于点坐标<br><img src="/uploads/2014/11/14/layer_coords_bounds_2x.png" alt=""><br>从上图可以看出layer的position时位于中间的。<br>基于统一的坐标系统<br><img src="/uploads/2014/11/14/layer_coords_unit_2x.png" alt=""><br>不管是点坐标还是统一坐标 用floating-point数字。</p>
<p>Anchor Points回影响到位置的变化：<br><img src="/uploads/2014/11/14/layer_coords_anchorpoint_position_2x.png" alt=""><br>下图显示了anchor point是怎么影响旋转的<br><img src="/uploads/2014/11/14/layer_coords_anchorpoint_transform_2x.png" alt=""></p>
<p>layer可以进行三维操作<br>一般transform可以用来改变layer的大小及旋转角度。一般情况下不会直接用这个旋转矩阵，可以通过KVC来设置layer属性达到动画效果。如下图所示：<br><img src="/uploads/2014/11/14/transform_basic_math_2x.png" alt=""><br>以下是几个常用的旋转矩阵，<br><img src="/uploads/2014/11/14/transform_manipulations_2x.png" alt=""></p>
<p>###Layer Tree从不同方面反应动画时期<br>一共有3种layer objects：<br>Model layer tree：是跟app交互最多的，它存储了动画所要修改的属性的目标值。<br>Presentation tree：包含了动画运行中的值。这个tree里面的值不能直接修改，而是在动画过程中读取，根据状态来创建新的动画。<br>Render tree：负责具体动画效果，对于Core Animation是私有的。</p>
<p>Layer Tree的初始状态跟View hierarchy是完全一样的。Layer Hierarchy如下：<br><img src="/uploads/2014/11/14/sublayer_hierarchy_2x.png" alt=""></p>
<p>通过presentaionLayer来获取动画种某个属性值，并且render tree跟presentation tree是一一对应的，如下图<br><img src="/uploads/2014/11/14/sublayer_hierarchies_2x.png" alt=""></p>
<p>###Layer与View的关系<br>首先layer不能替代view，layer提供了view的基础设施，它会让绘制以及让内容运动起来更容易，</p>
<p>Layer与View的不同：Layer不处理事件，渲染内容参与响应连。</p>
<p>##配置Layer Objects</p>
<p>###激活Core Animation<br>对于OS X来说，需要显示的激活layer，需要做如下几部：</p>
<ol>
<li>添加QuartzCore framework.</li>
<li>激活NSView的layer支持。</li>
</ol>
<p>可以重写<code>+[UIVIew layerClass]</code>方法来创建个性化的layer，一般来说iOS回创建<code>CALayer</code>。如下几种情况可以替换layer class</p>
<ol>
<li>view的内容是用OpenGL ES画的，你会用到<code>CAEAGLLayer</code>。</li>
<li>Layer提供了更好的性能。</li>
<li>希望更好的利用Core Animation layer的类。</li>
</ol>
<p>###配置Layer的内容<br>可以通过以下3种方法来设置Layer的内容：</p>
<ol>
<li>将一个image的object设到Layer的<code>contents</code>上去。</li>
<li>设置Layer的delegate，由delegate来提供layer的内容。</li>
<li>重新定义一个layer的子类，在内部重画layer的content。</li>
</ol>
<p>如果设置layer的delegate来绘制内容，需要实现<code>displayLayer:</code>或<code>drawLayer:inContext:</code>方法，前者优先级高。例如：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)displayLayer:(<span class="built_in">CALayer</span> *)theLayer &#123;</div><div class="line">    <span class="comment">// Check the value of some state property</span></div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.displayYesImage) &#123;</div><div class="line">        <span class="comment">// Display the Yes image</span></div><div class="line">        theLayer.contents = [someHelperObject loadStateYesImage];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// Display the No image</span></div><div class="line">        theLayer.contents = [someHelperObject loadStateNoImage];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)theLayer inContext:(<span class="built_in">CGContextRef</span>)theContext &#123;</div><div class="line">    <span class="built_in">CGMutablePathRef</span> thePath = <span class="built_in">CGPathCreateMutable</span>();</div><div class="line"> </div><div class="line">    <span class="built_in">CGPathMoveToPoint</span>(thePath,<span class="literal">NULL</span>,<span class="number">15.0</span>f,<span class="number">15.</span>f);</div><div class="line">    <span class="built_in">CGPathAddCurveToPoint</span>(thePath,</div><div class="line">                          <span class="literal">NULL</span>,</div><div class="line">                          <span class="number">15.</span>f,<span class="number">250.0</span>f,</div><div class="line">                          <span class="number">295.0</span>f,<span class="number">250.0</span>f,</div><div class="line">                          <span class="number">295.0</span>f,<span class="number">15.0</span>f);</div><div class="line"> </div><div class="line">    <span class="built_in">CGContextBeginPath</span>(theContext);</div><div class="line">    <span class="built_in">CGContextAddPath</span>(theContext, thePath);</div><div class="line"> </div><div class="line">    <span class="built_in">CGContextSetLineWidth</span>(theContext, <span class="number">5</span>);</div><div class="line">    <span class="built_in">CGContextStrokePath</span>(theContext);</div><div class="line"> </div><div class="line">    <span class="comment">// Release the path</span></div><div class="line">    <span class="built_in">CFRelease</span>(thePath);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以设置layer contentsGravity的属性，总体可以分为2类</p>
<ol>
<li>基于位置的gravity。<br><img src="/uploads/2014/11/14/layer_contentsgravity1_2x.png" alt=""></li>
<li>基于缩放的gravity。<br><img src="/uploads/2014/11/14/positioningmask_2x.png" alt=""></li>
</ol>
<p>###调整Layer的显示及外观<br>Layer有自己的背景和边框<br><img src="/uploads/2014/11/14/layer_border_background_2x.png" alt=""></p>
<p>Layer还支持圆角：<code>cornerRadius</code>，圆角会触发layer的transparency的属性，只有设置了<code>masksToBounds = YES</code>才会影响里面内容。<br><img src="/uploads/2014/11/14/layer_corner_radius_2x.png" alt=""></p>
<p>Layer支持阴影：可以通过设置Layer的<code>content</code>,<code>opacity</code>和<code>shape</code>来控制shadow的颜色位置。<br>shadow是超出layer的content的，如果设置了<code>masksToBounds</code>，shadow就会没掉，所以如果即需要<code>masksToBounds</code>又需要shadow，就需要用2个layer来模拟。<br>如图：<br><img src="/uploads/2014/11/14/layer_shadows_2x.png" alt=""></p>
<p>还可以未layer添加滤镜，<code>filters</code>是一个list，它只会影响到前面的内容，<code>backgroundFilters</code>只会影响到背后内容，<code>compositingFilter</code>定义了怎么将前面的内容和后面的内容融合在一起。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CIFilter</span>* aFilter = [<span class="built_in">CIFilter</span> filterWithName:<span class="string">@"CIPinchDistortion"</span>];</div><div class="line">[aFilter setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">500.0</span>] forKey:<span class="string">@"inputRadius"</span>];</div><div class="line">[aFilter setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">1.25</span>] forKey:<span class="string">@"inputScale"</span>];</div><div class="line">[aFilter setValue:[<span class="built_in">CIVector</span> vectorWithX:<span class="number">250.0</span> Y:<span class="number">150.0</span>] forKey:<span class="string">@"inputCenter"</span>];</div><div class="line">myLayer.filters = [<span class="built_in">NSArray</span> arrayWithObject:aFilter];</div></pre></td></tr></table></figure></p>
<p>##让Layer内容动起来</p>
<p>###通过修改属性来生成动画<br>可以显式和隐式的触发动画。直接设置Layer属性就可以触发隐式动画。</p>
<p>###用关键帧动画<br>设置values的最主要的方式就是用array来保存值，不过像<code>anchorPoint</code>和<code>position</code>的话，可以用<code>CGPathRef</code>来代替。<br>指定关键帧动画的时间：<code>calculationMode</code>定义了动画时间的算法</p>
<p>###使当前正在进行的显式动画停止<br>停止一个可以调用<code>removeAnimationForKey:</code>，与之对应的是<code>addAnimation:forKey:</code>。<br>停止多个动画可以调用<code>removeAllAnimations</code>。<br>隐式动画不能中途停止。</p>
<p>###让多个改动同时进行动画<br>可以将动画打包成<code>CAAnimationGroup</code></p>
<p>###判定动画的结束时刻</p>
<ol>
<li>设置<code>setCompletionBlock:</code>来表示当前的动画已结束。</li>
<li>设置<code>CAAnimation</code>的delegate，病实现<code>animationDidStart:</code>和<code>animationDidStop:finished:</code>。</li>
</ol>
<p>##建立Layer Hierarchy<br>再添加子layer的时候，必须设置大小和位置属性，要用整数来设置layer的高度和宽度。<br>Layer Hierarchies是通过speed来影响动画的，而且会叠加。</p>
<p>###Sublayer以及裁剪<br>可以通过设置<code>masksToBounds</code>为YES来达到裁剪的目的。<br><img src="/uploads/2014/11/14/clipping_2x.png" alt=""></p>
<p>可以通过以下几个API进行坐标切换<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">convertPoint:fromLayer:</div><div class="line">convertPoint:toLayer:</div><div class="line">convertRect:fromLayer:</div><div class="line">convertRect:toLayer:</div></pre></td></tr></table></figure></p>
<p>##动画的高级技巧</p>
<p>###过度动画<br>过度动画可以让你进行显示、推送、移动或者交叉动画。创建果冻动画，首先需要创建一个<code>CATransition</code>，然后将它添加到layer里面。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CATransition</span>* transition = [<span class="built_in">CATransition</span> animation];</div><div class="line">transition.startProgress = <span class="number">0</span>;</div><div class="line">transition.endProgress = <span class="number">1.0</span>;</div><div class="line">transition.type = kCATransitionPush;</div><div class="line">transition.subtype = kCATransitionFromRight;</div><div class="line">transition.duration = <span class="number">1.0</span>;</div><div class="line"> </div><div class="line"><span class="comment">// Add the transition animation to both layers</span></div><div class="line">[myView1.layer addAnimation:transition forKey:<span class="string">@"transition"</span>];</div><div class="line">[myView2.layer addAnimation:transition forKey:<span class="string">@"transition"</span>];</div><div class="line"> </div><div class="line"><span class="comment">// Finally, change the visibility of the layers.</span></div><div class="line">myView1.hidden = <span class="literal">YES</span>;</div><div class="line">myView2.hidden = <span class="literal">NO</span>;</div></pre></td></tr></table></figure></p>
<p>###个性化设置动画时间<br>可以通过<code>CAMediaTiming</code>协议定义的属性和方法来设置动画的时间，<code>CAAnimation</code>和<code>CALayer</code>都遵循这个协议。每个Layer都有其自己的时间系统，用来控制动画的计时。子layer的时间系统可以被其父节点的layer修改。可以通过以下方法获取layer的当前时间：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">CFTimeInterval</span> localLayerTime = [myLayer convertTime:<span class="built_in">CACurrentMediaTime</span>() fromLayer:<span class="literal">nil</span>];</div></pre></td></tr></table></figure></p>
<p>可以通过以下方法来设置动画时间：</p>
<ol>
<li><code>beginTime</code>设置动画开始时间，而且需要设置<code>fillMode = kCAFillModebackwards</code>，如果不设置，就会看到再动画开始之前，就瞬间完成了。</li>
<li><code>autoreverses</code>用来控制动画在特定的时间点，回到动画开始的值。可以结合<code>repeatCount</code>来设置重复的次数。</li>
<li><code>timeOffset</code>可以设置group animation的延迟开始时间。</li>
</ol>
<p>###暂停和恢复动画<br>可以通过设置<code>CAMediaTiming</code>协议的<code>speed = 0</code>来暂停动画。</p>
<p>##修改Layer默认的行为<br>Core Animation是用action objects来实现的隐式动画，Action objects其实就是一个遵循<code>CAAction</code>协议的变量，且定义了对于layer的相关行为。所有的<code>CAAnimation</code>都实现了这个协议。</p>
<p>###创建遵循<code>CAAction</code>协议的Action Objects<br>需要实现函数<code>runActionForKey:object:arguments:</code>，当定义action object的时候，必须确定这个怎么触发：</p>
<ol>
<li>layer的属性改变，包括哪些没有定义动画的属性。</li>
<li>layer再显示出来或者加到layer hierarchy的时候，会触发key - <code>kCAOnOrderIn</code>。</li>
<li>layer再参与渐变的动画过程中，会触发key - <code>kCATransition</code>。</li>
</ol>
<p>###Action Object必须设置再layer上<br>当相应的事件再layer上面触发时，layer的<code>actionForKey:</code>会被调用到。寻找action object的优先级如下：</p>
<ol>
<li>如果有delegate 定义了<code>actionForLayer:forKey:</code>，就会调用delegate这个方法：如果是action object直接返回；如果是nil，继续寻找；如果是<code>NSNull</code>，直接退出。</li>
<li>查找<code>actions</code>这个字典中的变量。</li>
<li>需要两级，先查找<code>style</code>的字典，找到定义action的字典，再在这个字典中查找action objects。</li>
<li>直接调用<code>defaultActionForKey:</code>方法。</li>
<li>如果有隐式的动画，执行隐式动画。</li>
</ol>
<p>示例代码如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">CAAction</span>&gt;)actionForLayer:(<span class="built_in">CALayer</span> *)theLayer</div><div class="line">                        forKey:(<span class="built_in">NSString</span> *)theKey &#123;</div><div class="line">    <span class="built_in">CATransition</span> *theAnimation=<span class="literal">nil</span>;</div><div class="line"> </div><div class="line">    <span class="keyword">if</span> ([theKey isEqualToString:<span class="string">@"contents"</span>]) &#123;</div><div class="line"> </div><div class="line">        theAnimation = [[<span class="built_in">CATransition</span> alloc] init];</div><div class="line">        theAnimation.duration = <span class="number">1.0</span>;</div><div class="line">        theAnimation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:kCAMediaTimingFunctionEaseIn];</div><div class="line">        theAnimation.type = kCATransitionPush;</div><div class="line">        theAnimation.subtype = kCATransitionFromRight;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> theAnimation;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###暂时禁掉动画<br>代码如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[<span class="built_in">CATransaction</span> begin];</div><div class="line">[<span class="built_in">CATransaction</span> setValue:(<span class="keyword">id</span>)kCFBooleanTrue</div><div class="line">                 forKey:kCATransactionDisableActions];</div><div class="line">[aLayer removeFromSuperlayer];</div><div class="line">[<span class="built_in">CATransaction</span> commit];</div></pre></td></tr></table></figure></p>
<p>##改善动画的技巧</p>
<ol>
<li>用不透明的layer，</li>
<li>用更简单的paths - <code>CAShapeLayer</code></li>
<li>对于可区分的layer，显式设置layer的内容</li>
<li>总是将layer的size设成整数</li>
<li>在需要的时候，用异步方法去绘制layer - <code>drawAsynchronously</code></li>
<li>当添加阴影的时候，指定阴影的path - <code>shadowpath</code></li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/13/-iOS-Memory-Management-for-iOS/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/13/-iOS-Memory-Management-for-iOS/" itemprop="url">
                  [iOS] Memory Management And Performance Tips
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-13T11:37:36+08:00">
              2014-11-13
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/13/-iOS-Memory-Management-for-iOS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/13/-iOS-Memory-Management-for-iOS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Basic Memory Management Rules</p>
<ol>
<li>You own any object you create</li>
<li>You can take ownership of an object using retain</li>
<li>When you no longer need it, you must relinquish ownership of an object you own</li>
<li>You must not relinquish ownership of an object you do not own</li>
</ol>
<p>##Performance Overview</p>
<p>###CPU Time</p>
<ol>
<li>If your program has nothing to do, it should not consume CPU time.</li>
<li>Move work out of the CPU whenever you can.</li>
</ol>
<p>###Memory Space</p>
<ol>
<li>Reduce the memory footprint of your program.</li>
</ol>
<p>###Mass Storage Space</p>
<ol>
<li>Eliminate unnecessary file operations and delay others until the information is actually needed.</li>
</ol>
<p>###The Perception of Speed</p>
<ol>
<li>Make your program responsive to the user.</li>
</ol>
<p>##Common Areas to Monitor</p>
<ol>
<li>Code for Your Program’s Key Tasks</li>
<li>Drawing Code<blockquote>
<p>Live resizing<br>Custom view drawing code, especially if portions of the view can be updated without updating the whole view<br>Textured graphics<br>Entirely opaque views</p>
</blockquote>
</li>
<li>Launch Time Initialization</li>
<li>File Access Code</li>
<li>Application Footprint</li>
<li>Memory Allocation Code</li>
</ol>
<p>##Fundamental Optimization Tips</p>
<ol>
<li>Be Lazy</li>
<li>Take Advantage of Perceived Performance</li>
<li>Use Event-Based Handlers</li>
<li>Improve the Concurrency of Your Program’s Tasks</li>
<li>Use the Accelerate Framework</li>
<li>Modernize Your Application</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/10/-LeetCode-Exercise-Day6/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/10/-LeetCode-Exercise-Day6/" itemprop="url">
                  [LeetCode]Exercise(Day6)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-10T23:06:48+08:00">
              2014-11-10
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/10/-LeetCode-Exercise-Day6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/10/-LeetCode-Exercise-Day6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cizqx3fl6007q4hti7d1jr90t"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Search a 2D Matrix</p>
<p>###问题描述<br>Write an efficient algorithm that searches for a value in an m x n matrix. This matrix has the following properties:</p>
<p>Integers in each row are sorted from left to right.<br>The first integer of each row is greater than the last integer of the previous row.<br>For example,</p>
<p>Consider the following matrix:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  [1,   3,  5,  7],</div><div class="line">  [10, 11, 16, 20],</div><div class="line">  [23, 30, 34, 50]</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>Given target = <code>3</code>, return <code>true</code>.</p>
<p>###解决方法<br>二分查找，先找对应序列，找到以后，再进行一次二分查找<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">searchMatrix</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; &amp;matrix, <span class="keyword">int</span> target)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (matrix.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> outside_low = <span class="number">0</span>;</div><div class="line">       <span class="keyword">int</span> outside_high = (<span class="keyword">int</span>)matrix.size() - <span class="number">1</span>;</div><div class="line">       </div><div class="line">       <span class="comment">// 先找确定大得list得位置，二分查找</span></div><div class="line">       <span class="keyword">while</span> (outside_low &lt;= outside_high) &#123;</div><div class="line">           <span class="keyword">int</span> outside_mid = (outside_low + outside_high) / <span class="number">2</span>;</div><div class="line">           </div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; inside_vector = matrix[outside_mid];</div><div class="line">           <span class="keyword">if</span> (inside_vector.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">           </div><div class="line">           <span class="keyword">int</span> inside_count = (<span class="keyword">int</span>)inside_vector.size();</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (inside_vector[<span class="number">0</span>] &gt; target) &#123;</div><div class="line">               outside_high = outside_mid - <span class="number">1</span>;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">if</span> (inside_vector[inside_count - <span class="number">1</span>] &lt; target)&#123;</div><div class="line">               outside_low = outside_mid + <span class="number">1</span>;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="comment">//确定了list得位置，再在这个list里面查找对应的值，二分查找</span></div><div class="line">           <span class="keyword">int</span> inside_low = <span class="number">0</span>;</div><div class="line">           <span class="keyword">int</span> inside_high = inside_count - <span class="number">1</span>;</div><div class="line">           <span class="keyword">while</span> (inside_low &lt;= inside_high) &#123;</div><div class="line">               <span class="keyword">int</span> inside_mid = (inside_low + inside_high) / <span class="number">2</span>;</div><div class="line">               <span class="keyword">if</span> (target == inside_vector[inside_mid]) &#123;</div><div class="line">                   <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span> <span class="keyword">if</span>(target &lt; inside_vector[inside_mid])&#123;</div><div class="line">                   inside_high = inside_mid - <span class="number">1</span>;</div><div class="line">                   <span class="keyword">continue</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   inside_low = inside_mid + <span class="number">1</span>;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Merge k Sorted Lists</p>
<p>###问题描述<br>Merge k sorted linked lists and return it as one sorted list. Analyze and describe its complexity.</p>
<p>###解决方法<br>想了两种方案，第一种方案的时间复杂度为n<em>k</em>k(n代表每一个list里面element的数量，k代表list的数量),<br>方案一：先建立k大小的vector保存每个链表头结点指针，然后用快排，将head的指针排序，然后每次取第一个element，加到大得list里面，然后去此链表的下一个节点，插入到之前我们创建出来的vector里面-插入排序，效率比较低，在LeetCode里面会超时，代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 对于创建的vector，进行快速排序</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSortList</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode*&gt;&amp; head_vector, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span> ;</div><div class="line">       <span class="keyword">if</span> (head_vector.size() == <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> low = left;</div><div class="line">       <span class="keyword">int</span> high = right;</div><div class="line">       <span class="keyword">int</span> key = head_vector[low]-&gt;val;</div><div class="line">       ListNode* keyNode = head_vector[low];</div><div class="line">       </div><div class="line">       <span class="keyword">while</span> (low &lt; high) &#123;</div><div class="line">           <span class="keyword">while</span> (low &lt; high &amp;&amp; head_vector[high]-&gt;val &gt;= key) high--;</div><div class="line">           head_vector[low] = head_vector[high];</div><div class="line">           <span class="keyword">while</span> (low &lt; high &amp;&amp; head_vector[low]-&gt;val &lt;= key) low++;</div><div class="line">           head_vector[high] = head_vector[low];</div><div class="line">       &#125;</div><div class="line">       head_vector[low] = keyNode;</div><div class="line">       </div><div class="line">       quickSortList(head_vector, left, low - <span class="number">1</span>);</div><div class="line">       quickSortList(head_vector, low + <span class="number">1</span>, right);</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function">ListNode *<span class="title">mergeKLists</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode *&gt; &amp;lists)</span></span></div><div class="line">   &#123;</div><div class="line">       ListNode* head = <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (lists.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       <span class="built_in">vector</span>&lt;ListNode*&gt; head_list;</div><div class="line">       <span class="keyword">int</span> lNotNullListCount = <span class="number">0</span>;</div><div class="line">       </div><div class="line">       <span class="comment">// 初始化pointer的vector，并记录list的数量</span></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lists.begin(); iter != lists.end(); iter++) &#123;</div><div class="line">           <span class="keyword">if</span> (*iter != <span class="literal">NULL</span>) &#123;</div><div class="line">               head_list.push_back(*iter);</div><div class="line">               lNotNullListCount++;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (lNotNullListCount == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       <span class="comment">// 对于此vector，进行快速排序</span></div><div class="line">       quickSortList(head_list, <span class="number">0</span>, lNotNullListCount - <span class="number">1</span>);</div><div class="line">       </div><div class="line">       ListNode* pNode = <span class="literal">NULL</span>;</div><div class="line">       <span class="keyword">while</span> (lNotNullListCount &gt; <span class="number">1</span>) &#123;</div><div class="line">       	<span class="comment">// 每次取出vector的第一个节点插入到大得list里面</span></div><div class="line">           <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</div><div class="line">               head = head_list[<span class="number">0</span>];</div><div class="line">               pNode = head;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               pNode-&gt;next = head_list[<span class="number">0</span>];</div><div class="line">               pNode = pNode-&gt;next;</div><div class="line">           &#125;</div><div class="line">           head_list[<span class="number">0</span>] = <span class="literal">NULL</span>;</div><div class="line">           </div><div class="line">           <span class="comment">//确定下一个节点指针</span></div><div class="line">           ListNode* nextNode = pNode-&gt;next;</div><div class="line">           </div><div class="line">           <span class="comment">// 如果下一个节点指针是空的，那么将剩余的往前移动1个位置</span></div><div class="line">           <span class="keyword">if</span> (nextNode == <span class="literal">NULL</span>) &#123;</div><div class="line">               lNotNullListCount--;</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lNotNullListCount; i++) &#123;</div><div class="line">                   head_list[i] = head_list[i+<span class="number">1</span>];</div><div class="line">               &#125;</div><div class="line">               head_list[lNotNullListCount] = <span class="literal">NULL</span>;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="comment">// 否则，插入排序,顺便移动item pointer的位置</span></div><div class="line">           <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">           <span class="keyword">for</span> (; i &lt; lNotNullListCount - <span class="number">1</span>; i++) &#123;</div><div class="line">               <span class="keyword">if</span> (nextNode-&gt;val &lt; head_list[i+<span class="number">1</span>]-&gt;val) &#123;</div><div class="line">                   head_list[i] = nextNode;</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   head_list[i] = head_list[i+<span class="number">1</span>];</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (i == lNotNullListCount - <span class="number">1</span>) &#123;</div><div class="line">               head_list[i] = nextNode;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="comment">// 最后合并</span></div><div class="line">       <span class="keyword">if</span> (pNode == <span class="literal">NULL</span>) &#123;</div><div class="line">           pNode = head_list[<span class="number">0</span>];</div><div class="line">           head = pNode;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">else</span>&#123;</div><div class="line">           pNode-&gt;next = head_list[<span class="number">0</span>];</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> head;</div><div class="line">       </div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>方案二：进行两两合并，最终合并为一个list，时间复杂度为n<em>k</em>log(k)，代码如下，简洁了许多:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="function">ListNode *<span class="title">mergeKLists2</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode *&gt; &amp;lists)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (lists.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       ListNode* head = <span class="literal">NULL</span>;</div><div class="line">       <span class="keyword">int</span> lListCount = (<span class="keyword">int</span>)lists.size();</div><div class="line">       </div><div class="line">       <span class="comment">// 此函数用来合并两个链表，并返回头节点</span></div><div class="line">       <span class="keyword">auto</span> mergeTwoList = [&amp;](ListNode* list1, ListNode* list2)&#123;</div><div class="line">           <span class="keyword">if</span> (list1 == <span class="literal">NULL</span>) <span class="keyword">return</span> list2;</div><div class="line">           <span class="keyword">if</span> (list2 == <span class="literal">NULL</span>) <span class="keyword">return</span> list1;</div><div class="line">           </div><div class="line">           ListNode* head = <span class="literal">NULL</span>;</div><div class="line">           ListNode* pNode = <span class="literal">NULL</span>;</div><div class="line">           </div><div class="line">           <span class="keyword">while</span> (list1 != <span class="literal">NULL</span> &amp;&amp; list2 != <span class="literal">NULL</span>) &#123;</div><div class="line">               ListNode* nextNode = <span class="literal">NULL</span>;</div><div class="line">               <span class="keyword">if</span> (list1-&gt;val &gt; list2-&gt;val) &#123;</div><div class="line">                   nextNode = list2;</div><div class="line">                   list2 = list2-&gt;next;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   nextNode = list1;</div><div class="line">                   list1 = list1-&gt;next;</div><div class="line">               &#125;</div><div class="line">               </div><div class="line">               <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</div><div class="line">                   head = nextNode;</div><div class="line">                   pNode = nextNode;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   pNode-&gt;next = nextNode;</div><div class="line">                   pNode = pNode-&gt;next;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (list1 != <span class="literal">NULL</span>) &#123;</div><div class="line">               pNode-&gt;next = list1;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               pNode-&gt;next = list2;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">return</span> head;</div><div class="line">       &#125;;</div><div class="line">       </div><div class="line">       <span class="comment">// 当list的数量大于1的时候进行合并</span></div><div class="line">       <span class="keyword">while</span> (lListCount &gt; <span class="number">1</span>) &#123;</div><div class="line">           </div><div class="line">           <span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">           <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">           <span class="comment">// 两两合并</span></div><div class="line">           <span class="keyword">for</span> (; i &lt; lListCount - <span class="number">1</span>; i += <span class="number">2</span>) &#123;</div><div class="line">               ListNode* tpHead = mergeTwoList(lists[i], lists[i+<span class="number">1</span>]);</div><div class="line">               lists[index++] = tpHead;</div><div class="line">           &#125;</div><div class="line">           <span class="comment">// 如果还剩余一个，将剩下的一个往前移动</span></div><div class="line">           <span class="keyword">if</span> (i == lListCount - <span class="number">1</span>) &#123;</div><div class="line">               lists[index] = lists[lListCount - <span class="number">1</span>];</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="comment">// 标记list的数量</span></div><div class="line">           <span class="keyword">if</span> (lListCount % <span class="number">2</span> == <span class="number">0</span>) &#123;</div><div class="line">               lListCount /= <span class="number">2</span>;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               lListCount = lListCount / <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//最后head指向头节点</span></div><div class="line">       head = lists[<span class="number">0</span>];</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> head;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar/avatar.jpg"
               alt="姜楠" />
          <p class="site-author-name" itemprop="name">姜楠</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">116</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/njiang1987" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">姜楠</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"njiang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
