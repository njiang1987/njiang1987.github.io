<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="天空の城">
<meta property="og:url" content="http://www.njiang.cn/page/4/index.html">
<meta property="og:site_name" content="天空の城">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="天空の城">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.njiang.cn/page/4/"/>





  <title> 天空の城 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-43682645-1', 'auto');
  ga('send', 'pageview');
</script>









  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">天空の城</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">愤怒的程序员，梦想着有一天也能飞！</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/13/-iOS-Memory-Management-for-iOS/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/13/-iOS-Memory-Management-for-iOS/" itemprop="url">
                  [iOS] Memory Management And Performance Tips
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-13T11:37:36+08:00">
              2014-11-13
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/13/-iOS-Memory-Management-for-iOS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/13/-iOS-Memory-Management-for-iOS/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Basic Memory Management Rules</p>
<ol>
<li>You own any object you create</li>
<li>You can take ownership of an object using retain</li>
<li>When you no longer need it, you must relinquish ownership of an object you own</li>
<li>You must not relinquish ownership of an object you do not own</li>
</ol>
<p>##Performance Overview</p>
<p>###CPU Time</p>
<ol>
<li>If your program has nothing to do, it should not consume CPU time.</li>
<li>Move work out of the CPU whenever you can.</li>
</ol>
<p>###Memory Space</p>
<ol>
<li>Reduce the memory footprint of your program.</li>
</ol>
<p>###Mass Storage Space</p>
<ol>
<li>Eliminate unnecessary file operations and delay others until the information is actually needed.</li>
</ol>
<p>###The Perception of Speed</p>
<ol>
<li>Make your program responsive to the user.</li>
</ol>
<p>##Common Areas to Monitor</p>
<ol>
<li>Code for Your Program’s Key Tasks</li>
<li>Drawing Code<blockquote>
<p>Live resizing<br>Custom view drawing code, especially if portions of the view can be updated without updating the whole view<br>Textured graphics<br>Entirely opaque views</p>
</blockquote>
</li>
<li>Launch Time Initialization</li>
<li>File Access Code</li>
<li>Application Footprint</li>
<li>Memory Allocation Code</li>
</ol>
<p>##Fundamental Optimization Tips</p>
<ol>
<li>Be Lazy</li>
<li>Take Advantage of Perceived Performance</li>
<li>Use Event-Based Handlers</li>
<li>Improve the Concurrency of Your Program’s Tasks</li>
<li>Use the Accelerate Framework</li>
<li>Modernize Your Application</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/10/-LeetCode-Exercise-Day6/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/10/-LeetCode-Exercise-Day6/" itemprop="url">
                  [LeetCode]Exercise(Day6)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-10T23:06:48+08:00">
              2014-11-10
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/10/-LeetCode-Exercise-Day6/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/10/-LeetCode-Exercise-Day6/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cj0m5l1vu007qjftixt5wdjud"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Search a 2D Matrix</p>
<p>###问题描述<br>Write an efficient algorithm that searches for a value in an m x n matrix. This matrix has the following properties:</p>
<p>Integers in each row are sorted from left to right.<br>The first integer of each row is greater than the last integer of the previous row.<br>For example,</p>
<p>Consider the following matrix:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  [1,   3,  5,  7],</div><div class="line">  [10, 11, 16, 20],</div><div class="line">  [23, 30, 34, 50]</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>Given target = <code>3</code>, return <code>true</code>.</p>
<p>###解决方法<br>二分查找，先找对应序列，找到以后，再进行一次二分查找<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">searchMatrix</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; &amp;matrix, <span class="keyword">int</span> target)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (matrix.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> outside_low = <span class="number">0</span>;</div><div class="line">       <span class="keyword">int</span> outside_high = (<span class="keyword">int</span>)matrix.size() - <span class="number">1</span>;</div><div class="line">       </div><div class="line">       <span class="comment">// 先找确定大得list得位置，二分查找</span></div><div class="line">       <span class="keyword">while</span> (outside_low &lt;= outside_high) &#123;</div><div class="line">           <span class="keyword">int</span> outside_mid = (outside_low + outside_high) / <span class="number">2</span>;</div><div class="line">           </div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; inside_vector = matrix[outside_mid];</div><div class="line">           <span class="keyword">if</span> (inside_vector.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">           </div><div class="line">           <span class="keyword">int</span> inside_count = (<span class="keyword">int</span>)inside_vector.size();</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (inside_vector[<span class="number">0</span>] &gt; target) &#123;</div><div class="line">               outside_high = outside_mid - <span class="number">1</span>;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">if</span> (inside_vector[inside_count - <span class="number">1</span>] &lt; target)&#123;</div><div class="line">               outside_low = outside_mid + <span class="number">1</span>;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="comment">//确定了list得位置，再在这个list里面查找对应的值，二分查找</span></div><div class="line">           <span class="keyword">int</span> inside_low = <span class="number">0</span>;</div><div class="line">           <span class="keyword">int</span> inside_high = inside_count - <span class="number">1</span>;</div><div class="line">           <span class="keyword">while</span> (inside_low &lt;= inside_high) &#123;</div><div class="line">               <span class="keyword">int</span> inside_mid = (inside_low + inside_high) / <span class="number">2</span>;</div><div class="line">               <span class="keyword">if</span> (target == inside_vector[inside_mid]) &#123;</div><div class="line">                   <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span> <span class="keyword">if</span>(target &lt; inside_vector[inside_mid])&#123;</div><div class="line">                   inside_high = inside_mid - <span class="number">1</span>;</div><div class="line">                   <span class="keyword">continue</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   inside_low = inside_mid + <span class="number">1</span>;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Merge k Sorted Lists</p>
<p>###问题描述<br>Merge k sorted linked lists and return it as one sorted list. Analyze and describe its complexity.</p>
<p>###解决方法<br>想了两种方案，第一种方案的时间复杂度为n<em>k</em>k(n代表每一个list里面element的数量，k代表list的数量),<br>方案一：先建立k大小的vector保存每个链表头结点指针，然后用快排，将head的指针排序，然后每次取第一个element，加到大得list里面，然后去此链表的下一个节点，插入到之前我们创建出来的vector里面-插入排序，效率比较低，在LeetCode里面会超时，代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 对于创建的vector，进行快速排序</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSortList</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode*&gt;&amp; head_vector, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span> ;</div><div class="line">       <span class="keyword">if</span> (head_vector.size() == <span class="number">0</span>) <span class="keyword">return</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> low = left;</div><div class="line">       <span class="keyword">int</span> high = right;</div><div class="line">       <span class="keyword">int</span> key = head_vector[low]-&gt;val;</div><div class="line">       ListNode* keyNode = head_vector[low];</div><div class="line">       </div><div class="line">       <span class="keyword">while</span> (low &lt; high) &#123;</div><div class="line">           <span class="keyword">while</span> (low &lt; high &amp;&amp; head_vector[high]-&gt;val &gt;= key) high--;</div><div class="line">           head_vector[low] = head_vector[high];</div><div class="line">           <span class="keyword">while</span> (low &lt; high &amp;&amp; head_vector[low]-&gt;val &lt;= key) low++;</div><div class="line">           head_vector[high] = head_vector[low];</div><div class="line">       &#125;</div><div class="line">       head_vector[low] = keyNode;</div><div class="line">       </div><div class="line">       quickSortList(head_vector, left, low - <span class="number">1</span>);</div><div class="line">       quickSortList(head_vector, low + <span class="number">1</span>, right);</div><div class="line">   &#125;</div><div class="line">   </div><div class="line">   <span class="function">ListNode *<span class="title">mergeKLists</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode *&gt; &amp;lists)</span></span></div><div class="line">   &#123;</div><div class="line">       ListNode* head = <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (lists.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       <span class="built_in">vector</span>&lt;ListNode*&gt; head_list;</div><div class="line">       <span class="keyword">int</span> lNotNullListCount = <span class="number">0</span>;</div><div class="line">       </div><div class="line">       <span class="comment">// 初始化pointer的vector，并记录list的数量</span></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> iter = lists.begin(); iter != lists.end(); iter++) &#123;</div><div class="line">           <span class="keyword">if</span> (*iter != <span class="literal">NULL</span>) &#123;</div><div class="line">               head_list.push_back(*iter);</div><div class="line">               lNotNullListCount++;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (lNotNullListCount == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       <span class="comment">// 对于此vector，进行快速排序</span></div><div class="line">       quickSortList(head_list, <span class="number">0</span>, lNotNullListCount - <span class="number">1</span>);</div><div class="line">       </div><div class="line">       ListNode* pNode = <span class="literal">NULL</span>;</div><div class="line">       <span class="keyword">while</span> (lNotNullListCount &gt; <span class="number">1</span>) &#123;</div><div class="line">       	<span class="comment">// 每次取出vector的第一个节点插入到大得list里面</span></div><div class="line">           <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</div><div class="line">               head = head_list[<span class="number">0</span>];</div><div class="line">               pNode = head;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               pNode-&gt;next = head_list[<span class="number">0</span>];</div><div class="line">               pNode = pNode-&gt;next;</div><div class="line">           &#125;</div><div class="line">           head_list[<span class="number">0</span>] = <span class="literal">NULL</span>;</div><div class="line">           </div><div class="line">           <span class="comment">//确定下一个节点指针</span></div><div class="line">           ListNode* nextNode = pNode-&gt;next;</div><div class="line">           </div><div class="line">           <span class="comment">// 如果下一个节点指针是空的，那么将剩余的往前移动1个位置</span></div><div class="line">           <span class="keyword">if</span> (nextNode == <span class="literal">NULL</span>) &#123;</div><div class="line">               lNotNullListCount--;</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lNotNullListCount; i++) &#123;</div><div class="line">                   head_list[i] = head_list[i+<span class="number">1</span>];</div><div class="line">               &#125;</div><div class="line">               head_list[lNotNullListCount] = <span class="literal">NULL</span>;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="comment">// 否则，插入排序,顺便移动item pointer的位置</span></div><div class="line">           <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">           <span class="keyword">for</span> (; i &lt; lNotNullListCount - <span class="number">1</span>; i++) &#123;</div><div class="line">               <span class="keyword">if</span> (nextNode-&gt;val &lt; head_list[i+<span class="number">1</span>]-&gt;val) &#123;</div><div class="line">                   head_list[i] = nextNode;</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   head_list[i] = head_list[i+<span class="number">1</span>];</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (i == lNotNullListCount - <span class="number">1</span>) &#123;</div><div class="line">               head_list[i] = nextNode;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="comment">// 最后合并</span></div><div class="line">       <span class="keyword">if</span> (pNode == <span class="literal">NULL</span>) &#123;</div><div class="line">           pNode = head_list[<span class="number">0</span>];</div><div class="line">           head = pNode;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">else</span>&#123;</div><div class="line">           pNode-&gt;next = head_list[<span class="number">0</span>];</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> head;</div><div class="line">       </div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>方案二：进行两两合并，最终合并为一个list，时间复杂度为n<em>k</em>log(k)，代码如下，简洁了许多:<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line"><span class="function">ListNode *<span class="title">mergeKLists2</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode *&gt; &amp;lists)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (lists.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</div><div class="line">       </div><div class="line">       ListNode* head = <span class="literal">NULL</span>;</div><div class="line">       <span class="keyword">int</span> lListCount = (<span class="keyword">int</span>)lists.size();</div><div class="line">       </div><div class="line">       <span class="comment">// 此函数用来合并两个链表，并返回头节点</span></div><div class="line">       <span class="keyword">auto</span> mergeTwoList = [&amp;](ListNode* list1, ListNode* list2)&#123;</div><div class="line">           <span class="keyword">if</span> (list1 == <span class="literal">NULL</span>) <span class="keyword">return</span> list2;</div><div class="line">           <span class="keyword">if</span> (list2 == <span class="literal">NULL</span>) <span class="keyword">return</span> list1;</div><div class="line">           </div><div class="line">           ListNode* head = <span class="literal">NULL</span>;</div><div class="line">           ListNode* pNode = <span class="literal">NULL</span>;</div><div class="line">           </div><div class="line">           <span class="keyword">while</span> (list1 != <span class="literal">NULL</span> &amp;&amp; list2 != <span class="literal">NULL</span>) &#123;</div><div class="line">               ListNode* nextNode = <span class="literal">NULL</span>;</div><div class="line">               <span class="keyword">if</span> (list1-&gt;val &gt; list2-&gt;val) &#123;</div><div class="line">                   nextNode = list2;</div><div class="line">                   list2 = list2-&gt;next;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   nextNode = list1;</div><div class="line">                   list1 = list1-&gt;next;</div><div class="line">               &#125;</div><div class="line">               </div><div class="line">               <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</div><div class="line">                   head = nextNode;</div><div class="line">                   pNode = nextNode;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   pNode-&gt;next = nextNode;</div><div class="line">                   pNode = pNode-&gt;next;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (list1 != <span class="literal">NULL</span>) &#123;</div><div class="line">               pNode-&gt;next = list1;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               pNode-&gt;next = list2;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">return</span> head;</div><div class="line">       &#125;;</div><div class="line">       </div><div class="line">       <span class="comment">// 当list的数量大于1的时候进行合并</span></div><div class="line">       <span class="keyword">while</span> (lListCount &gt; <span class="number">1</span>) &#123;</div><div class="line">           </div><div class="line">           <span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">           <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">           <span class="comment">// 两两合并</span></div><div class="line">           <span class="keyword">for</span> (; i &lt; lListCount - <span class="number">1</span>; i += <span class="number">2</span>) &#123;</div><div class="line">               ListNode* tpHead = mergeTwoList(lists[i], lists[i+<span class="number">1</span>]);</div><div class="line">               lists[index++] = tpHead;</div><div class="line">           &#125;</div><div class="line">           <span class="comment">// 如果还剩余一个，将剩下的一个往前移动</span></div><div class="line">           <span class="keyword">if</span> (i == lListCount - <span class="number">1</span>) &#123;</div><div class="line">               lists[index] = lists[lListCount - <span class="number">1</span>];</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="comment">// 标记list的数量</span></div><div class="line">           <span class="keyword">if</span> (lListCount % <span class="number">2</span> == <span class="number">0</span>) &#123;</div><div class="line">               lListCount /= <span class="number">2</span>;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               lListCount = lListCount / <span class="number">2</span> + <span class="number">1</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="comment">//最后head指向头节点</span></div><div class="line">       head = lists[<span class="number">0</span>];</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> head;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/08/-LeetCode-Exercise-Day5/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/08/-LeetCode-Exercise-Day5/" itemprop="url">
                  [LeetCode]Exercise(Day5)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-08T17:20:56+08:00">
              2014-11-08
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/08/-LeetCode-Exercise-Day5/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/08/-LeetCode-Exercise-Day5/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/maomi.jpg" rel="gallery_cj0m5l1vt007njfti75n2xt0l"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/maomi.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Reverse Linked List II</p>
<p>###问题描述<br>Reverse a linked list from position m to n. Do it in-place and in one-pass.</p>
<p>For example:<br>Given <code>1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;NULL</code>, m = 2 and n = 4,</p>
<p>return <code>1-&gt;4-&gt;3-&gt;2-&gt;5-&gt;NULL</code>.</p>
<p>Note:<br>Given m, n satisfy the following condition:<br>1 ≤ m ≤ n ≤ length of list.</p>
<p>###解决方法<br>在遍历链表的时候，记录断点，以及reverse的链表的头和尾，等遍历完全，再将链表重新连接起来。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="function">ListNode *<span class="title">reverseBetween</span><span class="params">(ListNode *head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (head == <span class="literal">NULL</span> || n &lt; m) <span class="keyword">return</span> head;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> index = <span class="number">1</span>;</div><div class="line">       ListNode* pNode = head;</div><div class="line">       ListNode* partHead = <span class="literal">NULL</span>;</div><div class="line">       ListNode* reverseHead = <span class="literal">NULL</span>;</div><div class="line">       ListNode* reverseTail = <span class="literal">NULL</span>;</div><div class="line">       <span class="keyword">while</span> (pNode != <span class="literal">NULL</span>) &#123;</div><div class="line">           <span class="keyword">if</span> (index &lt; m) &#123;</div><div class="line">               partHead = pNode;</div><div class="line">               pNode = pNode-&gt;next;</div><div class="line">               index++;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">if</span> (index &gt;= m &amp;&amp; index &lt;= n) &#123;</div><div class="line">               ListNode* tp = pNode-&gt;next;</div><div class="line">               pNode-&gt;next = reverseHead;</div><div class="line">               reverseHead = pNode;</div><div class="line">               <span class="keyword">if</span> (reverseTail == <span class="literal">NULL</span>) &#123;</div><div class="line">                   reverseTail = pNode;</div><div class="line">               &#125;</div><div class="line">               index++;</div><div class="line">               pNode = tp;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               <span class="keyword">break</span>;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (partHead != <span class="literal">NULL</span>) &#123;</div><div class="line">           partHead-&gt;next = reverseHead;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (reverseTail != <span class="literal">NULL</span>) &#123;</div><div class="line">           reverseTail-&gt;next = pNode;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> (m == <span class="number">1</span>) &#123;</div><div class="line">           <span class="keyword">return</span> reverseHead;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">else</span>&#123;</div><div class="line">           <span class="keyword">return</span> head;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Largest Rectangle in Histogram</p>
<p>###问题描述<br>Given n non-negative integers representing the histogram’s bar height where the width of each bar is 1, find the area of largest rectangle in the histogram.<br><img src="/uploads/2014/11/09/1.png" alt=""><br>Above is a histogram where width of each bar is 1, given height = <code>[2,1,5,6,2,3]</code>.<br><img src="/uploads/2014/11/09/2.png" alt=""><br>The largest rectangle is shown in the shaded area, which has area = 10 unit.</p>
<p>For example,<br>Given height = <code>[2,1,5,6,2,3]</code>,<br>return <code>10</code>.</p>
<p>###解决方法<br>先贴一个最优解法，此方法由戴方勤提供。维护一个递增的栈，然后每次遍历，判断如果比栈顶得小，那么计算栈里面高于当前值区间的最大面积，然后再将此值压栈。代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;height)</span> </span>&#123;</div><div class="line">       <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; s;</div><div class="line">       height.push_back(<span class="number">0</span>);</div><div class="line">       <span class="keyword">int</span> result = <span class="number">0</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; height.size();) &#123;</div><div class="line">           <span class="keyword">if</span> (s.empty() || height[i] &gt; height[s.top()]) &#123;</div><div class="line">               s.push(i++);</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               <span class="keyword">int</span> pos = s.top();</div><div class="line">               s.pop();</div><div class="line">               <span class="keyword">int</span> span = s.empty() ? i : i - s.top() - <span class="number">1</span>;</div><div class="line">               <span class="keyword">int</span> area = height[pos] * span;</div><div class="line">               result = max(result, area);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>自己实现了个O(n2)的方法，在遍历到第i个直方，计算前面i-1个，总得面积，然后再跟当前最大值比较，<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">largestRectangleArea</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;height)</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (height.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> max = INT_MIN;</div><div class="line">       <span class="keyword">int</span> current_start = <span class="number">-1</span>;</div><div class="line">       <span class="keyword">int</span> current_height = <span class="number">0</span>;</div><div class="line">       <span class="keyword">int</span> current_max = INT_MIN;</div><div class="line">       </div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; height.size(); i++) &#123;</div><div class="line">           <span class="keyword">if</span> (height[i] == <span class="number">0</span>) &#123;</div><div class="line">               current_start = <span class="number">-1</span>;</div><div class="line">               current_height = INT_MAX;</div><div class="line">               current_max = INT_MIN;</div><div class="line">               <span class="keyword">continue</span>;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (current_start == <span class="number">-1</span>) &#123;</div><div class="line">               current_start = i;</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           current_height = INT_MAX;</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &gt;= current_start; j--) &#123;</div><div class="line">               <span class="keyword">if</span> (height[j] &lt; current_height) &#123;</div><div class="line">                   current_height = height[j];</div><div class="line">               &#125;</div><div class="line">               </div><div class="line">               <span class="keyword">if</span> ((i - j + <span class="number">1</span>) * current_height &gt; current_max) &#123;</div><div class="line">                   current_max = (i - j + <span class="number">1</span>) * current_height;</div><div class="line">               &#125;</div><div class="line">               </div><div class="line">               <span class="keyword">if</span> (current_max &gt; max) &#123;</div><div class="line">                   max = current_max;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> max;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/06/-LeetCode-Exercise-Day4/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/06/-LeetCode-Exercise-Day4/" itemprop="url">
                  [LeetCode]Exercise(Day4)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-06T23:37:13+08:00">
              2014-11-06
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/06/-LeetCode-Exercise-Day4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/06/-LeetCode-Exercise-Day4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/maomi.jpg" rel="gallery_cj0m5l1vr007kjftip510t6n1"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/maomi.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Word Ladder</p>
<p>###问题描述<br>You are given a string, S, and a list of words, L, that are all Given two words (start and end), and a dictionary, find the length of shortest transformation sequence from start to end, such that:</p>
<p>Only one letter can be changed at a time<br>Each intermediate word must exist in the dictionary<br>For example,</p>
<p>Given:<br>start = <code>&quot;hit&quot;</code><br>end = <code>&quot;cog&quot;</code><br>dict = <code>[&quot;hot&quot;,&quot;dot&quot;,&quot;dog&quot;,&quot;lot&quot;,&quot;log&quot;]</code><br>As one shortest transformation is <code>&quot;hit&quot;</code> -&gt; <code>&quot;hot&quot;</code> -&gt; <code>&quot;dot&quot;</code> -&gt; <code>&quot;dog&quot;</code> -&gt; <code>&quot;cog&quot;</code>,<br>return its length <code>5</code>.</p>
<p>Note:</p>
<ol>
<li>Return 0 if there is no such transformation sequence.</li>
<li>All words have the same length.</li>
<li>All words contain only lowercase alphabetic characters.</li>
</ol>
<p>###解决方法<br>可以先将L中得元素，按照只改变一个字母的原则，简历一颗树，这样问题就简化为，广度优先遍历这棵树，然后找到root到leaf得最短长度。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">ladderLength</span><span class="params">(<span class="built_in">string</span> start, <span class="built_in">string</span> end, <span class="built_in">unordered_set</span>&lt;<span class="built_in">string</span>&gt; &amp;dict)</span> </span>&#123;</div><div class="line">       <span class="built_in">queue</span>&lt;<span class="built_in">string</span>&gt; current, next;</div><div class="line">       <span class="built_in">unordered_set</span>&lt;<span class="built_in">string</span>&gt; visited;</div><div class="line"></div><div class="line">       <span class="keyword">auto</span> isEqualToEndString = [&amp;](<span class="keyword">const</span> <span class="built_in">string</span>&amp; s)&#123;<span class="keyword">return</span> s == end;&#125;;</div><div class="line">       <span class="keyword">auto</span> extendString = [&amp;](<span class="keyword">const</span> <span class="built_in">string</span>&amp; s)&#123;</div><div class="line">           <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; result;</div><div class="line"></div><div class="line">           <span class="keyword">const</span> <span class="keyword">size_t</span> length = s.length();</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</div><div class="line">               <span class="function"><span class="built_in">string</span> <span class="title">str</span><span class="params">(s)</span></span>;</div><div class="line">               <span class="keyword">for</span> (<span class="keyword">char</span> c = <span class="string">'a'</span>; c &lt;= <span class="string">'z'</span>; c++) &#123;</div><div class="line">                   <span class="keyword">if</span> (c == str[i]) <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">                   swap(c, str[i]);</div><div class="line"></div><div class="line">                   <span class="keyword">if</span> ((dict.count(str) || (str == end)) &gt; <span class="number">0</span> &amp;&amp; visited.count(str) == <span class="number">0</span>) &#123;</div><div class="line">                       visited.insert(str);</div><div class="line">                       result.push_back(str);</div><div class="line">                   &#125;</div><div class="line"></div><div class="line">                   swap(c, str[i]);</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125;;</div><div class="line">       <span class="keyword">bool</span> found = <span class="literal">false</span>;</div><div class="line">       <span class="keyword">int</span> level = <span class="number">0</span>;</div><div class="line">       current.push(start);</div><div class="line">       <span class="keyword">while</span> (!current.empty() &amp;&amp; !found) &#123;</div><div class="line">           ++level;</div><div class="line">           <span class="keyword">while</span> (!current.empty() &amp;&amp; !found) &#123;</div><div class="line">               <span class="keyword">const</span> <span class="built_in">string</span> str = current.front();</div><div class="line">               current.pop();</div><div class="line"></div><div class="line">               <span class="keyword">const</span> <span class="keyword">auto</span>&amp; extend = extendString(str);</div><div class="line">               <span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; state : extend)&#123;</div><div class="line">                   next.push(state);</div><div class="line">                   <span class="keyword">if</span> (isEqualToEndString(state)) &#123;</div><div class="line">                       found = <span class="literal">true</span>;</div><div class="line">                       <span class="keyword">break</span>;</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           swap(current, next);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (found) &#123;</div><div class="line">           <span class="keyword">return</span> level + <span class="number">1</span>;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">else</span>&#123;</div><div class="line">           <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Substring with Concatenation of All Words</p>
<p>###问题描述<br>You are given a string, S, and a list of words, L, that are all of the same length. Find all starting indices of substring(s) in S that is a concatenation of each word in L exactly once and without any intervening characters.</p>
<p>For example, given:<br>S: <code>&quot;barfoothefoobarman&quot;</code><br>L: <code>[&quot;foo&quot;, &quot;bar&quot;]</code></p>
<p>You should return the indices: [0,9].(order does not matter).</p>
<p>###解决方法<br>由于我写的代码在另一台机器上，以下是戴方勤的代码，思想就是在<code>S</code>中逐个查找，如果是在<code>L</code>中得单词，就进入j的循环，查看后面catLength长度的字符串是不是都符合题目中得要求，在L中能找到。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; findSubstring(<span class="built_in">string</span> s, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; dict) &#123;</div><div class="line">         <span class="keyword">size_t</span> wordLength = dict.front().length();</div><div class="line">         <span class="keyword">size_t</span> catLength = wordLength * dict.size();</div><div class="line">         <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result;</div><div class="line">         <span class="keyword">if</span> (s.length() &lt; catLength) <span class="keyword">return</span> result;</div><div class="line">         <span class="built_in">unordered_map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; wordCount;</div><div class="line">         <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word : dict) ++wordCount[word];</div><div class="line">         <span class="keyword">for</span> (<span class="keyword">auto</span> i = begin(s); i &lt;= prev(end(s), catLength); ++i) &#123;</div><div class="line">             <span class="built_in">unordered_map</span>&lt;<span class="built_in">string</span>, <span class="keyword">int</span>&gt; unused(wordCount);</div><div class="line">             <span class="keyword">for</span> (<span class="keyword">auto</span> j = i; j != next(i, catLength); j += wordLength) &#123;</div><div class="line">                 <span class="keyword">auto</span> pos = unused.find(<span class="built_in">string</span>(j, next(j, wordLength)));</div><div class="line">                 <span class="keyword">if</span> (pos == unused.end() || pos-&gt;second == <span class="number">0</span>) <span class="keyword">break</span>;</div><div class="line">                 <span class="keyword">if</span> (--pos-&gt;second == <span class="number">0</span>) unused.erase(pos);</div><div class="line">             &#125;</div><div class="line">             <span class="keyword">if</span> (unused.size() == <span class="number">0</span>) result.push_back(distance(begin(s), i));</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">return</span> result;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>##Path Sum II</p>
<p>###问题描述<br>Given a binary tree and a sum, find all root-to-leaf paths where each path’s sum equals the given sum.</p>
<p>For example:<br>Given the below binary tree and <code>sum = 22</code>,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">      5</div><div class="line">     / \</div><div class="line">    4   8</div><div class="line">   /   / \</div><div class="line">  11  13  4</div><div class="line"> /  \    / \</div><div class="line">7    2  5   1</div></pre></td></tr></table></figure>
<p>return<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">   [5,4,11,2],</div><div class="line">   [5,8,4,5]</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>###解决方法<br>这个题目，拿过来首先想到递归遍历，<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; pathSum(TreeNode *root, <span class="keyword">int</span> sum) &#123;</div><div class="line">       <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</div><div class="line">       <span class="keyword">if</span> (root == <span class="number">0</span>) <span class="keyword">return</span> result;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> val = root-&gt;val;</div><div class="line">       </div><div class="line">       <span class="keyword">if</span> ((val == sum) &amp;&amp; (root-&gt;left == <span class="literal">NULL</span>) &amp;&amp; (root-&gt;right == <span class="literal">NULL</span>)) &#123;</div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; t = &#123;val&#125;;</div><div class="line">           result.push_back(t);</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; leftPath = pathSum(root-&gt;left, sum - val);</div><div class="line">       <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; rightPath = pathSum(root-&gt;right, sum - val);</div><div class="line">       </div><div class="line">       </div><div class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> iter = leftPath.begin(); iter != leftPath.end(); iter++) &#123;</div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp = *iter;</div><div class="line">           tmp.insert(tmp.begin(), val);</div><div class="line">           result.push_back(tmp);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> iter = rightPath.begin(); iter != rightPath.end(); iter++) &#123;</div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp = *iter;</div><div class="line">           tmp.insert(tmp.begin(), val);</div><div class="line">           result.push_back(tmp);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Binary Tree Preorder Traversal</p>
<p>###问题描述<br>Given a binary tree, return the preorder traversal of its nodes’ values.</p>
<p>For example:<br>Given binary tree {1,#,2,3},<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">1</div><div class="line"> \</div><div class="line">  2</div><div class="line"> /</div><div class="line">3</div></pre></td></tr></table></figure></p>
<p>return <code>[1,2,3]</code>.</p>
<p>Note: Recursive solution is trivial, could you do it iteratively?</p>
<p>###解决方法<br>戴的解法是：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; preorderTraversal(TreeNode *root) &#123;</div><div class="line">         <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result;</div><div class="line">         <span class="keyword">const</span> TreeNode *p;</div><div class="line">         <span class="built_in">stack</span>&lt;<span class="keyword">const</span> TreeNode *&gt; s;</div><div class="line">         p = root;</div><div class="line">         <span class="keyword">if</span> (p != <span class="literal">nullptr</span>) s.push(p);</div><div class="line">         <span class="keyword">while</span> (!s.empty()) &#123;</div><div class="line">             p = s.top();</div><div class="line">             s.pop();</div><div class="line">             result.push_back(p-&gt;val);</div><div class="line">             <span class="keyword">if</span> (p-&gt;right != <span class="literal">nullptr</span>) s.push(p-&gt;right);</div><div class="line">             <span class="keyword">if</span> (p-&gt;left != <span class="literal">nullptr</span>) s.push(p-&gt;left);</div><div class="line">         &#125;</div><div class="line">         <span class="keyword">return</span> result;</div><div class="line">     &#125;</div></pre></td></tr></table></figure></p>
<p>我的解法，有点复杂，<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; preorderTraversal(TreeNode *root)</div><div class="line">   &#123;</div><div class="line">       <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result;</div><div class="line">       <span class="keyword">if</span> (root == <span class="literal">NULL</span>) <span class="keyword">return</span> result;</div><div class="line">       </div><div class="line">       <span class="built_in">stack</span>&lt;TreeNode*&gt; lpStack;</div><div class="line">       <span class="built_in">unordered_map</span>&lt;TreeNode*, <span class="keyword">bool</span>&gt; visited;</div><div class="line">       TreeNode* pNode = root;</div><div class="line">       </div><div class="line">       <span class="keyword">while</span> (pNode != <span class="literal">NULL</span>) &#123;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (!visited[pNode]) &#123;</div><div class="line">               lpStack.push(pNode);</div><div class="line">               visited[pNode] = <span class="literal">true</span>;</div><div class="line">               result.push_back(pNode-&gt;val);</div><div class="line">           &#125;</div><div class="line">           </div><div class="line">           <span class="keyword">if</span> (pNode-&gt;left &amp;&amp; !visited[pNode-&gt;left]) &#123;</div><div class="line">               pNode = pNode-&gt;left;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(pNode-&gt;right &amp;&amp; !visited[pNode-&gt;right])&#123;</div><div class="line">               pNode = pNode-&gt;right;</div><div class="line">           &#125;</div><div class="line">           <span class="keyword">else</span>&#123;</div><div class="line">               <span class="keyword">if</span> (lpStack.size() &gt; <span class="number">0</span>) &#123;</div><div class="line">                   pNode = lpStack.top();</div><div class="line">                   lpStack.pop();</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   pNode = <span class="literal">NULL</span>;</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Unique Paths</p>
<p>###问题描述<br>A robot is located at the top-left corner of a m x n grid (marked ‘Start’ in the diagram below).</p>
<p>The robot can only move either down or right at any point in time. The robot is trying to reach the bottom-right corner of the grid (marked ‘Finish’ in the diagram below).</p>
<p>How many possible unique paths are there?<br><img src="/uploads/2014/11/08/robot_maze.png" alt=""><br>Above is a 3 x 7 grid. How many possible unique paths are there?</p>
<p>Note: m and n will be at most 100.</p>
<p>###解决方法<br>利用动态规划，a[i][j] = a[i-1][j] + a[i][j-1],最后就可以得出a[m-1][n-1]的值。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">if</span> (m &lt;= <span class="number">0</span> || n &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">       <span class="keyword">if</span> (m == <span class="number">1</span> || n == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">       </div><div class="line">       <span class="keyword">int</span>* a = <span class="keyword">new</span> <span class="keyword">int</span>[m*n];</div><div class="line">       a[<span class="number">0</span>] = <span class="number">1</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">               <span class="keyword">if</span> (j == <span class="number">0</span> &amp;&amp; i == <span class="number">0</span>) &#123;</div><div class="line">                   <span class="keyword">continue</span>;</div><div class="line">               &#125;</div><div class="line">               </div><div class="line">               <span class="keyword">if</span> (j == <span class="number">0</span>) &#123;</div><div class="line">                   a[i*n + j] = a[(i - <span class="number">1</span>)*n + j];</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span> <span class="keyword">if</span> (i == <span class="number">0</span>)&#123;</div><div class="line">                   a[i*n + j] = a[j - <span class="number">1</span>];</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   a[i*n + j] = a[(i<span class="number">-1</span>)*n + j] + a[i*n + j - <span class="number">1</span>];</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> a[(m<span class="number">-1</span>)*n + n<span class="number">-1</span>];</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>##Subsets</p>
<p>###问题描述<br>Given a set of distinct integers, S, return all possible subsets.</p>
<p>Note:<br>Elements in a subset must be in non-descending order.<br>The solution set must not contain duplicate subsets.<br>For example,<br>If S = [1,2,3], a solution is:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  [3],</div><div class="line">  [1],</div><div class="line">  [2],</div><div class="line">  [1,2,3],</div><div class="line">  [1,3],</div><div class="line">  [2,3],</div><div class="line">  [1,2],</div><div class="line">  []</div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>###解决方法<br>先对队列排序，完了用递归，<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; subsets(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;S) &#123;</div><div class="line">       <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</div><div class="line">       <span class="keyword">if</span> (S.size() == <span class="number">0</span>) &#123;</div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; empty;</div><div class="line">           result.push_back(empty);</div><div class="line">           <span class="keyword">return</span> result;</div><div class="line">       &#125;</div><div class="line">       </div><div class="line">       sort(S.begin(), S.end());</div><div class="line">       </div><div class="line">       <span class="keyword">int</span> val = S.front();</div><div class="line">       S.erase(S.begin());</div><div class="line">       <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; prevs = subsets(S);</div><div class="line">       result = prevs;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">auto</span> iter = prevs.begin(); iter != prevs.end(); iter++) &#123;</div><div class="line">           <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tmp = *iter;</div><div class="line">           tmp.insert(tmp.begin(), val);</div><div class="line">           result.push_back(tmp);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/05/-LeetCode-Exercise-Day3/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/05/-LeetCode-Exercise-Day3/" itemprop="url">
                  [LeetCode]Exercise(Day3)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-05T22:59:35+08:00">
              2014-11-05
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/05/-LeetCode-Exercise-Day3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/05/-LeetCode-Exercise-Day3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Permutation Sequence</p>
<p>###问题描述<br>The set [1,2,3,⋯,n] contains a total of n! unique permutations.<br>By listing and labeling all of the permutations in order, We get the following sequence (ie, for n = 3):<br>  “123”<br>  “132”<br>  “213”<br>  “231”<br>  “312”<br>  “321”<br>Given n and k, return the kth permutation sequence.<br> Note: Given n will be between 1 and 9 inclusive.</p>
<p>###解决方法<br>这个可以利用上一个问题里面的方法，暴力破解，逐个查找，直到第K个。<br>从别人的了解到还有康托编码的方法解决这个问题，<br>利用康托编码的思路,假设有n个不重复的元素,第k个排列是a1,a2,a3,…,an,那么a1 是 哪一个位置呢?<br>我们把 a1 去掉,那么剩下的排列为 a2, a3, …, an, 共计 n − 1 个元素,n − 1 个元素共有 (n − 1)! 个排列,于是就可以知道 a1 = k/(n − 1)!。<br>同理,a2,a3,…,an 的值推导如下:</p>
<p><img src="/uploads/2014/11/05/1.png" alt="" title="Title"></p>
<p>使用 next_permutation()<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// LeetCode, Permutation Sequence // 使用 next_permutation(),TLE class Solution &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">      <span class="function"><span class="built_in">string</span> <span class="title">getPermutation</span><span class="params">(<span class="keyword">int</span> n, <span class="keyword">int</span> k)</span> </span>&#123;</div><div class="line">          <span class="function"><span class="built_in">string</span> <span class="title">s</span><span class="params">(n, <span class="string">'0'</span>)</span></span>;</div><div class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i)</div><div class="line">              s[i] += i+<span class="number">1</span>;</div><div class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k<span class="number">-1</span>; ++i)</div><div class="line">              next_permutation(s.begin(), s.end());</div><div class="line">          <span class="keyword">return</span> s;</div><div class="line">	&#125;</div><div class="line">      <span class="keyword">template</span>&lt;<span class="keyword">typename</span> BidiIt&gt;</div><div class="line">      <span class="function"><span class="keyword">bool</span> <span class="title">next_permutation</span><span class="params">(BidiIt first, BidiIt last)</span> </span>&#123;</div><div class="line">	<span class="comment">// 代码见上一题 Next Permutation</span></div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>康托编码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> Sequence&gt;</div><div class="line">   <span class="function">Sequence <span class="title">kth_permutation</span><span class="params">(<span class="keyword">const</span> Sequence&amp; seq, <span class="keyword">int</span> k)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">const</span> <span class="keyword">int</span> n = (<span class="keyword">int</span>)seq.size();</div><div class="line">       <span class="function">Sequence <span class="title">S</span><span class="params">(seq)</span></span>;</div><div class="line">       Sequence result;</div><div class="line">       <span class="keyword">int</span> base = factorial(n<span class="number">-1</span>);</div><div class="line">       --k;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; k %= base, base /= i, i--) &#123;</div><div class="line">           <span class="keyword">auto</span> a = next(S.begin(), k / base);</div><div class="line">           result.push_back(*a);</div><div class="line">           S.erase(a);</div><div class="line">       &#125;</div><div class="line">       result.push_back(S[<span class="number">0</span>]);</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>###扩展阅读<br>康托编码<br><br>{1,2,3,4,…,n}表示1,2,3,…,n的排列如 {1,2,3} 按从小到大排列一共6个。123 132 213 231 312 321 。<br>代表的数字 1 2 3 4 5 6 也就是把10进制数与一个排列对应起来。<br>他们间的对应关系可由康托展开来找到。<br>如我想知道321是{1,2,3}中第几个小的数可以这样考虑 ：</p>
<p>第一位是3，当第一位的数小于3时，那排列数小于321 如 123、 213 ，小于3的数有1、2 。所以有2<em>2!个。再看小于第二位2的：小于2的数只有一个就是1 ，所以有1</em>1!=1 所以小于321的{1,2,3}排列数有2<em>2!+1</em>1!=5个。所以321是第6个小的数。 2<em>2!+1</em>1!+0*0!就是康托展开。</p>
<p>再举个例子：1324是{1,2,3,4}排列数中第几个大的数：第一位是1小于1的数没有，是0个 0<em>3! 第二位是3小于3的数有1和2，但1已经在第一位了，所以只有一个数2 1</em>2! 。第三位是2小于2的数是1，但1在第一位，所以有0个数 0<em>1! ，所以比1324小的排列有0</em>3!+1<em>2!+0</em>1!=2个，1324是第三个小数。</p>
<p>##Trapping Rain Water</p>
<p>###问题描述<br>Given n non-negative integers representing an elevation map where the width of each bar is 1, compute how much water it is able to trap after raining.</p>
<p>For example, Given [0,1,0,2,1,0,1,3,2,1,2,1], return 6.</p>
<p><img src="/uploads/2014/11/05/2.png" alt=""></p>
<p>###解决方法<br>应该从没一个数字去考虑，比如上面序列第2个0的位置，也就是第3个数字，可以查找它两边最高的，然后取两者之间的最小值，减去自己的高度，这个差值就是当前位置的储水量，即<code>min(max_left, max_right) - height</code>。问题来了，怎么找到它的左右两边的最大值，遍历一遍，可以找到。以下参考网上的解决方法。</p>
<ol>
<li>从左往右扫描一遍,对于每个柱子,求取左边最大值;</li>
<li>从右往左扫描一遍,对于每个柱子,求最大右值;</li>
<li>再扫描一遍,把每个柱子的面积并累加。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">trap</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">int</span>* max_left = <span class="keyword">new</span> <span class="keyword">int</span>(n);</div><div class="line">       <span class="keyword">int</span>* max_right = <span class="keyword">new</span> <span class="keyword">int</span>(n);</div><div class="line"></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">           max_left[i] = max(max_left[i<span class="number">-1</span>], A[i]);</div><div class="line">           max_right[n - i - <span class="number">1</span>] = max(max_right[n - i], A[n - i - <span class="number">1</span>]);</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">int</span> result = <span class="number">0</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">           <span class="keyword">int</span> heigh = min(max_left[i], max_right[i]) - i;</div><div class="line">           <span class="keyword">if</span> (heigh &gt; <span class="number">0</span>) &#123;</div><div class="line">               result = heigh;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">delete</span> [] max_left;</div><div class="line">       <span class="keyword">delete</span> [] max_right;</div><div class="line">       <span class="keyword">return</span> result;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>还有一种解决方法，就是用栈来保存峰值信息。小于的话，直接压栈，只要比top的大或相等，就出栈。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">trap2</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="built_in">stack</span>&lt;Pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; lpStack;</div><div class="line"></div><div class="line">       <span class="keyword">int</span> water = <span class="number">0</span>;</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">           <span class="keyword">int</span> height = <span class="number">0</span>;</div><div class="line"></div><div class="line">           <span class="keyword">while</span> (!lpStack.empty()) &#123;</div><div class="line">               <span class="keyword">int</span> bar = lpStack.top().first();</div><div class="line">               <span class="keyword">int</span> pos = lpStack.top().second();</div><div class="line"></div><div class="line">               water += (min(bar, A[i]) - height) * (i - pos - <span class="number">1</span>);</div><div class="line">               height = bar;</div><div class="line"></div><div class="line">               <span class="keyword">if</span> (bar &gt; A[i]) &#123;</div><div class="line">                   <span class="keyword">break</span>;</div><div class="line">               &#125;</div><div class="line">               <span class="keyword">else</span>&#123;</div><div class="line">                   lpStack.pop();</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line"></div><div class="line">           lpStack.push(Pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;(A[i], i));</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">return</span> water;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>##Rotate Image</p>
<p>###问题描述<br>You are given an n × n 2D matrix representing an image. Rotate the image by 90 degrees (clockwise).<br>Follow up: Could you do this in-place?</p>
<p>###解决方法<br>首先想到,纯模拟,从外到内一圈一圈的转,但这个方法太慢。<br>  如下图,首先沿着副对角线翻转一次,然后沿着水平中线翻转一次。<br><img src="/uploads/2014/11/05/3.png" alt=""></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt;&amp; matrix)</span></span></div><div class="line">   &#123;</div><div class="line">       <span class="keyword">const</span> <span class="keyword">int</span> n = (<span class="keyword">int</span>)matrix.size();</div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n - i; j++) &#123;</div><div class="line">               swap(matrix[i][j], matrix[n - j - <span class="number">1</span>][n - i - <span class="number">1</span>]);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n / <span class="number">2</span>; i++) &#123;</div><div class="line">           <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++) &#123;</div><div class="line">               swap(matrix[i][j], matrix[n - i - <span class="number">1</span>][j]);</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/04/-iOS-底层并发-API-读书笔记/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/04/-iOS-底层并发-API-读书笔记/" itemprop="url">
                  [iOS]底层并发 API-读书笔记
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-04T19:18:59+08:00">
              2014-11-04
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/04/-iOS-底层并发-API-读书笔记/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/04/-iOS-底层并发-API-读书笔记/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##GCD和NSOperationQueue<br>GCD是基于C的耿底层的API，它可以</p>
<p>##dispatch_once<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">UIColor</span> *)boringColor;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">UIColor</span> *color;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        color = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">0.380</span>f green:<span class="number">0.376</span>f blue:<span class="number">0.376</span>f alpha:<span class="number">1.000</span>f];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> color;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>onceToken 被声明为 static ，或者有全局作用域</li>
</ol>
<p>##dispatch_after<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)foo</div><div class="line">&#123;</div><div class="line">    <span class="keyword">double</span> delayInSeconds = <span class="number">2.0</span>;</div><div class="line">    dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t) (delayInSeconds * <span class="built_in">NSEC_PER_SEC</span>));</div><div class="line">    dispatch_after(popTime, dispatch_get_main_queue(), ^(<span class="keyword">void</span>)&#123;</div><div class="line">        [<span class="keyword">self</span> bar];</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##Queue<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)init;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</div><div class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> != <span class="literal">nil</span>) &#123;</div><div class="line">        <span class="built_in">NSString</span> *label = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@.isolation.%p"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">self</span>];</div><div class="line">        <span class="keyword">self</span>.isolationQueue = dispatch_queue_create([label UTF8String], <span class="number">0</span>);</div><div class="line"></div><div class="line">        label = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@.work.%p"</span>, [<span class="keyword">self</span> <span class="keyword">class</span>], <span class="keyword">self</span>];</div><div class="line">        <span class="keyword">self</span>.workQueue = dispatch_queue_create([label UTF8String], <span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>默认情况下，队列是串行的。</li>
<li>GCD 通过创建所谓的线程池来大致匹配 CPU 内核数量。</li>
<li>不应该在GCD队列中以阻塞的方式来做这些操作，比如从文件或者网络中读写数据</li>
</ol>
<p>###目标队列<br><code>(lldb) thread list</code> 命令将会在控制台打印出所有队列的名字</p>
<p>###优先级<br>DISPATCH_QUEUE_PRIORITY_BACKGROUND，理解了 throttled I/O 和 background status as per setpriority(2) 的意义</p>
<p>##隔离</p>
<p>###单一资源的多读单写<br>创建队列<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">self</span>.isolationQueue = dispatch_queue_create([label UTF8String], DISPATCH_QUEUE_CONCURRENT);</div></pre></td></tr></table></figure></p>
<p>读写操作<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setCount:(<span class="built_in">NSUInteger</span>)count forKey:(<span class="built_in">NSString</span> *)key</div><div class="line">&#123;</div><div class="line">    key = [key <span class="keyword">copy</span>];</div><div class="line">    dispatch_barrier_async(<span class="keyword">self</span>.isolationQueue, ^()&#123;</div><div class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</div><div class="line">            [<span class="keyword">self</span>.counts removeObjectForKey:key];</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">self</span>.counts[key] = @(count);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div><div class="line">- (<span class="built_in">NSUInteger</span>)countForKey:(<span class="built_in">NSString</span> *)key;</div><div class="line">&#123;</div><div class="line">    __block <span class="built_in">NSUInteger</span> count;</div><div class="line">    <span class="built_in">dispatch_sync</span>(<span class="keyword">self</span>.isolationQueue, ^()&#123;</div><div class="line">        <span class="built_in">NSNumber</span> *n = <span class="keyword">self</span>.counts[key];</div><div class="line">        count = [n unsignedIntegerValue];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> count;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>当使用并发队列时，要确保所有的 barrier 调用都是 async 的.</li>
</ol>
<p>###锁竞争</p>
<ol>
<li>所有对 dispatch_async，dispatch_sync 等等的调用都需要完成某种形式的锁——以确保仅有一个线程或者特定的线程运行指定的代码</li>
<li><p>性能下降的原因：</p>
<p> 第一个是独占临界区资源太久的开销，以至于别的线程都因为进入临界区的操作而阻塞。第二个是太频繁出入临界区的开销</p>
</li>
</ol>
<p>###全都使用异步分发<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queueA; <span class="comment">// assume we have this</span></div><div class="line"><span class="built_in">dispatch_sync</span>(queueA, ^()&#123;</div><div class="line">    <span class="built_in">dispatch_sync</span>(queueA, ^()&#123;</div><div class="line">        foo();</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>进入第2个dispatch_sync会发生死锁。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">dispatch_queue_t</span> queueA; <span class="comment">// assume we have this</span></div><div class="line"><span class="built_in">dispatch_async</span>(queueA, ^()&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(queueA, ^()&#123;</div><div class="line">        foo();</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>##如何写出好的异步API<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)processImage:(<span class="built_in">UIImage</span> *)image completionHandler:(<span class="keyword">void</span>(^)(<span class="built_in">BOOL</span> success))handler;</div><div class="line">&#123;</div><div class="line">    <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.isolationQueue, ^(<span class="keyword">void</span>)&#123;</div><div class="line">        <span class="comment">// do actual processing here</span></div><div class="line">        <span class="built_in">dispatch_async</span>(<span class="keyword">self</span>.resultQueue, ^(<span class="keyword">void</span>)&#123;</div><div class="line">            handler(<span class="literal">YES</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##迭代执行diapatch_apply<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">dispatch_apply(height, dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^(size_t y) &#123;</div><div class="line">    <span class="keyword">for</span> (size_t x = <span class="number">0</span>; x &lt; width; x += <span class="number">2</span>) &#123;</div><div class="line">        <span class="comment">// Do something with x and y here</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>##组<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">dispatch_group_t group = dispatch_group_create();</div><div class="line"></div><div class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</div><div class="line">dispatch_group_async(group, queue, ^()&#123;</div><div class="line">    <span class="comment">// Do something that takes a while</span></div><div class="line">    [<span class="keyword">self</span> doSomeFoo];</div><div class="line">    dispatch_group_async(group, dispatch_get_main_queue(), ^()&#123;</div><div class="line">        <span class="keyword">self</span>.foo = <span class="number">42</span>;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line">dispatch_group_async(group, queue, ^()&#123;</div><div class="line">    <span class="comment">// Do something else that takes a while</span></div><div class="line">    [<span class="keyword">self</span> doSomeBar];</div><div class="line">    dispatch_group_async(group, dispatch_get_main_queue(), ^()&#123;</div><div class="line">        <span class="keyword">self</span>.bar = <span class="number">1</span>;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// This block will run once everything above is done:</span></div><div class="line">dispatch_group_notify(group, dispatch_get_main_queue(), ^()&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"foo: %d"</span>, <span class="keyword">self</span>.foo);</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"bar: %d"</span>, <span class="keyword">self</span>.bar);</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>##对现有API使用dispatch_group_t</p>
<p>确保自己使用 groups 的代码是成对出现的。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)withGroup:(dispatch_group_t)group performBlock:(dispatch_block_t)block</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (group == <span class="literal">NULL</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> performBlock:block];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        dispatch_group_enter(group);</div><div class="line">        [<span class="keyword">self</span> performBlock:^()&#123;</div><div class="line">            block();</div><div class="line">            dispatch_group_leave(group);</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>可以用<code>dispatch_group_notify</code>来运行一个block</p>
<p>类似的对于NSURLConnection，也可以做同样的事情<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">+ (<span class="keyword">void</span>)withGroup:(dispatch_group_t)group </div><div class="line">        sendAsynchronousRequest:(<span class="built_in">NSURLRequest</span> *)request </div><div class="line">        queue:(<span class="built_in">NSOperationQueue</span> *)queue </div><div class="line">        completionHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSURLResponse</span>*, <span class="built_in">NSData</span>*, <span class="built_in">NSError</span>*))handler</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (group == <span class="literal">NULL</span>) &#123;</div><div class="line">        [<span class="keyword">self</span> sendAsynchronousRequest:request </div><div class="line">                                queue:queue </div><div class="line">                    completionHandler:handler];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        dispatch_group_enter(group);</div><div class="line">        [<span class="keyword">self</span> sendAsynchronousRequest:request </div><div class="line">                                queue:queue </div><div class="line">                    completionHandler:^(<span class="built_in">NSURLResponse</span> *response, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error)&#123;</div><div class="line">            handler(response, data, error);</div><div class="line">            dispatch_group_leave(group);</div><div class="line">        &#125;];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li><code>dispatch_group_enter()</code> 必须要在 <code>dispatch_group_leave()</code>之前运行。</li>
<li><code>dispatch_group_enter()</code> 和 <code>dispatch_group_leave()</code> 一直是成对出现的（就算有错误产生时）。</li>
</ol>
<p>##事件源</p>
<p>###监视进程<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSRunningApplication</span> *mail = [<span class="built_in">NSRunningApplication</span> </div><div class="line">  runningApplicationsWithBundleIdentifier:<span class="string">@"com.apple.mail"</span>];</div><div class="line"><span class="keyword">if</span> (mail == <span class="literal">nil</span>) &#123;</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">pid_t <span class="keyword">const</span> pid = mail.processIdentifier;</div><div class="line"><span class="keyword">self</span>.source = dispatch_source_create(DISPATCH_SOURCE_TYPE_PROC, pid, </div><div class="line">  DISPATCH_PROC_EXIT, DISPATCH_TARGET_QUEUE_DEFAULT);</div><div class="line">dispatch_source_set_event_handler(<span class="keyword">self</span>.source, ^()&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Mail quit."</span>);</div><div class="line">&#125;);</div><div class="line">dispatch_resume(<span class="keyword">self</span>.source);</div></pre></td></tr></table></figure></p>
<p>在所有的事件源被传递到你的事件处理器之前，必须调用 dispatch_resume()</p>
<p>###监视文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSURL</span> *directoryURL; <span class="comment">// assume this is set to a directory</span></div><div class="line"><span class="keyword">int</span> <span class="keyword">const</span> fd = open([[directoryURL path] fileSystemRepresentation], O_EVTONLY);</div><div class="line"><span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</div><div class="line">    <span class="keyword">char</span> buffer[<span class="number">80</span>];</div><div class="line">    strerror_r(errno, buffer, <span class="keyword">sizeof</span>(buffer));</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Unable to open \"%@\": %s (%d)"</span>, [directoryURL path], buffer, errno);</div><div class="line">    <span class="keyword">return</span>;</div><div class="line">&#125;</div><div class="line">dispatch_source_t source = dispatch_source_create(DISPATCH_SOURCE_TYPE_VNODE, fd, </div><div class="line">  DISPATCH_VNODE_WRITE | DISPATCH_VNODE_DELETE, DISPATCH_TARGET_QUEUE_DEFAULT);</div><div class="line">dispatch_source_set_event_handler(source, ^()&#123;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">const</span> data = dispatch_source_get_data(source);</div><div class="line">    <span class="keyword">if</span> (data &amp; DISPATCH_VNODE_WRITE) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"The directory changed."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span> (data &amp; DISPATCH_VNODE_DELETE) &#123;</div><div class="line">        <span class="built_in">NSLog</span>(<span class="string">@"The directory has been deleted."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line">dispatch_source_set_cancel_handler(source, ^()&#123;</div><div class="line">    close(fd);</div><div class="line">&#125;);</div><div class="line"><span class="keyword">self</span>.source = source;</div><div class="line">dispatch_resume(<span class="keyword">self</span>.source);</div></pre></td></tr></table></figure></p>
<p>##定时器<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">dispatch_source_t source = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, </div><div class="line">  <span class="number">0</span>, <span class="number">0</span>, DISPATCH_TARGET_QUEUE_DEFAULT);</div><div class="line">dispatch_source_set_event_handler(source, ^()&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Time flies."</span>);</div><div class="line">&#125;);</div><div class="line">dispatch_time_t start</div><div class="line">dispatch_source_set_timer(source, DISPATCH_TIME_NOW, <span class="number">5</span>ull * <span class="built_in">NSEC_PER_SEC</span>, </div><div class="line">  <span class="number">100</span>ull * <span class="built_in">NSEC_PER_MSEC</span>);</div><div class="line"><span class="keyword">self</span>.source = source;</div><div class="line">dispatch_resume(<span class="keyword">self</span>.source);</div></pre></td></tr></table></figure></p>
<p>##GCD和缓冲区<br>GCD的缓冲区<code>dispatch_data_t</code>，类似于Objective-C的NSData。<br>这个缓冲区要么基于栈，要么基于内存区域。<code>dispatch_data_t</code>是基于零碎的内存区域。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dispatch_data_t a; <span class="comment">// Assume this hold some valid data</span></div><div class="line">dispatch_data_t b; <span class="comment">// Assume this hold some valid data</span></div><div class="line">dispatch_data_t c = dispatch_data_create_concat(a, b);</div></pre></td></tr></table></figure></p>
<p>以上只是retain了a和b。一下代码用来遍历c持有的内存区域：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">dispatch_data_apply(c, ^(dispatch_data_t region, size_t offset, <span class="keyword">const</span> <span class="keyword">void</span> *buffer, size_t size) &#123;</div><div class="line">    fprintf(stderr, <span class="string">"region with offset %zu, size %zu\n"</span>, offset, size);</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><code>dispatch_data_create_subrange</code> 来创建一个不做任何拷贝操作的子区域</p>
<p>##读和写<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">dispatch_io_t dispatch_io_create(dispatch_io_type_t type, dispatch_fd_t fd, </div><div class="line">  <span class="built_in">dispatch_queue_t</span> queue, <span class="keyword">void</span> (^cleanup_handler)(<span class="keyword">int</span> error));</div></pre></td></tr></table></figure></p>
<ol>
<li>有两种从根本上不同类型的通道：流和随机存取</li>
<li><code>dispatch_io_create_with_path</code>, GCD会延迟打开这个文件以限制相同时间内同时打开的文件数量</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/02/-LeetCode-Exercise-Day2/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/02/-LeetCode-Exercise-Day2/" itemprop="url">
                  [LeetCode]Exercise(Day2)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-02T10:20:43+08:00">
              2014-11-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/02/-LeetCode-Exercise-Day2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/02/-LeetCode-Exercise-Day2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cj0m5l1vl007ajftiv5lcs4md"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##Two Sum</p>
<p>###问题描述<br>Given an array of integers, find two numbers such that they add up to a specific target number.<br>The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2. Please note that your returned answers (both index1 and index2) are not zero-based.<br>You may assume that each input would have exactly one solution. Input: numbers={2, 7, 11, 15}, target=9<br>Output: index1=1, index2=2</p>
<p>###解决方法<br>我们可以用一个hashmap来保存之前已经遍历的值，然后在便利到某个值的时候，可以先找与它匹配的值是否已经加到hashmap里面；如果有，返回此值，否则继续，知道遍历完整个数组。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; twoSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;num, <span class="keyword">int</span> target)</div><div class="line">&#123;</div><div class="line">    <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; mapping;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result;</div><div class="line">    </div><div class="line">    <span class="keyword">size_t</span> size = num.size();</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</div><div class="line">        <span class="keyword">int</span> key = num[i];</div><div class="line">        <span class="keyword">if</span> (mapping[key] == <span class="number">0</span>) &#123;</div><div class="line">            mapping[key] = i+<span class="number">1</span>;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="comment">// find the next one</span></div><div class="line">        <span class="keyword">int</span> other = target - key;</div><div class="line">        <span class="keyword">if</span> (mapping[other] != <span class="number">0</span>) &#123;</div><div class="line">            result.push_back(mapping[other]);</div><div class="line">            result.push_back(i+<span class="number">1</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##3Sum</p>
<p>###问题描述<br>Given an array S of n integers, are there elements a,b,c in S such that a + b + c = 0? Find all unique triplets in the array which gives the sum of zero.<br>Note:<br>• Elements in a triplet (a, b, c) must be in non-descending order. (ie, a ≤ b ≤ c) • Thesolutionsetmustnotcontainduplicatetriplets.<br>For example, given array S = {-1 0 1 2 -1 -4}.<br>A solution set is:<br>  (-1, 0, 1)<br>  (-1, -1, 2)</p>
<p>###解决方法<br>有2个方法可以解决，时间复杂度都是O(n^2);<br>方法1：利用2个函数的和的那个函数，先拿出一个值来，再确定另外2个值，<br>方法2：先排序再从外向内的查找第3个数。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; num, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// 1 partition</span></div><div class="line">    <span class="keyword">int</span> key = num[left];</div><div class="line">    <span class="keyword">int</span> l = left;</div><div class="line">    <span class="keyword">int</span> h = right;</div><div class="line">    <span class="keyword">while</span>(l &lt; h)&#123;</div><div class="line">        <span class="keyword">while</span>(h &gt; l &amp;&amp; num[h] &gt;= key) h--;</div><div class="line">        num[l] = num[h];</div><div class="line">        <span class="keyword">while</span>(l &lt; h &amp;&amp; num[l] &lt;= key) l++;</div><div class="line">        num[h] = num[l];</div><div class="line">    &#125;</div><div class="line">    num[l] = key;</div><div class="line">    </div><div class="line">    <span class="comment">// quick left and right</span></div><div class="line">    quickSort(num, left, l - <span class="number">1</span>);</div><div class="line">    quickSort(num, l + <span class="number">1</span>, right);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// -1, 0, 1, 2, -1, -4</span></div><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; threeSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; num)</div><div class="line">&#123;</div><div class="line">    <span class="comment">// 1. quick sort</span></div><div class="line">    quickSort(num, <span class="number">0</span>, num.size() - <span class="number">1</span>);</div><div class="line">    </div><div class="line">    <span class="comment">// 2. find the right value</span></div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> target = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> l = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> h = (<span class="keyword">int</span>)num.size() - <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(h - l &gt; <span class="number">1</span>)&#123;</div><div class="line">        <span class="keyword">int</span> key1 = num[l];</div><div class="line">        <span class="keyword">int</span> key2 = num[h];</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> key3 = target - key1 - key2;</div><div class="line">        <span class="keyword">int</span> index = <span class="number">-1</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = l + <span class="number">1</span>; i &lt; h; i++)&#123;</div><div class="line">            <span class="keyword">if</span> (num[i] == key3) &#123;</div><div class="line">                index = i;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">        <span class="keyword">if</span>(index != <span class="number">-1</span>)&#123;</div><div class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; t;</div><div class="line">            t.push_back(key1);</div><div class="line">            t.push_back(key3);</div><div class="line">            t.push_back(key2);</div><div class="line">            result.push_back(t);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (key3 &gt;= <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">do</span> &#123;l++;&#125; <span class="keyword">while</span> (num[l] == key1);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(key3 &lt; <span class="number">0</span>)&#123;</div><div class="line">            <span class="keyword">do</span> &#123;h--;&#125; <span class="keyword">while</span> (num[h] == key2);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    sort(result.begin(), result.end());</div><div class="line">    result.erase(unique(result.begin(), result.end()), result.end());</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###扩展阅读<br>STL Unique函数的作用是去除相邻重复元素</p>
<p>##Remove Element</p>
<p>###问题描述<br>Given an array and a value, remove all instances of that value in place and return the new length. The order of elements can be changed. It doesn’t matter what you leave beyond the new length.</p>
<p>###解决方法<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeElement</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n, <span class="keyword">int</span> elem)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> index = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (A[i] != elem) &#123;</div><div class="line">            A[++index] = A[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> index + <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##Next Permutation</p>
<p>###问题描述<br>Implement next permutation, which rearranges numbers into the lexicographically next greater permu- tation of numbers.<br>If such arrangement is not possible, it must rearrange it as the lowest possible order (ie, sorted in ascend- ing order).<br>The replacement must be in-place, do not allocate extra memory.<br>Here are some examples. Inputs are in the left-hand column and its corresponding outputs are in the right-hand column.<br>  1,2,3 → 1,3,2<br>  3,2,1 → 1,2,3<br>  1,1,5 → 1,5,1</p>
<p>###解决方法<br>之前碰到过类似的题目，先从后面往前查找，第一个减小的数字，比如[1, 2, 3]，查找的时候因为3&gt;2，所以就停下，进行替换，替换的时候需要找到2后面：大于2且最小的值；置换2和此数字之后，再降后面的数组进行排序（因为我们之前判定过了是递增的，从后往前方向，所以这边直接reverse就可以）。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> _Iter&gt;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">next_permutation2</span><span class="params">(_Iter first, _Iter last)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> rfirst = reverse_iterator&lt;_Iter&gt;(last);</div><div class="line">    <span class="keyword">const</span> <span class="keyword">auto</span> rlast = reverse_iterator&lt;_Iter&gt;(first);</div><div class="line">    </div><div class="line">    <span class="keyword">auto</span> pivot = next(rfirst);</div><div class="line">    </div><div class="line">    <span class="keyword">while</span> (pivot != rlast &amp;&amp; *pivot &gt; *(prev(pivot)))</div><div class="line">        pivot++;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span> (pivot == rlast) &#123;</div><div class="line">        reverse(first, last);</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">auto</span> change = find_if(rfirst, pivot, bind1st(less&lt;<span class="keyword">int</span>&gt;(), *pivot));</div><div class="line">    swap(*change, *pivot);</div><div class="line">    reverse(rfirst, pivot);</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此程序是参考的其他人用STL编写的，其中用到了大量的STL操作，后续再做介绍。我自己实现了一个较难理解的程序，如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; num, <span class="keyword">int</span> left, <span class="keyword">int</span> right)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (left &gt;= right) <span class="keyword">return</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// 1 partition</span></div><div class="line">    <span class="keyword">int</span> key = num[left];</div><div class="line">    <span class="keyword">int</span> l = left;</div><div class="line">    <span class="keyword">int</span> h = right;</div><div class="line">    <span class="keyword">while</span>(l &lt; h)&#123;</div><div class="line">        <span class="keyword">while</span>(h &gt; l &amp;&amp; num[h] &gt;= key) h--;</div><div class="line">        num[l] = num[h];</div><div class="line">        <span class="keyword">while</span>(l &lt; h &amp;&amp; num[l] &lt;= key) l++;</div><div class="line">        num[h] = num[l];</div><div class="line">    &#125;</div><div class="line">    num[l] = key;</div><div class="line">    </div><div class="line">    <span class="comment">// quick left and right</span></div><div class="line">    quickSort(num, left, l - <span class="number">1</span>);</div><div class="line">    quickSort(num, l + <span class="number">1</span>, right);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">nextPermutation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;num)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">//1. find the first lower num</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">int</span> lCount = (<span class="keyword">int</span>)num.size();</div><div class="line">    <span class="keyword">int</span> lChangeIndex = <span class="number">-1</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = lCount - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</div><div class="line">        <span class="keyword">if</span> (num[i<span class="number">-1</span>] &lt; num[i]) &#123;</div><div class="line">            lChangeIndex = i<span class="number">-1</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// if the vec is like 3, 2, 1, reverse it automatically</span></div><div class="line">    <span class="keyword">if</span> (lChangeIndex == <span class="number">-1</span>) &#123;</div><div class="line">        <span class="keyword">int</span> l = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> h = lCount - <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (l &lt; h) &#123;</div><div class="line">            <span class="keyword">int</span> t = num[l];</div><div class="line">            num[l] = num[h];</div><div class="line">            num[h] = t;</div><div class="line">            l++; h--;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">int</span> lNextNum = INT_MAX;</div><div class="line">        <span class="keyword">int</span> lNextIndex = <span class="number">-1</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = lChangeIndex + <span class="number">1</span>; i &lt; lCount; i++) &#123;</div><div class="line">            <span class="keyword">if</span>(num[i] &gt; num[lChangeIndex] &amp;&amp; num[i] &lt; lNextNum)&#123;</div><div class="line">                lNextNum = num[i];</div><div class="line">                lNextIndex = i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> t = num[lChangeIndex];</div><div class="line">        num[lChangeIndex] = num[lNextIndex];</div><div class="line">        num[lNextIndex] = t;</div><div class="line">        quickSort(num, lChangeIndex + <span class="number">1</span>, lCount - <span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###扩展阅读</p>
<p>####reverse_iterator<br>对于left_null&gt;1-&gt;2-&gt;3-&gt;4-&gt;right_null,这样一个有4个元素(1,2,3,4)的链表.<br>    1-&gt;2-&gt;3-&gt;4-&gt;尾<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;iteraotr c1=intList.begin()      <span class="comment">// *c1=1;</span></div><div class="line"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;iteraotr c2=intList.end()         <span class="comment">// *c2=right_null;</span></div></pre></td></tr></table></figure></p>
<pre><code>尾&lt;-1&lt;-2&lt;-3&lt;-4
</code></pre><p><code>iterator++</code>,则对于上边正向链表从左向右遍历<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">*(--c2)=<span class="number">4</span>;</div><div class="line"><span class="keyword">for</span>(c1=.begin(),c1!=.end();c1++)</div><div class="line">       <span class="built_in">cout</span>&lt;&lt;..<span class="number">.1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span></div><div class="line"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;reverse_iteraotr c1=intList.rbegin()      <span class="comment">// *c1=4;   rbegin:相当于reverse_begin即反着看的头</span></div><div class="line"><span class="built_in">list</span>&lt;<span class="keyword">int</span>&gt;reverse_iteraotr c1=intList.rend()         <span class="comment">// *c1=left_null; rend相当于reverse_end即反着看的尾</span></div></pre></td></tr></table></figure></p>
<p><code>reverse_iterator++</code>,则对于上边正向链表从右向左遍历.<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">*(--c2)=<span class="number">1</span>;</div><div class="line"><span class="keyword">for</span>(c2=.rbegin();r2!=.rend();c2++)</div></pre></td></tr></table></figure></p>
<p>相当于:4 3 2 1</p>
<p>####bind1st和bind2nd函数<br><code>bind1st</code>和<code>bind2nd</code>函数用于将一个二元算子（binary functor，bf）转换成一元算子（unary functor，uf）。为了达到这个目的，它们需要两个参数：要转换的bf和一个值（v）。</p>
<p>值（v）是一个固定的参数。换言之，uf(x)等价于：</p>
<p>bf( x, v) – 当使用bind2nd时<br>bf( v, x) – 当使用bind1st时<br>bind1st和bind2nd函数在处理谓词时非常有用。它们使得二元谓词能够转换成一元谓词；这常用于将一个范围内的所有值与一个特定的值比较：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt; <span class="keyword">int</span>&gt; a;</div><div class="line"><span class="comment">// ……填充a</span></div><div class="line"><span class="comment">// 移除所有小于30的元素</span></div><div class="line">a.erase( <span class="built_in">std</span>::remove_if( a.begin(), a.end(),</div><div class="line">    <span class="built_in">std</span>::bind2nd( <span class="built_in">std</span>::less&lt; <span class="keyword">int</span>&gt;(), <span class="number">30</span>)), a.end());</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/02/-Boost-在XCode安装Boost/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/02/-Boost-在XCode安装Boost/" itemprop="url">
                  [Boost]在XCode安装Boost
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-02T08:57:50+08:00">
              2014-11-02
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/02/-Boost-在XCode安装Boost/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/02/-Boost-在XCode安装Boost/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/maomi.jpg" rel="gallery_cj0m5l1vh0073jftik7w3vznh"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/maomi.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>##下载Boost库<br>最新的版本可以在<a href="http://www.boost.org/" target="_blank" rel="external">http://www.boost.org/</a>找到，这里我下载的1.56.0版本，<a href="http://jaist.dl.sourceforge.net/project/boost/boost/1.56.0/boost_1_56_0.tar.gz" target="_blank" rel="external">Download</a></p>
<p>##编译Boost.Build<br>修改sh的文件属性<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">chmod +x bootstrap.sh</div></pre></td></tr></table></figure></p>
<p>执行bootstrap.sh<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./bootstrap.sh</div></pre></td></tr></table></figure></p>
<p>##编译Boost库<br>执行b2可执行程序<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">//用Clang编译boost file sytem</div><div class="line">./b2 toolset=clang cxxflags=<span class="string">"-arch x86_64"</span> linkflags=<span class="string">"-arch x86_64"</span> --with-filesystem</div></pre></td></tr></table></figure></p>
<p>最后生成的文件保存在./stage/lib目录</p>
<p>默认编译出来的是Release版本，编译debug版本：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./b2 toolset=clang cxxflags=<span class="string">"-arch x86_64"</span> linkflags=<span class="string">"-arch x86_64"</span> --with-filesystem variant=debug --stagedir=./stage/x64/debug</div></pre></td></tr></table></figure></p>
<p>##设置XCode<br>在 XCode 中，打开项目后 Build settings：<br>在中  Users Headers Search Paths 中添加，例如：/Users/Shared/boost_1_46_1</p>
<p>在Library Search Paths 中添加 /Users/Shared/include</p>
<p>##重新编译<br>重新编译就可以了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/11/01/-LeetCode-Exercise-Day1/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/01/-LeetCode-Exercise-Day1/" itemprop="url">
                  [LeetCode]Exercise(Day1)
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-11-01T15:34:59+08:00">
              2014-11-01
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/01/-LeetCode-Exercise-Day1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/01/-LeetCode-Exercise-Day1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##Remove Duplicates from Sorted Array</p>
<p>###问题描述<br>Given a sorted array, remove the duplicates in place such that each element appear only once and return the new length.<br>Do not allocate extra space for another array, you must do this in place with constant memory.<br>For example, Given input array A = [1,1,2],<br>Your function should return length = 2, and A is now [1,2].</p>
<p>###解决方案<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>* A, <span class="keyword">int</span> n)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</div><div class="line">        <span class="keyword">if</span> (A[index] != A[i]) &#123;</div><div class="line">            A[++index] = A[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> index+<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###扩展阅读<br>在编代码的时候看到了一种实现是<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// LeetCode, Remove Duplicates from Sorted Array </span></div><div class="line"><span class="comment">// 使用 STL,时间复杂度 O(n),空间复杂度 O(1) class Solution &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">      <span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">          <span class="keyword">return</span> removeDuplicates(A, A + n, A) - A;</div><div class="line">        &#125;</div><div class="line">        </div><div class="line">      <span class="keyword">template</span>&lt;<span class="keyword">typename</span> InIt, <span class="keyword">typename</span> OutIt&gt;</div><div class="line">      <span class="function">OutIt <span class="title">removeDuplicates</span><span class="params">(InIt first, InIt last, OutIt output)</span> </span>&#123;</div><div class="line">          <span class="keyword">while</span> (first != last) &#123;</div><div class="line">              *output++ = *first;</div><div class="line">              first = upper_bound(first, last, *first);</div><div class="line">            &#125;</div><div class="line">          <span class="keyword">return</span> output;</div><div class="line">      &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>在XCode上面编译会报错”Use of undeclared identifier ‘upder_bound’”，顺便查了下<code>upper_bound</code>的用法；<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">iterator lower_bound( const key_type &amp;key ): //返回一个迭代器，指向键值&gt;= key的第一个元素。</div><div class="line">iterator upper_bound( const key_type &amp;key )://返回一个迭代器，指向键值&gt; key的第一个元素。</div></pre></td></tr></table></figure></p>
<p>以下是测试用例<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt;mapStudent;</div><div class="line">mapStudent[<span class="number">1</span>]=<span class="string">"student_one"</span>;</div><div class="line">mapStudent[<span class="number">3</span>]=<span class="string">"student_three"</span>;</div><div class="line">mapStudent[<span class="number">5</span>]=<span class="string">"student_five"</span>;</div><div class="line"><span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="built_in">string</span>&gt;::iterator iter;</div><div class="line">iter=mapStudent.lower_bound(<span class="number">2</span>);</div><div class="line">&#123;</div><div class="line">    <span class="comment">//返回的是下界3的迭代器</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;iter-&gt;second&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line">iter=mapStudent.lower_bound(<span class="number">3</span>);</div><div class="line">&#123;</div><div class="line">    <span class="comment">//返回的是下界3的迭代器</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;iter-&gt;second&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line">iter=mapStudent.upper_bound(<span class="number">2</span>);</div><div class="line">&#123;</div><div class="line">    <span class="comment">//返回的是上界3的迭代器</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;iter-&gt;second&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div><div class="line">iter=mapStudent.upper_bound(<span class="number">3</span>);</div><div class="line">&#123;</div><div class="line">    <span class="comment">//返回的是上界5的迭代器</span></div><div class="line">    <span class="built_in">cout</span>&lt;&lt;iter-&gt;second&lt;&lt;<span class="built_in">endl</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">student_three</div><div class="line">student_three</div><div class="line">student_three</div><div class="line">student_five</div></pre></td></tr></table></figure></p>
<p>##Remove Duplicates from Sorted Array II</p>
<p>###问题描述<br>Follow up for ”Remove Duplicates”: What if duplicates are allowed at most twice? For example, Given sorted array A = [1,1,1,2,2,3],<br>Your function should return length = 5, and A is now [1,1,2,2,3]</p>
<p>###解决方案<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// LeetCode, Remove Duplicates from Sorted Array II // 时间复杂度 O(n),空间复杂度 O(1)</span></div><div class="line"><span class="comment">// @author hex108 (https://github.com/hex108) class Solution &#123;</span></div><div class="line">  <span class="keyword">public</span>:</div><div class="line">      <span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n)</span> </span>&#123;</div><div class="line">          <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) <span class="keyword">return</span> n;</div><div class="line">          <span class="keyword">int</span> index = <span class="number">2</span>;</div><div class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; n; i++)&#123;</div><div class="line">              <span class="keyword">if</span> (A[i] != A[index - <span class="number">2</span>])</div><div class="line">                  A[index++] = A[i];</div><div class="line">&#125;</div><div class="line">          <span class="keyword">return</span> index;</div><div class="line">      &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>期间自己写了一个解决方法，太冗长，不好理解，贴出代码，已被以后反省。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> index = <span class="number">0</span>;</div><div class="line"><span class="keyword">int</span> repeatCount = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (A[index] == A[i]) &#123;</div><div class="line">        repeatCount++;</div><div class="line">        <span class="keyword">if</span> (repeatCount &gt; <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            A[++index] = A[i];</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        repeatCount = <span class="number">0</span>;</div><div class="line">        A[++index] = A[i];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> index+<span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<p>##Search in Rotated Sorted Array</p>
<p>###问题描述<br>Suppose a sorted array is rotated at some pivot unknown to you beforehand.<br>(i.e., 0 1 2 4 5 6 7 might become 4 5 6 7 0 1 2).<br>You are given a target value to search. If found in the array return its index, otherwise return -1. You may assume no duplicate exists in the array.</p>
<p>###解决方法<br>解决方法就是努力找到有顺序的一边，然后根据所要查找的数字进行二分查找。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Solution &#123;</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n, <span class="keyword">int</span> target)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">int</span> low = <span class="number">0</span>;</div><div class="line">        <span class="keyword">int</span> high = n - <span class="number">1</span>;</div><div class="line">        <span class="keyword">while</span> (low &lt;= high) &#123;</div><div class="line">            <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (target == A[mid]) &#123;</div><div class="line">                <span class="keyword">return</span> mid;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (A[low] &lt; A[mid])&#123;</div><div class="line">                <span class="keyword">if</span> (A[low] &lt;= target &amp;&amp; target &lt; A[mid]) &#123;</div><div class="line">                    high = mid - <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span>&#123;</div><div class="line">                    low = mid + <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span>&#123;</div><div class="line">                <span class="keyword">if</span> (target &gt; A[mid] &amp;&amp; target &lt;= A[high])                 &#123;</div><div class="line">                    low = mid + <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span>&#123;</div><div class="line">                    high = mid - <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>之前写得另外一段程序，也列出来，以后进行比对，效率和理解性上不及上一个程序。<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> n, <span class="keyword">int</span> target)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> low = <span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> high = n - <span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span> (low &lt;= high) &#123;</div><div class="line">        <span class="keyword">if</span> (A[low] &gt;= A[high]) &#123;</div><div class="line">            <span class="keyword">if</span> (target &gt; A[high] &amp;&amp; target &lt; A[low]) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (target == A[mid]) &#123;</div><div class="line">                <span class="keyword">return</span> mid;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (target &lt; A[mid])&#123;</div><div class="line">                <span class="keyword">if</span> (target &gt;= A[low]) &#123;</div><div class="line">                    high = mid - <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">else</span>&#123;</div><div class="line">                    low = mid + <span class="number">1</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (target &gt; A[mid])&#123;</div><div class="line">                low = mid + <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">int</span> mid = (low + high) / <span class="number">2</span>;</div><div class="line">            <span class="keyword">if</span> (target == A[mid]) &#123;</div><div class="line">                <span class="keyword">return</span> mid;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(target &lt; A[mid])&#123;</div><div class="line">                high = mid - <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span>&#123;</div><div class="line">                low = mid + <span class="number">1</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>##Longest Consecutive Sequence</p>
<p>###问题描述<br>Given an unsorted array of integers, find the length of the longest consecutive elements sequence.<br>For example, Given [100, 4, 200, 1, 3, 2], The longest consecutive elements sequence is [1, 2, 3, 4]. Return its length: 4.<br>Your algorithm should run in O(n) complexity.</p>
<p>###解决方法<br>看到时间复杂度要求O(n)，第一直觉就是要用数据结构来保存相应信息来索引，开始没想出来，后来看了提示，用HashMap来保存相应信息，当时想到的是算hash值以后，在存hash值的时候，再遍历以存储的数值，计算出最大的连续序列。开始方向错掉了，后来看了提示，取到某值，先看齐前面一个值是否存在，然后再更新后面的值，代码如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 100, 4, 200, 1, 3, 2</span></div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestConsecutive</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;num)</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">if</span> (num.size() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">        </div><div class="line">        <span class="keyword">size_t</span> count = num.size();</div><div class="line">        <span class="keyword">int</span> result = <span class="number">0</span>;</div><div class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; lRecords;</div><div class="line">        </div><div class="line">        <span class="comment">// update the map</span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</div><div class="line">            <span class="keyword">int</span> key = num[i];</div><div class="line">            <span class="keyword">int</span> pre = key - <span class="number">1</span>;</div><div class="line">            <span class="keyword">int</span> length = lRecords[pre];</div><div class="line">            lRecords[key] = ++length;</div><div class="line">            </div><div class="line">            <span class="comment">// update next</span></div><div class="line">            <span class="keyword">int</span> next = key + <span class="number">1</span>;</div><div class="line">            <span class="keyword">while</span> (lRecords[next] != <span class="number">0</span>) &#123;</div><div class="line">                lRecords[next] = ++length;</div><div class="line">                next++;</div><div class="line">            &#125;</div><div class="line">            </div><div class="line">            <span class="keyword">if</span> (length &gt; result) &#123;</div><div class="line">                result = length;</div><div class="line">            &#125;</div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>因为这篇里面运用到了Boost的unordered_map,索性就百度了下unorderred_map和map的区别：</p>
<p>###扩展阅读<br><code>boost::unordered_map</code>， 它与 <code>stl::map</code>的区别就是，<code>stl::map</code>是按照operator&lt;比较判断元素是否相同，以及比较元素的大小，然后选择合适的位置插入到树中。所以，如果对map进行遍历（中序遍历）的话，输出的结果是有序的。顺序就是按照operator&lt; 定义的大小排序。</p>
<p>而<code>boost::unordered_map</code>是计算元素的Hash值，根据Hash值判断元素是否相同。所以，对<code>unordered_map</code>进行遍历，结果是无序的。</p>
<p>用法的区别就是，stl::map 的key需要定义operator&lt; 。 而<code>boost::unordered_map</code>需要定义<code>hash_value</code>函数并且重载<code>operator==</code>。对于内置类型，如string，这些都不用操心。对于自定义的类型做key，就需要自己重载operator&lt; 或者<code>hash_value()</code>了。 </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://www.njiang.cn/2014/10/31/KVO和KVC读书笔记（一）/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="姜楠">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/uploads/avatar/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="天空の城">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="天空の城" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/31/KVO和KVC读书笔记（一）/" itemprop="url">
                  KVO和KVC读书笔记（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time title="Post created" itemprop="dateCreated datePublished" datetime="2014-10-31T21:53:19+08:00">
              2014-10-31
            </time>

            &nbsp;|&nbsp;

            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-check-o"></i>
            </span>
            <time title="Post modified" itemprop="dateModified" datetime="2016-12-26T16:40:34+08:00">
              2016-12-26
            </time>
            
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/10/31/KVO和KVC读书笔记（一）/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/10/31/KVO和KVC读书笔记（一）/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          

          
          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      
        <div class="post-gallery" itemscope itemtype="http://schema.org/ImageGallery">
          
          
            <div class="post-gallery-row">
              <a class="post-gallery-img fancybox"
                 href="/uploads/header/meinv.jpg" rel="gallery_cj0m5l1vj0077jftibzm86jgu"
                 itemscope itemtype="http://schema.org/ImageObject" itemprop="url">
                <img src="/uploads/header/meinv.jpg" itemprop="contentUrl"/>
              </a>
            
          

          
          </div>
        </div>
      

      
        
          
            <p>转自：<a href="http://objccn.io/issue-7-3/" target="_blank" rel="external">http://objccn.io/issue-7-3/</a></p>
<p>Key-value coding (KVC) 和 key-value observing (KVO) 是两种能让我们驾驭 Objective-C 动态特性并简化代码的机制。在这篇文章里，我们将接触一些如何利用这些特性的例子。</p>
<p>##观察 model 对象的变化<br>在 Cocoa 的模型-视图-控制器 (Model-view-controller)架构里，控制器负责让视图和模型同步。这一共有两步：当 model 对象改变的时候，视图应该随之改变以反映模型的变化；当用户和控制器交互的时候，模型也应该做出相应的改变。</p>
<p>KVO 能帮助我们让视图和模型保持同步。控制器可以观察视图依赖的属性变化。</p>
<p>让我们看一个例子：我们的模型类 LabColor 代表一种 Lab色彩空间里的颜色。和 RGB 不同，这种色彩空间有三个元素 L, a, b。我们要做一个用来改变这些值的滑块和一个显示颜色的方块区域。</p>
<p>我们的模型类有以下三个用来代表颜色的属性：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">double</span> lComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">double</span> aComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">double</span> bComponent;</div></pre></td></tr></table></figure>
<p>##依赖的属性<br>我们需要从这个类创建一个 UIColor 对象来显示出颜色。我们添加三个额外的属性，分别对应 R, G, B：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="keyword">double</span> redComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="keyword">double</span> greenComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="keyword">double</span> blueComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIColor</span> *color;</div></pre></td></tr></table></figure>
<p>有了这些以后，我们就可以创建这个类的接口了：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">LabColor</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">double</span> lComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">double</span> aComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="keyword">double</span> bComponent;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="keyword">double</span> redComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="keyword">double</span> greenComponent;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">readonly</span>) <span class="keyword">double</span> blueComponent;</div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIColor</span> *color;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p><a href="http://www.baidu.com" target="_blank" rel="external">维基百科</a>提供了转换 RGB 到 Lab 色彩空间的算法。写成方法之后如下所示：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">double</span>)greenComponent;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> D65TristimulusValues[<span class="number">1</span>] * inverseF(<span class="number">1.</span>/<span class="number">116.</span> * (<span class="keyword">self</span>.lComponent + <span class="number">16</span>) + <span class="number">1.</span>/<span class="number">500.</span> * <span class="keyword">self</span>.aComponent);</div><div class="line">&#125;</div><div class="line"></div><div class="line">[...]</div><div class="line"></div><div class="line">- (<span class="built_in">UIColor</span> *)color</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="built_in">UIColor</span> colorWithRed:<span class="keyword">self</span>.redComponent * <span class="number">0.01</span> green:<span class="keyword">self</span>.greenComponent * <span class="number">0.01</span> blue:<span class="keyword">self</span>.blueComponent * <span class="number">0.01</span> alpha:<span class="number">1.</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这些代码没什么令人激动的地方。有趣的是<code>greenComponent</code> 属性依赖于<code>lComponent</code>和<code>aComponent</code>。不论何时设置 <code>lComponent</code>的值，我们需要让 RGB 三个 component 中与其相关的成员以及 color 属性都要得到通知以保持一致。这一点这在 KVO 中很重要。</p>
<p>Foundation 框架提供的表示属性依赖的机制如下：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingValueForKey:(<span class="built_in">NSString</span> *)key</div></pre></td></tr></table></figure>
<p>更详细的如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffecting&lt;键名&gt;</div></pre></td></tr></table></figure></p>
<p>在我们的例子中如下：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingRedComponent</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObject:<span class="string">@"lComponent"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingGreenComponent</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@"lComponent"</span>, <span class="string">@"aComponent"</span>, <span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingBlueComponent</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@"lComponent"</span>, <span class="string">@"bComponent"</span>, <span class="literal">nil</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">+ (<span class="built_in">NSSet</span> *)keyPathsForValuesAffectingColor</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="built_in">NSSet</span> setWithObjects:<span class="string">@"redComponent"</span>, <span class="string">@"greenComponent"</span>, <span class="string">@"blueComponent"</span>, <span class="literal">nil</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>现在我们完整的表达了属性之间的依赖关系。请注意，我们可以把这些属性链接起来。打个比方，如果我们写一个子类去 override <code>redComponent</code> 方法，这些依赖关系仍然能正常工作。</p>
<blockquote>
<p>[Nan]:这个是系统回调函数，在这边提供依赖的关系，SDK会建立依赖关系链；比如color-&gt;redComponent-&gt;lComponent,当lComponent改变时，最终会影响到color。</p>
</blockquote>
<p>##观察变化<br>现在让我们目光转向控制器。<code>NSViewController</code>的子类拥有 LabColor model 对象作为其属性。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) LabColor *labColor;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>我们把视图控制器注册为观察者来接收 KVO 的通知，这可以用以下 NSObject 的方法来实现：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)anObserver</div><div class="line">         forKeyPath:(<span class="built_in">NSString</span> *)keyPath</div><div class="line">            options:(<span class="built_in">NSKeyValueObservingOptions</span>)options</div><div class="line">            context:(<span class="keyword">void</span> *)context</div></pre></td></tr></table></figure>
<p>这会让以下方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath</div><div class="line">                      ofObject:(<span class="keyword">id</span>)object</div><div class="line">                        change:(<span class="built_in">NSDictionary</span> *)change</div><div class="line">                       context:(<span class="keyword">void</span> *)context</div></pre></td></tr></table></figure>
<p>在当 keyPath 的值改变的时候在观察者 anObserver 上面被调用。这个 API 看起来有一点吓人。更糟糕的是，我们还得记得调用以下的方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)removeObserver:(<span class="built_in">NSObject</span> *)anObserver</div><div class="line">            forKeyPath:(<span class="built_in">NSString</span> *)keyPath</div></pre></td></tr></table></figure>
<p>来移除观察者，否则我们我们的 app 会因为某些奇怪的原因崩溃。</p>
<p>对于大多数的应用来说，KVO 可以通过辅助类用一种更简单优雅的方式实现。我们在视图控制器添加以下的观察记号（Observation token）属性：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> colorObserveToken;</div></pre></td></tr></table></figure>
<p>当 labColor 在视图控制器中被设置时，我们只要 override labColor 的 setter 方法就行了：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setLabColor:(LabColor *)labColor</div><div class="line">&#123;</div><div class="line">    _labColor = labColor;</div><div class="line">    <span class="keyword">self</span>.colorObserveToken = [KeyValueObserver observeObject:labColor                                               keyPath:<span class="string">@"color"</span>                                            target:<span class="keyword">self</span>                                          selector:<span class="keyword">@selector</span>(colorDidChange:)                                        options:<span class="built_in">NSKeyValueObservingOptionInitial</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)colorDidChange:(<span class="built_in">NSDictionary</span> *)change;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.colorView.backgroundColor = <span class="keyword">self</span>.labColor.color;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>KeyValueObserver 辅助类 封装了<code>-addObserver:forKeyPath:options:context:，-observeValueForKeyPath:ofObject:change:context:和-removeObserverForKeyPath:</code>的调用，让视图控制器远离杂乱的代码。</p>
<blockquote>
<p>[Nan]:以后可以尝试应用此方法，当需要addObserver/removeObserver的时候，可以定义一个类，专门来控制添加删除的操作。</p>
</blockquote>
<p>##整合到一起<br>视图控制器需要对 L，a，b 的滑块控制做出反应：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">IBAction</span>)updateLComponent:(<span class="built_in">UISlider</span> *)sender;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.labColor.lComponent = sender.value;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">IBAction</span>)updateAComponent:(<span class="built_in">UISlider</span> *)sender;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.labColor.aComponent = sender.value;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">IBAction</span>)updateBComponent:(<span class="built_in">UISlider</span> *)sender;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">self</span>.labColor.bComponent = sender.value;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>所有的代码都在我们的 GitHub <a href="https://github.com/objcio/issue-7-lab-color-space-explorer" target="_blank" rel="external">示例代码</a> 中找到。</p>
<p>##手动通知 vs 自动通知<br>我们刚才所做的事情有点神奇，但是实际上发生的事情是，当 LabColor 实例的 -setLComponent: 等方法被调用的时候以下方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)willChangeValueForKey:(<span class="built_in">NSString</span> *)key</div></pre></td></tr></table></figure>
<p>和：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)didChangeValueForKey:(<span class="built_in">NSString</span> *)key</div></pre></td></tr></table></figure>
<p>会在运行 <code>-setLComponent:</code> 中的代码之前以及之后被自动调用。如果我们写了 -setLComponent: 或者我们选择使用自动 synthesize 的 lComponent 的 accessor 到时候就会发生这样的事情。</p>
<p>有些情况下当我们需要 override -setLComponent: 并且我们要控制是否发送键值改变的通知的时候，我们要做以下的事情：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//此方法关闭了lComponent得自动通知功能</span></div><div class="line">+ (<span class="built_in">BOOL</span>)automaticallyNotifiesObserversForLComponent;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setLComponent:(<span class="keyword">double</span>)lComponent;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (_lComponent == lComponent) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    [<span class="keyword">self</span> willChangeValueForKey:<span class="string">@"lComponent"</span>];</div><div class="line">    _lComponent = lComponent;</div><div class="line">    [<span class="keyword">self</span> didChangeValueForKey:<span class="string">@"lComponent"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们关闭了 <code>-willChangeValueForKey:</code>和 <code>-didChangeValueForKey:</code> 的自动调用，然后我们手动调用他们。我们只应该在关闭了自动调用的时候我们才需要在 setter 方法里手动调用 <code>-willChangeValueForKey:</code>和 <code>-didChangeValueForKey:</code>。大多数情况下，这样优化不会给我们带来太多好处。</p>
<p>如果我们在 accessor 方法之外改变实例对象（如 _lComponent ），我们要特别小心地和刚才一样封装 -willChangeValueForKey: 和 -didChangeValueForKey:。不过在多数情况下，我们只用 accessor 方法的话就可以了，这样代码会简洁很多。</p>
<blockquote>
<p>[Nan]:如果在添加observer的时候用参数<code>NSKeyValueObservingOptionPrior</code>的话，再加上手动发送消息，就会受到2此相同的信息。</p>
</blockquote>
<p>##KVO 和 context<br>有时我们会有理由不想用 KeyValueObserver 辅助类。创建另一个对象会有额外的性能开销。如果我们观察很多个键的话，这个开销可能会变得明显。</p>
<p>如果我们在实现一个类的时候把它自己注册为观察者的话：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)addObserver:(<span class="built_in">NSObject</span> *)anObserver</div><div class="line">         forKeyPath:(<span class="built_in">NSString</span> *)keyPath</div><div class="line">            options:(<span class="built_in">NSKeyValueObservingOptions</span>)options</div><div class="line">            context:(<span class="keyword">void</span> *)context</div></pre></td></tr></table></figure>
<p>一个非常重要的点是我们要传入一个这个类唯一的 <code>context</code>。我们推荐把以下代码</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> <span class="keyword">const</span> PrivateKVOContext;</div></pre></td></tr></table></figure>
<p>写在这个类 .m 文件的顶端，然后我们像这样调用 API 并传入 <code>PrivateKVOContext</code> 的指针：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[otherObject addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@"someKey"</span> options:someOptions context:&amp;PrivateKVOContext];</div></pre></td></tr></table></figure>
<p>然后我们这样写 <code>-observeValueForKeyPath:...</code> 的方法：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath</div><div class="line">                      ofObject:(<span class="keyword">id</span>)object</div><div class="line">                        change:(<span class="built_in">NSDictionary</span> *)change</div><div class="line">                       context:(<span class="keyword">void</span> *)context</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (context == &amp;PrivateKVOContext) &#123;</div><div class="line">        <span class="comment">// 这里写相关的观察代码</span></div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">super</span> observeValueForKeyPath:keyPath ofObject:object change:change context:context];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这将确保我们写的子类都是正确的。如此一来，子类和父类都能安全的观察同样的键值而不会冲突。否则我们将会碰到难以 debug 的奇怪行为。</p>
<p>##进阶 KVO<br>我们常常需要当一个值改变的时候更新 UI，但是我们也要在第一次运行代码的时候更新一次 UI。我们可以用 KVO 并添加<code>NSKeyValueObservingOptionInitial</code>的选项 来一箭双雕地做好这样的事情。这将会让 KVO 通知在调用 <code>-addObserver:forKeyPath:...</code>到时候也被触发。</p>
<p>###之前和之后<br>当我们注册 KVO 通知的时候，我们可以添加 <code>NSKeyValueObservingOptionPrior</code> 选项，这能使我们在键值改变之前被通知。这和<code>-willChangeValueForKey:</code>被触发的时间相对应。</p>
<p>如果我们注册通知的时候附加了 <code>NSKeyValueObservingOptionPrior</code> 选项，我们将会收到两个通知：一个在值变更前，另一个在变更之后。变更前的通知将会在 change 字典中有不同的键。我们可以像以下这样区分通知是在改变之前还是之后被触发的：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> ([change[<span class="built_in">NSKeyValueChangeNotificationIsPriorKey</span>] boolValue]) &#123;</div><div class="line">    <span class="comment">// 改变之前</span></div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    <span class="comment">// 改变之后</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###值<br>如果我们需要改变前后的值，我们可以在 KVO 选项中加入 <code>NSKeyValueObservingOptionNew</code>和/或 <code>NSKeyValueObservingOptionOld</code>。</p>
<p>更简单的办法是用 <code>NSKeyValueObservingOptionPrior</code> 选项，随后我们就可以用以下方式提取出改变前后的值：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">id</span> oldValue = change[<span class="built_in">NSKeyValueChangeOldKey</span>];</div><div class="line"><span class="keyword">id</span> newValue = change[<span class="built_in">NSKeyValueChangeNewKey</span>];</div></pre></td></tr></table></figure>
<p>通常来说 KVO 会在<code>-willChangeValueForKey:</code> 和 <code>-didChangeValueForKey:</code> 被调用的时候存储相应键的值。</p>
<p>##索引<br>KVO 对一些集合类也有很强的支持，以下方法会返回集合对象：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">-mutableArrayValueForKey:</div><div class="line">-mutableSetValueForKey:</div><div class="line">-mutableOrderedSetValueForKey:</div></pre></td></tr></table></figure></p>
<p>我们将会详细解释这是怎么工作的。如果你使用这些方法，change 字典里会包含键值变化的类型（添加、删除和替换）。对于有序的集合，change 字典会包含受影响的 index。</p>
<p>集合代理对象和变化的通知在用于更新UI的时候非常有效，尤其是处理大集合的时候。但是它们需要花费你一些心思。</p>
<p>##KVO 和线程<br>一个需要注意的地方是，KVO 行为是同步的，并且发生与所观察的值发生变化的同样的线程上。没有队列或者 Run-loop 的处理。手动或者自动调用 -didChange… 会触发 KVO 通知。</p>
<p>所以，当我们试图从其他线程改变属性值的时候我们应当十分小心，除非能确定所有的观察者都用线程安全的方法处理 KVO 通知。通常来说，我们不推荐把 KVO 和多线程混起来。如果我们要用多个队列和线程，我们不应该在它们互相之间用 KVO。</p>
<p>KVO 是同步运行的这个特性非常强大，只要我们在单一线程上面运行（比如主队列 main queue），KVO 会保证下列两种情况的发生：</p>
<p>首先，如果我们调用一个支持 KVO 的 setter 方法，如下所示：</p>
<p>self.exchangeRate = 2.345;<br>KVO 能保证所有 exchangeRate 的观察者在 setter 方法返回前被通知到。</p>
<p>其次，如果某个键被观察的时候附上了 NSKeyValueObservingOptionPrior 选项，直到 -observe… 被调用之前， exchangeRate 的 accessor 方法都会返回同样的值。</p>
<p>KVC<br>最简单的 KVC 能让我们通过以下的形式访问属性：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div></pre></td></tr></table></figure></p>
<p>取值：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *n = [object valueForKey:<span class="string">@"name"</span>]</div></pre></td></tr></table></figure></p>
<p>设定：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[object setValue:<span class="string">@"Daniel"</span> forKey:<span class="string">@"name"</span>]</div></pre></td></tr></table></figure></p>
<p>值得注意的是这个不仅可以访问作为对象属性，而且也能访问一些标量（例如 int 和 CGFloat）和 struct（例如 CGRect）。Foundation 框架会为我们自动封装它们。举例来说，如果有以下属性：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>) <span class="built_in">CGFloat</span> height;</div></pre></td></tr></table></figure></p>
<p>我们可以这样设置它：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[object setValue:@(<span class="number">20</span>) forKey:<span class="string">@"height"</span>]</div></pre></td></tr></table></figure></p>
<p>KVC 允许我们用属性的字符串名称来访问属性，字符串在这儿叫做键。有些情况下，这会使我们非常灵活地简化代码。我们下一节介绍例子简化列表 UI。</p>
<p>KVC 还有更多可以谈的。集合（NSArray，NSSet 等）结合 KVC 可以拥有一些强大的集合操作。还有，对象可以支持用 KVC 通过代理对象访问非常规的属性。</p>
<p>##简化列表 UI<br>假设我们有这样一个对象：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Contact</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *name;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *nickname;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *email;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">copy</span>) <span class="built_in">NSString</span> *city;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>还有一个 detail 视图控制器，含有四个对应的 UITextField 属性：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">DetailViewController</span> ()</span></div><div class="line"></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nameField;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *nicknameField;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *emailField;</div><div class="line"><span class="keyword">@property</span> (<span class="keyword">weak</span>, <span class="keyword">nonatomic</span>) <span class="keyword">IBOutlet</span> <span class="built_in">UITextField</span> *cityField;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>我们可以简化更新 UI 的逻辑。首先我们需要两个方法：一个返回 model 里我们用到的所有键的方法，一个把键映射到对应的文本框的方法：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSArray</span> *)contactStringKeys;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> @[<span class="string">@"name"</span>, <span class="string">@"nickname"</span>, <span class="string">@"email"</span>, <span class="string">@"city"</span>];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">UITextField</span> *)textFieldForModelKey:(<span class="built_in">NSString</span> *)key;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> valueForKey:[key stringByAppendingString:<span class="string">@"Field"</span>]];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有了这个，我们可以从 model 里更新文本框，如下所示：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)updateTextFields;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> <span class="keyword">self</span>.contactStringKeys) &#123;</div><div class="line">        [<span class="keyword">self</span> textFieldForModelKey:key].text = [<span class="keyword">self</span>.contact valueForKey:key];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们也可以用一个 action 方法让四个文本框都能实时更新 model：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">IBAction</span>)fieldEditingDidEnd:(<span class="built_in">UITextField</span> *)sender</div><div class="line">&#123;</div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *key <span class="keyword">in</span> <span class="keyword">self</span>.contactStringKeys) &#123;</div><div class="line">        <span class="built_in">UITextField</span> *field = [<span class="keyword">self</span> textFieldForModelKey:key];</div><div class="line">        <span class="keyword">if</span> (field == sender) &#123;</div><div class="line">            [<span class="keyword">self</span>.contact setValue:sender.text forKey:key];</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意：我们之后会添加验证输入的部分，在键值验证里会提到。</p>
<p>最后，我们需要确认文本框在需要的时候被更新：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)viewWillAppear:(<span class="built_in">BOOL</span>)animated;</div><div class="line">&#123;</div><div class="line">    [<span class="keyword">super</span> viewWillAppear:animated];</div><div class="line">    [<span class="keyword">self</span> updateTextFields];</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)setContact:(Contact *)contact</div><div class="line">&#123;</div><div class="line">    _contact = contact;</div><div class="line">    [<span class="keyword">self</span> updateTextFields];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>有了这个，我们的 detail 视图控制器 就能正常工作了。</p>
<p>整个项目可以在 <a href="https://github.com/objcio/issue-7-contact-editor" target="_blank" rel="external">GitHub</a> 上找到。它也用了我们后面提到的键值验证。</p>
<p>###键路径（Key Path）<br>KVC 同样允许我们通过关系来访问对象。假设 person 对象有属性 address，address 有属性 city，我们可以这样通过 person 来访问 city：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[person valueForKeyPath:<span class="string">@"address.city"</span>]</div></pre></td></tr></table></figure></p>
<p>值得注意的是这里我们调用 <code>-valueForKeyPath:</code> 而不是 <code>-valueForKey:</code>。</p>
<p>##Key-Value Coding Without @property<br>不需要 @property 的 KVC<br>我们可以实现一个支持 KVC 而不用 @property 和 @synthesize 或是自动 synthesize 的属性。最直接的方式是添加 -<key> 和 -set<key>: 方法。例如我们想要 name ，我们这样做：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSString</span> *)name;</div><div class="line">- (<span class="keyword">void</span>)setName:(<span class="built_in">NSString</span> *)name;</div></pre></td></tr></table></figure></key></key></p>
<p>这完全等于 @property 的实现方式。</p>
<p>但是当标量和 struct 的值被传入 nil 的时候尤其需要注意。假设我们要 height 属性支持 KVC 我们写了以下的方法：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGFloat</span>)height;</div><div class="line">- (<span class="keyword">void</span>)setHeight:(<span class="built_in">CGFloat</span>)height;</div></pre></td></tr></table></figure></p>
<p>然后我们这样调用：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[object setValue:<span class="literal">nil</span> forKey:<span class="string">@"height"</span>]</div></pre></td></tr></table></figure></p>
<p>这会抛出一个 exception。要正确的处理 nil，我们要像这样 override <code>-setNilValueForKey:</code><br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setNilValueForKey:(<span class="built_in">NSString</span> *)key</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> ([key isEqualToString:<span class="string">@"height"</span>]) &#123;</div><div class="line">        [<span class="keyword">self</span> setValue:@<span class="number">0</span> forKey:key];</div><div class="line">    &#125; <span class="keyword">else</span></div><div class="line">        [<span class="keyword">super</span> setNilValueForKey:key];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们可以通过 override 这些方法来让一个类支持 KVC：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">id</span>)valueForUndefinedKey:(<span class="built_in">NSString</span> *)key;</div><div class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key;</div></pre></td></tr></table></figure></p>
<p>这也许看起来很怪，但这可以让一个类动态的支持一些键的访问。但是这两个方法会在性能上拖后腿。</p>
<p>附注：Foundation 框架支持直接访问实例变量。请小心的使用这个特性。你可以去查看 +accessInstanceVariablesDirectly 的文档。这个值默认是 YES 的时候，Foundation 会按照 _<key>, _is<key>, <key> 和 is<key> 的顺序查找实例变量。</key></key></key></key></p>
<p>###集合的操作<br>一个常常被忽视的 KVC 特性是它对集合操作的支持。举个例子，我们可以这样来获得一个数组中最大的值：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *a = @[@<span class="number">4</span>, @<span class="number">84</span>, @<span class="number">2</span>];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"max = %@"</span>, [a valueForKeyPath:<span class="string">@"@max.self"</span>]);</div></pre></td></tr></table></figure></p>
<p>或者说，我们有一个 Transaction 对象的数组，对象有属性 amount 的话，我们可以这样获得最大的 amount：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSArray</span> *a = @[transaction1, transaction2, transaction3];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"max = %@"</span>, [a valueForKeyPath:<span class="string">@"@max.amount"</span>]);</div></pre></td></tr></table></figure></p>
<p>当我们调用<code>[a valueForKeyPath:@&quot;@max.amount&quot;]</code> 的时候，它会在数组 a 的每个元素中调用 <code>-valueForKey:@&quot;amount&quot;</code>然后返回最大的那个。</p>
<p>KVC 的苹果官方文档有一个章节 Collection Operators 详细的讲述了类似的用法。</p>
<p>通过集合代理对象来实现 KVC<br>虽然我们可以像对待一般的对象一样用 KVC 深入集合内部（NSArray 和 NSSet 等），但是通过集合代理对象， KVC 也让我们实现一个兼容 KVC 的集合。这是一个颇为高端的技巧。</p>
<p>当我们在对象上调用 -valueForKey: 的时候，它可以返回 NSArray，NSSet 或是 NSOrderedSet 的集合代理对象。这个类没有实现通常的 -<key> 方法，但是它实现了代理对象所需要使用的很多方法。</key></p>
<p>如果我们希望一个类支持通过代理对象的 contacts 键返回一个 NSArray，我们可以这样写：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSUInteger</span>)countOfContacts;</div><div class="line">- (<span class="keyword">id</span>)objectInContactsAtIndex:(<span class="built_in">NSUInteger</span>)idx;</div></pre></td></tr></table></figure></p>
<p>这样做的话，当我们调用 [object valueForKey:@”contacts”] 的时候，它会返回一个由这两个方法来代理所有调用方法的 NSArray 对象。这个数组支持所有正常的对 NSArray 的调用。换句话说，调用者并不知道返回的是一个真正的 NSArray， 还是一个代理的数组。</p>
<p>对于 NSSet 和 NSOrderedSet，如果要做同样的事情，我们需要实现的方法是：</p>
<table>
<thead>
<tr>
<th>NSArray</th>
<th>NSSet</th>
<th>NSOrderedSet   </th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-countOf&lt;Key&gt;</code></td>
<td><code>-countOf&lt;Key&gt;</code></td>
<td><code>-countOf&lt;Key&gt;</code></td>
</tr>
<tr>
<td>-</td>
<td><code>-enumeratorOf&lt;Key&gt;</code></td>
<td><code>-indexIn&lt;Key&gt;OfObject:</code></td>
</tr>
<tr>
<td> -</td>
<td><code>-memberOf&lt;Key&gt;:</code></td>
<td>-</td>
</tr>
<tr>
<td>以下两者二选一</td>
<td>-</td>
<td>以下两者二选一</td>
</tr>
<tr>
<td><code>-objectIn&lt;Key&gt;AtIndex:</code></td>
<td>-</td>
<td><code>-objectIn&lt;Key&gt;AtIndex:</code></td>
</tr>
<tr>
<td><code>-&lt;key&gt;AtIndexes:</code></td>
<td>-</td>
<td><code>-&lt;key&gt;AtIndexes:</code>     </td>
</tr>
<tr>
<td>可选（增强性能）</td>
<td>-</td>
<td>可选（增强性能）</td>
</tr>
<tr>
<td><code>-get&lt;Key&gt;:range:</code></td>
<td>-</td>
<td><code>-get&lt;Key&gt;:range:</code></td>
</tr>
</tbody>
</table>
<p>可选 的一些方法可以增强代理对象的性能。</p>
<p>虽然只有特殊情况下我们用这些代理对象才会有意义，但是在这些情况下代理对象非常的有用。想象一下我们有一个很大的数据结构，调用者不需要（一次性）访问所有的对象。</p>
<p>举一个（也许比较做作的）例子说，我们想写一个包含有很长一串质数的类。如下所示：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Primes</span> : <span class="title">NSObject</span></span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">readonly</span>, <span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSArray</span> *primes;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Primes</span></span></div><div class="line"></div><div class="line"><span class="keyword">static</span> int32_t <span class="keyword">const</span> primes[] = &#123;</div><div class="line">    <span class="number">2</span>, <span class="number">101</span>, <span class="number">233</span>, <span class="number">383</span>, <span class="number">3</span>, <span class="number">103</span>, <span class="number">239</span>, <span class="number">389</span>, <span class="number">5</span>, <span class="number">107</span>, <span class="number">241</span>, <span class="number">397</span>, <span class="number">7</span>, <span class="number">109</span>,</div><div class="line">    <span class="number">251</span>, <span class="number">401</span>, <span class="number">11</span>, <span class="number">113</span>, <span class="number">257</span>, <span class="number">409</span>, <span class="number">13</span>, <span class="number">127</span>, <span class="number">263</span>, <span class="number">419</span>, <span class="number">17</span>, <span class="number">131</span>, <span class="number">269</span>,</div><div class="line">    <span class="number">421</span>, <span class="number">19</span>, <span class="number">137</span>, <span class="number">271</span>, <span class="number">431</span>, <span class="number">23</span>, <span class="number">139</span>, <span class="number">277</span>, <span class="number">433</span>, <span class="number">29</span>, <span class="number">149</span>, <span class="number">281</span>, <span class="number">439</span>,</div><div class="line">    <span class="number">31</span>, <span class="number">151</span>, <span class="number">283</span>, <span class="number">443</span>, <span class="number">37</span>, <span class="number">157</span>, <span class="number">293</span>, <span class="number">449</span>, <span class="number">41</span>, <span class="number">163</span>, <span class="number">307</span>, <span class="number">457</span>, <span class="number">43</span>,</div><div class="line">    <span class="number">167</span>, <span class="number">311</span>, <span class="number">461</span>, <span class="number">47</span>, <span class="number">173</span>, <span class="number">313</span>, <span class="number">463</span>, <span class="number">53</span>, <span class="number">179</span>, <span class="number">317</span>, <span class="number">467</span>, <span class="number">59</span>, <span class="number">181</span>,</div><div class="line">    <span class="number">331</span>, <span class="number">479</span>, <span class="number">61</span>, <span class="number">191</span>, <span class="number">337</span>, <span class="number">487</span>, <span class="number">67</span>, <span class="number">193</span>, <span class="number">347</span>, <span class="number">491</span>, <span class="number">71</span>, <span class="number">197</span>, <span class="number">349</span>,</div><div class="line">    <span class="number">499</span>, <span class="number">73</span>, <span class="number">199</span>, <span class="number">353</span>, <span class="number">503</span>, <span class="number">79</span>, <span class="number">211</span>, <span class="number">359</span>, <span class="number">509</span>, <span class="number">83</span>, <span class="number">223</span>, <span class="number">367</span>, <span class="number">521</span>,</div><div class="line">    <span class="number">89</span>, <span class="number">227</span>, <span class="number">373</span>, <span class="number">523</span>, <span class="number">97</span>, <span class="number">229</span>, <span class="number">379</span>, <span class="number">541</span>, <span class="number">547</span>, <span class="number">701</span>, <span class="number">877</span>, <span class="number">1049</span>,</div><div class="line">    <span class="number">557</span>, <span class="number">709</span>, <span class="number">881</span>, <span class="number">1051</span>, <span class="number">563</span>, <span class="number">719</span>, <span class="number">883</span>, <span class="number">1061</span>, <span class="number">569</span>, <span class="number">727</span>, <span class="number">887</span>,</div><div class="line">    <span class="number">1063</span>, <span class="number">571</span>, <span class="number">733</span>, <span class="number">907</span>, <span class="number">1069</span>, <span class="number">577</span>, <span class="number">739</span>, <span class="number">911</span>, <span class="number">1087</span>, <span class="number">587</span>, <span class="number">743</span>,</div><div class="line">    <span class="number">919</span>, <span class="number">1091</span>, <span class="number">593</span>, <span class="number">751</span>, <span class="number">929</span>, <span class="number">1093</span>, <span class="number">599</span>, <span class="number">757</span>, <span class="number">937</span>, <span class="number">1097</span>, <span class="number">601</span>,</div><div class="line">    <span class="number">761</span>, <span class="number">941</span>, <span class="number">1103</span>, <span class="number">607</span>, <span class="number">769</span>, <span class="number">947</span>, <span class="number">1109</span>, <span class="number">613</span>, <span class="number">773</span>, <span class="number">953</span>, <span class="number">1117</span>,</div><div class="line">    <span class="number">617</span>, <span class="number">787</span>, <span class="number">967</span>, <span class="number">1123</span>, <span class="number">619</span>, <span class="number">797</span>, <span class="number">971</span>, <span class="number">1129</span>, <span class="number">631</span>, <span class="number">809</span>, <span class="number">977</span>,</div><div class="line">    <span class="number">1151</span>, <span class="number">641</span>, <span class="number">811</span>, <span class="number">983</span>, <span class="number">1153</span>, <span class="number">643</span>, <span class="number">821</span>, <span class="number">991</span>, <span class="number">1163</span>, <span class="number">647</span>, <span class="number">823</span>,</div><div class="line">    <span class="number">997</span>, <span class="number">1171</span>, <span class="number">653</span>, <span class="number">827</span>, <span class="number">1009</span>, <span class="number">1181</span>, <span class="number">659</span>, <span class="number">829</span>, <span class="number">1013</span>, <span class="number">1187</span>, <span class="number">661</span>,</div><div class="line">    <span class="number">839</span>, <span class="number">1019</span>, <span class="number">1193</span>, <span class="number">673</span>, <span class="number">853</span>, <span class="number">1021</span>, <span class="number">1201</span>, <span class="number">677</span>, <span class="number">857</span>, <span class="number">1031</span>,</div><div class="line">    <span class="number">1213</span>, <span class="number">683</span>, <span class="number">859</span>, <span class="number">1033</span>, <span class="number">1217</span>, <span class="number">691</span>, <span class="number">863</span>, <span class="number">1039</span>, <span class="number">1223</span>, <span class="number">1229</span>,</div><div class="line">&#125;;</div><div class="line"></div><div class="line">- (<span class="built_in">NSUInteger</span>)countOfPrimes;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> (<span class="keyword">sizeof</span>(primes) / <span class="keyword">sizeof</span>(*primes));</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">id</span>)objectInPrimesAtIndex:(<span class="built_in">NSUInteger</span>)idx;</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSParameterAssert</span>(idx &lt; <span class="keyword">sizeof</span>(primes) / <span class="keyword">sizeof</span>(*primes));</div><div class="line">    <span class="keyword">return</span> @(primes[idx]);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>我们将会运行以下代码：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Primes *primes = [[Primes alloc] init];</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"The last prime is %@"</span>, [primes.primes lastObject]);</div></pre></td></tr></table></figure></p>
<p>这将会调用一次 <code>-countOfPrimes</code>和一次传入参数 idx 作为最后一个索引的 <code>-objectInPrimesAtIndex:</code>。为了只取出最后一个值，它不需要先把所有的数封装成 NSNumber 然后把它们都导入 NSArray。</p>
<p>在一个复杂一点的例子中，通讯录编辑器示例 app 用同样的方法把 C++ std::vector 封装以来。它详细说明了应该怎么利用这个方法。</p>
<p>###可变的集合<br>我们也可以在可变集合（例如 <code>NSMutableArray</code>，<code>NSMutableSet</code>，和 <code>NSMutableOrderedSet</code>）中用集合代理。</p>
<p>访问这些可变的集合有一点点不同。调用者在这儿需要调用以下其中一个方法：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSMutableArray</span> *)mutableArrayValueForKey:(<span class="built_in">NSString</span> *)key;</div><div class="line">- (<span class="built_in">NSMutableSet</span> *)mutableSetValueForKey:(<span class="built_in">NSString</span> *)key;</div><div class="line">- (<span class="built_in">NSMutableOrderedSet</span> *)mutableOrderedSetValueForKey:(<span class="built_in">NSString</span> *)key;</div></pre></td></tr></table></figure></p>
<p>一个窍门：我们可以让一个类用以下方法返回可变集合的代理：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">NSMutableArray</span> *)mutableContacts;</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> mutableArrayValueForKey:<span class="string">@"wrappedContacts"</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在实现键 wrappedContacts 的一些方法。</p>
<p>我们需要实现上面的不变集合的两个方法，还有以下的几个：</p>
<table>
<thead>
<tr>
<th>NSMutableArray / NSMutableOrderedSet</th>
<th>NSMutableSet    </th>
</tr>
</thead>
<tbody>
<tr>
<td>至少实现一个插入方法和一个删除方法</td>
<td>至少实现一个插入方法和一个删除方法</td>
</tr>
<tr>
<td><code>-insertObject:in&lt;Key&gt;AtIndex:</code></td>
<td><code>-add&lt;Key&gt;Object:</code></td>
</tr>
<tr>
<td><code>-removeObjectFrom&lt;Key&gt;AtIndex:</code></td>
<td><code>-remove&lt;Key&gt;Object:</code></td>
</tr>
<tr>
<td><code>-insert&lt;Key&gt;:atIndexes:</code></td>
<td><code>-add&lt;Key&gt;:</code></td>
</tr>
<tr>
<td><code>-remove&lt;Key&gt;AtIndexes:</code></td>
<td><code>-remove&lt;Key&gt;:</code></td>
</tr>
<tr>
<td>可选（增强性能）以下方法二选一</td>
<td>可选（增强性能）</td>
</tr>
<tr>
<td><code>-replaceObjectIn&lt;Key&gt;AtIndex:withObject:</code></td>
<td><code>-intersect&lt;Key&gt;:</code></td>
</tr>
<tr>
<td><code>-replace&lt;Key&gt;AtIndexes:with&lt;Key&gt;:</code></td>
<td><code>-set&lt;Key&gt;:</code></td>
</tr>
</tbody>
</table>
<p>上面提到，这些可变集合代理对象和 KVO 结合起来也十分强大。KVO 机制能在这些集合改变的时候把详细的变化放进 change 字典中。</p>
<p>有批量更新（需要传入多个对象）的方法，也有只改变一个对象的方法。我们推荐选择相对于给定任务来说最容易实现的那个来写，虽然我们有一点点倾向于选择批量更新的那个。</p>
<p>在实现这些方法的时候，我们要对自动和手动的 KVO 之间的差别十分小心。Foundation 默认自动发出十分详尽的变化通知。如果我们要手动实现发送详细通知的话，我们得实现这些：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-willChange:valuesAtIndexes:forKey:</div><div class="line">-didChange:valuesAtIndexes:forKey:</div></pre></td></tr></table></figure></p>
<p>或者这些：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-willChangeValueForKey:withSetMutation:usingObjects:</div><div class="line">-didChangeValueForKey:withSetMutation:usingObjects:</div></pre></td></tr></table></figure></p>
<p>我们要保证先把自动通知关闭，否则每次改变 KVO 都会发出两次通知。</p>
<p>##常见的 KVO 错误<br>首先，KVO 兼容是 API的一部分。如果类的所有者不保证某个属性兼容 KVO，我们就不能保证 KVO 正常工作。苹果文档里有 KVO 兼容属性的文档。例如，NSProgress 类的大多数属性都是兼容 KVO 的。</p>
<p>当做出改变以后，有些人试着放空的 -willChange 和 -didChange 方法来强制 KVO 的触发。KVO 通知虽然会生效，但是这样做破坏了有依赖于 NSKeyValueObservingOld 选项的观察者。详细来说，这影响了 KVO 对观察键路径 (key path) 的原生支持。KVO 在观察键路径 (key path) 时依赖于 NSKeyValueObservingOld 属性。</p>
<p>我们也要指出有些集合是不能被观察的。KVO 旨在观察关系 (relationship) 而不是集合。我们不能观察 NSArray，我们只能观察一个对象的属性——而这个属性有可能是 NSArray。举例说，如果我们有一个 ContactList 对象，我们可以观察它的 contacts 属性。但是我们不能向要观察对象的 -addObserver:forKeyPath:… 传入一个 NSArray。</p>
<p>相似地，观察 self 不是永远都生效的。而且这不是一个好的设计。</p>
<p>##调试 KVO<br>你可以在 lldb 里查看一个被观察对象的所有观察信息。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) po [observedObject observationInfo]</div></pre></td></tr></table></figure></p>
<p>这会打印出有关谁观察谁之类的很多信息。</p>
<p>这个信息的格式不是公开的，我们不能让任何东西依赖它，因为苹果随时都可以改变它。不过这是一个很强大的排错工具。</p>
<p>##键值验证 (KVV)<br>最后提示，KVV 也是 KVC API 的一部分。这是一个用来验证属性值的 API，只是它光靠自己很难提供逻辑和功能。</p>
<p>如果我们写能够验证值的 model 类的话，我们就应该实现 KVV 的 API 来保证一致性。用 KVV 验证 model 类的值是 Cocoa 的惯例。</p>
<p>让我们在一次强调一下：KVC 不会做任何的验证，也不会调用任何 KVV 的方法。那是你的控制器需要做的事情。通过 KVV 实现你自己的验证方法会保证它们的一致性。</p>
<p>以下是一个简单的例子：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">IBAction</span>)nameFieldEditingDidEnd:(<span class="built_in">UITextField</span> *)sender;</div><div class="line">&#123;</div><div class="line">    <span class="built_in">NSString</span> *name = [sender text];</div><div class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</div><div class="line">    <span class="keyword">if</span> ([<span class="keyword">self</span>.contact validateName:&amp;name error:&amp;error]) &#123;</div><div class="line">        <span class="keyword">self</span>.contact.name = name;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="comment">// Present the error to the user</span></div><div class="line">    &#125;</div><div class="line">    sender.text = <span class="keyword">self</span>.contact.name;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>它强大之处在于，当 model 类（Contact）验证 name 的时候，会有机会去处理名字。</p>
<p>如果我们想让名字不要有前后的空白字符，我们应该把这些逻辑放在 model 对象里面。Contact 类可以像这样实现 KVV：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)validateName:(<span class="built_in">NSString</span> **)nameP error:(<span class="built_in">NSError</span> * __autoreleasing *)error</div><div class="line">&#123;</div><div class="line">    <span class="keyword">if</span> (*nameP == <span class="literal">nil</span>) &#123;</div><div class="line">        *nameP = <span class="string">@""</span>;</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        *nameP = [*nameP stringByTrimmingCharactersInSet:[<span class="built_in">NSCharacterSet</span> whitespaceAndNewlineCharacterSet]];</div><div class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通讯录示例 里的 <code>DetailViewController</code> 和 Contact 类详解了这个用法。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar/avatar.jpg"
               alt="姜楠" />
          <p class="site-author-name" itemprop="name">姜楠</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">118</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/njiang1987" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">姜楠</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"njiang"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  

  


</body>
</html>
